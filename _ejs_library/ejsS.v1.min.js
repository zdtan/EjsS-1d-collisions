var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.AnalyticCurve={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setNumPoints(e.getNumPoints()),t.setMinimun(e.getMinimun()),t.setMaximun(e.getMaximun()),t.setVariable(e.getVariable()),t.setFunctionX(e.getFunctionX()),t.setFunctionY(e.getFunctionY())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("NumPoints",e.setNumPoints,e.getNumPoints),t.registerProperty("Minimum",e.setMinimun,e.getMinimun),t.registerProperty("Maximum",e.setMaximun,e.getMaximun),t.registerProperty("Variable",e.setVariable,e.getVariable),t.registerProperty("FunctionX",e.setFunctionX,e.getFunctionX),t.registerProperty("FunctionY",e.setFunctionY,e.getFunctionY),t.registerAction("OnError")}},EJSS_DRAWING2D.analyticCurve=function(e){var t,r,n=EJSS_DRAWING2D.element(e),i="t",o="t",a="0",s={},l=5*screen.width;return n.getClass=function(){return"ElementAnalyticCurve"},n.setParameters=function(e){for(var t in e)s[t]=e[t];n.setChanged(!0)},n.getParameters=function(){return s},n.getBounds=function(e){var u,g,c=n.getX(),S=n.getY(),f=n.getSizeX(),E=n.getSizeY(),d=f/2,p=E/2,h=n.getRelativePositionOffset(f,E),m=EJSS_DRAWING2D.functionsParser(),A=!1;try{u=m.parse(o)}catch(e){console.log("Analytic curve error parsing FunctionX: "+o),A=!0}if(!A)try{g=m.parse(a)}catch(e){console.log("Analytic curve error parsing FunctionY: "+a),A=!0}if(A)return n.getController().invokeAction("OnError"),{left:c+h[0]-d-f,right:c+h[0]-d+f,top:S+h[1]-p+E,bottom:S+h[1]-p-E};var _=null==t?n.getPanel().getRealWorldXMin():t,D=null==r?n.getPanel().getRealWorldXMax():r,I=(D-_)/l,P=[],C={};for(var T in s)C[T]=s[T];try{for(var y=0,R=_;R<D;R+=I){C[i]=R;var N=u.evaluate(C),v=g.evaluate(C);isNaN(N)||isNaN(v)||(P[y]=[],P[y][0]=N,P[y++][1]=v)}}catch(e){return n.getController().invokeAction("OnError"),{left:c+h[0]-d-f,right:c+h[0]-d+f,top:S+h[1]-p+E,bottom:S+h[1]-p-E}}var O=0,M=0,b=0,G=0;if(P.length>0){O=P[0][0],b=P[0][0],M=P[0][1],G=P[0][1];for(var L=0;L<P.length;L++)P[L][0]>O&&(O=P[L][0]),P[L][0]<b&&(b=P[L][0]),P[L][1]>M&&(M=P[L][1]),P[L][1]<G&&(G=P[L][1])}return{left:c+h[0]-d+b*f,right:c+h[0]-d+O*f,top:S+h[1]-p+M*E,bottom:S+h[1]-p+G*E}},n.setNumPoints=function(e){l!=e&&(l=e,n.setChanged(!0))},n.getNumPoints=function(){return l},n.setMinimun=function(e){t!=e&&(t=e,n.setChanged(!0))},n.getMinimun=function(){return t},n.setMaximun=function(e){r!=e&&(r=e,n.setChanged(!0))},n.getMaximun=function(){return r},n.setVariable=function(e){i!=e&&(i=e,n.setChanged(!0))},n.getVariable=function(){return i},n.setFunctionX=function(e){o!=e&&(o=e,n.setChanged(!0))},n.getFunctionX=function(){return o},n.setFunctionY=function(e){a!=e&&(a=e,n.setChanged(!0))},n.getFunctionY=function(){return a},n.registerProperties=function(e){EJSS_DRAWING2D.AnalyticCurve.registerProperties(n,e)},n.setSize([1,1]),n.setRelativePosition("SOUTH_WEST"),n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Arrow={NONE:0,ANGLE:1,CIRCLE:2,RECTANGLE:3,LINE:4,CURVE:5,TRIANGLE:6,DIAMOND:7,WEDGE:8,POINTED:9,INVANGLE:10,INVTRIANGLE:11,SPLINE_NONE:0,SPLINE_CUBIC:1,SPLINE_QUADRATIC:2,SPLINE_CUBIC_WITH_MIDDLE_POINT:3,SPLINE_QUADRATIC_WITH_MIDDLE_POINT:4,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setRelativePosition(e.getRelativePosition()),t.setMarkEnd(e.getMarkEnd()),t.setMarkEndWidth(e.getMarkEndWidth()),t.setMarkEndHeight(e.getMarkEndHeight()),t.setMarkEndColor(e.getMarkEndColor()),t.setMarkEndStroke(e.getMarkEndStroke()),t.setMarkEndOrient(e.getMarkEndOrient()),t.setMarkStart(e.getMarkStart()),t.setMarkStartWidth(e.getMarkStartWidth()),t.setMarkStartHeight(e.getMarkStartHeight()),t.setMarkStartColor(e.getMarkStartColor()),t.setMarkStartStroke(e.getMarkStartStroke()),t.setMarkStartOrient(e.getMarkStartOrient()),t.setMarkMiddle(e.getMarkMiddle()),t.setMarkMiddleWidth(e.getMarkMiddleWidth()),t.setMarkMiddleHeight(e.getMarkMiddleHeight()),t.setMarkMiddleColor(e.getMarkMiddleColor()),t.setMarkMiddleColorSnd(e.getMarkMiddleColorSnd()),t.setMarkMiddleStroke(e.getMarkMiddleStroke()),t.setMarkMiddleOrient(e.getMarkMiddleOrient()),t.setMarkProportion(e.getMarkProportion()),t.setSplineType(e.getSplineType())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("SplineType",e.setSplineType),t.registerProperty("InteractionPosition",e.setInteractionPosition),t.registerProperty("Offset",e.setRelativePosition,e.getRelativePosition),t.registerProperty("MarkEnd",e.setMarkEnd),t.registerProperty("MarkEndWidth",e.setMarkEndWidth),t.registerProperty("MarkEndHeight",e.setMarkEndHeight),t.registerProperty("MarkEndDiameter",e.setMarkEndDiameter),t.registerProperty("MarkEndColor",e.setMarkEndColor),t.registerProperty("MarkEndStroke",e.setMarkEndStroke),t.registerProperty("MarkEndOrient",e.setMarkEndOrient),t.registerProperty("MarkStart",e.setMarkStart),t.registerProperty("MarkStartWidth",e.setMarkStartWidth),t.registerProperty("MarkStartHeight",e.setMarkStartHeight),t.registerProperty("MarkStartDiameter",e.setMarkStartDiameter),t.registerProperty("MarkStartColor",e.setMarkStartColor),t.registerProperty("MarkStartStroke",e.setMarkStartStroke),t.registerProperty("MarkStartOrient",e.setMarkStartOrient),t.registerProperty("MarkMiddle",e.setMarkMiddle),t.registerProperty("MarkMiddleWidth",e.setMarkMiddleWidth),t.registerProperty("MarkMiddleHeight",e.setMarkMiddleHeight),t.registerProperty("MarkMiddleDiameter",e.setMarkMiddleDiameter),t.registerProperty("MarkMiddleColor",e.setMarkMiddleColor),t.registerProperty("MarkMiddleColorSnd",e.setMarkMiddleColorSnd),t.registerProperty("MarkMiddleStroke",e.setMarkMiddleStroke),t.registerProperty("MarkMiddleOrient",e.setMarkMiddleOrient),t.registerProperty("MarkProportion",e.setMarkProportion)}},EJSS_DRAWING2D.arrow=function(e){var t=EJSS_DRAWING2D.element(e),r=.5,n=EJSS_DRAWING2D.Arrow.NONE,i="none",o=12,a=10,s=-1,l="auto",u=EJSS_DRAWING2D.Arrow.ANGLE,g="none",c=12,S=12,f=-1,E="auto",d=EJSS_DRAWING2D.Arrow.NONE,p="none",h="none",m=12,A=10,_=-1,D="auto",I=EJSS_DRAWING2D.Arrow.SPLINE_NONE;return t.getClass=function(){return"ElementArrow"},t.setInteractionPosition=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Element[e.toUpperCase()]);var r=t.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION);r.getPositionOffset()!=e&&(r.setPositionOffset(e),t.setChanged(!0))},t.getInteractionPosition=function(){return t.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).getPositionOffset()},t.setMarkProportion=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getMarkProportion=function(){return r},t.setMarkStart=function(e){n="string"==typeof e?EJSS_DRAWING2D.Arrow[e.toUpperCase()]:e},t.getMarkStart=function(){return n},t.setMarkStartColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=i&&(i=e,t.setChanged(!0)),t},t.getMarkStartColor=function(){return i},t.setMarkStartStroke=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getMarkStartStroke=function(){return s},t.setMarkStartWidth=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getMarkStartWidth=function(){return o},t.setMarkStartHeight=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getMarkStartHeight=function(){return a},t.setMarkStartDiameter=function(e){a==e&&o==e||(a=e,o=e,t.setChanged(!0))},t.getMarkStartOrient=function(){return l},t.setMarkStartOrient=function(e){l!=e&&(l=e,t.setChanged(!0))},t.setMarkEnd=function(e){u="string"==typeof e?EJSS_DRAWING2D.Arrow[e.toUpperCase()]:e},t.getMarkEnd=function(){return u},t.setMarkEndColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=g&&(g=e,t.setChanged(!0)),t},t.getMarkEndColor=function(){return g},t.setMarkEndStroke=function(e){f!=e&&(f=e,t.setChanged(!0))},t.getMarkEndStroke=function(){return f},t.setMarkEndWidth=function(e){c!=e&&(c=e,t.setChanged(!0))},t.getMarkEndWidth=function(){return c},t.setMarkEndHeight=function(e){S!=e&&(S=e,t.setChanged(!0))},t.getMarkEndHeight=function(){return S},t.setMarkEndDiameter=function(e){S==e&&c==e||(S=e,c=e,t.setChanged(!0))},t.getMarkEndOrient=function(){return E},t.setMarkEndOrient=function(e){E!=e&&(E=e,t.setChanged(!0))},t.setMarkMiddle=function(e){d="string"==typeof e?EJSS_DRAWING2D.Arrow[e.toUpperCase()]:e},t.getMarkMiddle=function(){return d},t.setMarkMiddleColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=p&&(p=e,t.setChanged(!0)),t},t.getMarkMiddleColor=function(){return p},t.setMarkMiddleStroke=function(e){_!=e&&(_=e,t.setChanged(!0))},t.getMarkMiddleStroke=function(){return _},t.setMarkMiddleColorSnd=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=h&&(h=e,t.setChanged(!0)),t},t.getMarkMiddleColorSnd=function(){return h},t.setMarkMiddleWidth=function(e){m!=e&&(m=e,t.setChanged(!0))},t.getMarkMiddleWidth=function(){return m},t.setMarkMiddleHeight=function(e){A!=e&&(A=e,t.setChanged(!0))},t.getMarkMiddleHeight=function(){return A},t.setMarkMiddleDiameter=function(e){A==e&&m==e||(A=e,m=e,t.setChanged(!0))},t.getMarkMiddleOrient=function(){return D},t.setMarkMiddleOrient=function(e){D!=e&&(D=e,t.setChanged(!0))},t.setSplineType=function(e){I!=e&&(I=e,t.setChanged(!0))},t.getSplineType=function(){return I},t.registerProperties=function(e){EJSS_DRAWING2D.Arrow.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Arrow.copyTo(t,e)},t.setSize([.1,.1]),t.setRelativePosition("SOUTH_WEST"),t},EJSS_DRAWING2D.ArrowSet={registerProperties:function(e,t){EJSS_DRAWING2D.ElementSet.registerProperties(e,t),t.registerProperty("Offset",(function(t){e.setToEach((function(e,t){e.setRelativePosition(t)}),t)})),t.registerProperty("InteractionPosition",(function(t){e.setToEach((function(e,t){e.setInteractionPosition(t)}),t)})),t.registerProperty("MarkEnd",(function(t){e.setToEach((function(e,t){e.setMarkEnd(t)}),t)})),t.registerProperty("MarkEndWidth",(function(t){e.setToEach((function(e,t){e.setMarkEndWidth(t)}),t)})),t.registerProperty("MarkEndHeight",(function(t){e.setToEach((function(e,t){e.setMarkEndHeight(t)}),t)})),t.registerProperty("MarkEndDiameter",(function(t){e.setToEach((function(e,t){e.setMarkEndDiameter(t)}),t)})),t.registerProperty("MarkEndColor",(function(t){e.setToEach((function(e,t){e.setMarkEndColor(t)}),t)})),t.registerProperty("MarkEndStroke",(function(t){e.setToEach((function(e,t){e.setMarkEndStroke(t)}),t)})),t.registerProperty("MarkEndRotate",(function(t){e.setToEach((function(e,t){e.setMarkEndRotate(t)}),t)})),t.registerProperty("MarkEndOrient",(function(t){e.setToEach((function(e,t){e.setMarkEndOrient(t)}),t)})),t.registerProperty("MarkStart",(function(t){e.setToEach((function(e,t){e.setMarkStart(t)}),t)})),t.registerProperty("MarkStartWidth",(function(t){e.setToEach((function(e,t){e.setMarkStartWidth(t)}),t)})),t.registerProperty("MarkStartHeight",(function(t){e.setToEach((function(e,t){e.setMarkStartHeight(t)}),t)})),t.registerProperty("MarkStartDiameter",(function(t){e.setToEach((function(e,t){e.setMarkStartDiameter(t)}),t)})),t.registerProperty("MarkStartColor",(function(t){e.setToEach((function(e,t){e.setMarkStartColor(t)}),t)})),t.registerProperty("MarkStartStroke",(function(t){e.setToEach((function(e,t){e.setMarkStartStroke(t)}),t)})),t.registerProperty("MarkStartRotate",(function(t){e.setToEach((function(e,t){e.setMarkStartRotate(t)}),t)})),t.registerProperty("MarkStartOrient",(function(t){e.setToEach((function(e,t){e.setMarkStartOrient(t)}),t)})),t.registerProperty("MarkMiddle",(function(t){e.setToEach((function(e,t){e.setMarkMiddle(t)}),t)})),t.registerProperty("MarkMiddleWidth",(function(t){e.setToEach((function(e,t){e.setMarkMiddleWidth(t)}),t)})),t.registerProperty("MarkMiddleHeight",(function(t){e.setToEach((function(e,t){e.setMarkMiddleHeight(t)}),t)})),t.registerProperty("MarkMiddleDiameter",(function(t){e.setToEach((function(e,t){e.setMarkMiddleDiameter(t)}),t)})),t.registerProperty("MarkMiddleColor",(function(t){e.setToEach((function(e,t){e.setMarkMiddleColor(t)}),t)})),t.registerProperty("MarkMiddleColorSnd",(function(t){e.setToEach((function(e,t){e.setMarkMiddleColorSnd(t)}),t)})),t.registerProperty("MarkMiddleStroke",(function(t){e.setToEach((function(e,t){e.setMarkMiddleStroke(t)}),t)})),t.registerProperty("MarkMiddleRotate",(function(t){e.setToEach((function(e,t){e.setMarkMiddleRotate(t)}),t)})),t.registerProperty("MarkProportion",(function(t){e.setToEach((function(e,t){e.setMarkProportion(t)}),t)})),t.registerProperty("MarkMiddleOrient",(function(t){e.setToEach((function(e,t){e.setMarkMiddleOrient(t)}),t)}))}},EJSS_DRAWING2D.arrowSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.arrow,e),r=EJSS_DRAWING2D.ArrowSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Axis={AXIS_VERTICAL:0,AXIS_HORIZONTAL:1,TICKS_UP:2,TICKS_DOWN:3,SCALE_NUM:0,SCALE_LOG:1,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Step",e.setStep,e.getStep),t.registerProperty("TickStep",e.setTickStep,e.getTickStep),t.registerProperty("Ticks",e.setTicks,e.getTicks),t.registerProperty("AutoTicks",e.setAutoTicks,e.getAutoTicks),t.registerProperty("FixedTick",e.setFixedTick,e.getFixedTick),t.registerProperty("Orient",e.setOrient,e.getOrient),t.registerProperty("Scale",e.setScale,e.getScale),t.registerProperty("TicksMode",e.setTicksMode,e.getTicksMode),t.registerProperty("TicksSize",e.setTicksSize,e.getTicksSize),t.registerProperty("AutoStepMin",e.setAutoStepMin,e.getAutoStepMin),t.registerProperty("AutoTicksRange",e.setAutoTicksRange,e.getAutoTicksRange),t.registerProperty("TextPosition",e.setTextPosition,e.getTextPosition),t.registerProperty("ScalePrecision",e.setScalePrecision,e.getScalePrecision),t.registerProperty("Font",e.getFont().setFont),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",e.getFont().setFontSize),t.registerProperty("LetterSpacing",e.getFont().setLetterSpacing),t.registerProperty("FontOutlineColor",e.getFont().setOutlineColor),t.registerProperty("FontWeight",e.getFont().setFontWeight),t.registerProperty("FontFillColor",e.getFont().setFillColor),t.registerProperty("Show",e.setShow,e.getShow)}},EJSS_DRAWING2D.axis=function(e){var t=EJSS_DRAWING2D.segment(e),r=!0,n=0,i=20,o=0,a=Number.NaN,s=EJSS_DRAWING2D.Axis.AXIS_VERTICAL,l=[-1,1],u=!1,g=EJSS_DRAWING2D.Axis.SCALE_NUM,c=EJSS_DRAWING2D.Axis.TICKS_UP,S=10,f=1,E=EJSS_DRAWING2D.font(e),d=40,p=[5,10,20],h=!0;return t.getClass=function(){return"ElementAxis"},t.setShow=function(e){h!=e&&(h=e,t.setChanged(!0))},t.getShow=function(){return h},t.getFont=function(){return E},t.setAutoTicksRange=function(e){p!=e&&(p=e,t.setChanged(!0))},t.getAutoTicksRange=function(){return p},t.setAutoStepMin=function(e){d!=e&&(d=e,t.setChanged(!0))},t.getAutoStepMin=function(){return d},t.setFixedTick=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getFixedTick=function(){return a},t.setAutoTicks=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getAutoTicks=function(){return r},t.setStep=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getStep=function(){return i},t.setTickStep=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getTickStep=function(){return o},t.setTicks=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getTicks=function(){return n},t.setTicksMode=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Grid[e.toUpperCase()]),g!=e&&(g=e,t.setChanged(!0))},t.getTicksMode=function(){return g},t.setTextPosition=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Axis[e.toUpperCase()]),c!=e&&(c=e,t.setChanged(!0))},t.getTextPosition=function(){return c},t.setOrient=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Axis[e.toUpperCase()]),s!=e&&(s=e,t.setChanged(!0))},t.getOrient=function(){return s},t.setScale=function(e){l!=e&&(l=e,t.setChanged(!0))},t.getScale=function(){return l},t.setScalePrecision=function(e){f!=e&&(f=e,t.setChanged(!0))},t.getScalePrecision=function(){return f},t.setTicksSize=function(e){S!=e&&(S=e,t.setChanged(!0))},t.getTicksSize=function(){return S},t.setInvertedScaleY=function(e){u!=e&&(u=e,t.setChanged(!0))},t.getInvertedScaleY=function(){return u},t.registerProperties=function(e){EJSS_DRAWING2D.Axis.registerProperties(t,e)},E.setChangeListener((function(e){t.setChanged(!0)})),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ByteRaster={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData,e.getData),t.registerProperty("NumColors",e.getColorMapper().setNumberOfColors),t.registerProperty("Colors",e.getColorMapper().setColorPalette),t.registerProperty("Palette",e.getColorMapper().setPaletteType),t.registerProperty("AutoUpdate",e.setAutoupdate),t.registerProperty("RGBData",e.setRGBData)}},EJSS_DRAWING2D.byteRaster=function(e){var t=EJSS_DRAWING2D.element(e),r=EJSS_DRAWING2D.colorMapper(20,EJSS_DRAWING2D.ColorMapper.REDBLUE_SHADE),n=[],i=!1,o=!0,a=!1;return t.getClass=function(){return"ElementByteRaster"},t.setData=function(e){(o||n!=e)&&(n=e,i=!0,t.setChanged(!0))},t.getData=function(){return n},t.setRGBData=function(e){a=e,o&&(i=!0)},t.isRGBData=function(){return a},t.setAutoupdate=function(e){(o=e)&&(i=!0)},t.setColorMapper=function(e){r!=e&&(r=e,i=!0,t.setChanged(!0))},t.getColorMapper=function(){return r},t.setIndexedColor=function(e){var n=e.color,i=void 0===n[3]?"rgb("+n[0]+","+n[1]+","+n[2]+")":"rgb("+n[0]+","+n[1]+","+n[2]+","+n[3]+")";console.log(t.getName()+": setIndexedColor("+e.index+","+i+")"),r.getColors()[e.index]=i},t.getDataChanged=function(){return i},t.setDataChanged=function(e){i=e},t.invalidate=function(){i=!0},t.registerProperties=function(e){EJSS_DRAWING2D.ByteRaster.registerProperties(t,e)},r.setChangeListener((function(e){t.setChanged(!0)})),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Canvas={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setDimensions(e.getDimensions())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Dimensions",e.setDimensions,e.getDimensions)}},EJSS_DRAWING2D.canvas=function(e){var t=EJSS_DRAWING2D.element(e),r=[];return t.getClass=function(){return"ElementCanvas"},t.setDimensions=function(e){xMin=e[0],xMax=e[1],yMin=e[2],yMax=e[3],t.setChanged(!0)},t.getDimensions=function(){return[xMin,xMax,yMin,yMax]},t.addDrawable=function(e){r.push(e),t.setChanged(!0)},t.addImageField=function(e,r,n,i,o,a,s,l,u,g){var c=function(){var c={};function S(e,t,r){for(var n=[],i=(t-e)/(r-1),o=e,a=0;a<r;a++)n.push(o),o+=i;return n}return c.imageField=!0,c.data=e||void 0,c.xMin=void 0===r?-5:r,c.xMax=void 0===n?5:n,c.nx=i||128,c.yMin=void 0===o?-5:o,c.yMax=void 0===a?5:a,c.ny=s||128,c.autoscale=l||!0,c.lower=void 0===u?-1:u,c.upper=void 0===g?1:g,c.center=(c.lower+c.upper)/2,c.maskRadius=0,c.xPos=S(c.xMin,c.xMax,c.nx),c.yPos=S(c.yMin,c.yMax,c.ny),c.updateData=function(e){c.data=e||c.data,c.xPos=S(c.xMin,c.xMax,c.nx),c.yPos=S(c.yMin,c.yMax,c.ny),t.setChanged(!0)},c.setThreshold=function(e,r){c.lower=void 0===e?c.lower:e,c.upper=void 0===r?c.upper:r,t.setChanged(!0)},c.setCircularMask=function(e){c.maskRadius=e,t.setChanged(!0)},c}();return t.addDrawable(c),c},t.getDrawables=function(){return r},this.clearObjects=function(){r=[],t.setChanged(!0)},t.registerProperties=function(e){EJSS_DRAWING2D.Canvas.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Canvas.copyTo(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.CellLattice={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData,e.getData),t.registerProperty("ShowGrid",e.setShowGrid,e.getShowGrid),t.registerProperty("NumColors",e.getColorMapper().setNumberOfColors),t.registerProperty("Colors",e.getColorMapper().setColorPalette),t.registerProperty("Palette",e.getColorMapper().setPaletteType),t.registerProperty("AutoUpdate",e.setAutoupdate)}},EJSS_DRAWING2D.cellLattice=function(e){var t=EJSS_DRAWING2D.element(e),r=EJSS_DRAWING2D.colorMapper(20,EJSS_DRAWING2D.ColorMapper.REDBLUE_SHADE),n=!0,i=[],o=!0;return t.getClass=function(){return"ElementCellLattice"},t.setData=function(e){(o||i!=e)&&(i=e,mDataChanged=!0,t.setChanged(!0))},t.getData=function(){return i},t.setAutoupdate=function(e){(o=e)&&(mDataChanged=!0)},t.setColorMapper=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getColorMapper=function(){return r},t.setShowGrid=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getShowGrid=function(){return n},t.registerProperties=function(e){EJSS_DRAWING2D.CellLattice.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Cursor={HORIZONTAL:0,VERTICAL:1,CROSSHAIR:2,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("CursorType",e.setCursorType,e.getCursorType)}},EJSS_DRAWING2D.cursor=function(e){var t,r=EJSS_DRAWING2D.element(e),n=EJSS_DRAWING2D.Cursor;return r.getClass=function(){return"ElementCursor"},r.setCursorType=function(e){var i=EJSS_DRAWING2D.InteractionTarget,o=r.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION);switch(t="string"==typeof e?EJSS_DRAWING2D.Cursor[e.toUpperCase()]:e){default:o.setSensitivityType(i.SENSITIVITY_ANY);break;case n.HORIZONTAL:o.setSensitivityType(i.SENSITIVITY_HORIZONTAL);break;case n.VERTICAL:o.setSensitivityType(i.SENSITIVITY_VERTICAL)}},r.getCursorType=function(){return t},r.isChanged=function(){return!0},r.registerProperties=function(e){n.registerProperties(r,e)},r.setMeasured(!1),t=n.CROSSHAIR,r.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setSensitivityType(EJSS_DRAWING2D.InteractionTarget.SENSITIVITY_ANY),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Custom={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t)}},EJSS_DRAWING2D.custom=function(e){var t,r=EJSS_DRAWING2D.element(e);return r.getClass=function(){return"ElementCustom"},r.registerProperties=function(e){EJSS_DRAWING2D.Custom.registerProperties(r,e)},r.setFunction=function(e){t=e},r.getFunction=function(){return t},r.setSize([1,1]),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.DrawingPanel={MOUSE_ENTERED:0,MOUSE_EXITED:1,MOUSE_PRESSED:2,MOUSE_DRAGGED:3,MOUSE_RELEASED:4,GRAPHICS2D_SVG:0,GRAPHICS2D_CANVAS:1,SCALE_NUM:0,SCALE_LOG:1,ENABLED_NONE:0,ENABLED_ANY:1,ENABLED_X:2,ENABLED_Y:3,ENABLED_NO_MOVE:4,registerProperties:function(e,t){e.setController(t),t.registerProperty("AutoScale",e.setAutoScale,e.getAutoScale),t.registerProperty("AutoScaleX",e.setAutoScaleX,e.getAutoScaleX),t.registerProperty("AutoScaleY",e.setAutoScaleY,e.getAutoScaleY),t.registerProperty("InvertedScaleY",e.setInvertedScaleY,e.getInvertedScaleY),t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("ScaleXType",(function(t){e.setTypeScaleX(t),e.scale()}),e.getTypeScaleX),t.registerProperty("ScaleYType",(function(t){e.setTypeScaleY(t),e.scale()}),e.getTypeScaleY),t.registerProperty("MarginX",e.setMarginX,e.getMarginX),t.registerProperty("MarginY",e.setMarginY,e.getMarginY),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("ClassName",e.getGraphics().setClassName),t.registerProperty("Width",(function(t){e.getGraphics().setWidth(t)&&e.scale()}),e.getGraphics().getBox().width),t.registerProperty("Height",(function(t){e.getGraphics().setHeight(t)&&e.scale()}),e.getGraphics().getBox().height),t.registerProperty("SquareAspect",e.setSquareAspect),t.registerProperty("GraphicsMode",e.setGraphicsMode),t.registerProperty("Enabled",e.getPanelInteraction().setEnabled),t.registerProperty("StopMoveEvents",e.getPanelInteraction().setStopMoveEvents),t.registerProperty("StopEventPropagation",e.getPanelInteraction().setStopGestures),t.registerProperty("Gutters",e.setGutters),t.registerProperty("GuttersLineColor",e.getGuttersStyle().setLineColor),t.registerProperty("GuttersLineWidth",e.getGuttersStyle().setLineWidth),t.registerProperty("GuttersDrawLines",e.getGuttersStyle().setDrawLines),t.registerProperty("GuttersColor",e.getGuttersStyle().setFillColor),t.registerProperty("GuttersFill",e.getGuttersStyle().setDrawFill),t.registerProperty("GuttersRendering",e.getStyle().setShapeRendering),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getStyle().setLineColor),t.registerProperty("LineColor",e.getStyle().setLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("ShapeRendering",e.getStyle().setShapeRendering),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS),t.registerProperty("TRMessage",e.getMessageDecoration("TR").setText),t.registerProperty("TRMessageFont",e.getMessageDecoration("TR").getFont().setFont),t.registerProperty("TRMessageColor",e.getMessageDecoration("TR").getFont().setFillColor),t.registerProperty("TRMessageFillColor",e.getMessageDecoration("TR").getStyle().setFillColor),t.registerProperty("TRMessageLineColor",e.getMessageDecoration("TR").getStyle().setLineColor),t.registerProperty("TLMessage",e.getMessageDecoration("TL").setText),t.registerProperty("TLMessageFont",e.getMessageDecoration("TL").getFont().setFont),t.registerProperty("TLMessageColor",e.getMessageDecoration("TL").getFont().setFillColor),t.registerProperty("TLMessageFillColor",e.getMessageDecoration("TL").getStyle().setFillColor),t.registerProperty("TLMessageLineColor",e.getMessageDecoration("TL").getStyle().setLineColor),t.registerProperty("BRMessage",e.getMessageDecoration("BR").setText),t.registerProperty("BRMessageFont",e.getMessageDecoration("BR").getFont().setFont),t.registerProperty("BRMessageColor",e.getMessageDecoration("BR").getFont().setFillColor),t.registerProperty("BRMessageFillColor",e.getMessageDecoration("BR").getStyle().setFillColor),t.registerProperty("BRMessageLineColor",e.getMessageDecoration("BR").getStyle().setLineColor),t.registerProperty("BLMessage",e.getMessageDecoration("BL").setText),t.registerProperty("BLMessageFont",e.getMessageDecoration("BL").getFont().setFont),t.registerProperty("BLMessageColor",e.getMessageDecoration("BL").getFont().setFillColor),t.registerProperty("BLMessageFillColor",e.getMessageDecoration("BL").getStyle().setFillColor),t.registerProperty("BLMessageLineColor",e.getMessageDecoration("BL").getStyle().setLineColor),t.registerProperty("CoordinatesFormat",e.getCoordinates().setFormat),t.registerProperty("ShowCoordinates",e.setShowCoordinates),t.registerProperty("ShowAreaRectangle",e.setShowAreaRectangle),t.registerProperty("EnabledZooming",e.setEnabledZooming),t.registerProperty("EnabledDragging",e.setEnabledDragging),t.registerProperty("CursorTypeForMove",e.getInteraction().setCursorTypeForMove),t.registerAction("OnDoubleClick",e.getInteraction().getInteractionPoint),t.registerAction("OnMove",e.getInteraction().getInteractionPoint,e.getOnMoveHandler),t.registerAction("OnPress",e.getInteraction().getInteractionPoint,e.getOnPressHandler),t.registerAction("OnDrag",e.getInteraction().getInteractionPoint,e.getOnDragHandler),t.registerAction("OnRelease",e.getInteraction().getInteractionBounds,e.getOnReleaseHandler),t.registerAction("OnResize",e.getInteraction().getInteractionBounds,e.scale),t.registerAction("OnOrientationChange",e.getInteraction().getOrientation,e.scale),t.registerAction("OnZoom",e.getInteraction().getPinchDistance,e.getOnZoomHandler)}},EJSS_DRAWING2D.drawingPanel=function(e,t){var r,n={},i=EJSS_DRAWING2D.style(e),o=[],a=[],s=!1,l=!1,u=!1,g=!1,c=0,S=0,f=[],E=!0,d=!0,p=!1,h=!1,m=1.1,A=[.1,1e3],_=[],D=-1,I=1,P=-1,C=1,T={xminPreferred:NaN,xmaxPreferred:NaN,yminPreferred:NaN,ymaxPreferred:NaN,xminMeasured:NaN,xmaxMeasured:NaN,yminMeasured:NaN,ymaxMeasured:NaN,xmargin:0,ymargin:0,xmin:-1,xmax:1,ymin:-1,ymax:1,squareAspect:!1,xorigin:0,yorigin:0,xscale:1,yscale:1},y={left:0,right:0,top:0,bottom:0,visible:!1},R=EJSS_DRAWING2D.style(e+" gutters"),N=!0,v=!0,O=!0,M={propertiesChanged:function(){},invokeAction:function(){}};n.getName=function(){return e},n.getGraphics=function(){return r},n.importGraphics=function(e){return r.importSVG?r.importSVG(e):null},n.getStyle=function(){return i},n.getGraphicsMode=function(){return t},n.getGraphicsModeName=function(){switch(t){case EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_CANVAS:return"CANVAS";default:case EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG:return"SVG"}},n.setGraphicsMode=function(n){if("string"==typeof n?(0!=n.indexOf("GRAPHICS2D_")&&(n="GRAPHICS2D_"+n),n=EJSS_DRAWING2D.DrawingPanel[n.toUpperCase()]|EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG):void 0===n&&(n=EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG),n!=t){t=n;var i=void 0!==r;if(i){var o=r.getParent(),a=r.getWidth(),l=r.getHeight(),u=r.getEventContext().getAttribute("style"),g=document.getElementById(e);g.parentNode.removeChild(g)}n==EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_SVG?r=EJSS_GRAPHICS.svgGraphics(e):n==EJSS_DRAWING2D.DrawingPanel.GRAPHICS2D_CANVAS?r=EJSS_GRAPHICS.canvasGraphics(e):console.log("WARNING: setGraphics() - Graphics not supported"),i&&(r.setParent(o),r.setWidth(a),r.setHeight(l),r.getEventContext().setAttribute("style",u),s=!0,k.reload())}},n.getAutoScale=function(){return l||u},n.setAutoScale=function(e){n.setAutoScaleX(e),n.setAutoScaleY(e)},n.setAutoScaleX=function(e){l=e},n.getAutoScaleX=function(){return l},n.setAutoScaleY=function(e){u=e},n.getAutoScaleY=function(){return u},n.setInvertedScaleY=function(e){g!=e&&((g=e)&&(S=EJSS_DRAWING2D.DrawingPanel.SCALE_NUM),n.reportDecorations("bounds")&&(N=!0))},n.getInvertedScaleY=function(){return g},n.setTypeScaleX=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.DrawingPanel[e.toUpperCase()]),c=e},n.getTypeScaleX=function(){return c},n.setTypeScaleY=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.DrawingPanel[e.toUpperCase()]),(S=e)==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG&&(g=!1)},n.getTypeScaleY=function(){return S},n.setWorldXMin=function(e){e!==T.xminPreferred&&(T.xminPreferred=e)},n.getWorldXMin=function(){return T.xminPreferred},n.setWorldXMax=function(e){e!==T.xmaxPreferred&&(T.xmaxPreferred=e)},n.getWorldXMax=function(){return T.xmaxPreferred},n.setWorldYMin=function(e){e!==T.yminPreferred&&(T.yminPreferred=e)},n.getWorldYMin=function(){return T.yminPreferred},n.setWorldYMax=function(e){e!==T.ymaxPreferred&&(T.ymaxPreferred=e)},n.getWorldYMax=function(){return T.ymaxPreferred},n.setWorldCoordinates=function(e){n.setWorldXMin(e[0]),n.setWorldXMax(e[1]),n.setWorldYMin(e[2]),n.setWorldYMax(e[3])},n.getWorldCoordinates=function(){return[n.getWorldXMin(),n.getWorldXMax(),n.getWorldYMin(),n.getWorldYMax()]},n.getMeasuredCoordinates=function(){return[T.xminMeasured,T.xmaxMeasured,T.yminMeasured,T.ymaxMeasured]},n.getRealWorldCoordinates=function(){return[T.xmin,T.xmax,T.ymin,T.ymax]},n.getRealWorldXMin=function(){return T.xmin},n.getRealWorldXMax=function(){return T.xmax},n.getRealWorldYMin=function(){return T.ymin},n.getRealWorldYMax=function(){return T.ymax},n.setSquareAspect=function(e){e!==T.squareAspect&&(T.squareAspect=e,v=!0)},n.setMarginX=function(e){T.xmargin!=e&&(T.xmargin=e,v=!0)},n.getMarginX=function(){return T.xmargin},n.setMarginY=function(e){T.ymargin!=e&&(T.ymargin=e,v=!0)},n.getMarginY=function(){return T.ymargin},n.setEnabledDragging=function(e){"string"==typeof e?(value=EJSS_DRAWING2D.DrawingPanel[e.toUpperCase()],p="undefined"==typeof value?EJSS_DRAWING2D.DrawingPanel.ENABLED_NONE:value):p=e},n.getEnabledDragging=function(){return p},n.setEnabledZooming=function(e){h=e},n.getEnabledZooming=function(){return h},n.setZoomRate=function(e){m=e},n.getZoomRate=function(){return m},n.setZoomLimits=function(e){A=e},n.getZoomLimits=function(){return A},n.setShowCoordinates=function(e){E=e},n.getShowCoordinates=function(){return E},n.setShowAreaRectangle=function(e){d=e},n.getShowAreaRectangle=function(){return d},n.addDecoration=function(e,t,r){return r?EJSS_TOOLS.addToArray(f,e,t):EJSS_TOOLS.addToArray(o,e,t),e.setPanel&&e.setPanel(n),n},n.removeDecoration=function(e){return EJSS_TOOLS.removeFromArray(o,e),EJSS_TOOLS.removeFromArray(f,e),e.setPanel&&e.setPanel(null),n},n.addElement=function(e,t){if(void 0===t)EJSS_TOOLS.addToArray(a,e);else if("object"==typeof t){var r=EJSS_TOOLS.arrayObjectIndexOf(a,t);EJSS_TOOLS.addToArray(a,e,r)}else EJSS_TOOLS.addToArray(a,e,t);e.setPanel(n),e.dataCollected&&_.push(e),s=!0},n.removeElement=function(e){EJSS_TOOLS.removeFromArray(a,e),k.clearInteractionElement(e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(_,e),s=!0},n.getElements=function(){return a},n.indexOfElement=function(e){return a.indexOf(e)},n.setGutters=function(e){var t=e[0],r=e[1],n=e[2],i=e[3],o=!1;t!==y.left&&(y.left=t,o=!0),r!==y.top&&(y.top=r,o=!0),n!==y.right&&(y.right=n,o=!0),i!==y.bottom&&(y.bottom=i,o=!0),o&&(y.visible=y.left>0||y.top>0||y.right>0||y.bottom>0,N=!0,v=!0)},n.getGutters=function(){return y},n.getGuttersStyle=function(){return R},n.toPixelAxisY=function(e){return T.yorigin-e-T.yscale*T.ymin},n.toPixelAxisX=function(e){return T.xorigin+e-T.xscale*T.xmin},n.toPixelPosition=function(e,t){var r=void 0!==t?t:S,i=[];return(void 0!==t?t:c)==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?i[0]=n.toPixelLogScale(e[0],T.xorigin,T.xmin,T.xmax,T.xscale):i[0]=T.xorigin+T.xscale*(e[0]-T.xmin),r==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?i[1]=n.toPixelLogScale(e[1],T.yorigin,T.ymin,T.ymax,T.yscale):i[1]=g?y.top+T.yscale*(T.ymin-e[1]):T.yorigin+T.yscale*(e[1]-T.ymin),i},n.toPixelMod=function(e){var t=[];return t[0]=e[0]*T.xscale,t[1]=e[1]*T.yscale,t},n.toPanelPosition=function(e,t){var r=void 0!==t?t:S,i=[];return(void 0!==t?t:c)==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?i[0]=n.toPanelLogScale(e[0],T.xorigin,T.xmin,T.xmax,T.xscale):i[0]=T.xmin+(e[0]-T.xorigin)/T.xscale,r==EJSS_DRAWING2D.DrawingPanel.SCALE_LOG?i[1]=n.toPanelLogScale(e[1],T.yorigin,T.ymin,T.ymax,T.yscale):i[1]=g?T.ymin-(e[1]-y.top)/T.yscale:T.ymin+(e[1]-T.yorigin)/T.yscale,i},n.toPanelMod=function(e){var t=[];return t[0]=0==T.xscale?0:e[0]/T.xscale,t[1]=0==T.yscale?0:e[1]/T.yscale,t},n.toPixelLogScale=function(e,t,r,n,i){var o=r<=0?1:Math.log(r)/Math.log(10);return t+(n-r)*i/((n<=0?1:Math.log(n)/Math.log(10))-o)*((e<=0?0:Math.log(e)/Math.log(10))-o)},n.toPanelLogScale=function(e,t,r,n,i){var o=r<0?0:Math.log(r)/Math.log(10),a=(n-r)*i/((n<0?0:Math.log(n)/Math.log(10))-o);return Math.pow(10,o+(e-t)/a)},n.getPixelPositionWorldOrigin=function(){return[T.xorigin,T.yorigin]},n.getInnerRect=function(){var e=n.getRealWorldCoordinates();if(n.getInvertedScaleY())t=n.toPixelPosition([e[0],e[2]]);else var t=n.toPixelPosition([e[0],e[3]]);var r=n.toPixelMod([e[1]-e[0],e[3]-e[2]]);return{x:t[0],width:Math.abs(r[0]),y:t[1],height:Math.abs(r[1])}},n.scale=function(){v=!0,s=!0},n.touch=function(){v=!0,s=!0;for(var e=0,t=a.length;e<t;e++)a[e].setChanged(!0)},n.recomputeScales=function(){var e,t,i=!1,o=(T.xmaxMeasured-T.xminMeasured)/2,s=(T.ymaxMeasured-T.yminMeasured)/2,l=T.xminMeasured-Math.abs(o*T.xmargin/100),u=T.xmaxMeasured+Math.abs(o*T.xmargin/100),g=T.yminMeasured-Math.abs(s*T.ymargin/100),c=T.ymaxMeasured+Math.abs(s*T.ymargin/100),S=r.getBox(),f=S.width-(y.left+y.right),E=S.height-(y.bottom+y.top),d=f/(u-l),p=E/(c-g);(T.squareAspect&&((e=Math.abs(d/p))>=1?d=f/((u+=t=(u-l)*((e=Math.min(e,f))-1)/2)-(l-=t)):p=E/((c+=t=(c-g)*(1/(e=Math.max(e,1/E))-1)/2)-(g-=t))),i=T.xscale!=d||T.yscale!=-p,T.xscale=d,T.yscale=-p,T.xorigin=y.left+.5,T.yorigin=E+y.top+.5,v=!1,T.xmin!==l||T.xmax!==u||T.ymin!==g||T.ymax!==c)&&(T.xmin=l,T.xmax=u,T.ymin=g,T.ymax=c,n.reportDecorations("bounds")&&(N=!0),i=!0);if(i)for(var h=0,m=a.length;h<m;h++)a[h].setMustProject(!0)},n.reportDecorations=function(e){var t,r,n=!1;for(t=0,r=o.length;t<r;t++)n|=o[t].panelChangeListener&&o[t].panelChangeListener("bounds");for(t=0,r=f.length;t<r;t++)f[t].panelChangeListener&&f[t].panelChangeListener("bounds");return n},n.checkMeasure=function(){var e=Number.MAX_VALUE,t=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=-Number.MAX_VALUE;if(n.getAutoScaleY()||n.getAutoScaleX())for(var o=0,s=a.length;o<s;o++)if(a[o].isMeasured()&&!a[o].isGroup()&&(null==a[o].getGroup()||a[o].getGroup().isMeasured()))if(a[o].isPixelSize()){var l=a[o].getPosition();e=Math.min(e,l[0]),t=Math.max(t,l[0]),r=Math.min(r,l[1]),i=Math.max(i,l[1])}else{var u=a[o].getAbsoluteBounds();e=Math.min(e,u.left),t=Math.max(t,u.right),r=Math.min(r,u.bottom),i=Math.max(i,u.top)}var g=!1;n.getAutoScaleX()?(isNaN(T.xminPreferred)||(e=Math.min(e,T.xminPreferred)),isNaN(T.xmaxPreferred)||(t=Math.max(t,T.xmaxPreferred)),t<=e?(g=T.xminMeasured!=D||T.xmaxMeasured!=I,T.xminMeasured=D,T.xmaxMeasured=I):(g=T.xminMeasured!=e||T.xmaxMeasured!=t,T.xminMeasured=e,T.xmaxMeasured=t)):isNaN(T.xminPreferred)||isNaN(T.xmaxPreferred)?(g=T.xminMeasured!=D||T.xmaxMeasured!=I,T.xminMeasured=D,T.xmaxMeasured=I):(g=T.xminMeasured!=T.xminPreferred||T.xmaxMeasured!=T.xmaxPreferred,T.xminMeasured=T.xminPreferred,T.xmaxMeasured=T.xmaxPreferred);var c=!1;return n.getAutoScaleY()?(isNaN(T.yminPreferred)||(r=Math.min(r,T.yminPreferred)),isNaN(T.ymaxPreferred)||(i=Math.max(i,T.ymaxPreferred)),i<=r?(c=T.yminMeasured!=P||T.ymaxMeasured!=C,T.yminMeasured=P,T.ymaxMeasured=C):(c=T.yminMeasured!=r||T.ymaxMeasured!=i,T.yminMeasured=r,T.ymaxMeasured=i)):isNaN(T.yminPreferred)||isNaN(T.ymaxPreferred)?(c=T.yminMeasured!=P||T.ymaxMeasured!=C,T.yminMeasured=P,T.ymaxMeasured=C):(c=T.yminMeasured!=T.yminPreferred||T.ymaxMeasured!=T.ymaxPreferred,T.yminMeasured=T.yminPreferred,T.ymaxMeasured=T.ymaxPreferred),g||c},n.reset=function(){r.reset()},n.disable=function(){O=!1},n.enable=function(){O=!0},n.render=function(){if(O){var e=!1;(r.setImageData||s)&&(r.reset(),e=!0,s=!1);for(var t=0,i=_.length;t<i;t++)_[t].dataCollected();var l=n.checkMeasure();(v||l)&&n.recomputeScales(),(N||e)&&r.drawPanel(n),r.draw(o),r.draw(a,e),(N||e)&&r.drawGutters(n),r.draw(f),N=!1;for(t=0,i=a.length;t<i;t++)a[t].setChanged(!1)}},n.getPanelInteraction=function(){return k},n.getController=function(){return M},n.setController=function(e){M=e},n.getOnMoveHandler=null,n.getOnZoomHandler=function(){if(h){var e=k.getInteractionZoomDelta(),t=n.getWorldCoordinates();(isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3]))&&(t=n.getMeasuredCoordinates());var r=+(1-m)*(t[1]-t[0])*e/2,i=+(1-m)*(t[3]-t[2])*e/2,o=Math.abs(t[0]-t[1])-2*r;o>A[0]&&o<A[1]&&(n.setWorldCoordinates([t[0]+r,t[1]-r,t[2]+i,t[3]-i]),n.getController().propertiesChanged("MinimumX","MaximumX","MinimumY","MaximumY","Bounds"))}},n.getOnPressHandler=function(){if(E){var e=k.getInteractionPoint(),t=n.getRealWorldCoordinates();t[0]<e[0]&&t[1]>e[0]&&t[3]>e[1]&&t[2]<e[1]&&(w.setText(e),w.setVisible(!0),w.getController().propertiesChanged("Visible","Text"))}},n.getOnDragHandler=function(){if(E){var e=k.getInteractionPoint();(i=n.getRealWorldCoordinates())[0]<e[0]&&i[1]>e[0]&&i[3]>e[1]&&i[2]<e[1]&&(w.setText(e),w.setVisible(!0),w.getController().propertiesChanged("Visible","Text"))}if(d){var t=k.getInteractionBounds();t.length>0&&c==EJSS_DRAWING2D.DrawingPanel.SCALE_NUM&&S==EJSS_DRAWING2D.DrawingPanel.SCALE_NUM?(b.setBounds(t),b.setVisible(!0),b.getController().propertiesChanged("Position","X","Y","Size","SizeX","SizeY","Visible")):(b.setVisible(!1),b.getController().propertiesChanged("Visible"))}if(0!=p&&4!=p){var r=k.getInteractionDistance();if(r.length>0&&c==EJSS_DRAWING2D.DrawingPanel.SCALE_NUM&&S==EJSS_DRAWING2D.DrawingPanel.SCALE_NUM){var i=n.getWorldCoordinates();(isNaN(i[0])||isNaN(i[1])||isNaN(i[2])||isNaN(i[3]))&&(i=n.getMeasuredCoordinates()),1==p?n.setWorldCoordinates([i[0]+r[0],i[1]+r[0],i[2]+r[1],i[3]+r[1]]):2==p?n.setWorldCoordinates([i[0]+r[0],i[1]+r[0],i[2],i[3]]):n.setWorldCoordinates([i[0],i[1],i[2]+r[1],i[3]+r[1]]),n.getController().propertiesChanged("MinimumX","MaximumX","MinimumY","MaximumY","Bounds")}}},n.getOnReleaseHandler=function(){E&&(w.setVisible(!1),w.getController().propertiesChanged("Visible")),d&&(b.setVisible(!1),b.getController().propertiesChanged("Visible"))},n.getMessageDecoration=function(e){switch(e){case"TL":return G;case"BR":return x;case"BL":return L}return J},n.getCoordinates=function(){return w},n.getInteraction=function(){return k},n.registerProperties=function(e){EJSS_DRAWING2D.DrawingPanel.registerProperties(n,e)},n.serialize=function(){return{mStyle:i.serialize(),mTopDecorations:f,mBottomDecorations:o,mElements:a,mCollectersList:_,mAutoScaleX:l,mAutoScaleY:u,mInvertedScaleY:g,mTypeScaleX:c,mTypeScaleY:S,mShowCoordinates:E,xmindef:D,xmaxdef:I,ymindef:P,ymaxdef:C,mWorld:T,mGutters:y,mGuttersStyle:R.serialize()}},n.unserialize=function(e){i.unserialize(e.mStyle),l=e.mAutoScaleX,u=e.mAutoScaleY,g=e.mInvertedScaleY,c=e.mTypeScaleX,S=e.mTypeScaleY,E=e.mShowCoordinates,D=e.xmindef,I=e.xmaxdef,P=e.ymindef,C=e.ymaxdef,T=e.mWorld,y=e.mGutters,R.unserialize(e.mGuttersStyle),N=!0},n.setGraphicsMode(t),i.setLineColor("black"),i.setFillColor("rgb(239,239,255)"),i.setChangeListener((function(e){N=!0})),R.setChangeListener((function(e){N=!0}));var b=EJSS_DRAWING2D.shape(e+"__cursorBox__");b.setShapeType(EJSS_DRAWING2D.Shape.RECTANGLE),b.getStyle().setDrawFill(!1),b.getStyle().setLineColor("black"),b.setRelativePosition("CENTER"),b.setVisible(!1),n.addDecoration(b,0,!0);var G=EJSS_DRAWING2D.text(e+"__tlmessage__");G.setRelativePosition("NORTH_WEST"),G.getStyle().setDrawLines(!0),G.getStyle().setDrawFill(!0),G.getStyle().setFillColor("yellow"),G.getStyle().setLineColor("black"),G.getFont().setFontSize(12),G.setPosition([T.xmin,T.ymax]),G.setFramed(!0),G.panelChangeListener=function(e){"bounds"==e&&(n.getInvertedScaleY()?G.setPosition([T.xmin,T.ymin]):G.setPosition([T.xmin,T.ymax]))},n.addDecoration(G,0,!0);var L=EJSS_DRAWING2D.text(e+"__blmessage__");L.setRelativePosition("SOUTH_WEST"),L.getStyle().setDrawLines(!0),L.getStyle().setDrawFill(!0),L.getStyle().setFillColor("yellow"),L.getStyle().setLineColor("black"),L.getFont().setFontSize(12),L.setPosition([T.xmin,T.ymin]),L.setFramed(!0),L.panelChangeListener=function(e){"bounds"==e&&(n.getInvertedScaleY()?L.setPosition([T.xmin,T.ymax]):L.setPosition([T.xmin,T.ymin]))},n.addDecoration(L,0,!0);var x=EJSS_DRAWING2D.text(e+"__brmessage__");x.setRelativePosition("SOUTH_EAST"),x.getStyle().setDrawLines(!0),x.getStyle().setDrawFill(!0),x.getStyle().setFillColor("yellow"),x.getStyle().setLineColor("black"),x.getFont().setFontSize(12),x.setPosition([T.xmax,T.ymin]),x.setFramed(!0),x.panelChangeListener=function(e){"bounds"==e&&(n.getInvertedScaleY()?x.setPosition([T.xmax,T.ymax]):x.setPosition([T.xmax,T.ymin]))},n.addDecoration(x,0,!0);var J=EJSS_DRAWING2D.text(e+"__trmessage__");J.setRelativePosition("NORTH_EAST"),J.getStyle().setDrawLines(!0),J.getStyle().setDrawFill(!0),J.getStyle().setFillColor("yellow"),J.getStyle().setLineColor("black"),J.getFont().setFontSize(12),J.setPosition([T.xmax,T.ymax]),J.setFramed(!0),J.panelChangeListener=function(e){"bounds"==e&&(n.getInvertedScaleY()?J.setPosition([T.xmax,T.ymin]):J.setPosition([T.xmax,T.ymax]))},n.addDecoration(J,0,!0);var w=EJSS_DRAWING2D.infoText(e+"__coor__");w.setRelativePosition("SOUTH_WEST"),w.getFont().setFontSize(12),w.getStyle().setFillColor("yellow"),w.setPosition([T.xmin,T.ymin]),w.setFormat("x:0.##,y:0.##"),w.setFramed(!0),w.setVisible(!1),w.panelChangeListener=function(e){"bounds"==e&&(n.getInvertedScaleY()?w.setPosition([T.xmin,T.ymax]):w.setPosition([T.xmin,T.ymin]))},n.addDecoration(w,0,!0),n.getGuttersStyle().setLineColor("black"),n.getGuttersStyle().setFillColor("rgb(239,239,255)"),n.getGuttersStyle().setShapeRendering("RENDER_CRISPEDGES");var k=EJSS_DRAWING2D.panelInteraction(n);return r.getEventContext().addEventListener("dblclick",(function(e){return e.preventDefault(),e.stopPropagation(),!1}),!0),n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Element={CENTER:0,NORTH:1,SOUTH:2,EAST:3,WEST:4,NORTH_EAST:5,NORTH_WEST:6,SOUTH_EAST:7,SOUTH_WEST:8,registerProperties:function(e,t){var r=EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION,n=EJSS_DRAWING2D.PanelInteraction.TARGET_SIZE,i=e.getStyle();e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("X",e.setX,e.getX),t.registerProperty("Y",e.setY,e.getY),t.registerProperty("Position",e.setPosition,e.getPosition),t.registerProperty("PixelPosition",e.setPixelPosition,e.getPixelPosition),t.registerProperty("Diameter",(function(t){e.setSize([t,t])})),t.registerProperty("Radius",(function(t){e.setSize([2*t,2*t])})),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("PixelSize",e.setPixelSize,e.getPixelSize),t.registerProperty("Bounds",e.setBounds,e.getBounds),t.registerProperty("RelativePosition",e.setRelativePosition,e.getRelativePosition),t.registerProperty("Visibility",e.setVisible,e.isVisible),t.registerProperty("Measured",e.setMeasured,e.isMeasured),t.registerProperty("Transformation",e.setTransformation),t.registerProperty("Rotate",e.setRotate),t.registerProperty("ScaleX",e.setScaleX),t.registerProperty("ScaleY",e.setScaleY),t.registerProperty("SkewX",e.setSkewX),t.registerProperty("SkewY",e.setSkewY),t.registerProperty("LineColor",i.setLineColor,i.getLineColor),t.registerProperty("LineWidth",i.setLineWidth,i.getLineWidth),t.registerProperty("DrawLines",i.setDrawLines,i.getDrawLines),t.registerProperty("FillColor",i.setFillColor,i.getFillColor),t.registerProperty("DrawFill",i.setDrawFill,i.getDrawFill),t.registerProperty("ShapeRendering",i.setShapeRendering,i.getShapeRendering),t.registerProperty("Attributes",i.setAttributes,i.getAttributes),t.registerProperty("EnabledPosition",(function(t){e.getInteractionTarget(r).setMotionEnabled(t)})),t.registerProperty("MovesGroup",(function(t){e.getInteractionTarget(r).setAffectsGroup(t)})),t.registerProperty("EnabledSize",(function(t){e.getInteractionTarget(n).setMotionEnabled(t)})),t.registerProperty("ResizesGroup",(function(t){e.getInteractionTarget(n).setAffectsGroup(t)})),t.registerProperty("Sensitivity",(function(t){e.getInteractionTarget(r).setSensitivity(t),e.getInteractionTarget(n).setSensitivity(t)})),t.registerAction("OnDoubleClick",e.getOnDoubleClickInformation),t.registerAction("OnEnter",e.getOnEnterInformation),t.registerAction("OnExit",e.getOnExitInformation),t.registerAction("OnPress",e.getOnPressInformation),t.registerAction("OnDrag",e.getOnDragInformation),t.registerAction("OnRelease",e.getOnReleaseInformation)},copyTo:function(e,t){var r=EJSS_DRAWING2D.InteractionTarget,n=EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION,i=EJSS_DRAWING2D.PanelInteraction.TARGET_SIZE;EJSS_DRAWING2D.Style.copyTo(e.getStyle(),t.getStyle()),t.setVisible(e.isVisible()),t.setMeasured(e.isMeasured()),t.setPosition(e.getPosition()),t.setPixelPosition(e.isPixelPosition()),t.setSize(e.getSize()),t.setPixelSize(e.isPixelSize()),t.setTransformation(e.getTransformation()),t.setRotate(e.getRotate()),t.setRelativePosition(e.getRelativePosition()),r.copyTo(e.getInteractionTarget(n),t.getInteractionTarget(n)),r.copyTo(e.getInteractionTarget(i),t.getInteractionTarget(i)),t.setParent(e.getParent(),e)},getRelativePositionOffset:function(e,t,r,n){var i=0,o=0;switch(e){default:case EJSS_DRAWING2D.Element.CENTER:i=0,o=0;break;case EJSS_DRAWING2D.Element.NORTH:i=0,o=-r/2;break;case EJSS_DRAWING2D.Element.SOUTH:i=0,o=r/2;break;case EJSS_DRAWING2D.Element.EAST:i=-t/2,o=0;break;case EJSS_DRAWING2D.Element.WEST:i=t/2,o=0;break;case EJSS_DRAWING2D.Element.NORTH_EAST:i=-t/2,o=-r/2;break;case EJSS_DRAWING2D.Element.NORTH_WEST:i=t/2,o=-r/2;break;case EJSS_DRAWING2D.Element.SOUTH_EAST:i=-t/2,o=r/2;break;case EJSS_DRAWING2D.Element.SOUTH_WEST:i=t/2,o=r/2}return void 0!==n&&n&&(o=-o),[i,o]},getSWRelativePositionOffset:function(e,t,r,n){var i=0,o=0;switch(e){default:case EJSS_DRAWING2D.Element.CENTER:i=-t/2,o=r/2;break;case EJSS_DRAWING2D.Element.NORTH:i=-t/2,o=r;break;case EJSS_DRAWING2D.Element.SOUTH:i=-t/2,o=0;break;case EJSS_DRAWING2D.Element.EAST:i=-t,o=r/2;break;case EJSS_DRAWING2D.Element.WEST:i=0,o=r/2;break;case EJSS_DRAWING2D.Element.NORTH_EAST:i=-t,o=r;break;case EJSS_DRAWING2D.Element.NORTH_WEST:i=0,o=r;break;case EJSS_DRAWING2D.Element.SOUTH_EAST:i=-t,o=0;break;case EJSS_DRAWING2D.Element.SOUTH_WEST:i=0,o=0}return void 0!==n&&n&&(o=-o),[i,o]}},EJSS_DRAWING2D.element=function(e){var t={},r=EJSS_DRAWING2D.Element,n=EJSS_DRAWING2D.PanelInteraction,i=EJSS_DRAWING2D.style(e),o=!0,a=!0,s=r.CENTER,l=0,u=0,g=!1,c=1,S=1,f=!1,E=[],d=0,p={positionTarget:EJSS_DRAWING2D.interactionTarget(t,n.TARGET_POSITION,r.CENTER),sizeTarget:EJSS_DRAWING2D.interactionTarget(t,n.TARGET_SIZE,r.NORTH_EAST)},h=null,m=null,A=null,_=-1,D=[],I=[],P=!0,C=!0,T={propertiesChanged:function(){},invokeAction:function(){}},y=null;return t.getName=function(){return e},t.setParent=function(e,r){e.render?(t.setGroup(null),e.addElement(t),t.setPanel(e)):"ElementGroup"==e.getClass()?(t.setGroup(e),t.getGroupPanel().addElement(t,r),t.setPanel(t.getGroupPanel())):console.log("WARNING: setParent() - Parent not valid : "+e.getName())},t.getParent=function(){return null!==m?t.getGroup():t.getPanel()},t.isGroup=function(){return!1},t.getStyle=function(){return i},t.setCustomObject=function(e){y=e},t.getCustomObject=function(){return y},t.setX=function(e,t){l!=e&&(l=e,C=!0)},t.getX=function(){return l},t.setY=function(e){u!=e&&(u=e,C=!0)},t.getY=function(){return u},t.setPosition=function(e){t.setX(e[0]),t.setY(e[1])},t.getPosition=function(){return[l,u]},t.setPixelPosition=function(e){g!=e&&(g=e,C=!0)},t.isPixelPosition=function(){return g},t.setSizeX=function(e){c!=e&&(c=e,C=!0)},t.getSizeX=function(){return c},t.setSizeY=function(e){S!=e&&(S=e,C=!0)},t.getSizeY=function(){return S},t.setSize=function(e){t.setSizeX(e[0]),t.setSizeY(e[1])},t.getSize=function(){return[t.getSizeX(),t.getSizeY()]},t.setPixelSize=function(e){f!=e&&(f=e,C=!0)},t.isPixelSize=function(){return f},t.setBounds=function(e){var r,n,i,o;e.left?(r=e.left,n=e.right,i=e.top,o=e.bottom):(r=e[0],n=e[1],i=e[2],o=e[3]);var a=n-r,s=o-i,l=t.getRelativePositionOffset(a,s),u=s/2,g=r+a/2-l[0],c=i+u-l[1];t.setX(g),t.setY(c),t.setSizeX(a),t.setSizeY(s)},t.getBounds=function(){var e=f?h.toPanelMod([c,-S]):[c,S],r=e[0]/2,n=e[1]/2,i=t.getRelativePositionOffset(e[0],e[1]);return{left:l+i[0]-r,right:l+i[0]+r,top:u+i[1]+n,bottom:u+i[1]-n}},t.getAbsoluteBounds=function(e){var r=t.getBounds(),n=t.toGroupSpace([r.left,r.top],e),i=t.toGroupSpace([r.right,r.bottom],e);return{left:n[0],top:n[1],right:i[0],bottom:i[1]}},t.setRelativePosition=function(e){"string"==typeof e&&(e=r[e.toUpperCase()]),s!=e&&(s=e,C=!0)},t.getRelativePosition=function(){return s},t.getRelativePositionOffset=function(e,t){var n,i;Array.isArray(e)?(n=e[0],i=e[1]):(n=e,i=t);var o=!!h.getInvertedScaleY&&h.getInvertedScaleY();return r.getRelativePositionOffset(s,n,i,o)},t.setVisible=function(e){e!=o&&(o=e,C=!0)},t.isVisible=function(){return o},t.isGroupVisible=function(){for(var e=m;null!=e;){if(!e.isVisible())return!1;e=e.getGroup()}return o},t.setMeasured=function(e){a=e},t.isMeasured=function(){return a},t.setTransformation=function(e){null==e?E=[]:Array.isArray(e)&&e.length>5?EJSS_TOOLS.compareArrays(E,e)||(E=e.slice(),C=!0):d!=e&&(d=e,C=!0)},t.getTransformation=function(){return E},t.setRotate=function(e){d!=e&&(d=e,C=!0)},t.getRotate=function(){return d},t.setScaleX=function(e){0==E.length&&(E=[1,0,0,1,0,0]),E[0]!=e&&(E[0]=e,C=!0)},t.getScaleX=function(){return 0==E.length?1:E[0]},t.setScaleY=function(e){0==E.length&&(E=[1,0,0,1,0,0]),E[3]!=e&&(E[3]=e,C=!0)},t.getScaleY=function(){return 0==E.length?1:E[3]},t.setSkewX=function(e){0==E.length&&(E=[1,0,0,1,0,0]),E[2]!=e&&(E[2]=e,C=!0)},t.getSkewX=function(){return 0==E.length?0:E[2]},t.setSkewY=function(e){0==E.length&&(E=[1,0,0,1,0,0]),E[1]!=e&&(E[1]=e,C=!0)},t.getSkewY=function(){return 0==E.length?0:E[1]},t.getInfo=function(){return"x="+l.toFixed(2)+" y="+u.toFixed(2)},t.setPanel=function(e){h=e,P=!0},t.getPanel=function(){return h},t.getGroupPanel=function(){for(var e=t;e.getGroup();)e=e.getGroup();return e.getPanel()},t.setGroup=function(e){m=e,C=!0},t.getGroup=function(){return m},t.setSet=function(e,t){A=e,_=t},t.getSet=function(){return A},t.getSetIndex=function(){return _},t.isChanged=function(){return C},t.setChanged=function(e){C=e},t.isGroupChanged=function(){for(var e=t.getGroup();null!=e;){if(e.isChanged())return!0;e=e.getGroup()}return!1},t.setMustProject=function(e){P=e},t.isMustProject=function(){return P},t.getPixelPosition=function(e){return(t.isChanged()||t.isGroupChanged()||t.isMustProject()||e)&&(D=t.getPixelPositionOf(l,u,e),I=t.getPixelSizeOf(c,S),t.setMustProject(e)),D},t.getPixelSizes=function(e){return(t.isChanged()||t.isGroupChanged()||t.isMustProject())&&(D=t.getPixelPositionOf(l,u,e),I=t.getPixelSizeOf(c,S),t.setMustProject(e)),I},t.getAbsoluteSize=function(){var e=f?h.toPanelMod([c,-S]):[c,S];return t.toGroupSpaceMod(e)},t.getAbsolutePosition=function(e){var r;return r=g?null===m?h.toPanelPosition([l,u]):h.toPanelPosition([l,u],EJSS_DRAWING2D.DrawingPanel.SCALE_NUM):[l,u],t.toGroupSpace(r,e)},t.setAbsolutePosition=function(e){g?console.log("setAbsolutePosition not supported!"):t.setPosition(t.toElementSpace(e))},t.setAbsoluteX=function(e){g?console.log("setAbsoluteX not supported!"):t.setX(t.toElementSpace([e,0])[0])},t.setAbsoluteY=function(e){g?console.log("setAbsoluteY not supported!"):t.setY(t.toElementSpace([0,e])[1])},t.getPixelSizeOf=function(e,r){return f?[e,-r]:t.getGroupPanel().toPixelMod(t.toGroupSpaceMod([e,r]))},t.getPixelPositionOf=function(e,r,n){if(g){if(m){var i=m.getPixelPosition();return[i[0]+e,i[1]-r]}return[t.getGroupPanel().toPixelAxisX(e),t.getGroupPanel().toPixelAxisY(r)]}return null===m?t.getGroupPanel().toPixelPosition(t.toGroupSpace([e,r])):t.getGroupPanel().toPixelPosition(t.toGroupSpace([e,r],n),EJSS_DRAWING2D.DrawingPanel.SCALE_NUM)},t.toGroupSpaceMod=function(e){for(var t=m;null!=t;)e[0]*=t.getSizeX(),e[1]*=t.getSizeY(),t=t.getGroup();return e},t.toGroupSpace=function(e,t){for(var r=m;null!=r;)e[0]*=r.getSizeX(),e[1]*=r.getSizeY(),e[0]+=r.getX(),e[1]+=r.getY(),r=r.getGroup();if(t)for(r=m;null!=r;){var n=r.getRotate();if(0!=n){var i=r.getAbsolutePosition();e=EJSS_TOOLS.Mathematics.rotate(i,e,-n)}r=r.getGroup()}return e},t.toElementSpace=function(e){for(var t=[],r=m;null!=r;)t.push(r),r=r.getGroup();for(var n=(t=t.reverse()).length,i=0;i<n;i++){r=t[i];e[0]-=r.getX(),e[1]-=r.getY(),0==r.getSizeX()?e[0]=0:e[0]/=r.getSizeX(),0==r.getSizeY()?e[1]=0:e[1]/=r.getSizeY()}return e},t.getController=function(){return T},t.setController=function(e){T=e},t.getInteractionTarget=function(e){switch(e){case n.TARGET_POSITION:return p.positionTarget;case n.TARGET_SIZE:return p.sizeTarget}return null},t.getInteractionTargets=function(){return[p.positionTarget,p.sizeTarget]},t.getInteractionInformation=function(){return{info:t.getPosition(),element:t,point:t.getGroupPanel().getPanelInteraction().getInteractionPoint()}},t.getOnDoubleClickInformation=function(){var e=t.getInteractionInformation();return e.action="OnDoubleClick",e},t.getOnEnterInformation=function(){var e=t.getInteractionInformation();return e.action="OnEnter",e},t.getOnExitInformation=function(){var e=t.getInteractionInformation();return e.action="OnExit",e},t.getOnPressInformation=function(){var e=t.getInteractionInformation();return e.action="OnPress",e},t.getOnDragInformation=function(){var e=t.getInteractionInformation();return e.action="OnDrag",e},t.getOnReleaseInformation=function(){var e=t.getInteractionInformation();return e.action="OnRelease",e},t.registerProperties=function(e){EJSS_DRAWING2D.Element.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Element.copyTo(t,e)},t.serialize=function(){return{mStyle:i.serialize(),mVisible:o,mMeasured:a,mRelativePosition:s,mX:l,mY:u,mPixelPosition:g,mSizeX:c,mSizeY:S,mPixelSize:f,mTransformation:E,mInteraction:{},mPanel:h?h.getName():h,mGroup:m?m.getName():m,mSet:A?A.getName():A,mIndexInSet:_,mProjectedPosition:D,mProjectedSize:I}},t.unserialize=function(e){i.unserialize(e.mStyle),o=e.mVisible,a=e.mMeasured,s=e.mRelativePosition,l=e.mX,u=e.mY,g=e.mPixelPosition,c=e.mSizeX,S=e.mSizeY,f=e.mPixelSize,E=e.mTransformation,_=e.mIndexInSet,D=e.mProjectedPosition,I=e.mProjectedSize,C=!0},i.setChangeListener((function(e){C=!0})),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ElementSet={registerProperties:function(e,t){var r=EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION,n=EJSS_DRAWING2D.PanelInteraction.TARGET_SIZE;e.setController(t),e.setToEach((function(e,t){e.setController(t)}),t),t.registerProperty("Parent",(function(t){e.setParent(t),e.setToEach((function(e,t){e.setParent(t)}),e)})),t.registerProperty("NumberOfElements",e.setNumberOfElements),t.registerProperty("ElementInteracted",e.setElementInteracted,e.getElementInteracted),t.registerProperty("X",(function(t){e.setToEach((function(e,t){e.setX(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getX()}))})),t.registerProperty("Y",(function(t){e.setToEach((function(e,t){e.setY(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getY()}))})),t.registerProperty("Position",(function(t){e.setToEach((function(e,t){e.setPosition(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getPosition()}))})),t.registerProperty("PixelPosition",(function(t){e.setToEach((function(e,t){e.setPixelPosition(t)}),t)})),t.registerProperty("Diameter",(function(t){e.setToEach((function(e,t){e.setSize([t,t])}),t)})),t.registerProperty("Radius",(function(t){e.setToEach((function(e,t){e.setSize([2*t,2*t])}),t)})),t.registerProperty("SizeX",(function(t){e.setToEach((function(e,t){e.setSizeX(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getSizeX()}))})),t.registerProperty("SizeY",(function(t){e.setToEach((function(e,t){e.setSizeY(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getSizeY()}))})),t.registerProperty("Size",(function(t){e.setToEach((function(e,t){e.setSize(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getSize()}))})),t.registerProperty("PixelSize",(function(t){e.setToEach((function(e,t){e.setPixelSize(t)}),t)})),t.registerProperty("Bounds",(function(t){e.setToEach((function(e,t){e.setX(t[0]),e.setY(t[2]),e.setSizeX(t[1]-t[0]),e.setSizeY(t[3]-t[2])}),t)}),(function(){return e.getFromEach((function(e){return[e.getX(),e.getX()+e.getSizeX(),e.getY(),e.getY()+e.getSizeY()]}))})),t.registerProperty("Visibility",(function(t){e.setToEach((function(e,t){e.setVisible(t)}),t)})),t.registerProperty("Measured",(function(t){e.setToEach((function(e,t){e.setMeasured(t)}),t)})),t.registerProperty("Transformation",(function(t){e.setToEach((function(e,t){e.setTransformation(t)}),t)})),t.registerProperty("Rotate",(function(t){e.setToEach((function(e,t){e.setRotate(t)}),t)})),t.registerProperty("ScaleX",(function(t){e.setToEach((function(e,t){e.setScaleX(t)}),t)})),t.registerProperty("ScaleY",(function(t){e.setToEach((function(e,t){e.setScaleY(t)}),t)})),t.registerProperty("SkewX",(function(t){e.setToEach((function(e,t){e.setSkewX(t)}),t)})),t.registerProperty("SkewY",(function(t){e.setToEach((function(e,t){e.setSkewY(t)}),t)})),t.registerProperty("RelativePosition",(function(t){e.setToEach((function(e,t){e.setRelativePosition(t)}),t)})),t.registerProperty("LineColor",(function(t){e.setToEach((function(e,t){e.getStyle().setLineColor(t)}),t)})),t.registerProperty("LineWidth",(function(t){e.setToEach((function(e,t){e.getStyle().setLineWidth(t)}),t)})),t.registerProperty("DrawLines",(function(t){e.setToEach((function(e,t){e.getStyle().setDrawLines(t)}),t)})),t.registerProperty("FillColor",(function(t){e.setToEach((function(e,t){e.getStyle().setFillColor(t)}),t)})),t.registerProperty("DrawFill",(function(t){e.setToEach((function(e,t){e.getStyle().setDrawFill(t)}),t)})),t.registerProperty("Attributes",(function(t){e.setToEach((function(e,t){e.getStyle().setAttributes(t)}),t)})),t.registerProperty("ShapeRendering",(function(t){e.setToEach((function(e,t){e.getStyle().setShapeRendering(t)}),t)})),t.registerProperty("EnabledPosition",(function(t){e.setToEach((function(e,t){e.getInteractionTarget(r).setMotionEnabled(t)}),t)})),t.registerProperty("MovesGroup",(function(t){e.setToEach((function(e,t){e.getInteractionTarget(r).setAffectsGroup(t)}),t)})),t.registerProperty("EnabledSize",(function(t){e.setToEach((function(e,t){e.getInteractionTarget(n).setMotionEnabled(t)}),t)})),t.registerProperty("ResizesGroup",(function(t){e.setToEach((function(e,t){e.getInteractionTarget(n).setAffectsGroup(t)}),t)})),t.registerProperty("Sensitivity",(function(t){e.setToEach((function(e,t){e.getInteractionTarget(r).setSensitivity(t),e.getInteractionTarget(n).setSensitivity(t)}),t)}));var i=function(){var r=e.getGroupPanel(),n=r.getPanelInteraction().getIndexElement(),i=r.getElements()[n],o=i.getSetIndex();return e.setElementInteracted(o),t.propertiesChanged("ElementInteracted"),{index:o,position:i.getPosition()}};t.registerAction("OnDoubleClick",i),t.registerAction("OnEnter",i),t.registerAction("OnExit",i),t.registerAction("OnPress",i),t.registerAction("OnDrag",i),t.registerAction("OnRelease",i)}},EJSS_DRAWING2D.elementSet=function(e,t){var r=EJSS_DRAWING2D.group(t),n=EJSS_DRAWING2D.ElementSet,i=[],o=!1,a=-1,s=[];function l(t){var n=r.getName?r.getName():"unnamed";t=Math.max(1,t);var o=i.length-t;if(o>0){s=i.splice(t,o);for(var a=0;a<s.length;a++){var l=s[a].getPanel();l&&l.removeElement(s[a])}}else if(o<0){s=[];for(var u=r.getController(),g=i[i.length-1],c=i.length;c<t;c++){var S=e(n+"["+c+"]");S.setSet(r,c),g.copyTo(S),S.setController(u),i.push(S)}}}r.setNumberOfElements=function(e){o=!0,l(e)},r.getElements=function(){return i},r.getElement=function(e){return i[e]},r.getLastElements=function(){var e=s.slice();return s=[],e},r.setElementInteracted=function(e){a=e},r.getElementInteracted=function(){return a};var u=r.setPanel;r.setPanel=function(e){u(e);for(var t=0,r=i.length;t<r;t++)i[t].setPanel(e)},r.setToEach=function(e,t){if(Array.isArray(t)){o||i.length<t.length&&l(t.length);for(var r=0,n=Math.min(i.length,t.length);r<n;r++)e(i[r],t[r])}else for(r=0,n=i.length;r<n;r++)e(i[r],t)},r.getFromEach=function(e){for(var t=[],r=0,n=i.length;r<n;r++)t[r]=e(i[r]);return t},r.registerProperties=function(e){n.registerProperties(r,e)};var g=e(t+"[0]");return g.setController(r.getController()),g.setSet(r,0),i.push(g),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Grid={SCALE_NUM:0,SCALE_LOG:1,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("StepX",e.setStepX,e.getStepX),t.registerProperty("StepY",e.setStepY,e.getStepY),t.registerProperty("TicksX",e.setTicksX,e.getTicksX),t.registerProperty("TicksY",e.setTicksY,e.getTicksY),t.registerProperty("TickStepX",e.setTickStepX,e.getTickStepX),t.registerProperty("TickStepY",e.setTickStepY,e.getTickStepY),t.registerProperty("TicksXMode",e.setTicksXMode,e.getTicksXMode),t.registerProperty("TicksYMode",e.setTicksYMode,e.getTicksYMode),t.registerProperty("ShowX",e.setShowX,e.getShowX),t.registerProperty("ShowY",e.setShowY,e.getShowY),t.registerProperty("FixedTickX",e.setFixedTickX,e.getFixedTickX),t.registerProperty("FixedTickY",e.setFixedTickY,e.getFixedTickY),t.registerProperty("ScaleX",e.setScaleX,e.getScaleX),t.registerProperty("ScaleY",e.setScaleY,e.getScaleY),t.registerProperty("ScalePrecisionX",e.setScalePrecisionX,e.getScalePrecisionX),t.registerProperty("ScalePrecisionY",e.setScalePrecisionY,e.getScalePrecisionY),t.registerProperty("AutoTicksX",e.setAutoTicksX,e.getAutoTicksX),t.registerProperty("AutoTicksY",e.setAutoTicksY,e.getAutoTicksY),t.registerProperty("AutoStepXMin",e.setAutoStepXMin,e.getAutoStepXMin),t.registerProperty("AutoStepYMin",e.setAutoStepYMin,e.getAutoStepYMin),t.registerProperty("AutoTicksXRange",e.setAutoTicksXRange,e.getAutoTicksXRange),t.registerProperty("AutoTicksYRange",e.setAutoTicksYRange,e.getAutoTicksYRange),t.registerProperty("LineColorX",e.setLineColorX,e.getLineColorX),t.registerProperty("LineWidthX",e.setLineWidthX,e.getLineWidthX),t.registerProperty("ShapeRenderingX",e.setShapeRenderingX,e.getShapeRenderingX),t.registerProperty("LineColorY",e.setLineColorY,e.getLineColorY),t.registerProperty("LineWidthY",e.setLineWidthY,e.getLineWidthY),t.registerProperty("ShapeRenderingY",e.setShapeRenderingY,e.getShapeRenderingY)}},EJSS_DRAWING2D.grid=function(e){var t=EJSS_DRAWING2D.element(e),r=!0,n=!0,i=0,o=0,a=0,s=0,l=0,u=0,g=!0,c=!0,S=Number.NaN,f=Number.NaN,E=[-1,1],d=[-1,1],p=1,h=1,m=EJSS_DRAWING2D.Grid.SCALE_NUM,A=EJSS_DRAWING2D.Grid.SCALE_NUM,_=40,D=40,I=[5,10,20],P=[5,10,20],C="black",T=.5,y=EJSS_DRAWING2D.Style.RENDER_AUTO,R="black",N=.5,v=EJSS_DRAWING2D.Style.RENDER_AUTO;return t.getClass=function(){return"ElementGrid"},t.setAutoTicksRangeY=function(e){P!=e&&(P=e,t.setChanged(!0))},t.getAutoTicksRangeY=function(){return P},t.setAutoTicksRangeX=function(e){I!=e&&(I=e,t.setChanged(!0))},t.getAutoTicksRangeX=function(){return I},t.setAutoStepYMin=function(e){D!=e&&(D=e,t.setChanged(!0))},t.getAutoStepYMin=function(){return D},t.setAutoStepXMin=function(e){_!=e&&(_=e,t.setChanged(!0))},t.getAutoStepXMin=function(){return _},t.setScaleY=function(e){d!=e&&(d=e,t.setChanged(!0))},t.getScaleY=function(){return d},t.setScaleX=function(e){E!=e&&(E=e,t.setChanged(!0))},t.getScaleX=function(){return E},t.setScalePrecisionX=function(e){p!=e&&(p=e,t.setChanged(!0))},t.getScalePrecisionX=function(){return p},t.setScalePrecisionY=function(e){h!=e&&(h=e,t.setChanged(!0))},t.getScalePrecisionY=function(){return h},t.setFixedTickX=function(e){S!=e&&(S=e,t.setChanged(!0))},t.getFixedTickX=function(){return S},t.setFixedTickY=function(e){f!=e&&(f=e,t.setChanged(!0))},t.getFixedTickY=function(){return f},t.setAutoTicksX=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getAutoTicksX=function(){return r},t.setAutoTicksY=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getAutoTicksY=function(){return n},t.setStepX=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getStepX=function(){return a},t.setStepY=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getStepY=function(){return s},t.setTickStepX=function(e){l!=e&&(l=e,t.setChanged(!0))},t.getTickStepX=function(){return l},t.setTickStepY=function(e){u!=e&&(u=e,t.setChanged(!0))},t.getTickStepY=function(){return u},t.setTicksX=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getTicksX=function(){return i},t.setTicksY=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getTicksY=function(){return o},t.setTicksXMode=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Grid[e.toUpperCase()]),m!=e&&(m=e,t.setChanged(!0))},t.getTicksXMode=function(){return m},t.setTicksYMode=function(e){"string"==typeof e&&(ticksXMode=EJSS_DRAWING2D.Grid[e.toUpperCase()]),A!=e&&(A=e,t.setChanged(!0))},t.setShowX=function(e){g!=e&&(g=e,t.setChanged(!0))},t.getShowX=function(){return g},t.setShowY=function(e){c!=e&&(c=e,t.setChanged(!0))},t.getShowY=function(){return c},t.getTicksYMode=function(){return A},t.setLineColorX=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=C&&(C=e,t.setChanged(!0)),t},t.getLineColorX=function(){return C},t.setLineWidthX=function(e){e!=T&&(T=e,t.setChanged(!0))},t.getLineWidthX=function(){return T},t.setShapeRenderingX=function(e){"RENDER"==e.substring(0,6)&&(e=EJSS_DRAWING2D.Style[e.toUpperCase()]),y!=e&&(y=e,t.setChanged(!0))},t.getShapeRenderingX=function(){return y},t.setLineColorY=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=R&&(R=e,t.setChanged(!0)),t},t.getLineColorY=function(){return R},t.setLineWidthY=function(e){e!=N&&(N=e,t.setChanged(!0))},t.getLineWidthY=function(){return N},t.setShapeRenderingY=function(e){"RENDER"==e.substring(0,6)&&(e=EJSS_DRAWING2D.Style[e.toUpperCase()]),v!=e&&(v=e,t.setChanged(!0))},t.getShapeRenderingY=function(){return v},t.registerProperties=function(e){EJSS_DRAWING2D.Grid.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Group={},EJSS_DRAWING2D.group=function(e){var t=EJSS_DRAWING2D.element(e);return t.getClass=function(){return"ElementGroup"},t.isGroup=function(){return!0},t},EJSS_DRAWING2D.GroupSet={},EJSS_DRAWING2D.groupSet=function(e){return EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.group,e)};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Histogram={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setInput(e.getInput()),t.setEnabled(e.getEnabled()),t.setOccurrences(e.getOccurrences()),t.setClearAtInput(e.getClearAtInput()),t.setDiscrete(e.getDiscrete()),t.setNormalized(e.getNormalized()),t.setBinWidth(e.getBinWidth())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Input",e.addInput),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("Occurrences",e.setOccurrences,e.getOccurrences),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Discrete",e.setDiscrete,e.getDiscrete),t.registerProperty("Normalized",e.setNormalized,e.getNormalized),t.registerProperty("BinWidth",e.setBinWidth,e.getBinWidth),t.registerProperty("FixBin",e.setFixBin,e.getFixBin)}},EJSS_DRAWING2D.histogram=function(e){var t=EJSS_DRAWING2D.element(e),r=[],n=!0,i=1,o=!1,a=!1,s=!1,l=1,u=0,g=null;return t.getClass=function(){return"ElementHistogram"},t.dataCollected=function(){},t.getInput=function(){return r},t.addInput=function(e){if(n){o&&t.clear();for(var a=0;a<i;a++)e instanceof Array?r=r.concat(e):r.push(e);g=null,t.setChanged(!0)}},t.clear=function(){r=[],g=null,t.setChanged(!0)},t.getClearAtInput=function(){return o},t.setClearAtInput=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getActive=function(){return n},t.setActive=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getOccurrences=function(){return i},t.setOccurrences=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getDiscrete=function(){return a},t.setDiscrete=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getNormalized=function(){return s},t.setNormalized=function(e){s!=e&&(s=e,g=null,t.setChanged(!0))},t.getBinWidth=function(){return l},t.setBinWidth=function(e){l!=e&&(l=e,g=null,t.setChanged(!0))},t.getFixBin=function(){return u},t.setFixBin=function(e){u!=e&&(u=e,g=null,t.setChanged(!0))},t.getBars=function(){if(null!=g)return g;if(0==r.length)return g=[[0,0]];g=[],r=r.sort((function(e,t){return e-t}));for(var e=l/2,t=0==l?r[0]:u-e>r[0]?u-(Math.floor((u-e-r[0])/l)+1)*l:u+e<r[0]?u+Math.floor((r[0]-u-e)/l)*l:u,n=0,i=r.length,o=0;o<i;o++)r[o]<=t+e?n++:(n>0&&(s&&(n/=i),g.push([t,n])),0==l?t=r[o]:t+=(Math.floor((r[o]-t-e)/l)+1)*l,n=1);return n>0&&(s&&(n/=i),g.push([t,n])),g},t.getBounds=function(e){t.getBars();for(var r=g.length,n=g[0][0],i=g[r-1][0],o=0,a=0;a<r;a++)o=Math.max(o,g[a][1]);var s=t.getX(),l=t.getY(),u=t.getSizeX(),c=t.getSizeY(),S=u/2,f=c/2,E=t.getRelativePositionOffset(u,c);return{left:s+E[0]-S+n*u,right:s+E[0]-S+i*u,top:l+E[1]-f+o*c,bottom:l+E[1]-f+0*c}},t.getBoundsOld=function(e){var n,i,o,a;if(0==r.length)n=i=o=a=0;else{console.log("mCurrentInput="+r);var l=r.sort((function(e,t){return e-t})),u=l.length;n=l[0],i=l[u-1],a=0,o=0;var g=[];if(l.forEach((function(e){g[e]=(g[e]||0)+1})),s)for(var c in g)g[c]/=u;for(var c in g)g[c]>a&&(a=g[c])}var S=t.getX(),f=(c=t.getY(),t.getSizeX()),E=t.getSizeY(),d=f/2,p=E/2,h=t.getRelativePositionOffset(f,E);return{left:S+h[0]-d+n*f,right:S+h[0]-d+i*f,top:c+h[1]-p+a*E,bottom:c+h[1]-p+o*E}},t.registerProperties=function(e){EJSS_DRAWING2D.Histogram.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Histogram.copyTo(t,e)},t.getStyle().setFillColor("Blue"),t.getStyle().setLineColor("Black"),t.setRelativePosition("SOUTH_WEST"),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Image={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setImageUrl(e.getImageUrl())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("Encode",e.setEncode)}},EJSS_DRAWING2D.image=function(e){var t=EJSS_DRAWING2D.element(e),r="",n="",i=!1;return t.getClass=function(){return"ElementImage"},t.setImageUrl=function(e){var n=t.getSet(),i=null!=n?n.getResourcePath:t.getResourcePath;null!=i?e=i(e):console.log("No getResourcePath function for "+t.getName()+". Texture = "+e),r!=e&&(r=e,t.setChanged(!0),t.setChangedImage(!0))},t.getImageUrl=function(){return r},t.forceImageUrl=function(e){console.log("Setting image to "+e),r=window.URL.createObjectURL(e),t.setChanged(!0),t.setChangedImage(!0)},t.setChangedImage=function(e){i=e},t.getChangedImage=function(){return i},t.setEncode=function(e){n.length!=e.length&&(n=e,t.setChanged(!0),t.setChangedImage(!0))},t.getEncode=function(){return n},t.getImageData=function(e){var n=t.getPixelSizes(),i=new Image;i.src=r;var o=document.createElement("canvas"),a=o.getContext("2d");if(o.width=Math.abs(n[0])+1,o.height=Math.abs(n[1])+1,!e)return a.drawImage(i,0,0,i.width,i.height,0,0,o.width,o.height),a.getImageData(0,0,o.width,o.height);i.onload=function(){a.drawImage(i,0,0,i.width,i.height,0,0,o.width,o.height),e(a.getImageData(0,0,o.width,o.height))}},t.registerProperties=function(e){EJSS_DRAWING2D.Image.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Image.copyTo(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ImageSet={registerProperties:function(e,t){EJSS_DRAWING2D.ElementSet.registerProperties(e,t),t.registerProperty("ImageUrl",(function(t){e.setToEach((function(e,t){e.setImageUrl(t)}),t)}))}},EJSS_DRAWING2D.imageSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.image,e),r=EJSS_DRAWING2D.ImageSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.analyticCurve=function(e,t){var r,n,i=t.getPixelPosition(),o=t.getPixelSizes(),a=t.getRelativePositionOffset(o),s=i[0]+a[0],l=i[1]+a[1],u=o[0]/2,g=o[1]/2,c=t.getNumPoints(),S=t.getMinimun(),f=t.getMaximun(),E=null==S?t.getPanel().getRealWorldXMin():S,d=null==f?t.getPanel().getRealWorldXMax():f,p=t.getVariable(),h=t.getFunctionX(),m=t.getFunctionY(),A=EJSS_DRAWING2D.functionsParser(),_=!1;try{r=A.parse(h)}catch(e){console.log("Analytic curve error parsing FunctionX: "+h),_=!0}if(!_)try{n=A.parse(m)}catch(e){console.log("Analytic curve error parsing FunctionY: "+m),_=!0}if(_)t.getController().invokeAction("OnError");else{var D=(d-E)/(c-1),I=[],P={},C=t.getParameters();for(var T in C)P[T]=C[T];try{for(var y=0,R=E;R<=d;R+=D){P[p]=R;var N=r.evaluate(P),v=n.evaluate(P);isNaN(N)||isNaN(v)||(I[y]=[],I[y][0]=N,I[y++][1]=v)}}catch(e){t.getController().invokeAction("OnError")}!function(t,r,n,i,o){e.beginPath();for(var a=0;a<t.length;a++){var s=t[a],l=r+s[0]*i,u=n+s[1]*o,g=s[2];0==a||0==g?e.moveTo(l,u):e.lineTo(l,u)}}(I,s-u,l-g,o[0],o[1]);var O=t.getStyle();O.getDrawFill()&&"none"!=O.getFillColor()&&(e.fillStyle=O.getFillColor(),e.fill()),O.getDrawLines()&&(e.lineWidth=O.getLineWidth(),e.strokeStyle=O.getLineColor(),e.stroke())}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.arrow=function(e,t){var r=EJSS_DRAWING2D.Arrow;function n(t,n,i,o,a,s,l,u,g){e.save(),o/=2,a/=2;var c=0==u?Math.PI/2:Math.atan(g/u);switch(c+=u<0?-Math.PI/2:Math.PI/2,i){case r.TRIANGLE:e.beginPath(),e.translate(t,n),e.rotate(c),e.moveTo(0,a/2),e.lineTo(o,a/2),e.lineTo(0,-a/2),e.lineTo(-o,a/2),e.closePath();break;case r.ANGLE:e.beginPath(),e.translate(t,n),e.rotate(c),e.moveTo(o,a),e.lineTo(0,0),e.lineTo(-o,a);break;case r.LINE:e.beginPath(),e.translate(t,n),e.rotate(c),e.moveTo(o,0),e.lineTo(-o,0);break;case r.RECTANGLE:e.beginPath(),e.translate(t,n),e.rotate(c),e.moveTo(0,-a),e.lineTo(o,-a),e.lineTo(o,a),e.lineTo(-o,a),e.lineTo(-o,-a),e.closePath();break;case r.POINTED:e.beginPath(),e.translate(t,n),e.rotate(c),e.moveTo(0,a/4),e.lineTo(o,a),e.lineTo(0,-a/4),e.lineTo(-o,a),e.closePath();break;case r.CIRCLE:var S=o<a?o:a;e.beginPath(),e.translate(t,n),e.arc(0,0,S,0,2*Math.PI,!1);break;case r.DIAMOND:e.beginPath(),e.translate(t,n),e.rotate(c),e.moveTo(0,-a),e.lineTo(o,0),e.lineTo(0,a),e.lineTo(-o,0),e.closePath();break;case r.INVTRIANGLE:e.beginPath(),e.translate(t,n),e.rotate(c),e.moveTo(0,-a/2),e.lineTo(-o,-a/2),e.lineTo(0,a/2),e.lineTo(o,-a/2),e.closePath();break;case r.INVANGLE:e.beginPath(),e.translate(t,n),e.rotate(c),e.moveTo(-o,-a),e.lineTo(0,0),e.lineTo(o,-a);break;case r.WEDGE:case r.CURVE:console.log("Type of Arrow: not supported")}"none"!=l&&(i!=r.ANGLE&&i!=r.INVANGLE&&(e.fillStyle=l,e.fill()),i!=r.POINTED&&(e.lineWidth=s,e.strokeStyle=l,e.stroke())),e.restore()}var i=t.getPixelPosition(),o=t.getPixelSizes(),a=t.getRelativePositionOffset(o),s=i[0]+a[0],l=i[1]+a[1],u=o[0]/2,g=o[1]/2;if(0!=o[0]||0!=o[1]){e.beginPath(),e.moveTo(s-u,l-g),e.lineTo(s+u,l+g);var c=t.getStyle();if(c.getDrawFill()&&"none"!=c.getFillColor()&&(e.fillStyle=c.getFillColor(),e.fill()),c.getDrawLines()&&(e.lineWidth=c.getLineWidth(),e.strokeStyle=c.getLineColor(),e.stroke()),t.getMarkEnd()!=r.NONE){var S=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([o[0],o[1]]),f=0!=S&&S<t.getMarkEndWidth()?S:t.getMarkEndWidth(),E=0!=S&&S<t.getMarkEndHeight()?S:t.getMarkEndHeight(),d="none"==t.getMarkEndColor()?t.getStyle().getLineColor():t.getMarkEndColor(),p=t.getMarkEndStroke()<0?t.getStyle().getLineWidth():t.getMarkEndStroke();n(s+u,l+g,t.getMarkEnd(),f,E,p,d,u,g)}if(t.getMarkMiddle()!=r.NONE){var h=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([o[0],o[1]]),m=0!=h&&h<t.getMarkMiddleWidth()?h:t.getMarkMiddleWidth(),A=0!=h&&h<t.getMarkMiddleHeight()?h:t.getMarkMiddleHeight();d="none"==t.getMarkMiddleColor()?t.getStyle().getLineColor():t.getMarkMiddleColor(),p=t.getMarkMiddleStroke()<0?t.getStyle().getLineWidth():t.getMarkMiddleStroke();n(s,l,t.getMarkMiddle(),m,A,p,d,u,g)}if(t.getMarkStart()!=r.NONE){var _=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([o[0],o[1]]),D=0!=_&&_<t.getMarkStartWidth()?_:t.getMarkStartWidth(),I=0!=_&&_<t.getMarkStartHeight()?_:t.getMarkStartHeight();d="none"==t.getMarkStartColor()?t.getStyle().getLineColor():t.getMarkStartColor(),p=t.getMarkStartStroke()<0?t.getStyle().getLineWidth():t.getMarkStartStroke();n(s-u,l-g,t.getMarkStart(),D,I,p,d,u,g)}}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.axis=function(e,t){function r(t,r,n,i){i==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?(e.moveTo(t-n/2,r),e.lineTo(t+n/2,r)):(e.moveTo(t,r-n/2),e.lineTo(t,r+n/2))}function n(r,n,i,o,a){e.save();var s="";s+="none"!=(o=t.getFont()).getFontStyle()?o.getFontStyle()+" ":"",s+="none"!=o.getFontWeight()?o.getFontWeight()+" ":"",s+=o.getFontSizeString()+"px ",s+=o.getFontFamily(),e.font=s,e.fillStyle=o.getFillColor(),a?r-=e.measureText(i).width/2+.5:n+=o.getFontSize()/2,e.fillText(i,r,n),e.restore()}if(t.getShow()){var i=t.getPixelPosition(),o=t.getPixelSizes(),a=t.getRelativePositionOffset(o),s=i[0]+a[0],l=i[1]+a[1],u=o[0]/2,g=o[1]/2,c=t.getStyle(),S=t.getOrient(),f=t.getInvertedScaleY();e.beginPath(),function(t,r,n,i,o,a){o==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?(a&&(i=-i,r=-r),e.moveTo(t,r-i),e.lineTo(t,r+i)):(e.moveTo(t-n,r),e.lineTo(t+n,r))}(s,l,u,g,S,f);var E=S==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?Math.abs(o[1]):Math.abs(o[0]),d=t.getTicksMode();if(d==EJSS_DRAWING2D.Axis.SCALE_LOG){if((y=t.getScale())[0]>0&&y[1]>0){var p=t.getTicks(),h=t.getScalePrecision(),m=t.getTicksSize();EJSS_GRAPHICS.GraphicsUtils.drawLogTicks(s,l,u,g,E,m,y,p,S,r);var A=t.getFont(),_=t.getTextPosition();EJSS_GRAPHICS.GraphicsUtils.drawLogTicksText(s,l,u,g,p,m,y,h,A,_,S,n)}}else if(d==EJSS_DRAWING2D.Axis.SCALE_NUM){var D=0,I=0;if(t.getAutoTicks())for(var P=t.getAutoStepMin(),C=t.getAutoTicksRange(),T=C.length-1;T>=0&&!(1.001*(D=Math.abs(E/C[T]))>=P);T--);else 0!=(p=t.getTicks())?D=E/p:(D=t.getStep(),I=t.getTickStep());h=t.getScalePrecision();var y=t.getScale();if(0==I)var R=Math.abs((y[1]-y[0])*D/E);else{R=I;D=Math.abs(R*E/(y[1]-y[0]))}var N=Math.pow(10,h),v=Math.round(R*N)/N;v>0&&(R=v,D=Math.abs(v*E/(y[1]-y[0])));var O=t.getFixedTick(),M=y[1];isNaN(O)||(M=O<y[0]?O+(Math.floor((y[0]-O)/R)+1)*R:O>y[1]?O-(Math.floor((O-y[1])/R)+1)*R:O);var b=Math.abs((y[0]-M)%R),G=Math.abs(b-R);(b<.001||G<.001)&&(b=0);var L=E*b/Math.abs(y[1]-y[0]);m=t.getTicksSize();EJSS_GRAPHICS.GraphicsUtils.drawDecTicks(s,l,u,g,m,D,L,S,f,r);A=t.getFont(),_=t.getTextPosition();EJSS_GRAPHICS.GraphicsUtils.drawDecTicksText(s,l,u,g,m,D,L,y,h,R,b,A,_,S,f,n)}(c=t.getStyle()).getDrawFill()&&"none"!=c.getFillColor()&&(e.fillStyle=c.getFillColor(),e.fill()),c.getDrawLines()&&(e.lineWidth=c.getLineWidth(),e.strokeStyle=c.getLineColor(),e.stroke())}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.byteRaster=function(e,t){if(t.getDataChanged()){var r=t.getData(),n=t.getColorMapper().getColors(),i=r.length,o=r[0].length,a=t.getColorMapper().getNumberOfColors(),s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=Math.abs(l[0]/2),f=Math.abs(l[1]/2),E=e.canvas.id;EJSS_SVGGRAPHICS.Utils.ImageDataCanvas(i,o,a,r,n,(function(t){var r=document.getElementById(E);(e=r.getContext("2d")).putImageData(t,g-S,c-f)})),t.setDataChanged(!1)}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.canvas=function(e,t){for(var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=t.getDimensions(),l=s[1]-s[0],u=s[3]-s[2],g=Math.abs(n[0]),c=Math.abs(n[1]),S=g/l,f=c/u,E=o-g/2,d=a+c/2,p=t.getDrawables(),h=0;h<p.length;h++)void 0!==p[h].imageField?EJSS_GRAPHICS.GraphicsUtils.drawImageField(e,E,d,xMin,yMin,g,c,S,f,p[h]):void 0!==p[h].run&&p[h].draw(e,E,d,xMin,yMin,g,c,S,f)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.cellLattice=function(e,t){function r(t,r,n,i,o){e.beginPath();var a=n/2,s=i/2;e.moveTo(t-a,r+s),e.lineTo(t+a,r+s),e.lineTo(t+a,r-s),e.lineTo(t-a,r-s),e.lineTo(t-a,r+s),e.fillStyle=o,e.fill(),e.lineWidth=1,e.strokeStyle=o,e.stroke()}for(var n=t.getPixelPosition(),i=t.getPixelSizes(),o=t.getRelativePositionOffset(i),a=n[0]+o[0],s=n[1]+o[1],l=i[0]/2,u=i[1]/2,g=t.getStyle(),c=t.getData(),S=t.getColorMapper().getColors(),f=c.length,E=c[0].length,d=Math.abs(i[0]/f),p=Math.abs(i[1]/E),h=a-l+d/2,m=s-u-p/2,A=0;A<E;A++)for(var _=0;_<f;_++)r(h+d*_,m-p*A,d,p,S[c[_][A]]);t.getShowGrid()&&function(t,r,n,i,o,a,s){var l=n/2,u=i/2;!function(t,r,n,i,o,a){e.beginPath(),0==o&&(o=Math.abs(n-t));for(var s=t;s<=n;s+=o)e.moveTo(s,r),e.lineTo(s,i);for(0==a&&(a=Math.abs(r-i)),s=i;s>=r;s-=a)e.moveTo(t,s),e.lineTo(n,s)}(t-l,r+u,t+l,r-u,o,a),s.getDrawFill()&&"none"!=s.getFillColor()&&(e.fillStyle=s.getFillColor(),e.fill()),s.getDrawLines()&&(e.lineWidth=s.getLineWidth(),e.strokeStyle=s.getLineColor(),e.stroke())}(a,s,i[0],i[1],d,p,g)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.cursor=function(e,t){var r=t.getPixelPosition(),n=t.getCursorType(),i=t.getGroupPanel(),o=i.getRealWorldCoordinates(),a=i.toPixelPosition([o[0],o[2]]),s=i.toPixelPosition([o[1],o[3]]);if(e.beginPath(),n!=EJSS_DRAWING2D.Cursor.VERTICAL){var l=a[0],u=s[0],g=r[1];g>a[1]?g=a[1]:g<s[1]&&(g=s[1]),e.moveTo(l,g),e.lineTo(u,g)}if(n!=EJSS_DRAWING2D.Cursor.HORIZONTAL){var c=r[0],S=a[1],f=s[1];c<a[0]?c=a[0]:c>s[0]&&(c=s[0]),e.moveTo(c,S),e.lineTo(c,f)}var E=t.getStyle();E.getDrawFill()&&"none"!=E.getFillColor()&&(e.fillStyle=E.getFillColor(),e.fill()),E.getDrawLines()&&(e.lineWidth=E.getLineWidth(),e.strokeStyle=E.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.ellipse=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=Math.abs(n[0]),l=Math.abs(n[1]),u=o-s/2,g=a-l/2;ox=s/2*.5522848,oy=l/2*.5522848,xe=u+s,ye=g+l,e.beginPath(),e.moveTo(u,a),e.bezierCurveTo(u,a-oy,o-ox,g,o,g),e.bezierCurveTo(o+ox,g,xe,a-oy,xe,a),e.bezierCurveTo(xe,a+oy,o+ox,ye,o,ye),e.bezierCurveTo(o-ox,ye,u,a+oy,u,a);var c=t.getStyle();c.getDrawFill()&&"none"!=c.getFillColor()&&(e.fillStyle=c.getFillColor(),e.fill()),c.getDrawLines()&&(e.lineWidth=c.getLineWidth(),e.strokeStyle=c.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.grid=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2,u=t.getShowX(),g=t.getShowY();if(u){e.beginPath();var c=t.getTicksXMode();if(c==EJSS_DRAWING2D.Grid.SCALE_LOG){if((P=t.getScaleX())[0]>0&&P[1]>0){var S=t.getTicksX(),f=o-s,E=o+s,d=a+l,p=a-l;EJSS_GRAPHICS.GraphicsUtils.drawLogGrid(f,d,E,p,S,P,1,(function(t,r){e.moveTo(t,r)}),(function(t,r){e.lineTo(t,r)}))}}else if(c==EJSS_DRAWING2D.Grid.SCALE_NUM){var h=0,m=0;if(t.getAutoTicksX())for(var A=t.getAutoStepXMin(),_=t.getAutoTicksRangeX(),D=_.length-1;D>=0&&!((h=Math.abs(n[0]/_[D]))>=A);D--);else 0!=(S=t.getTicksX())?h=Math.abs(n[0]/S):(h=t.getStepX(),m=t.getTickStepX());var I=t.getScalePrecisionX(),P=t.getScaleX();if(0==m)var C=Math.abs((P[1]-P[0])*h/n[0]);else{C=m;h=Math.abs(C*n[0]/(P[1]-P[0]))}var T=Math.pow(10,I),y=Math.round(C*T)/T;y>0&&(C=y,h=Math.abs(y*n[0]/(P[1]-P[0])));var R=t.getFixedTickX(),N=P[1];isNaN(R)||(N=R<P[0]?R+(Math.floor((P[0]-R)/C)+1)*C:R>P[1]?R-(Math.floor((R-P[1])/C)+1)*C:R);var v=Math.abs((P[0]-N)%C),O=Math.abs(v-C);(v<.001||O<.001)&&(v=0);var M=Math.abs(n[0]*v/(P[1]-P[0]));f=o-s,E=o+s,d=a+l,p=a-l;EJSS_GRAPHICS.GraphicsUtils.drawDecGrid(f,d,E,p,M,h,1,(function(t,r){e.moveTo(t,r)}),(function(t,r){e.lineTo(t,r)}))}e.lineWidth=t.getLineWidthX(),e.strokeStyle=t.getLineColorX(),e.stroke()}if(g){e.beginPath();var b=t.getTicksYMode();if(b==EJSS_DRAWING2D.Grid.SCALE_LOG){if((W=t.getScaleY())[0]>0&&W[1]>0){var G=t.getTicksY();f=o-s,E=o+s,d=a+l,p=a-l;EJSS_GRAPHICS.GraphicsUtils.drawLogGrid(f,d,E,p,G,W,-1,(function(t,r){e.moveTo(t,r)}),(function(t,r){e.lineTo(t,r)}))}}else if(b==EJSS_DRAWING2D.Grid.SCALE_NUM){var L=0,x=0;if(t.getAutoTicksY()){var J=t.getAutoStepYMin(),w=t.getAutoTicksRangeY();for(D=w.length-1;D>=0&&!((L=Math.abs(n[1]/w[D]))>=J);D--);}else 0!=(G=t.getTicksY())?L=Math.abs(n[1]/G):(L=t.getStepY(),x=t.getTickStepY());var k=t.getScalePrecisionY(),W=t.getScaleY();if(0==x)var F=Math.abs((W[1]-W[0])*L/n[1]);else{F=x;L=Math.abs(F*n[1]/(W[1]-W[0]))}var V=Math.pow(10,k),U=Math.round(F*V)/V;U>0&&(F=U,L=Math.abs(U*n[1]/(W[1]-W[0])));R=t.getFixedTickY(),N=W[1];isNaN(R)||(N=R<W[0]?R+(Math.floor((W[0]-R)/F)+1)*F:R>W[1]?R-(Math.floor((R-W[1])/F)+1)*F:R);v=Math.abs((W[0]-N)%F),O=Math.abs(v-F);(v<.001||O<.001)&&(v=0);var Y=Math.abs(n[1]*v/(W[1]-W[0]));f=o-s,E=o+s,d=a+l,p=a-l;EJSS_GRAPHICS.GraphicsUtils.drawDecGrid(f,d,E,p,Y,L,-1,(function(t,r){e.moveTo(t,r)}),(function(t,r){e.lineTo(t,r)}))}e.lineWidth=t.getLineWidthY(),e.strokeStyle=t.getLineColorY(),e.stroke()}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.histogram=function(e,t){function r(t,r,n,i,o){e.beginPath(),e.moveTo(t,i),e.lineTo(t,n),e.lineTo(r,n),e.lineTo(r,i),o.getDrawFill()&&"none"!=o.getFillColor()&&(e.fillStyle=o.getFillColor(),e.fill()),o.getDrawLines()&&(e.lineWidth=o.getLineWidth(),e.strokeStyle=o.getLineColor(),e.stroke())}for(var n=t.getPixelPosition(),i=t.getPixelSizes(),o=t.getRelativePositionOffset(i),a=n[0]+o[0],s=n[1]+o[1],l=i[0]/2,u=i[1]/2,g=t.getStyle(),c=t.getDiscrete(),S=t.getBinWidth()/2,f=t.getBars(),E=t.getGroupPanel().getPixelPositionWorldOrigin()[1],d=0;d<f.length;d++){var p,h,m=f[d][0];c?p=h=a-l+m*i[0]:(p=a-l+(m-S)*i[0],h=a-l+(m+S)*i[0]),r(p,h,s-u+f[d][1]*i[1],E,g)}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.image=function(e,t,r){var n,i=t.getPixelPosition(),o=t.getPixelSizes(),a=t.getRelativePositionOffset(o),s=i[0]+a[0],l=i[1]+a[1],u=Math.abs(o[0]/2),g=Math.abs(o[1]/2);if(t.getChangedImage()||(n=t.getCustomObject()),n)e.save(),r(t),e.drawImage(n,s-u,l-g,Math.abs(o[0]),Math.abs(o[1])),e.restore();else{n=new Image,t.setCustomObject(n),n.onload=function(){e.save(),r(t),e.drawImage(n,s-u,l-g,Math.abs(o[0]),Math.abs(o[1])),e.restore()};var c=t.getEncode();c.length>0?n.src="data:png;base64,"+c:n.src=t.getImageUrl()}t.setChangedImage(!1)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.mesh=function(e,t){var r,n,i,o;function a(t,r,n,i){e.beginPath();for(var o=t.length,a=0;a<o;a++)0==a?e.moveTo(t[0],r[0]):e.lineTo(t[a],r[a]);e.lineTo(t[0],r[0]),n&&i.getDrawFill()&&"none"!=i.getFillColor()&&(e.fillStyle=i.getFillColor(),e.fill()),i.getDrawLines()&&(e.lineWidth=i.getLineWidth(),e.strokeStyle=i.getLineColor(),e.stroke())}function s(t,r,n,i){for(var o=0;o<t.length;o++){var a=t[o],s=r[o],l=n[o][0],u=n[o][1],g=EJSS_TOOLS.Mathematics.norm([l,u]),c=l*i/g,f=u*i/g;if(0!=c||0!=f){var d=.3*EJSS_TOOLS.Mathematics.norm([c,f]),p=0!=d&&d<12?d:12,h=Math.atan2(c,f);e.beginPath(),e.moveTo(a,s),e.lineTo(a+c-p*Math.cos(h),s+f-p*Math.sin(h)),e.lineTo(a+c-p*Math.cos(h-Math.PI/6),s+f-p*Math.sin(h-Math.PI/6)),e.lineTo(a+c,S+E),e.lineTo(a+c-p*Math.cos(h+Math.PI/6),s+f-p*Math.sin(h+Math.PI/6)),e.lineTo(a+c-p*Math.cos(h),s+f-p*Math.sin(h)),e.lineWidth=1,e.strokeStyle="black",e.stroke()}}}var l=t.getPixelPosition(),u=t.getPixelSizes(),g=t.getRelativePositionOffset(u),c=l[0]+g[0],S=l[1]+g[1],f=u[0]/2,E=u[1]/2,d=t.getPoints();if(null!=d){var p=d.length;r=new Array(p),n=new Array(p);for(var h=0;h<p;h++)r[h]=c-f+d[h][0]*u[0],n[h]=S-E+d[h][1]*u[1];var m=t.getCells(),A=t.getFieldAtPoints();if(A?i=EJSS_GRAPHICS.GraphicsUtils.buildCells(r,n,m,A,!1):(A=t.getFieldAtCells(),i=EJSS_GRAPHICS.GraphicsUtils.buildCells(r,n,m,A,!0)),null!=m){var _=t.getStyle();if(null!=A){var D=t.getColorCoded();EJSS_GRAPHICS.GraphicsUtils.drawPolygons(i,D,(function(e,t){a(e,t,!1,_)}),(function(t,r,n,i,o){!function(t,r,n,i,o){e.beginPath();for(var a=0;a<n;a++)0==a?e.moveTo(t[0],r[0]):e.lineTo(t[a],r[a]);e.lineTo(t[0],r[0]);var s=i.indexToColor(o);e.fillStyle=s,e.fill(),e.lineWidth=1.25,e.strokeStyle=s,e.stroke()}(t,r,n,i,o)}))}else EJSS_GRAPHICS.GraphicsUtils.drawPolygons(i,D,(function(e,t){a(e,t,!0,_)}),(function(e,t,r,n,i){}))}var I=t.getBoundary();if(t.getDrawBoundary()&&null!=I){var P=t.getBoundaryLabels(),C=t.getBoundaryColors(),T=t.getBoundaryLineWidth();o=EJSS_GRAPHICS.GraphicsUtils.buildBoundary(r,n,I),EJSS_GRAPHICS.GraphicsUtils.drawBoundary(o,P,C,(function(t,r,n){!function(t,r,n,i){e.beginPath();for(var o=t.length,a=0;a<o;a++)0==a?e.moveTo(t[0],r[0]):e.lineTo(t[a],r[a]);e.lineTo(t[0],r[0]),e.lineWidth=i+.5,e.strokeStyle=n,e.stroke()}(t,r,n,T)}))}if(t.getDataType()>=4&&null!=A)for(var y=t.getVectorLength()*u[0],R=(h=0,m.length);h<R;h++)s(mCellA[h],mCellB[h],A[h],y)}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.pipe=function(e,t){var r=t.getPoints();if(r&&!(r.length<=0)){var n=t.getPixelPosition(),i=t.getPixelSizes(),o=t.getRelativePositionOffset(i),a=n[0]+o[0],s=n[1]+o[1],l=Math.abs(i[0]),u=Math.abs(i[1]),g=a-l/2,c=s+u/2,S=t.getStyle();e.beginPath(),e.moveTo(g,c);a=g,s=c;for(var f=0,E=r.length;f<E;f++){var d=r[f];a+=Math.round(d[0]*l),s+=Math.round(-d[1]*u),e.lineTo(a,s)}S.getDrawLines()&&(e.lineWidth=2*S.getLineWidth()+t.getPipeWidth(),e.strokeStyle=S.getLineColor(),e.stroke()),e.beginPath(),e.moveTo(g,c);for(a=g,s=c,f=0,E=r.length;f<E;f++){d=r[f];a+=Math.round(d[0]*l),s+=Math.round(-d[1]*u),e.lineTo(a,s)}S.getDrawLines()&&(e.lineWidth=t.getPipeWidth(),e.strokeStyle=S.getFillColor(),e.stroke())}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.point=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1];e.beginPath(),e.arc(o,a,2,0,2*Math.PI);var s=t.getStyle();e.fillStyle=s.getFillColor(),e.fill()};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.polygon=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2;e.beginPath();for(var u=t.getPoints(),g=0;g<u.length;g++){var c=u[g],S=o-s+c[0]*n[0],f=a-l+c[1]*n[1],E=c[2];0==g||0==E?e.moveTo(S,f):e.lineTo(S,f)}var d=t.getStyle();d.getDrawFill()&&"none"!=d.getFillColor()&&(e.fillStyle=d.getFillColor(),e.fill()),d.getDrawLines()&&(e.lineWidth=d.getLineWidth(),e.strokeStyle=d.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.rectangle=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2;e.beginPath(),e.moveTo(o-s,a+l),e.lineTo(o+s,a+l),e.lineTo(o+s,a-l),e.lineTo(o-s,a-l),e.lineTo(o-s,a+l);var u=t.getStyle();u.getDrawFill()&&"none"!=u.getFillColor()&&(e.fillStyle=u.getFillColor(),e.fill()),u.getDrawLines()&&(e.lineWidth=u.getLineWidth(),e.strokeStyle=u.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.roundRectangle=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=Math.abs(n[0]),l=Math.abs(n[1]),u=o-s/2,g=a-l/2,c=Math.abs(t.getCornerRadius());e.beginPath(),e.moveTo(u+c,g),e.lineTo(u+s-c,g),e.quadraticCurveTo(u+s,g,u+s,g+c),e.lineTo(u+s,g+l-c),e.quadraticCurveTo(u+s,g+l,u+s-c,g+l),e.lineTo(u+c,g+l),e.quadraticCurveTo(u,g+l,u,g+l-c),e.lineTo(u,g+c),e.quadraticCurveTo(u,g,u+c,g),e.closePath();var S=t.getStyle();S.getDrawFill()&&"none"!=S.getFillColor()&&(e.fillStyle=S.getFillColor(),e.fill()),S.getDrawLines()&&(e.lineWidth=S.getLineWidth(),e.strokeStyle=S.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.canvas=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=t.getMaximumX()-t.getMinimumX(),l=t.getMaximumY()-t.getMinimumY(),u=Math.abs(n[0]),g=Math.abs(n[1]),c=u/s,S=g/l,f=o-u/2,E=a+g/2;EJSS_GRAPHICS.GraphicsUtils.drawImageField(context,f,E,t.getMinimumX(),t.getMinimumY(),u,g,c,S,{data:t.getData()})};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.segment=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2;e.beginPath(),e.moveTo(o-s,a-l),e.lineTo(o+s,a+l);var u=t.getStyle();u.getDrawFill()&&"none"!=u.getFillColor()&&(e.fillStyle=u.getFillColor(),e.fill()),u.getDrawLines()&&(e.lineWidth=u.getLineWidth(),e.strokeStyle=u.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.spring=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=n[0]/2,l=n[1]/2,u=t.getGroupPanel().toPixelMod([t.getRadius(),0])[0];e.beginPath(),EJSS_GRAPHICS.GraphicsUtils.drawSpring(t.getLoops(),t.getPointsPerLoop(),u,t.getSolenoid(),t.getThinExtremes(),o-s,a-l,n[0],n[1],(function(t,r){e.moveTo(t,r)}),(function(t,r){e.lineTo(t,r)}));var g=t.getStyle();g.getDrawFill()&&"none"!=g.getFillColor()&&(e.fillStyle=g.getFillColor(),e.fill()),g.getDrawLines()&&(e.lineWidth=g.getLineWidth(),e.strokeStyle=g.getLineColor(),e.stroke())};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.tank=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=Math.abs(n[0]/2),l=Math.abs(n[1]/2),u=t.getPixelSizeOf(0,t.getLevel()),g=o-s,c=o+s,S=a+l,f=a-l,E=S+u[1],d=t.getStyle();e.beginPath(),e.moveTo(g+u[0],E),e.lineTo(g,S),e.lineTo(c,S),e.lineTo(c+u[0],E),e.fillStyle=t.getLevelColor(),e.fill(),e.beginPath(),e.moveTo(g,f),e.lineTo(g,S),e.lineTo(c,S),e.lineTo(c,f),d.getDrawFill()&&"none"!=d.getFillColor()&&(e.fillStyle=d.getFillColor(),e.fill()),e.lineWidth=d.getLineWidth(),e.strokeStyle=d.getLineColor(),e.stroke()};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.text=function(e,t){var r=t.getFont(),n="";n+="none"!=r.getFontStyle()?r.getFontStyle()+" ":"",n+="none"!=r.getFontWeight()?r.getFontWeight()+" ":"",n+=r.getFontSizeString()+(r.getFontSizeString().toString().indexOf("px")>-1?" ":"px "),n+=r.getFontFamily(),e.font=n;var i=t.getText(),o=t.getPixelPosition(),a=t.getFramed()?4:0,s=[e.measureText(i).width+2*a,r.getFontSize()+2*a],l=EJSS_DRAWING2D.Element.getSWRelativePositionOffset(t.getRelativePosition(),s[0],s[1]),u=t.getMarginX(),g=t.getMarginY(),c=o[0]+l[0]+u+a,S=o[1]+l[1]+g-a;if(t.getFramed()){var f=s[0]-2*a;if(f>0){var E=S+a,d=S-(s[1]-2*a)-a,p=c-a,h=c+f+a;e.save(),e.beginPath(),e.moveTo(p,E),e.lineTo(h,E),e.lineTo(h,d),e.lineTo(p,d),e.lineTo(p,E);var m=t.getStyle();m.getDrawFill()&&"none"!=m.getFillColor()&&(e.fillStyle=m.getFillColor(),e.fill()),m.getDrawLines()&&(e.lineWidth=m.getLineWidth(),e.strokeStyle=m.getLineColor(),e.stroke()),e.restore()}}var A=0;switch(t.getWritingMode()){case EJSS_DRAWING2D.Text.MODE_TOPDOWN:A=Math.PI/2;break;case EJSS_DRAWING2D.Text.MODE_RIGTHLEFT:A=Math.PI;break;case EJSS_DRAWING2D.Text.MODE_DOWNTOP:A=3*Math.PI/2;break;case EJSS_DRAWING2D.Text.MODE_LEFTRIGHT:A=0}e.translate(o[0]+u,o[1]+g),e.rotate(A),e.translate(-(o[0]+u),-(o[1]+g)),e.fillStyle=r.getFillColor(),e.fillText(t.getText(),c,S)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.trace=function(e,t){function r(t,r,n,i){var o=t,a=r,s=Math.abs(n[0]),l=Math.abs(n[1]),u=o-s/2,g=a-l/2;ox=s/2*.5522848,oy=l/2*.5522848,xe=u+s,ye=g+l,e.beginPath(),e.moveTo(u,a),e.bezierCurveTo(u,a-oy,o-ox,g,o,g),e.bezierCurveTo(o+ox,g,xe,a-oy,xe,a),e.bezierCurveTo(xe,a+oy,o+ox,ye,o,ye),e.bezierCurveTo(o-ox,ye,u,a+oy,u,a),i.getDrawFill()&&"none"!=i.getFillColor()&&(e.fillStyle=i.getFillColor(),e.fill()),i.getDrawLines()&&(e.lineWidth=i.getLineWidth(),e.strokeStyle=i.getLineColor(),e.stroke())}function n(t,r,n,i){var o=t,a=r,s=Math.abs(n[0]),l=Math.abs(n[1]);e.beginPath(),e.rect(o-s/2,a-l/2,s,l),i.getDrawFill()&&"none"!=i.getFillColor()&&(e.fillStyle=i.getFillColor(),e.fill()),i.getDrawLines()&&(e.lineWidth=i.getLineWidth(),e.strokeStyle=i.getLineColor(),e.stroke())}function i(t,r,n,i,o,a){e.beginPath(),e.moveTo(t,o),e.lineTo(t,r),e.lineTo(n,i),e.lineTo(n,o),a.getDrawFill()&&"none"!=a.getFillColor()&&(e.fillStyle=a.getFillColor(),e.fill()),a.getDrawLines()&&(e.lineWidth=a.getLineWidth(),e.strokeStyle=a.getLineColor(),e.stroke())}var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=a[0]/2,c=a[1]/2;!function(t,r,n,i,o){e.beginPath();for(var a=0;a<t.length;a++){var s=t[a],l=r+s[0]*i,u=n+s[1]*o,g=s[2];0==a||0==g?e.moveTo(l,u):e.lineTo(l,u)}}(t.getPoints(),l-g,u-c,a[0],a[1]);var S=t.getStyle();S.getDrawFill()&&"none"!=S.getFillColor()&&(e.fillStyle=S.getFillColor(),e.fill()),S.getDrawLines()&&(e.lineWidth=S.getLineWidth(),e.strokeStyle=S.getLineColor(),e.stroke());for(var f,E,d=t.getPoints(),p=0;p<d.length;p++){var h=d[p],m=l-g+h[0]*a[0],A=u-c+h[1]*a[1],_=h[3],D=h[4],I=[h[5],h[6]];if(_==EJSS_DRAWING2D.Trace.ELLIPSE)r(m,A,I,D);else if(_==EJSS_DRAWING2D.Trace.RECTANGLE)n(m,A,I,D);else if(_==EJSS_DRAWING2D.Trace.BAR){var P=t.getGroupPanel().toPixelPosition([0,0])[1];I[1]=P-A,n(m,A+=I[1]/2,I,D)}else if(_==EJSS_DRAWING2D.Trace.AREA){if(0!=p){P=t.getGroupPanel().toPixelPosition([0,0])[1];var C=l-g+f*a[0],T=u-c+E*a[1];i(mMark,C,T,m,A,P)}f=h[0],E=h[1]}}};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.trail=function(e,t){function r(t,r,n,i,o,a,s){if(!(r<=0)){e.beginPath();for(var l=0;l<r;l++){var u=t[l],g=i+u[0]*a,c=o+u[1]*s,S=u[2];0==l||0==S?e.moveTo(g,c):e.lineTo(g,c)}n.getDrawLines()&&(e.lineWidth=n.getLineWidth(),e.strokeStyle=n.getLineColor(),e.stroke())}}var n=t.getPixelPosition(),i=t.getPixelSizes(),o=t.getRelativePositionOffset(i),a=n[0]+o[0],s=n[1]+o[1],l=a-i[0]/2,u=s-i[1]/2,g=i[0],c=i[1],S=t.getSegmentsCount();if(S>0)for(var f=0;f<S;f++){var E=t.getSegmentPoints(f).length;r(t.getSegmentPoints(f),E,t.getSegmentStyle(f),l,u,g,c)}E=t.getCurrentPoints().length;r(t.getCurrentPoints(),E,t.getStyle(),l,u,g,c)};var EJSS_CANVASGRAPHICS=EJSS_CANVASGRAPHICS||{};EJSS_CANVASGRAPHICS.wheel=function(e,t){var r=t.getPixelPosition(),n=t.getPixelSizes(),i=t.getRelativePositionOffset(n),o=r[0]+i[0],a=r[1]+i[1],s=Math.abs(n[0]),l=Math.abs(n[1]),u=n[0]/2,g=n[1]/2,c=o-s/2,S=a-l/2;ox=s/2*.5522848,oy=l/2*.5522848,xe=c+s,ye=S+l,e.beginPath(),e.moveTo(c,a),e.bezierCurveTo(c,a-oy,o-ox,S,o,S),e.bezierCurveTo(o+ox,S,xe,a-oy,xe,a),e.bezierCurveTo(xe,a+oy,o+ox,ye,o,ye),e.bezierCurveTo(o-ox,ye,c,a+oy,c,a),e.moveTo(o-u,a),e.lineTo(o+u,a),e.moveTo(o,a-g),e.lineTo(o,a+g);var f=t.getStyle();f.getDrawFill()&&"none"!=f.getFillColor()&&(e.fillStyle=f.getFillColor(),e.fill()),f.getDrawLines()&&(e.lineWidth=f.getLineWidth(),e.strokeStyle=f.getLineColor(),e.stroke())};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.CanvasGraphics={getOffsetRect:function(e){return EJSS_GRAPHICS.GraphicsUtils.getOffsetRect(e)}},EJSS_GRAPHICS.canvasGraphics=function(e){var t=EJSS_INTERFACE.canvas(e),r=t.getDOMElement(),n=t.getContext();return t.getEventContext=function(){return r},t.getBox=function(){var e=EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(t);return e.width-=1,e.height-=1,e},t.reset=function(){var e=EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(t);n.clearRect(0,0,e.width,e.height)},t.draw=function(e,r){for(var n=0,i=e.length;n<i;n++){var o=e[n];o.isGroupVisible()&&t.drawElement(o,t.transformElement)}},t.drawElement=function(e,t){var r=EJSS_DRAWING2D.Shape,i=e.getClass();if("ElementImage"===i)EJSS_CANVASGRAPHICS.image(n,e,t);else{switch(n.save(),t(e),i){case"ElementCustom":var o=e.getFunction();o&&o(n,e);break;case"ElementShape":switch(e.getShapeType()){default:case r.ELLIPSE:EJSS_CANVASGRAPHICS.ellipse(n,e);break;case r.RECTANGLE:EJSS_CANVASGRAPHICS.rectangle(n,e);break;case r.ROUND_RECTANGLE:EJSS_CANVASGRAPHICS.roundRectangle(n,e);break;case r.WHEEL:EJSS_CANVASGRAPHICS.wheel(n,e);break;case r.NONE:case r.POINT:EJSS_CANVASGRAPHICS.point(n,e)}break;case"ElementSegment":EJSS_CANVASGRAPHICS.segment(n,e);break;case"ElementArrow":EJSS_CANVASGRAPHICS.arrow(n,e);break;case"ElementText":EJSS_CANVASGRAPHICS.text(n,e);break;case"ElementSpring":EJSS_CANVASGRAPHICS.spring(n,e);break;case"ElementTrail":EJSS_CANVASGRAPHICS.trail(n,e);break;case"ElementTrace":EJSS_CANVASGRAPHICS.trace(n,e);break;case"ElementGrid":EJSS_CANVASGRAPHICS.grid(n,e);break;case"ElementAxis":EJSS_CANVASGRAPHICS.axis(n,e);break;case"ElementCursor":EJSS_CANVASGRAPHICS.cursor(n,e);break;case"ElementPolygon":EJSS_CANVASGRAPHICS.polygon(n,e);break;case"ElementAnalyticCurve":EJSS_CANVASGRAPHICS.analyticCurve(n,e);break;case"ElementCellLattice":EJSS_CANVASGRAPHICS.cellLattice(n,e);break;case"ElementByteRaster":EJSS_CANVASGRAPHICS.byteRaster(n,e);break;case"ElementMesh":EJSS_CANVASGRAPHICS.mesh(n,e);break;case"ElementTank":EJSS_CANVASGRAPHICS.tank(n,e);break;case"ElementPipe":EJSS_CANVASGRAPHICS.pipe(n,e);break;case"ElementHistogram":EJSS_CANVASGRAPHICS.histogram(n,e);break;case"ElementScalarField":EJSS_CANVASGRAPHICS.scalarField(n,e);break;case"ElementCanvas":EJSS_CANVASGRAPHICS.canvas(n,e);break;case"ElementVideo":Console.log("Not supported ElementVideo in Canvas!")}n.restore()}},t.transformElement=function(e){null!=e.getGroup()&&t.transformElement(e.getGroup());var r=e.getTransformation(),i=e.getRotate();if(Array.isArray(r)&&r.length>0)console.log("Array transformations are not supported in Canvas!");else if("string"==typeof r)console.log("SVG-based transformations are not supported in Canvas!");else if(0!=i){var o=e.getPixelPosition();n.translate(o[0],o[1]),n.rotate(-i),n.translate(-o[0],-o[1])}},t.drawGutters=function(e){if(e.getGutters().visible){var r=e.getInnerRect(),i=.5,o=.5,a=t.getBox(),s=a.width,l=a.height,u=e.getGuttersStyle(),g=e.getStyle();u.getDrawFill()&&(n.beginPath(),n.moveTo(i,o),n.lineTo(i,o+l),n.lineTo(i+s,o+l),n.lineTo(i+s,o),n.lineTo(i,o),n.moveTo(r.x,r.y),n.lineTo(r.x+r.width,r.y),n.lineTo(r.x+r.width,r.y+r.height),n.lineTo(r.x,r.y+r.height),n.lineTo(r.x,r.y),n.moveTo(i,o),n.closePath(),n.fillStyle=u.getFillColor(),n.fill()),u.getDrawLines()&&(n.beginPath(),n.moveTo(i,o),n.lineTo(i,o+l),n.lineTo(i+s,o+l),n.lineTo(i+s,o),n.lineTo(i,o),n.closePath(),n.lineWidth=u.getLineWidth(),n.strokeStyle=u.getLineColor(),n.stroke()),u.getDrawLines()&&(n.beginPath(),n.moveTo(r.x,r.y),n.lineTo(r.x+r.width,r.y),n.lineTo(r.x+r.width,r.y+r.height),n.lineTo(r.x,r.y+r.height),n.lineTo(r.x,r.y),n.closePath(),n.lineWidth=g.getLineWidth(),n.strokeStyle=g.getLineColor(),n.stroke())}},t.drawPanel=function(e){var r=t.getBox();n.beginPath(),n.rect(.5,.5,r.width,r.height);var i=e.getStyle();n.fillStyle=i.getFillColor(),n.fill(),i.getDrawLines()&&(n.lineWidth=i.getLineWidth(),n.strokeStyle=i.getLineColor(),n.stroke())},t};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.GraphicsUtils={getOffsetRect:function(e){var t,r,n,i,o=e.getDOMElement(),a=e.getWidth(),s=e.getHeight();t=parseFloat(a);var l=!isNaN(t)&&isFinite(a);r=parseFloat(s);var u=!isNaN(r)&&isFinite(s);if(o.getBoundingClientRect){var g=o.getElementById?o.getElementById(".myPanel"):null;if(g&&g.childElementCount>0)var c=g.getBoundingClientRect();else c=o.getBoundingClientRect();n=c.top,i=c.left,l||(t=c.width),u||(r=c.height)}else if(void 0!==o.offsetTop)n=o.offsetTop,i=o.offsetLeft,l||(t=o.offsetWidth),u||(r=o.offsetHeight);else{for(var S=o.parentNode||document.getElementById(o.id).parentNode;S&&!S.offsetTop&&S&&!S.previousElementSibling&&!S.nextElementSibling;)S=S.parentNode;n=S.offsetTop,i=S.offsetLeft,l||(t=S.offsetWidth),u||(r=S.offsetHeight)}var f=document.body,E=document.documentElement;return{top:n-=E.clientTop||f.clientTop||0,left:i-=E.clientLeft||f.clientLeft||0,width:t,height:r,bottom:n+r,right:i+t}},drawSpring:function(e,t,r,n,i,o,a,s,l,u,g){var c=e*t,S=2*Math.PI/t;r<0&&(S*=-1);for(var f=t/2,E=[s,l,0],d=EJSS_TOOLS.Mathematics.normalTo(E),p=EJSS_TOOLS.Mathematics.normalize(EJSS_TOOLS.Mathematics.crossProduct(E,d)),h=0;h<=c;h++){var m;m=i?h<f?0:h<t?h-f:h>c-f?0:h>c-t?c-h-f:f:f;var A=Math.PI/2+h*S,_=Math.cos(A),D=Math.sin(A),I=o+h*s/c+m*r*(_*d[0]+D*p[0])/f,P=a+h*l/c+m*r*(_*d[1]+D*p[1])/f;if(0!=n){var C=m*Math.cos(2*h*Math.PI/t)/f;I+=n*C*s,P+=n*C*l}0==h?u(I,P):g(I,P)}},drawDecTicks:function(e,t,r,n,i,o,a,s,l,u){var g=EJSS_SVGGRAPHICS.Utils,c=e-r,S=e+r,f=t+n,E=t-n,d=g.crispValue(S),p=g.crispValue(E);if(s==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var h=p-a;h>=f-.5;h-=o)u(e,h,i,s);else for(h=c+a;h<=d+.5;h+=o)u(h,t,i,s)},drawDecTicksText:function(e,t,r,n,i,o,a,s,l,u,g,c,S,f,E,d){var p=EJSS_SVGGRAPHICS.Utils,h=e-r,m=e+r,A=t+n,_=t-n,D=p.crispValue(m),I=p.crispValue(_);if(f==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var P=0,C=I-a;C>=A-.5;C-=o,P++){if(E)var T=s[1]-g-u*P;else T=s[0]+g+u*P;var y=parseFloat(T.toFixed(l)).toFixed(l);if(S==EJSS_DRAWING2D.Axis.TICKS_DOWN){var R=i/2;d(mGroup,e+R,C,y,c,!1)}else{R=y.length*Math.floor(c.getFontSize()/2);R+=y.length*c.getNumberLetterSpacing(),d(e-(R+=Math.floor(i/2)),C,y,c,!1)}}else for(P=0,C=h+a;C<=D+.5;C+=o,P++){T=s[0]+g+u*P,y=parseFloat(T.toFixed(l)).toFixed(l);if(S==EJSS_DRAWING2D.Axis.TICKS_DOWN){Math.floor(i/2);d(C,t-i,y,c,!0)}else{d(C,t+(c.getFontSize()+Math.floor(i/2)),y,c,!0)}}},drawLogTicks:function(e,t,r,n,i,o,a,s,l,u){var g=e-r,c=t-n,S=EJSS_SVGGRAPHICS.Utils.crispValue(c);if(l==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var f=Math.log(a[0])/Math.log(10),E=Math.log(a[1])/Math.log(10)-f,d=Math.ceil(E),p=i/E,h=0;h<=d;h++)for(var m=Math.pow(10,h+f),A=Math.pow(10,h+f+1)/s,_=0;_<s-1;_++){if(0!=(D=m+_*A)&&D>=a[0]&&D<=a[1])u(e,S-(Math.log(D)/Math.log(10)-f)*p,o,l)}else for(f=Math.log(a[0])/Math.log(10),E=Math.log(a[1])/Math.log(10)-f,d=Math.ceil(E),p=i/E,h=0;h<=d;h++)for(m=Math.pow(10,h+f),A=Math.pow(10,h+f+1)/s,_=0;_<s-1;_++){var D;if(0!=(D=m+_*A)&&D>=a[0]&&D<=a[1])u(g+(Math.log(D)/Math.log(10)-f)*p,t,o,l)}},drawLogTicksText:function(e,t,r,n,i,o,a,s,l,u,g,c,S){var f=e-r,E=t-n,d=EJSS_SVGGRAPHICS.Utils.crispValue(E);if(c==EJSS_DRAWING2D.Axis.AXIS_VERTICAL)for(var p=Math.log(s[0])/Math.log(10),h=Math.log(s[1])/Math.log(10)-p,m=Math.ceil(h),A=i/h,_=0;_<=m;_++)for(var D=Math.pow(10,_+p),I=Math.pow(10,_+p+1)/o,P=0;P<o-1;P++){if(0!=(R=D+P*I)&&R>=s[0]&&R<=s[1]){var C=d-(Math.log(R)/Math.log(10)-p)*A;if(0==P)var T=R.toExponential(l);else T=parseFloat((R/D).toFixed(l)).toFixed(l);if(g==EJSS_DRAWING2D.Axis.TICKS_DOWN){S(e+(y=a/2),C,T,u,!1)}else{var y=T.length*Math.floor(u.getFontSize()/2);y+=T.length*u.getNumberLetterSpacing(),S(e-(y+=Math.floor(a/2)),C,T,u,!1)}}}else for(p=Math.log(s[0])/Math.log(10),h=Math.log(s[1])/Math.log(10)-p,m=Math.ceil(h),A=i/h,_=0;_<=m;_++)for(D=Math.pow(10,_+p),I=Math.pow(10,_+p+1)/o,P=0;P<o-1;P++){var R;if(0!=(R=D+P*I)&&R>=s[0]&&R<=s[1]){C=f+(Math.log(R)/Math.log(10)-p)*A;if(0==P)T=R.toExponential(l);else T=parseFloat((R/D).toFixed(l)).toFixed(l);if(g==EJSS_DRAWING2D.Axis.TICKS_DOWN){Math.floor(a/2);S(C,t-a,T,u,!0)}else{S(C,t+(u.getFontSize()+Math.floor(a/2)),T,u,!0)}}}},drawDecGrid:function(e,t,r,n,i,o,a,s,l){var u=EJSS_SVGGRAPHICS.Utils,g=u.crispValue(e),c=u.crispValue(r),S=u.crispValue(t),f=u.crispValue(n);if(-1==a){0==o&&(o=Math.abs(S-f));for(var E=f-i;E>=t-.5;E-=o)s(e,E),l(r,E)}else{0==o&&(o=Math.abs(c-g));for(E=e+i;E<=c+.5;E+=o)s(E,t),l(E,n)}},drawLogGrid:function(e,t,r,n,i,o,a,s,l){var u=EJSS_SVGGRAPHICS.Utils,g=u.crispValue(e),c=u.crispValue(r),S=u.crispValue(t),f=u.crispValue(n),E=Math.log(o[0])/Math.log(10),d=Math.log(o[1])/Math.log(10)-E,p=Math.ceil(d);if(-1==a)var h=(f-S)/d;else h=(c-g)/d;for(var m=0;m<=p;m++)for(var A=Math.pow(10,m+E),_=Math.pow(10,m+E+1)/i,D=0;D<i-1;D++){var I=A+D*_;if(0!=I&&I>=o[0]&&I<=o[1]){var P,C=Math.log(I)/Math.log(10);if(-1==a)s(g,P=f-(C-E)*h),l(c,P);else s(P=g+(C-E)*h,S),l(P,f)}}return""},buildCells:function(e,t,r,n,i){var o,a,s,l;if(null!=r&&r.length>0){var u=r.length;o=new Array(u),a=new Array(u),s=new Array(u),l=new Array(u);var g=1;null!=n&&(g=i?n[0][0].length:n[0].length);for(var c=0;c<u;c++){var S=r[c],f=S.length;o[c]=new Array(f),a[c]=new Array(f);for(var E=0;E<f;E++){var d=S[E];o[c][E]=e[d],a[c][E]=t[d]}if(null!=n)if(s[c]=new Array(f),l[c]=new Array(f),i){var p=n[c];for(E=0;E<f;E++){s[c][E]=g<=1?p[E][0]:EJSS_TOOLS.Mathematics.norm(p[E]),l[c][E]=new Array(g);for(h=0;h<g;h++)l[c][E][h]=p[E][h]}}else for(var E=0;E<f;E++){d=S[E];s[c][E]=g<=1?n[d][0]:EJSS_TOOLS.Mathematics.norm(n[d]),l[c][E]=new Array(g);for(var h=0;h<g;h++)l[c][E][h]=n[d][h]}}}return{cellA:o,cellB:a,cellZ:s,cellVector:l}},drawPolygons:function(e,t,r,n){for(var i=e.cellA,o=e.cellB,a=e.cellZ,s=0,l=i.length;s<l;s++){var u=i[s],g=o[s],c=a[s];if(void 0!==c){for(var S=u.length,f=new Array(S),E=Number.MAX_VALUE,d=Number.MIN_VALUE,p=0;p<S;p++){var h=t.doubleToIndex(c[p]);E=Math.min(h,E),d=Math.max(h,d),f[p]=h}for(var m=t.getColorThresholds(),A=new Array(2*S),_=new Array(2*S),D=E;D<=d;D++){for(var I=0,P=0;P<S;P++){var C=(P+1)%S;if(f[P]<=D&&f[C]>=D){if(f[P]==D)A[I]=u[P],_[I]=g[P],I++;else{var T=(m[D]-c[P])/(c[C]-c[P]);A[I]=Math.round(u[P]+T*(u[C]-u[P])),_[I]=Math.round(g[P]+T*(g[C]-g[P])),I++}if(f[C]>D){T=(m[D+1]-c[P])/(c[C]-c[P]);A[I]=Math.round(u[P]+T*(u[C]-u[P])),_[I]=Math.round(g[P]+T*(g[C]-g[P])),I++}}else if(f[P]>=D&&f[C]<=D){if(f[P]==D)A[I]=u[P],_[I]=g[P],I++;else{T=(m[D+1]-c[P])/(c[C]-c[P]);A[I]=Math.round(u[P]+T*(u[C]-u[P])),_[I]=Math.round(g[P]+T*(g[C]-g[P])),I++}if(f[C]<D){T=(m[D]-c[P])/(c[C]-c[P]);A[I]=Math.round(u[P]+T*(u[C]-u[P])),_[I]=Math.round(g[P]+T*(g[C]-g[P])),I++}}}I>0&&n(A,_,I,t,D)}}r(u,g)}},buildBoundary:function(e,t,r){var n,i;if(null!=r&&r.length>0){var o=r.length;n=new Array(o),i=new Array(o);for(var a=0;a<o;a++){var s=r[a],l=s.length;n[a]=new Array(l),i[a]=new Array(l);for(var u=0;u<l;u++){var g=s[u];n[a][u]=e[g],i[a][u]=t[g]}}}return{boundaryA:n,boundaryB:i}},drawBoundary:function(e,t,r,n){for(var i=e.boundaryA,o=e.boundaryB,a="black",s=0,l=i.length;s<l;s++){if(null!=t){var u=t[s];null!=r&&u<r.length&&(a=r[u])}n(i[s],o[s],a)}},drawImageField:function(e,t){for(var r=(t.colors.length-1)/(t.upper-t.lower),n=e.getImageData(0,0,t.width,t.height),i=0;i<t.width;i++)for(var o=Math.floor(i*t.nx/t.width),a=0;a<t.height;a++){var s,l=Math.floor(a*t.ny/t.height);if(t.data[o][l]<t.lower)s=t.colors[0];else if(t.data[o][l]<t.upper){var u=Math.round((t.data[o][l]-t.lower)*r);s=t.colors[u]}else s=t.colors[t.colors.length-1];var g=4*i+4*t.width*a;n.data[g+0]=s[0],n.data[g+1]=s[1],n.data[g+2]=s[2]}e.putImageData(n,0,0)},drawImageFieldParallel:function(e){for(var t=(e.colors.length-1)/(e.upper-e.lower),r=new Uint8ClampedArray(e.width*e.height*4),n=0;n<e.width;n++)for(var i=Math.floor(n*e.nx/e.width),o=0;o<e.height;o++){var a,s=Math.floor(o*e.ny/e.height);if(e.data[i][s]<e.lower)a=e.colors[0];else if(e.data[i][s]<e.upper){var l=Math.round((e.data[i][s]-e.lower)*t);a=e.colors[l]}else a=e.colors[e.colors.length-1];var u=4*n+4*e.width*o;r[u+0]=a[0],r[u+1]=a[1],r[u+2]=a[2]}return r}};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.analyticCurve=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&((i=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()),r.appendChild(i));var o,a,s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=l[0]/2,f=l[1]/2,E=t.getNumPoints(),d=t.getMinimun(),p=t.getMaximun(),h=null==d?t.getPanel().getRealWorldXMin():d,m=null==p?t.getPanel().getRealWorldXMax():p,A=t.getVariable(),_=t.getFunctionX(),D=t.getFunctionY(),I=EJSS_DRAWING2D.functionsParser(),P=!1;try{o=I.parse(_)}catch(e){console.log("Analytic curve error parsing FunctionX: "+_),P=!0}if(!P)try{a=I.parse(D)}catch(e){console.log("Analytic curve error parsing FunctionY: "+D),P=!0}if(!P){var C=(m-h)/(E-1),T=[],y={},R=t.getParameters();for(var N in R)y[N]=R[N];try{for(var v=0,O=h;O<=m;O+=C){y[A]=O;var M=o.evaluate(y),b=a.evaluate(y);isNaN(M)||isNaN(b)||(T[v]=[],T[v][0]=M,T[v++][1]=b)}}catch(e){t.getController().invokeAction("OnError")}var G=function(e,t,r,n,i){for(var o="",a=0;a<e.length;a++){var s=e[a],l=t+s[0]*n,u=r+s[1]*i,g=s[2];o+=0==a||0==g?" M "+l+" "+u:" L "+l+" "+u}return o}(T,g-S,c-f,l[0],l[1]);if(""!==G){i.setAttribute("d",G);var L=t.getStyle();L.getDrawFill()?i.setAttribute("fill",L.getFillColor()):i.setAttribute("fill","none"),L.getDrawLines()?(i.setAttribute("stroke",L.getLineColor()),i.setAttribute("stroke-width",L.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",L.getShapeRendering());var x=L.getAttributes();for(var J in x)i.setAttribute(J,x[J])}return i}t.getController().invokeAction("OnError")};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.arrow=function(e,t){var r=EJSS_SVGGRAPHICS.Utils,n=EJSS_DRAWING2D.Arrow;function i(t,r,i,o,a,s,l,u,g,c){var S,f,E=e.getElementById(t);null===E?((E=document.createElementNS("http://www.w3.org/2000/svg","marker")).setAttribute("id",t),(S=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t+".markpath"),E.appendChild(S),(f=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t+".markpath2"),E.appendChild(f),e.getElementsByTagName("defs")[0].appendChild(E)):(S=e.getElementById(t+".markpath"),f=e.getElementById(t+".markpath2"),e.getElementsByTagName("defs")[0].insertBefore(E,E));var d=o+2*s,p=a+2*s;switch(E.setAttribute("viewBox",-s+" "+-s+" "+d+" "+p),E.setAttribute("refX",o/2),E.setAttribute("refY",a/2),E.setAttribute("markerUnits","userSpaceOnUse"),E.setAttribute("markerWidth",d),E.setAttribute("markerHeight",p),E.setAttribute("orient",i),S.setAttribute("fill",l),S.setAttribute("stroke",l),S.setAttribute("stroke-width",s),S.setAttribute("style","  marker-start :none;   marker-end :none; "),f.setAttribute("fill",u),f.setAttribute("stroke",u),f.setAttribute("stroke-width",s),f.setAttribute("style","  marker-start :none;   marker-end :none; "),r){case n.TRIANGLE:var h="M 0 0 L "+o+" "+a/2+" L 0 "+a+" z";S.setAttribute("d",h);break;case n.INVTRIANGLE:h="M "+o+" 0 L 0 "+a/2+" L "+o+" "+a+" z";S.setAttribute("d",h);break;case n.ANGLE:E.setAttribute("markerHeight",a),E.setAttribute("refX",o);h="M 0 "+-(s-1)+" L "+o+" "+a/2+" L 0 "+(a+(s-1));S.setAttribute("d",h),S.setAttribute("fill","none");break;case n.INVANGLE:E.setAttribute("markerHeight",a),E.setAttribute("refX",1);h="M "+o+" "+-(s-1)+" L 0 "+a/2+" L "+o+" "+(a+(s-1));S.setAttribute("d",h),S.setAttribute("fill","none");break;case n.LINE:h="M "+o/2+" 0 L "+o/2+" "+a+" z";S.setAttribute("d",h);break;case n.RECTANGLE:h="M 0 0 L "+o+" 0 L "+o+" "+a+" L 0 "+a+" z";S.setAttribute("d",h);break;case n.DIAMOND:h="M "+o/2+" 0 L "+o+" "+a/2+" L "+o/2+" "+a+" L 0 "+a/2+" z";S.setAttribute("d",h);break;case n.CIRCLE:var m=o<a?o:a;h="M "+o/2+" "+a/2+" m "+-(m/=2)+", 0 a "+m+","+m+" 0 1,0 "+2*m+",0 a "+m+","+m+" 0 1,0 "+2*-m+",0";S.setAttribute("d",h);break;case n.WEDGE:S.setAttribute("stroke-width",0),f.setAttribute("stroke-width",.5);var A=void 0===c||0===c?0:Math.atan(g/c),_=(m=o<a?o:a,o/2),D=a/2,I=" M "+_+" "+D+" L "+(_+(m/=2)*Math.cos(A))+","+(D-m*Math.sin(A))+" A "+m+","+m+" 0 0,1 "+(_+m*Math.cos(Math.PI/3.25-A))+","+(D+m*Math.sin(Math.PI/3.25-A)),P="M "+_+" "+D+" m "+-m+", 0 a "+m+","+m+" 0 1,0 "+2*m+",0 a "+m+","+m+" 0 1,0 "+2*-m+",0 ";S.setAttribute("d",P),f.setAttribute("d",I);break;case n.POINTED:E.setAttribute("refX",o),S.setAttribute("stroke-width",0);h="M 0 0 L "+o+" "+a/2+" L 0 "+a+" L "+o/2+" "+a/2+" L 0 0 z";S.setAttribute("d",h);break;case n.CURVE:E.setAttribute("refX",o),S.setAttribute("stroke-width",0);var C=3*o,T=a/2.5;h="M 0 0  A "+C+","+C+" 1 0,0 "+o+","+a/2+" A "+C+","+C+" 1 0,0  0,"+a+" A "+T+","+T+" 1 0,0  0,"+a/2+" A "+T+","+T+" 1 0,0  0,0 z";S.setAttribute("d",h)}}var o,a=t.getGroup();o=null!==a?e.getElementById(a.getName()):e;var s=e.getElementById(t.getName());null===s&&((s=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()),o.appendChild(s));var l=t.getPixelPosition(),u=t.getPixelSizes(),g=t.getRelativePositionOffset(u),c=l[0]+g[0],S=l[1]+g[1],f=u[0]/2,E=u[1]/2;if(0!=u[0]||0!=u[1]){if(t.getMarkEnd()!=n.NONE){var d=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([u[0],u[1]]),p=0!=d&&d<t.getMarkEndWidth()?d:t.getMarkEndWidth(),h=0!=d&&d<t.getMarkEndHeight()?d:t.getMarkEndHeight(),m="none"==t.getMarkEndColor()?t.getStyle().getLineColor():t.getMarkEndColor(),A=t.getMarkEndStroke()<0?t.getStyle().getLineWidth():t.getMarkEndStroke();i(t.getName()+".end",t.getMarkEnd(),t.getMarkEndOrient(),p,h,A,m),s.setAttribute("marker-end","url(#"+t.getName()+".end)")}else s.removeAttribute("marker-end");if(t.getMarkMiddle()!=n.NONE){var _=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([u[0],u[1]]),D=0!=_&&_<t.getMarkMiddleWidth()?_:t.getMarkMiddleWidth(),I=0!=_&&_<t.getMarkMiddleHeight()?_:t.getMarkMiddleHeight(),P=(m="none"==t.getMarkMiddleColor()?t.getStyle().getLineColor():t.getMarkMiddleColor(),"none"==t.getMarkMiddleColorSnd()?t.getStyle().getLineColor():t.getMarkMiddleColorSnd());A=t.getMarkMiddleStroke()<0?t.getStyle().getLineWidth():t.getMarkMiddleStroke();i(t.getName()+".mid",t.getMarkMiddle(),t.getMarkMiddleOrient(),D,I,A,m,P,u[0],u[1]),s.setAttribute("marker-mid","url(#"+t.getName()+".mid)")}else s.removeAttribute("marker-mid");if(t.getMarkStart()!=n.NONE){var C=t.getMarkProportion()*EJSS_TOOLS.Mathematics.norm([u[0],u[1]]),T=0!=C&&C<t.getMarkStartWidth()?C:t.getMarkStartWidth(),y=0!=C&&C<t.getMarkStartHeight()?C:t.getMarkStartHeight();m="none"==t.getMarkStartColor()?t.getStyle().getLineColor():t.getMarkStartColor(),A=t.getMarkStartStroke()<0?t.getStyle().getLineWidth():t.getMarkStartStroke();i(t.getName()+".start",t.getMarkStart(),t.getMarkStartOrient(),T,y,A,m),s.setAttribute("marker-start","url(#"+t.getName()+".start)")}else s.removeAttribute("marker-start")}else s.removeAttribute("marker-end"),s.removeAttribute("marker-mid"),s.removeAttribute("marker-start");var R=r.crispValue,N=t.getStyle();switch(t.getSplineType()){default:case n.SPLINE_NONE:"crispEdges"==N.getShapeRendering()?t.getMarkMiddle()!=n.NONE?s.setAttribute("d","M "+R(c-f)+" "+R(S-E)+" L "+R(c)+" "+R(S)+" L "+R(c+f)+" "+R(S+E)):s.setAttribute("d","M "+R(c-f)+" "+R(S-E)+" L "+R(c+f)+" "+R(S+E)):t.getMarkMiddle()!=n.NONE?s.setAttribute("d","M "+(c-f)+" "+(S-E)+" L "+c+" "+S+" L "+(c+f)+" "+(S+E)):s.setAttribute("d","M "+(c-f)+" "+(S-E)+" L "+(c+f)+" "+(S+E));break;case n.SPLINE_CUBIC:var v=.25*Math.abs(f);"crispEdges"==N.getShapeRendering()?t.getMarkMiddle()!=n.NONE?s.setAttribute("d","M "+R(c-f)+" "+R(S-E)+" Q "+R(c-v)+" "+R(S-E)+", "+R(c)+" "+R(S)+" Q "+R(c+v)+" "+R(S+E)+", "+R(c+f)+" "+R(S+E)):s.setAttribute("d","M "+R(c-f)+" "+R(S-E)+" C "+R(c)+" "+R(S-E)+", "+R(c)+" "+R(S+E)+", "+R(c+f)+" "+R(S+E)):t.getMarkMiddle()!=n.NONE?s.setAttribute("d","M "+(c-f)+" "+(S-E)+" Q "+(c-v)+" "+(S-E)+", "+c+" "+S+" Q "+(c+v)+" "+(S+E)+", "+(c+f)+" "+(S+E)):s.setAttribute("d","M "+(c-f)+" "+(S-E)+" C "+c+" "+(S-E)+", "+c+" "+(S+E)+", "+(c+f)+" "+(S+E)+" L "+(c+f)+" "+(S+E))}N.getDrawFill()?s.setAttribute("fill",N.getFillColor()):s.setAttribute("fill","none"),N.getDrawLines()?(s.setAttribute("stroke",N.getLineColor()),s.setAttribute("stroke-width",N.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("shapeRendering",N.getShapeRendering());var O=N.getAttributes();for(var M in O)s.setAttribute(M,O[M]);return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.axis=function(e,t){var r=EJSS_SVGGRAPHICS.Utils;function n(e,t,n,i,o,a){if(a==EJSS_DRAWING2D.Axis.AXIS_VERTICAL){var s=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(s),"crispEdges"==o.getShapeRendering()?s.setAttribute("d","M "+r.crispValue(t-i/2)+" "+r.crispValue(n)+" L "+r.crispValue(t+i/2)+" "+r.crispValue(n)):s.setAttribute("d","M "+(t-i/2)+" "+n+" L "+(t+i/2)+" "+n)}else{s=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(s),"crispEdges"==o.getShapeRendering()?s.setAttribute("d","M "+r.crispValue(t)+" "+r.crispValue(n-i/2)+" L "+r.crispValue(t)+" "+r.crispValue(n+i/2)):s.setAttribute("d","M "+t+" "+(n-i/2)+" L "+t+" "+(n+i/2))}}function i(e,t,r,n,i,o){var a=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(a);var s=document.createElementNS("http://www.w3.org/2000/svg","text");a.appendChild(s),s.setAttribute("font-family",i.getFontFamily()),s.setAttribute("font-size",i.getFontSizeString()),s.setAttribute("fill",i.getFillColor()),s.setAttribute("stroke",i.getOutlineColor()),s.setAttribute("stroke-width",i.getFontWeight()),s.setAttribute("letterSpacing",i.getLetterSpacing()),s.textContent=n,o?t-=s.getComputedTextLength()/2+.5:r+=i.getFontSize()/2,s.setAttribute("x",t),s.setAttribute("y",r)}var o,a=t.getGroup();o=null!==a?e.getElementById(a.getName()):e;var s=e.getElementById(t.getName());if(null!==s&&o.removeChild(s),t.getShow()){(s=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()),o.appendChild(s);var l=t.getPixelPosition(),u=t.getPixelSizes(),g=t.getRelativePositionOffset(u),c=l[0]+g[0],S=l[1]+g[1],f=u[0]/2,E=u[1]/2,d=t.getStyle(),p=t.getOrient(),h=t.getInvertedScaleY();!function(e,t,n,i,o,a,s,l){var u=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(u),s==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?(l&&(o=-o,n=-n),"crispEdges"==a.getShapeRendering()?u.setAttribute("d","M "+r.crispValue(t)+" "+r.crispValue(n-.5-o)+" L "+r.crispValue(t)+" "+r.crispValue(n-.5+o)):u.setAttribute("d","M "+t+" "+(n-o)+" L "+t+" "+(n+o))):"crispEdges"==a.getShapeRendering()?u.setAttribute("d","M "+r.crispValue(t+.5-i)+" "+r.crispValue(n)+" L "+r.crispValue(t+.5+i)+" "+r.crispValue(n)):u.setAttribute("d","M "+(t-i)+" "+n+" L "+(t+i)+" "+n)}(s,c,S,f,E,d,p,h);var m=p==EJSS_DRAWING2D.Axis.AXIS_VERTICAL?Math.abs(u[1]):Math.abs(u[0]),A=t.getTicksMode();if(A==EJSS_DRAWING2D.Axis.SCALE_LOG){if((O=t.getScale())[0]>0&&O[1]>0){var _=t.getTicks(),D=t.getScalePrecision(),I=t.getTicksSize();EJSS_GRAPHICS.GraphicsUtils.drawLogTicks(c,S,f,E,m,I,O,_,p,(function(e,t,r,i){n(s,e,t,r,d,i)}));var P=t.getFont(),C=t.getTextPosition();EJSS_GRAPHICS.GraphicsUtils.drawLogTicksText(c,S,f,E,m,_,I,O,D,P,C,p,(function(e,t,r,n,o){i(s,e,t,r,n,o)}))}}else if(A==EJSS_DRAWING2D.Axis.SCALE_NUM){var T=0,y=0;if(t.getAutoTicks())for(var R=t.getAutoStepMin(),N=t.getAutoTicksRange(),v=N.length-1;v>=0&&!(1.001*(T=Math.abs(m/N[v]))>=R);v--);else 0!=(_=t.getTicks())?T=m/_:(T=t.getStep(),y=t.getTickStep());D=t.getScalePrecision();var O=t.getScale();if(0==y)var M=Math.abs((O[1]-O[0])*T/m);else{M=y;T=Math.abs(M*m/(O[1]-O[0]))}var b=Math.pow(10,D),G=Math.round(M*b)/b;G>0&&(M=G,T=Math.abs(G*m/(O[1]-O[0])));var L=t.getFixedTick(),x=O[1];isNaN(L)||(x=L<O[0]?L+(Math.floor((O[0]-L)/M)+1)*M:L>O[1]?L-(Math.floor((L-O[1])/M)+1)*M:L);var J=Math.abs((O[0]-x)%M),w=Math.abs(J-M);(J<.001||w<.001)&&(J=0);var k=m*J/Math.abs(O[1]-O[0]);I=t.getTicksSize();EJSS_GRAPHICS.GraphicsUtils.drawDecTicks(c,S,f,E,I,T,k,p,h,(function(e,t,r,i){n(s,e,t,r,d,i)}));P=t.getFont(),C=t.getTextPosition();EJSS_GRAPHICS.GraphicsUtils.drawDecTicksText(c,S,f,E,I,T,k,O,D,M,J,P,C,p,h,(function(e,t,r,n,o){i(s,e,t,r,n,o)}))}d.getDrawFill()?s.setAttribute("fill",d.getFillColor()):s.setAttribute("fill","none"),d.getDrawLines()?(s.setAttribute("stroke",d.getLineColor()),s.setAttribute("stroke-width",d.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("shapeRendering",d.getShapeRendering());var W=d.getAttributes();for(var F in W)s.setAttribute(F,W[F])}return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.byteRaster=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o=e.getElementById(t.getName());if(null==o?((o=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()),r.appendChild(o),(i=document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("id",t.getName()+".img"),o.appendChild(i)):i=e.getElementById(t.getName()+".img"),t.getDataChanged()){var a=t.getData(),s=t.getColorMapper().getColors(),l=a.length;if(l>0){var u=a[0].length,g=t.getColorMapper().getNumberOfColors();EJSS_SVGGRAPHICS.Utils.PNGCanvas(l,u,g,a,s,(function(e){i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e)}))}t.setDataChanged(!1)}var c=t.getPixelPosition(),S=t.getPixelSizes(),f=t.getRelativePositionOffset(S),E=c[0]+f[0],d=c[1]+f[1],p=Math.abs(S[0]/2),h=Math.abs(S[1]/2);i.setAttribute("x",E-p),i.setAttribute("y",d-h),i.setAttribute("width",Math.abs(S[0])),i.setAttribute("height",Math.abs(S[1]));var m=t.getStyle().getAttributes();for(var A in m)i.setAttribute(A,m[A]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.canvas=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o=e.getElementById(t.getName());null===o?((o=document.createElementNS("http://www.w3.org/2000/svg","foreignObject")).setAttribute("id",t.getName()),r.appendChild(o),(i=document.createElement("canvas")).setAttribute("id",t.getName()+".canvas"),o.appendChild(i)):i=document.getElementById(t.getName()+".canvas");var a=t.getPixelPosition(),s=t.getPixelSizes(),l=t.getRelativePositionOffset(s),u=a[0]+l[0],g=a[1]+l[1];i.width=Math.abs(s[0]),i.height=Math.abs(s[1]),o.width=Math.abs(s[0]),o.height=Math.abs(s[1]);var c=Math.abs(s[0]/2),S=Math.abs(s[1]/2);o.setAttribute("x",u-c),o.setAttribute("y",g-S);var f=t.getDimensions(),E=f[1]-f[0],d=f[3]-f[2],p=Math.abs(s[0]),h=Math.abs(s[1]),m=p/E,A=h/d,_=u-p/2,D=g+h/2,I=t.getDrawables(),P=i.getContext("2d");P.fillRect(0,0,i.width-.5,i.height-.5);for(var C=0;C<I.length;C++)void 0!==I[C].imageField?EJSS_GRAPHICS.GraphicsUtils.drawImageField(P,_,D,xMin,yMin,p,h,m,A,I[C]):void 0!==I[C].run&&I[C].draw(P,_,D,xMin,yMin,p,h,m,A);var T=t.getStyle().getAttributes();for(var y in T)o.setAttribute(y,T[y]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.cellLattice=function(e,t){var r=EJSS_SVGGRAPHICS.Utils;function n(e,t,n,i,o,a,s){var l=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(l);var u=i/2,g=o/2;"crispEdges"==a?l.setAttribute("d","M "+r.crispValue(t-u)+" "+r.crispValue(n+g)+" L "+r.crispValue(t+u)+" "+r.crispValue(n+g)+" L "+r.crispValue(t+u)+" "+r.crispValue(n-g)+" L "+r.crispValue(t-u)+" "+r.crispValue(n-g)+" z"):l.setAttribute("d","M "+(t-u)+" "+(n+g)+" L "+(t+u)+" "+(n+g)+" L "+(t+u)+" "+(n-g)+" L "+(t-u)+" "+(n-g)+" z"),l.setAttribute("fill",s),l.setAttribute("stroke",s)}var i,o=t.getGroup();i=null!==o?e.getElementById(o.getName()):e;var a=e.getElementById(t.getName());null!==a&&i.removeChild(a),(a=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()),i.appendChild(a);for(var s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=l[0]/2,f=l[1]/2,E=t.getStyle(),d=t.getData(),p=t.getColorMapper().getColors(),h=d.length,m=d[0].length,A=Math.abs(l[0]/h),_=Math.abs(l[1]/m),D=g-S+A/2,I=c-f-_/2,P=0;P<m;P++)for(var C=0;C<h;C++)n(a,D+A*C,I-_*P,A,_,E.getShapeRendering(),p[d[C][P]]);return t.getShowGrid()&&function(e,t,n,i,o,a,s,l){var u=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(u);var g=i/2,c=o/2,S=t-g,f=t+g,E=n+c,d=n-c;"crispEdges"==l.getShapeRendering()?u.setAttribute("d",function(e,t,n,i,o,a){var s="",l=r.crispValue(e),u=r.crispValue(n),g=r.crispValue(t),c=r.crispValue(i);0==o&&(o=Math.abs(n-e));for(var S=e;S<=Math.max(n,u)+.5;S+=o)s+=" M "+r.crispValue(S)+" "+g+" L "+r.crispValue(S)+" "+c;for(0==a&&(a=Math.abs(t-i)),S=i;S>=Math.min(t,g)-.5;S-=a)s+=" M "+l+" "+r.crispValue(S)+" L "+u+" "+r.crispValue(S);return s}(S,E,f,d,a,s)):u.setAttribute("d",function(e,t,r,n,i,o){var a="";0==i&&(i=Math.abs(r-e));for(var s=e;s<=r;s+=i)a+=" M "+s+" "+t+" L "+s+" "+n;for(0==o&&(o=Math.abs(t-n)),s=n;s>=t;s-=o)a+=" M "+e+" "+s+" L "+r+" "+s;return a}(S,E,f,d,a,s)),l.getDrawLines()?(u.setAttribute("stroke",l.getLineColor()),u.setAttribute("stroke-width",l.getLineWidth())):(u.setAttribute("stroke","none"),u.setAttribute("stroke-width",0));var p=l.getAttributes();for(var h in p)u.setAttribute(h,p[h])}(a,g,c,l[0],l[1],A,_,E),a};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.cursor=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o,a=e.getElementById(t.getName());null===a?((a=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()),r.appendChild(a),(i=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()+".line1"),a.appendChild(i),(o=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()+".line2"),a.appendChild(o)):(i=e.getElementById(t.getName()+".line1"),o=e.getElementById(t.getName()+".line2"));var s=t.getPixelPosition(),l=t.getCursorType(),u=t.getGroupPanel(),g=u.getRealWorldCoordinates(),c=u.toPixelPosition([g[0],g[2]]),S=u.toPixelPosition([g[1],g[3]]),f=t.getStyle();if(i.setAttribute("stroke-width",0),l!=EJSS_DRAWING2D.Cursor.VERTICAL){var E=c[0],d=S[0],p=s[1];p>c[1]?p=c[1]:p<S[1]&&(p=S[1]),"crispEdges"==f.getShapeRendering()?i.setAttribute("d","M "+UTILS.crispValue(E)+" "+UTILS.crispValue(p)+" L "+UTILS.crispValue(d)+" "+UTILS.crispValue(p)):i.setAttribute("d","M "+E+" "+p+" L "+d+" "+p),i.setAttribute("stroke-width",f.getLineWidth())}if(o.setAttribute("stroke-width",0),l!=EJSS_DRAWING2D.Cursor.HORIZONTAL){var h=s[0],m=c[1],A=S[1];h<c[0]?h=c[0]:h>S[0]&&(h=S[0]),"crispEdges"==f.getShapeRendering()?o.setAttribute("d","M "+UTILS.crispValue(h)+" "+UTILS.crispValue(m)+" L "+UTILS.crispValue(h)+" "+UTILS.crispValue(A)):o.setAttribute("d","M "+h+" "+m+" L "+h+" "+A),o.setAttribute("stroke-width",f.getLineWidth())}f.getDrawFill()?a.setAttribute("fill",f.getFillColor()):a.setAttribute("fill","none"),a.setAttribute("stroke",f.getLineColor()),a.setAttribute("shapeRendering",f.getShapeRendering());var _=f.getAttributes();for(var D in _)a.setAttribute(D,_[D]);return a};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.ellipse=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&((i=document.createElementNS("http://www.w3.org/2000/svg","ellipse")).setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=Math.abs(a[0]/2),c=Math.abs(a[1]/2);i.setAttribute("cx",l),i.setAttribute("cy",u),i.setAttribute("rx",g),i.setAttribute("ry",c);var S=t.getStyle();S.getDrawFill()?i.setAttribute("fill",S.getFillColor()):i.setAttribute("fill","none"),S.getDrawLines()?(i.setAttribute("stroke",S.getLineColor()),i.setAttribute("stroke-width",S.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",S.getShapeRendering());var f=S.getAttributes();for(var E in f)i.setAttribute(E,f[E]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.grid=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null!==i&&r.removeChild(i),(i=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()),r.appendChild(i);var o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("id",t.getName()+"X"),i.appendChild(o);var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("id",t.getName()+"Y"),i.appendChild(a);var s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=l[0]/2,f=l[1]/2,E=t.getShowX(),d=t.getShowY(),p="",h="";if(E){var m=t.getTicksXMode();if(m==EJSS_DRAWING2D.Grid.SCALE_LOG){if((O=t.getScaleX())[0]>0&&O[1]>0){var A=t.getTicksX(),_=g-S,D=g+S,I=c+f,P=c-f;EJSS_GRAPHICS.GraphicsUtils.drawLogGrid(_,I,D,P,A,O,1,(function(e,t){p+=" M "+e+" "+t}),(function(e,t){p+=" L "+e+" "+t}))}}else if(m==EJSS_DRAWING2D.Grid.SCALE_NUM){var C=0,T=0;if(t.getAutoTicksX())for(var y=t.getAutoStepXMin(),R=t.getAutoTicksRangeX(),N=R.length-1;N>=0&&!((C=Math.abs(l[0]/R[N]))>=y);N--);else 0!=(A=t.getTicksX())?C=Math.abs(l[0]/A):(C=t.getStepX(),T=t.getTickStepX());var v=t.getScalePrecisionX(),O=t.getScaleX();if(0==T)var M=Math.abs((O[1]-O[0])*C/l[0]);else{M=T;C=Math.abs(M*l[0]/(O[1]-O[0]))}var b=Math.pow(10,v),G=Math.round(M*b)/b;G>0&&(M=G,C=Math.abs(G*l[0]/(O[1]-O[0])));var L=t.getFixedTickX(),x=O[1];isNaN(L)||(x=L<O[0]?L+(Math.floor((O[0]-L)/M)+1)*M:L>O[1]?L-(Math.floor((L-O[1])/M)+1)*M:L);var J=Math.abs((O[0]-x)%M),w=Math.abs(J-M);(J<.001||w<.001)&&(J=0);var k=Math.abs(l[0]*J/(O[1]-O[0]));_=g-S,D=g+S,I=c+f,P=c-f;EJSS_GRAPHICS.GraphicsUtils.drawDecGrid(_,I,D,P,k,C,1,(function(e,t){p+=" M "+e+" "+t}),(function(e,t){p+=" L "+e+" "+t}))}}if(d){var W=t.getTicksYMode();if(W==EJSS_DRAWING2D.Grid.SCALE_LOG){if((H=t.getScaleY())[0]>0&&H[1]>0){var F=t.getTicksY();_=g-S,D=g+S,I=c+f,P=c-f;EJSS_GRAPHICS.GraphicsUtils.drawLogGrid(_,I,D,P,F,H,-1,(function(e,t){h+=" M "+e+" "+t}),(function(e,t){h+=" L "+e+" "+t}))}}else if(W==EJSS_DRAWING2D.Grid.SCALE_NUM){var V=0,U=0;if(t.getAutoTicksY()){var Y=t.getAutoStepYMin(),B=t.getAutoTicksRangeY();for(N=B.length-1;N>=0&&!((V=Math.abs(l[1]/B[N]))>=Y);N--);}else 0!=(F=t.getTicksY())?V=Math.abs(l[1]/F):(V=t.getStepY(),U=t.getTickStepY());var z=t.getScalePrecisionY(),H=t.getScaleY();if(0==U)var X=Math.abs((H[1]-H[0])*V/l[1]);else{X=U;V=Math.abs(X*l[1]/(H[1]-H[0]))}var Z=Math.pow(10,z),j=Math.round(X*Z)/Z;j>0&&(X=j,V=Math.abs(j*l[1]/(H[1]-H[0])));L=t.getFixedTickY(),x=H[1];isNaN(L)||(x=L<H[0]?L+(Math.floor((H[0]-L)/X)+1)*X:L>H[1]?L-(Math.floor((L-H[1])/X)+1)*X:L);J=Math.abs((H[0]-x)%X),w=Math.abs(J-X);(J<.001||w<.001)&&(J=0);var q=Math.abs(l[1]*J/(H[1]-H[0]));_=g-S,D=g+S,I=c+f,P=c-f;EJSS_GRAPHICS.GraphicsUtils.drawDecGrid(_,I,D,P,q,V,-1,(function(e,t){h+=" M "+e+" "+t}),(function(e,t){h+=" L "+e+" "+t}))}}p.length>0&&(o.setAttribute("d",p),o.setAttribute("shapeRendering",t.getShapeRenderingX()),o.setAttribute("stroke",t.getLineColorX()),o.setAttribute("stroke-width",t.getLineWidthX())),h.length>0&&(a.setAttribute("d",h),a.setAttribute("shapeRendering",t.getShapeRenderingY()),a.setAttribute("stroke",t.getLineColorY()),a.setAttribute("stroke-width",t.getLineWidthY()));var K=t.getStyle().getAttributes();for(var Q in K)o.setAttribute(Q,K[Q]),a.setAttribute(Q,K[Q]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.group=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());return null===i&&((i=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()),r.appendChild(i)),i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.histogram=function(e,t){function r(e,t,r,n,i,o){e.setAttribute("d","M "+t+" "+i+" L "+t+" "+n+" L "+r+" "+n+" L "+r+" "+i+" z"),o.getDrawFill()?e.setAttribute("fill",o.getFillColor()):e.setAttribute("fill","none"),o.getDrawLines()?(e.setAttribute("stroke",o.getLineColor()),e.setAttribute("stroke-width",o.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",o.getShapeRendering())}var n,i=t.getGroup();n=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());if(null===o)(o=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()),n.appendChild(o);else{var a=e.getElementById(t.getName()+".bars");o.removeChild(a)}(a=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()+".bars"),o.appendChild(a);for(var s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=l[0]/2,f=l[1]/2,E=t.getStyle(),d=t.getDiscrete(),p=t.getBinWidth()/2,h=t.getBars(),m=t.getGroupPanel().getPixelPositionWorldOrigin()[1],A=0;A<h.length;A++){var _,D,I=document.createElementNS("http://www.w3.org/2000/svg","path");I.setAttribute("id",t.getName()+".bar"+A),a.appendChild(I);var P=h[A][0];d?_=D=g-S+P*l[0]:(_=g-S+(P-p)*l[0],D=g-S+(P+p)*l[0]),r(I,_,D,c-f+h[A][1]*l[1],m,E)}var C=E.getAttributes();for(var T in C)o.setAttribute(T,C[T]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.image=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&((i=document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=Math.abs(a[0]/2),c=Math.abs(a[1]/2);if(!i.getAttributeNS("http://www.w3.org/1999/xlink","href")||t.getChangedImage()){var S=t.getEncode();S.length>0?i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","data:png;base64,"+S):i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t.getImageUrl()),t.setChangedImage(!1)}i.setAttribute("preserveAspectRatio","none"),i.setAttribute("x",l-g),i.setAttribute("y",u-c),i.setAttribute("width",Math.abs(a[0])),i.setAttribute("height",Math.abs(a[1]));var f=t.getStyle();f.getDrawFill()?i.setAttribute("fill",f.getFillColor()):i.setAttribute("fill","none"),f.getDrawLines()?(i.setAttribute("stroke",f.getLineColor()),i.setAttribute("stroke-width",f.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",f.getShapeRendering());var E=f.getAttributes();for(var d in E)i.setAttribute(d,E[d]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.mesh=function(e,t){var r,n,i,o;function a(e,t,r,n,i){var o=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(o);for(var a="",s=t.length-1,l=0;l<s;l++)a+=0==l?" M "+t[l]+" "+r[l]:" L "+t[l]+" "+r[l];a+=" L "+t[l]+" "+r[l]+" Z",o.setAttribute("d",a),n&&i.getDrawFill()?o.setAttribute("fill",i.getFillColor()):o.setAttribute("fill","none"),i.getDrawLines()?(o.setAttribute("stroke",i.getLineColor()),o.setAttribute("stroke-width",i.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",i.getShapeRendering())}function s(e,t,r,n,i){var o=document.createElementNS("http://www.w3.org/2000/svg","g");e.appendChild(o);for(var a=0;a<t.length;a++){var s=document.createElementNS("http://www.w3.org/2000/svg","g");o.appendChild(s);var l=document.createElementNS("http://www.w3.org/2000/svg","path");s.appendChild(l);var u=document.createElementNS("http://www.w3.org/2000/svg","polygon");s.appendChild(u);var g=t[a],c=r[a],S=n[a][0],f=n[a][1],E=S*i/(m=EJSS_TOOLS.Mathematics.norm([S,f])),d=f*i/m,p="M "+g+" "+c+" L "+(g+E)+" "+(c+d);if(l.setAttribute("d",p),0!=E||0!=d){var h,m;(h=.3*(m=EJSS_TOOLS.Mathematics.norm([E,d])))>12&&(h=12);var A=g+E,_=c+d,D=A+","+_+" "+(A-h)+","+(_+h/3)+" "+(A-h)+","+(_-h/3);u.setAttribute("points",D);var I=Math.atan2(E,-d);I=180*I/Math.PI,u.setAttribute("transform","rotate("+(I-90)+" "+A+" "+_+")")}s.setAttribute("stroke","black"),s.setAttribute("stroke-width",.5)}}var l,u=t.getGroup();l=null!==u?e.getElementById(u.getName()):e;var g=document.createElementNS("http://www.w3.org/2000/svg","g");g.setAttribute("id",t.getName());var c=e.getElementById(t.getName());null!==c?c.parentNode.replaceChild(g,c):l.appendChild(g);var S=t.getPixelPosition(),f=t.getPixelSizes(),E=t.getRelativePositionOffset(f),d=S[0]+E[0],p=S[1]+E[1],h=f[0]/2,m=f[1]/2,A=t.getPoints();if(null!=A){var _=A.length;r=new Array(_),n=new Array(_);for(var D=0;D<_;D++)r[D]=d-h+A[D][0]*f[0],n[D]=p-m+A[D][1]*f[1];var I=t.getCells(),P=t.getFieldAtPoints();if(P?i=EJSS_GRAPHICS.GraphicsUtils.buildCells(r,n,I,P,!1):(P=t.getFieldAtCells(),i=EJSS_GRAPHICS.GraphicsUtils.buildCells(r,n,I,P,!0)),null!=I){var C=t.getStyle();if(null!=P){var T=t.getColorCoded();EJSS_GRAPHICS.GraphicsUtils.drawPolygons(i,T,(function(e,t){a(g,e,t,!1,C)}),(function(e,t,r,n,i){!function(e,t,r,n,i,o){var a=document.createElementNS("http://www.w3.org/2000/svg","polygon");e.appendChild(a);for(var s="",l=0;l<n;l++)s+=t[l]+","+r[l]+" ";s+=t[0]+","+r[0]+" ",a.setAttribute("points",s);var u=i.indexToColor(o,!0);a.setAttribute("fill",u),a.setAttribute("stroke",u),a.setAttribute("stroke-width",1.25)}(g,e,t,r,n,i)}))}else EJSS_GRAPHICS.GraphicsUtils.drawPolygons(i,T,(function(e,t){a(g,e,t,!0,C)}),(function(e,t,r,n,i){}))}var y=t.getBoundary();if(t.getDrawBoundary()&&null!=y){var R=t.getBoundaryLabels(),N=t.getBoundaryColors(),v=t.getBoundaryLineWidth();o=EJSS_GRAPHICS.GraphicsUtils.buildBoundary(r,n,y),EJSS_GRAPHICS.GraphicsUtils.drawBoundary(o,R,N,(function(e,t,r){!function(e,t,r,n,i){var o=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(o);for(var a="",s=t.length-1,l=0;l<s;l++)a+=0==l?" M "+t[l]+" "+r[l]:" L "+t[l]+" "+r[l];a+=" L "+t[l]+" "+r[l]+" Z",o.setAttribute("d",a),o.setAttribute("fill","none"),o.setAttribute("stroke",n),o.setAttribute("stroke-width",i+.5)}(g,e,t,r,v)}))}if(t.getDataType()>=4&&null!=P)for(var O=t.getVectorLength()*f[0],M=(D=0,I.length);D<M;D++)s(g,mCellA[D],mCellB[D],P[D],O);var b=t.getStyle().getAttributes();for(var G in b)g.setAttribute(G,b[G]);return g}};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.pipe=function(e,t){var r,n=EJSS_SVGGRAPHICS.Utils,i=t.getGroup();r=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&((o=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()),r.appendChild(o));var a=e.getElementById(t.getName()+":container");null===a&&((a=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()+":container"),o.appendChild(a));var s=e.getElementById(t.getName()+":liquid");null===s&&((s=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()+":liquid"),o.appendChild(s));var l=t.getPoints();if(l&&!(l.length<=0)){var u,g=t.getPixelPosition(),c=t.getPixelSizes(),S=t.getRelativePositionOffset(c),f=g[0]+S[0],E=g[1]+S[1],d=Math.abs(c[0]),p=Math.abs(c[1]),h=f-d/2,m=E+p/2,A=t.getStyle(),_="crispEdges"==A.getShapeRendering(),D="",I="";D=u=_?"M "+n.crispValue(h)+" "+n.crispValue(m):"M "+h+" "+m,I=u;for(var P=0,C=l.length;P<C;P++){var T=l[P];f=Math.round(T[0]*d),E=Math.round(-T[1]*p);D+=u=_?" l "+n.crispValue(f)+" "+n.crispValue(E):" l "+f+" "+E,I+=u}a.setAttribute("d",D),s.setAttribute("d",I),A.getDrawFill()?(s.setAttribute("stroke",A.getFillColor()),s.setAttribute("stroke-width",t.getPipeWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0)),s.setAttribute("fill","none"),s.setAttribute("shapeRendering",A.getShapeRendering()),A.getDrawLines()?(a.setAttribute("stroke",A.getLineColor()),a.setAttribute("stroke-width",2*A.getLineWidth()+t.getPipeWidth())):(a.setAttribute("stroke","none"),a.setAttribute("stroke-width",0)),a.setAttribute("fill","none"),a.setAttribute("shapeRendering",A.getShapeRendering());var y=A.getAttributes();for(var R in y)s.setAttribute(R,y[R]),a.setAttribute(R,y[R]);return o}};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.point=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&((i=document.createElementNS("http://www.w3.org/2000/svg","ellipse")).setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1];i.setAttribute("cx",l),i.setAttribute("cy",u),i.setAttribute("rx",2),i.setAttribute("ry",2);var g=t.getStyle();i.setAttribute("fill",g.getFillColor());var c=g.getAttributes();for(var S in c)i.setAttribute(S,c[S]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.polygon=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&((i=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()),r.appendChild(i));for(var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=a[0]/2,c=a[1]/2,S=t.getPoints(),f="",E=0;E<S.length;E++){var d=S[E],p=l-g+d[0]*a[0],h=u-c+d[1]*a[1],m=d[2];f+=0==E||0==m?" M "+p+" "+h:" L "+p+" "+h}if(""!==f){i.setAttribute("d",f);var A=t.getStyle();A.getDrawFill()?i.setAttribute("fill",A.getFillColor()):i.setAttribute("fill","none"),A.getDrawLines()?(i.setAttribute("stroke",A.getLineColor()),i.setAttribute("stroke-width",A.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",A.getShapeRendering());var _=A.getAttributes();for(var D in _)i.setAttribute(D,_[D])}return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.rectangle=function(e,t){var r,n=EJSS_SVGGRAPHICS.Utils,i=t.getGroup();r=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&((o=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()),r.appendChild(o));var a=t.getPixelPosition(),s=t.getPixelSizes(),l=t.getRelativePositionOffset(s),u=a[0]+l[0],g=a[1]+l[1],c=s[0]/2,S=s[1]/2,f=t.getStyle();"crispEdges"==f.getShapeRendering()?o.setAttribute("d","M "+n.crispValue(u-c)+" "+n.crispValue(g+S)+" L "+n.crispValue(u+c)+" "+n.crispValue(g+S)+" L "+n.crispValue(u+c)+" "+n.crispValue(g-S)+" L "+n.crispValue(u-c)+" "+n.crispValue(g-S)+" z"):o.setAttribute("d","M "+(u-c)+" "+(g+S)+" L "+(u+c)+" "+(g+S)+" L "+(u+c)+" "+(g-S)+" L "+(u-c)+" "+(g-S)+" z"),f.getDrawFill()?o.setAttribute("fill",f.getFillColor()):o.setAttribute("fill","none"),f.getDrawLines()?(o.setAttribute("stroke",f.getLineColor()),o.setAttribute("stroke-width",f.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",f.getShapeRendering());var E=f.getAttributes();for(var d in E)o.setAttribute(d,E[d]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.roundRectangle=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&((i=document.createElementNS("http://www.w3.org/2000/svg","rect")).setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=Math.abs(a[0]/2),c=Math.abs(a[1]/2),S=Math.abs(t.getCornerRadius());i.setAttribute("x",l-g),i.setAttribute("y",u-c),i.setAttribute("width",Math.abs(a[0])),i.setAttribute("height",Math.abs(a[1])),i.setAttribute("rx",S),i.setAttribute("ry",S);var f=t.getStyle();f.getDrawFill()?i.setAttribute("fill",f.getFillColor()):i.setAttribute("fill","none"),f.getDrawLines()?(i.setAttribute("stroke",f.getLineColor()),i.setAttribute("stroke-width",f.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",f.getShapeRendering());var E=f.getAttributes();for(var d in E)i.setAttribute(d,E[d]);return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.scalarField=function(e,t){EJSS_SVGGRAPHICS.Utils;var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o=e.getElementById(t.getName());null===o?((o=document.createElementNS("http://www.w3.org/2000/svg","foreignObject")).setAttribute("id",t.getName()),r.appendChild(o),(i=document.createElement("canvas")).setAttribute("id",t.getName()+".canvas"),o.appendChild(i)):i=document.getElementById(t.getName()+".canvas");var a=t.getPixelPosition(),s=t.getPixelSizes(),l=t.getRelativePositionOffset(s),u=a[0]+l[0],g=a[1]+l[1],c=Math.round(Math.abs(s[0])),S=Math.round(Math.abs(s[1])),f=Math.abs(s[0]/2),E=Math.abs(s[1]/2);o.setAttribute("x",u-f),o.setAttribute("y",g-E),c==+o.getAttribute("width")&&S==+o.getAttribute("height")||(o.setAttribute("width",c),o.setAttribute("height",S),i.setAttribute("width",c),i.setAttribute("height",S));var d=t.getColorMapper().getColors(),p=t.getData(),h=p.length;if(h>0){var m=p[0].length,A=t.getMinimumZ(),_=t.getMaximumZ(),D={width:c,height:S,data:p,nx:h,ny:m,colors:d,lower:A,upper:_};if(t.getParallelDrawing()){new Parallel(D).spawn(EJSS_GRAPHICS.GraphicsUtils.drawImageFieldParallel).then((function(e){var t=i.getContext("2d");t.fillRect(0,0,c,S);for(var r=t.getImageData(0,0,c,S),n=r.data,o=0,a=e.length-4;o<a;o+=4)n[o]=e[o],n[o+1]=e[o+1],n[o+2]=e[o+2];t.putImageData(r,0,0)}))}else{var I=i.getContext("2d");I.fillRect(0,0,c,S),EJSS_GRAPHICS.GraphicsUtils.drawImageField(I,D)}}var P=t.getStyle().getAttributes();for(var C in P)o.setAttribute(C,P[C]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.segment=function(e,t){var r,n=EJSS_SVGGRAPHICS.Utils,i=t.getGroup();r=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&((o=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()),r.appendChild(o));var a=t.getPixelPosition(),s=t.getPixelSizes(),l=t.getRelativePositionOffset(s),u=a[0]+l[0],g=a[1]+l[1],c=s[0]/2,S=s[1]/2,f=t.getStyle();"crispEdges"==f.getShapeRendering()?o.setAttribute("d","M "+n.crispValue(u-c)+" "+n.crispValue(g-S)+" L "+n.crispValue(u+c)+" "+n.crispValue(g+S)):o.setAttribute("d","M "+(u-c)+" "+(g-S)+" L "+(u+c)+" "+(g+S)),f.getDrawFill()?o.setAttribute("fill",f.getFillColor()):o.setAttribute("fill","none"),f.getDrawLines()?(o.setAttribute("stroke",f.getLineColor()),o.setAttribute("stroke-width",f.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),o.setAttribute("shapeRendering",f.getShapeRendering());var E=f.getAttributes();for(var d in E)o.setAttribute(d,E[d]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.spring=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i=e.getElementById(t.getName());null===i&&((i=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()),r.appendChild(i));var o=t.getPixelPosition(),a=t.getPixelSizes(),s=t.getRelativePositionOffset(a),l=o[0]+s[0],u=o[1]+s[1],g=a[0]/2,c=a[1]/2,S=t.getGroupPanel().toPixelMod([t.getRadius(),0])[0],f="";if(EJSS_GRAPHICS.GraphicsUtils.drawSpring(t.getLoops(),t.getPointsPerLoop(),S,t.getSolenoid(),t.getThinExtremes(),l-g,u-c,a[0],a[1],(function(e,t){f+=" M "+e+" "+t}),(function(e,t){f+=" L "+e+" "+t})),""!==f){i.setAttribute("d",f);var E=t.getStyle();E.getDrawFill()?i.setAttribute("fill",E.getFillColor()):i.setAttribute("fill","none"),E.getDrawLines()?(i.setAttribute("stroke",E.getLineColor()),i.setAttribute("stroke-width",E.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",E.getShapeRendering());var d=E.getAttributes();for(var p in d)i.setAttribute(p,d[p])}return i};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.tank=function(e,t){var r,n=EJSS_SVGGRAPHICS.Utils,i=t.getGroup();r=null!==i?e.getElementById(i.getName()):e;var o=e.getElementById(t.getName());null===o&&((o=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()),r.appendChild(o));var a=e.getElementById(t.getName()+":container");null===a&&((a=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()+":container"),o.appendChild(a));var s=e.getElementById(t.getName()+":liquid");null===s&&((s=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()+":liquid"),o.appendChild(s));var l=t.getPixelPosition(),u=t.getPixelSizes(),g=t.getRelativePositionOffset(u),c=l[0]+g[0],S=l[1]+g[1],f=Math.abs(u[0]/2),E=Math.abs(u[1]/2),d=t.getPixelSizeOf(0,t.getLevel()),p=c-f,h=c+f,m=S+E,A=S-E,_=m+d[1],D=t.getStyle();"crispEdges"==D.getShapeRendering()?(s.setAttribute("d","M "+n.crispValue(xlevel)+" "+n.crispValue(_)+" L "+n.crispValue(p)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(m)+" L "+n.crispValue(xlevel)+" "+n.crispValue(_)+" Z"),D.getDrawFill()?a.setAttribute("d","M "+n.crispValue(p)+" "+n.crispValue(A)+" L "+n.crispValue(p)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(A)+" Z"):a.setAttribute("d","M "+n.crispValue(p)+" "+n.crispValue(A)+" L "+n.crispValue(p)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(m)+" L "+n.crispValue(h)+" "+n.crispValue(A))):(s.setAttribute("d","M "+(p+d[0])+" "+_+" L "+p+" "+m+" L "+h+" "+m+" L "+(h+d[0])+" "+_+" Z"),D.getDrawFill()?a.setAttribute("d","M "+p+" "+A+" L "+p+" "+m+" L "+h+" "+m+" L "+h+" "+A+" Z"):a.setAttribute("d","M "+p+" "+A+" L "+p+" "+m+" L "+h+" "+m+" L "+h+" "+A)),s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0),s.setAttribute("fill",t.getLevelColor()),s.setAttribute("shapeRendering",D.getShapeRendering()),D.getDrawFill()?a.setAttribute("fill",D.getFillColor()):a.setAttribute("fill","none"),a.setAttribute("stroke",D.getLineColor()),a.setAttribute("stroke-width",D.getLineWidth()),a.setAttribute("shapeRendering",D.getShapeRendering());var I=D.getAttributes();for(var P in I)s.setAttribute(P,I[P]),a.setAttribute(P,I[P]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.text=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var o,a,s,l=e.getElementById(t.getName());for(null===l?((l=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()),r.appendChild(l),(o=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()+".inner"),l.appendChild(o),(s=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()+".box"),o.appendChild(s),(a=document.createElementNS("http://www.w3.org/2000/svg","text")).setAttribute("id",t.getName()+".text"),o.appendChild(a)):(o=e.getElementById(t.getName()+".inner"),a=e.getElementById(t.getName()+".text"),s=e.getElementById(t.getName()+".box"));a.firstChild;)a.removeChild(a.firstChild);var u=t.getFont();a.setAttribute("font-style",u.getFontStyle()),a.setAttribute("font-weight",u.getFontWeight()),a.setAttribute("font-size",u.getFontSizeString()),a.setAttribute("font-family",u.getFontFamily()),a.setAttribute("fill",u.getFillColor()),a.setAttribute("stroke",u.getOutlineColor()),a.setAttribute("stroke-width",u.getOutlineWidth()),a.setAttribute("letterSpacing",u.getLetterSpacing());var g,c,S=t.getText(),f=S.split("\n"),E=t.getDrawingSize();if(-1==E[0]){for(void 0!==S&&null!=S||(S=""),g=0,c=u.getFontSize(),a.textContent="",a.setAttribute("visibility","hidden"),i=0;i<f.length;i++){a.textContent=f[i];var d=a.getComputedTextLength();d>g&&(g=d),i>0&&(c+=1.8*u.getFontSize())}a.setAttribute("visibility","inherit"),a.textContent="",t.setDrawingSize([g,c])}else g=E[0],c=E[1];var p=t.getPixelPosition(),h=t.getFramed()?4:0,m=[g+2*h,c/1.5+2*h],A=EJSS_DRAWING2D.Element.getSWRelativePositionOffset(t.getRelativePosition(),m[0],m[1]),_=t.getMarginX(),D=t.getMarginY(),I=p[0]+A[0]+_+h,P=p[1]+A[1]+D-h;for(a.setAttribute("x",I),a.setAttribute("y",P),i=f.length-1;i>=0;i--){var C=document.createElementNS("http://www.w3.org/2000/svg","tspan");i==f.length-1?C.setAttribute("y",P):C.setAttribute("dy","-1.2em"),C.setAttribute("x",I),C.textContent=f[i],a.appendChild(C)}if(t.getFramed()){var T=m[0]-2*h;if(T>0){var y=P+h,R=P-(m[1]-2*h)-h,N=I-h,v=I+T+h;s.setAttribute("d","M "+N+" "+y+" L "+v+" "+y+" L "+v+" "+R+" L "+N+" "+R+" z");var O=t.getStyle();O.getDrawFill()?s.setAttribute("fill",O.getFillColor()):s.setAttribute("fill","none"),O.getDrawLines()?(s.setAttribute("stroke",O.getLineColor()),s.setAttribute("stroke-width",O.getLineWidth())):(s.setAttribute("stroke","none"),s.setAttribute("stroke-width",0));var M=O.getAttributes();for(var b in M)mShape.setAttribute(b,M[b])}else s.setAttribute("stroke","none"),s.setAttribute("fill","none")}var G=0;switch(t.getWritingMode()){case EJSS_DRAWING2D.Text.MODE_TOPDOWN:G=90;break;case EJSS_DRAWING2D.Text.MODE_RIGTHLEFT:G=180;break;case EJSS_DRAWING2D.Text.MODE_DOWNTOP:G=270;break;case EJSS_DRAWING2D.Text.MODE_LEFTRIGHT:G=0}return o.setAttribute("transform","rotate("+G+" "+(p[0]+_)+" "+(p[1]+D)+")"),l.setAttribute("pointer-events","none"),l};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.trace=function(e,t){function r(e,t,r,n,i){var o=t,a=r,s=Math.abs(n[0]/2),l=Math.abs(n[1]/2);e.setAttribute("cx",o),e.setAttribute("cy",a),e.setAttribute("rx",s),e.setAttribute("ry",l),i.getDrawFill()?e.setAttribute("fill",i.getFillColor()):e.setAttribute("fill","none"),i.getDrawLines()?(e.setAttribute("stroke",i.getLineColor()),e.setAttribute("stroke-width",i.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",i.getShapeRendering())}function n(e,t,r,n,i){var o=t,a=r,s=Math.abs(n[0]/2),l=Math.abs(n[1]/2);G.setAttribute("d","M "+(o-s)+" "+(a+l)+" L "+(o+s)+" "+(a+l)+" L "+(o+s)+" "+(a-l)+" L "+(o-s)+" "+(a-l)+" z"),i.getDrawFill()?e.setAttribute("fill",i.getFillColor()):e.setAttribute("fill","none"),i.getDrawLines()?(e.setAttribute("stroke",i.getLineColor()),e.setAttribute("stroke-width",i.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",i.getShapeRendering())}function i(e,t,r,n,i,o,a){G.setAttribute("d","M "+t+" "+o+" L "+t+" "+r+" L "+n+" "+i+" L "+n+" "+o+" z"),a.getDrawFill()?e.setAttribute("fill",a.getFillColor()):e.setAttribute("fill","none"),a.getDrawLines()?(e.setAttribute("stroke",a.getLineColor()),e.setAttribute("stroke-width",a.getLineWidth())):(e.setAttribute("stroke","none"),e.setAttribute("stroke-width",0)),e.setAttribute("shapeRendering",a.getShapeRendering())}var o,a=t.getGroup();o=null!==a?e.getElementById(a.getName()):e;var s=document.createElementNS("http://www.w3.org/2000/svg","g");o.appendChild(s);var l=e.getElementById(t.getName());null!==l&&(o.insertBefore(s,l),o.removeChild(l)),s.setAttribute("id",t.getName());var u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("id",t.getName()+".trail"),s.appendChild(u);var g=document.createElementNS("http://www.w3.org/2000/svg","g");g.setAttribute("id",t.getName()+".marks"),s.appendChild(g);var c=t.getPixelPosition(),S=t.getPixelSizes(),f=t.getRelativePositionOffset(S),E=c[0]+f[0],d=c[1]+f[1],p=S[0]/2,h=S[1]/2,m=function(e,t,r,n,i){for(var o="",a=0;a<e.length;a++){var s=e[a],l=t+s[0]*n,u=r+s[1]*i,g=s[2];o+=0==a||0==g?" M "+l+" "+u:" L "+l+" "+u}return o}(t.getPoints(),E-p,d-h,S[0],S[1]);if(""!==m){u.setAttribute("d",m);var A=t.getStyle();A.getDrawFill()?u.setAttribute("fill",A.getFillColor()):u.setAttribute("fill","none"),A.getDrawLines()?(u.setAttribute("stroke",A.getLineColor()),u.setAttribute("stroke-width",A.getLineWidth())):(u.setAttribute("stroke","none"),u.setAttribute("stroke-width",0)),u.setAttribute("shapeRendering",A.getShapeRendering());for(var _,D,I=t.getPoints(),P=t.getMarkStyleList(),C=0;C<I.length;C++){var T=I[C],y=E-p+T[0]*S[0],R=d-h+T[1]*S[1],N=T[3],v=P.length>C?P[C]:T[4],O=[T[5],T[6]],M=T[7];if(N==EJSS_DRAWING2D.Trace.ELLIPSE)(G=document.createElementNS("http://www.w3.org/2000/svg","ellipse")).setAttribute("id",t.getName()+".mark"+C),g.appendChild(G),r(G,y,R,O,v);else if(N==EJSS_DRAWING2D.Trace.RECTANGLE){(G=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()+".mark"+C),g.appendChild(G),n(G,y,R,O,v)}else if(N==EJSS_DRAWING2D.Trace.BAR){(G=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()+".mark"+C),g.appendChild(G);var b=t.getGroupPanel().toPixelPosition([0,M])[1];O[1]=b-R,R+=O[1]/2,n(G,y,R,O,v)}else if(N==EJSS_DRAWING2D.Trace.AREA){if(0!=C){var G;(G=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()+".mark"+C),g.appendChild(G);b=t.getGroupPanel().toPixelPosition([0,M])[1];var L=E-p+_*S[0],x=d-h+D*S[1];i(G,L,x,y,R,b,v)}_=T[0],D=T[1]}}var J=A.getAttributes();for(var w in J)s.setAttribute(w,J[w])}return s};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.trail=function(e,t){function r(e,t,r,n,i,o,a,s){if(!(r<=0)){var l=document.createElementNS("http://www.w3.org/2000/svg","path");e.appendChild(l);for(var u="",g=0;g<r;g++){var c=t[g],S=i+c[0]*a,f=o+c[1]*s,E=c[2];u+=0==g||0==E?" M "+S+" "+f:" L "+S+" "+f}l.setAttribute("d",u),n.getDrawFill()?l.setAttribute("fill",n.getFillColor()):l.setAttribute("fill","none"),n.getDrawLines()?(l.setAttribute("stroke",n.getLineColor()),l.setAttribute("stroke-width",n.getLineWidth())):(l.setAttribute("stroke","none"),l.setAttribute("stroke-width",0)),l.setAttribute("shapeRendering",n.getShapeRendering());var d=n.getAttributes();for(var p in d)l.setAttribute(p,d[p])}}var n,i=t.getGroup();n=null!==i?e.getElementById(i.getName()):e;var o=document.createElementNS("http://www.w3.org/2000/svg","g");n.appendChild(o);var a=e.getElementById(t.getName());null!==a&&(n.insertBefore(o,a),n.removeChild(a)),o.setAttribute("id",t.getName());var s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=g-l[0]/2,f=c-l[1]/2,E=l[0],d=l[1],p=t.getSegmentsCount();if(p>0)for(var h=0;h<p;h++){var m=t.getSegmentPoints(h).length;r(o,t.getSegmentPoints(h),m,t.getSegmentStyle(h),S,f,E,d)}m=t.getCurrentPoints().length;return r(o,t.getCurrentPoints(),m,t.getStyle(),S,f,E,d),o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.Utils={},EJSS_SVGGRAPHICS.Utils.crispValue=function(e){return Math.round(+e.toFixed(4)+.5)-.5},EJSS_SVGGRAPHICS.Utils.crispTop=function(e){return Math.round(+e.toFixed(4)+.5)-.5},EJSS_SVGGRAPHICS.Utils.round=function(e){return+e.toFixed(4)},EJSS_SVGGRAPHICS.Utils.hsl2rgb=function(e){var t,r,n,i=e[0],o=e[1],a=e[2],s=(1-Math.abs(2*a-1))*o,l=i/60,u=s*(1-Math.abs(l%2-1));void 0===i||isNaN(i)||null===i?t=r=n=0:l>=0&&l<1?(t=s,r=u,n=0):l>=1&&l<2?(t=u,r=s,n=0):l>=2&&l<3?(t=0,r=s,n=u):l>=3&&l<4?(t=0,r=u,n=s):l>=4&&l<5?(t=u,r=0,n=s):l>=5&&l<6&&(t=s,r=0,n=u);var g,c,S,f=a-s/2;return g=255*(t+f),c=255*(r+f),S=255*(n+f),{r:g=Math.round(g),g:c=Math.round(c),b:S=Math.round(S)}},EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker=function(e){var t=e.data.params.imageData,r=e.data.params.width,n=e.data.params.height,i=(e.data.params.depth,e.data.params.data),o=e.data.params.colors,a=e.data.id;function s(e){return{r:e[0],g:e[1],b:e[2]}}function l(e){return{r:(e=e.substring(4,e.length-1).replace(/ /g,"").split(","))[0],g:e[1],b:e[2]}}function u(e,t,r,n,i,o,s){a=4*(t+r*e.width),e.data[a+0]=n,e.data[a+1]=i,e.data[a+2]=o,e.data[a+3]=s}for(var g,c=o[0],S=o[o.length-1],f=0;f<r;f++)for(var E=0;E<n;E++){var d=(a=i[f][n-E-1])<0?c:a<o.length?o[a]:S;void 0===d&&(d=c),"string"==typeof d?"rgb"==d.substring(0,3)?rgb=l(d):"hsl"==d.substring(0,3)&&(rgb=EJSS_SVGGRAPHICS.Utils.hsl2rgb({h:(g=(g=d).substring(4,g.length-1).replace(/ /g,"").replace(/%/g,"").split(","))[0],s:g[1]/100,l:g[2]/100})):Array.isArray(d)&&(rgb=s(d)),u(t,f,E,rgb.r,rgb.g,rgb.b,255)}self.postMessage({result:t,id:a})},EJSS_SVGGRAPHICS.Utils.PNGCanvasNoWorker=function(e,t,r,n,i,o){function a(e){return{r:e[0],g:e[1],b:e[2]}}function s(e){return{r:(e=e.substring(4,e.length-1).replace(/ /g,"").split(","))[0],g:e[1],b:e[2]}}function l(e,t,r,n,i,o,a){E=4*(t+r*e.width),e.data[E+0]=n,e.data[E+1]=i,e.data[E+2]=o,e.data[E+3]=a}for(var u,g=o[0],c=o[o.length-1],S=0;S<t;S++)for(var f=0;f<r;f++){var E=i[S][r-f-1],d=E<0?g:E<o.length?o[E]:c;void 0===d&&(d=g),"string"==typeof d?"rgb"==d.substring(0,3)?rgb=s(d):"hsl"==d.substring(0,3)&&(rgb=EJSS_SVGGRAPHICS.Utils.hsl2rgb({h:(u=(u=d).substring(4,u.length-1).replace(/ /g,"").replace(/%/g,"").split(","))[0],s:u[1]/100,l:u[2]/100})):Array.isArray(d)&&(rgb=a(d)),l(e,S,f,rgb.r,rgb.g,rgb.b,255)}},EJSS_SVGGRAPHICS.Utils.PNGCanvas=function(e,t,r,n,i,o){var a=document.createElement("canvas");a.setAttribute("width",e),a.setAttribute("height",t);var s=a.getContext("2d"),l=s.createImageData(e,t);EJSS_TOOLS.Worker&&EJSS_TOOLS.Worker.runFunction?EJSS_TOOLS.Worker.runFunction("PNGCanvasWorker",EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker,{imageData:l,width:e,height:t,depth:r,data:n,colors:i},(function(e){s.putImageData(e.result,0,0),o(a.toDataURL())})):(EJSS_SVGGRAPHICS.Utils.PNGCanvasNoWorker(l,e,t,r,n,i),s.putImageData(l,0,0),o(a.toDataURL()))},EJSS_SVGGRAPHICS.Utils.ImageDataCanvas=function(e,t,r,n,i,o){var a=document.createElement("canvas");a.setAttribute("width",e),a.setAttribute("height",t);var s=a.getContext("2d").createImageData(e,t);EJSS_TOOLS.Worker.runFunction("PNGCanvasWorker",EJSS_SVGGRAPHICS.Utils.PNGCanvasWorker,{imageData:s,width:e,height:t,depth:r,data:n,colors:i},(function(e){o(e)}))};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.video=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o=e.getElementById(t.getName());null===o?((o=document.createElementNS("http://www.w3.org/2000/svg","foreignObject")).setAttribute("id",t.getName()),r.appendChild(o),(i=document.createElement("video")).setAttribute("id",t.getName()+".video"),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia,navigator.getUserMedia&&t.getWebCam()?navigator.getUserMedia({video:!0},(function(e){i.src=window.URL.createObjectURL(e)}),(function(e){})):i.src=t.getVideoUrl(),o.appendChild(i)):i=document.getElementById(t.getName()+".video");var a=t.getPixelPosition(),s=t.getPixelSizes(),l=t.getRelativePositionOffset(s),u=a[0]+l[0],g=a[1]+l[1],c=Math.abs(s[0]/2),S=Math.abs(s[1]/2);i.loop=t.getLoop(),i.type=t.getType(),i.poster=t.getPoster(),i.autoplay=t.getAutoPlay(),i.controls=t.getControls(),!isNaN(i.duration)&&i.duration>=t.getCurrentTime()&&(i.currentTime=t.getCurrentTime()),i.width=Math.abs(s[0]),i.height=Math.abs(s[1]),o.setAttribute("x",u-c),o.setAttribute("y",g-S),t.isPlay()?i.play():i.pause();var f=t.getStyle().getAttributes();for(var E in f)o.setAttribute(E,f[E]);return o};var EJSS_SVGGRAPHICS=EJSS_SVGGRAPHICS||{};EJSS_SVGGRAPHICS.wheel=function(e,t){var r,n=t.getGroup();r=null!==n?e.getElementById(n.getName()):e;var i,o,a=e.getElementById(t.getName());null===a?((a=document.createElementNS("http://www.w3.org/2000/svg","g")).setAttribute("id",t.getName()),r.appendChild(a),(i=document.createElementNS("http://www.w3.org/2000/svg","ellipse")).setAttribute("id",t.getName()+".circle"),a.appendChild(i),(o=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",t.getName()+".cross"),a.appendChild(o)):(i=e.getElementById(t.getName()+".circle"),o=e.getElementById(t.getName()+".cross"));var s=t.getPixelPosition(),l=t.getPixelSizes(),u=t.getRelativePositionOffset(l),g=s[0]+u[0],c=s[1]+u[1],S=l[0]/2,f=l[1]/2;i.setAttribute("cx",g),i.setAttribute("cy",c),i.setAttribute("rx",Math.abs(S)),i.setAttribute("ry",Math.abs(f)),o.setAttribute("d","M "+(g-S)+" "+c+" L "+(g+S)+" "+c+" M "+g+" "+(c-f)+" L "+g+" "+(c+f));var E=t.getStyle();E.getDrawFill()?a.setAttribute("fill",E.getFillColor()):a.setAttribute("fill","none"),E.getDrawLines()?(a.setAttribute("stroke",E.getLineColor()),a.setAttribute("stroke-width",E.getLineWidth())):(a.setAttribute("stroke","none"),a.setAttribute("stroke-width",0)),a.setAttribute("shapeRendering",E.getShapeRendering());var d=E.getAttributes();for(var p in d)a.setAttribute(p,d[p]);return a};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.SvgGraphics={getOffsetRect:function(e){return EJSS_GRAPHICS.GraphicsUtils.getOffsetRect(e)}},EJSS_GRAPHICS.svgGraphics=function(e){var t=EJSS_INTERFACE.svgGraphics(e),r=t.getDOMElement(),n=document.createElementNS("http://www.w3.org/2000/svg","defs");return r.appendChild(n),t.getEventContext=function(){return r},t.getBox=function(){var e=EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(t);return e.width-=1,e.height-=1,e},t.remove=function(e){var t=r.getElementById(e);return null!==t&&(r.removeChild(t),!0)},t.reset=function(){for(;r.firstChild;)r.removeChild(r.firstChild);r.appendChild(n)},t.getDefs=function(){return n},t.draw=function(e,n){for(var i=0,o=e.length;i<o;i++){var a=e[i];if(a.getElements)for(var s=a.getLastElements(),l=0,u=s.length;l<u;l++){var g=r.getElementById(s[l].getName());g&&g.parentNode.removeChild(g)}if(n||a.isChanged()||a.isGroupChanged()||a.isMustProject()){var c=t.drawElement(a);void 0!==c&&null!=c&&t.transformElement(a,c)}}},t.drawElement=function(e){var t=EJSS_DRAWING2D.Shape,n=null;switch(e.getClass()){case"ElementCustom":var i=e.getFunction();i&&(n=i(r,e));break;case"ElementGroup":n=EJSS_SVGGRAPHICS.group(r,e);break;case"ElementShape":switch(e.getShapeType()){default:case t.ELLIPSE:n=EJSS_SVGGRAPHICS.ellipse(r,e);break;case t.RECTANGLE:n=EJSS_SVGGRAPHICS.rectangle(r,e);break;case t.ROUND_RECTANGLE:n=EJSS_SVGGRAPHICS.roundRectangle(r,e);break;case t.WHEEL:n=EJSS_SVGGRAPHICS.wheel(r,e);break;case t.NONE:case t.POINT:n=EJSS_SVGGRAPHICS.point(r,e)}break;case"ElementSegment":n=EJSS_SVGGRAPHICS.segment(r,e);break;case"ElementImage":n=EJSS_SVGGRAPHICS.image(r,e);break;case"ElementVideo":n=EJSS_SVGGRAPHICS.video(r,e);break;case"ElementArrow":n=EJSS_SVGGRAPHICS.arrow(r,e);break;case"ElementText":n=EJSS_SVGGRAPHICS.text(r,e);break;case"ElementSpring":n=EJSS_SVGGRAPHICS.spring(r,e);break;case"ElementTrail":n=EJSS_SVGGRAPHICS.trail(r,e);break;case"ElementTrace":n=EJSS_SVGGRAPHICS.trace(r,e);break;case"ElementGrid":n=EJSS_SVGGRAPHICS.grid(r,e);break;case"ElementAxis":n=EJSS_SVGGRAPHICS.axis(r,e);break;case"ElementCursor":n=EJSS_SVGGRAPHICS.cursor(r,e);break;case"ElementPolygon":n=EJSS_SVGGRAPHICS.polygon(r,e);break;case"ElementAnalyticCurve":n=EJSS_SVGGRAPHICS.analyticCurve(r,e);break;case"ElementCellLattice":n=EJSS_SVGGRAPHICS.cellLattice(r,e);break;case"ElementByteRaster":n=EJSS_SVGGRAPHICS.byteRaster(r,e);break;case"ElementMesh":n=EJSS_SVGGRAPHICS.mesh(r,e);break;case"ElementTank":n=EJSS_SVGGRAPHICS.tank(r,e);break;case"ElementPipe":n=EJSS_SVGGRAPHICS.pipe(r,e);break;case"ElementHistogram":n=EJSS_SVGGRAPHICS.histogram(r,e);break;case"ElementScalarField":n=EJSS_SVGGRAPHICS.scalarField(r,e);break;case"ElementCanvas":n=EJSS_SVGGRAPHICS.canvas(r,e)}return n&&(e.isGroupVisible()?n.setAttribute("visibility","visible"):n.setAttribute("visibility","hidden")),n},t.transformElement=function(e,t){var r="",n=e.getTransformation(),i=e.getRotate(),o=e.getPixelPosition();(n.length>0&&(r="translate("+o[0]+" "+o[1]+")",r+="matrix("+n[0]+" "+n[1]+" "+n[2]+" "+n[3]+" "+n[4]+" "+n[5]+")",r+="translate(-"+o[0]+" -"+o[1]+")"),0!=i)&&(r+=" rotate("+EJSS_TOOLS.Mathematics.degrees(-i)+" "+o[0]+" "+o[1]+")");t.setAttribute("transform",r)},t.drawGutters=function(e){if(e.getGutters().visible){var n=EJSS_SVGGRAPHICS.Utils,i=r.getElementById(".myGutters"),o=r.getElementById(".myOuterBorder"),a=r.getElementById(".myInnerBorder");null===i&&((i=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",".myGutters"),i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0),r.appendChild(i),(o=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",".myOuterBorder"),o.setAttribute("fill","none"),r.appendChild(o),(a=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",".myInnerBorder"),a.setAttribute("fill","none"),r.appendChild(a));var s=e.getInnerRect(),l=.5,u=.5,g=t.getBox(),c=g.width,S=g.height,f=e.getGuttersStyle(),E=e.getStyle();"crispEdges"==E.getShapeRendering()?(i.setAttribute("d","M "+n.crispValue(l)+" "+n.crispValue(u)+" L "+n.crispValue(l)+" "+n.crispValue(u+S)+" L "+n.crispValue(l+c)+" "+n.crispValue(u+S)+" L "+n.crispValue(l+c)+" "+n.crispValue(u)+" L "+n.crispValue(l)+" "+n.crispValue(u)+" M "+n.crispValue(s.x)+" "+n.crispValue(s.y)+" L "+n.crispValue(s.x+s.width)+" "+n.crispValue(s.y)+" L "+n.crispValue(s.x+s.width)+" "+n.crispValue(s.y+s.height)+" L "+n.crispValue(s.x)+" "+n.crispValue(s.y+s.height)+" L "+n.crispValue(s.x)+" "+n.crispValue(s.y)+" z"),o.setAttribute("d","M "+n.crispValue(l)+" "+n.crispValue(u)+" L "+n.crispValue(l)+" "+n.crispValue(u+S)+" L "+n.crispValue(l+c)+" "+n.crispValue(u+S)+" L "+n.crispValue(l+c)+" "+n.crispValue(u)+" L "+n.crispValue(l)+" "+n.crispValue(u)+" z"),a.setAttribute("d","M "+n.crispValue(s.x)+" "+n.crispValue(s.y)+" L "+n.crispValue(s.x+s.width)+" "+n.crispValue(s.y)+" L "+n.crispValue(s.x+s.width)+" "+n.crispValue(s.y+s.height)+" L "+n.crispValue(s.x)+" "+n.crispValue(s.y+s.height)+" L "+n.crispValue(s.x)+" "+n.crispValue(s.y)+" z")):(i.setAttribute("d","M 0.5 0.5 L 0.5 "+(u+S)+" L "+(l+c)+" "+(u+S)+" L "+(l+c)+" "+"0.5 L "+"0.5 "+"0.5 M "+s.x+" "+s.y+" L "+(s.x+s.width)+" "+s.y+" L "+(s.x+s.width)+" "+(s.y+s.height)+" L "+s.x+" "+(s.y+s.height)+" L "+s.x+" "+s.y+" z"),o.setAttribute("d","M 0.5 0.5 L 0.5 "+(u+S)+" L "+(l+c)+" "+(u+S)+" L "+(l+c)+" "+"0.5 L "+"0.5 "+"0.5 z"),a.setAttribute("d","M "+s.x+" "+s.y+" L "+(s.x+s.width)+" "+s.y+" L "+(s.x+s.width)+" "+(s.y+s.height)+" L "+s.x+" "+(s.y+s.height)+" L "+s.x+" "+s.y+" z")),f.getDrawFill()?i.setAttribute("fill",f.getFillColor()):i.setAttribute("fill","none"),f.getDrawLines()?(o.setAttribute("stroke",f.getLineColor()),o.setAttribute("stroke-width",f.getLineWidth())):(o.setAttribute("stroke","none"),o.setAttribute("stroke-width",0)),E.getDrawLines()?(a.setAttribute("stroke",E.getLineColor()),a.setAttribute("stroke-width",E.getLineWidth())):(a.setAttribute("stroke","none"),a.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",E.getShapeRendering()),o.setAttribute("shapeRendering",f.getShapeRendering()),a.setAttribute("shapeRendering",E.getShapeRendering())}},t.drawPanel=function(e){var n=EJSS_SVGGRAPHICS.Utils,i=r.getElementById(".myPanel");null===i&&((i=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("id",".myPanel"),r.appendChild(i));var o=.5,a=.5,s=t.getBox(),l=s.width,u=s.height,g=e.getStyle();"crispEdges"==g.getShapeRendering()?i.setAttribute("d","M "+n.crispValue(o)+" "+n.crispValue(a)+" L "+n.crispValue(o)+" "+n.crispValue(a+u)+" L "+n.crispValue(o+l)+" "+n.crispValue(a+u)+" L "+n.crispValue(o+l)+" "+n.crispValue(a)+" z"):i.setAttribute("d","M 0.5 0.5 L 0.5 "+(a+u)+" L "+(o+l)+" "+(a+u)+" L "+(o+l)+" "+"0.5 z"),g.getDrawFill()?i.setAttribute("fill",g.getFillColor()):i.setAttribute("fill","none"),g.getDrawLines()?(i.setAttribute("stroke",g.getLineColor()),i.setAttribute("stroke-width",g.getLineWidth())):(i.setAttribute("stroke","none"),i.setAttribute("stroke-width",0)),i.setAttribute("shapeRendering",g.getShapeRendering())},t.importSVG=function(e){var r=t.getBox(),n=document.createElement("canvas");n.width=r.width+1,n.height=r.height+1;var i=n.getContext("2d"),o=t.getDOMElement();o.setAttribute("width",n.width),o.setAttribute("height",n.height);var a=(new XMLSerializer).serializeToString(o),s=new Image;return s.src="data:image/svg+xml;utf8,"+a,s.onload=function(){console.log("tam "+n.width+" "+n.height),i.drawImage(s,0,0),e&&e(n.toDataURL("image/png"))},s.src},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.InfoText={registerProperties:function(e,t){EJSS_DRAWING2D.Text.registerProperties(e,t),t.registerProperty("Info",e.setInfo),t.registerProperty("Format",e.setFormat)}},EJSS_DRAWING2D.infoText=function(e){var t,r,n=EJSS_DRAWING2D.text(e),i=n.getText;return n.setInfo=function(e){t=e},n.getText=function(){if(void 0===t){var e=i();return function(e,t){var r="",n=e,i=e.match(/[0-9]*\.(\^|#)+/g);if(null==i)return t;Array.isArray(t)||(t=JSON.parse("["+t+"]"));for(var o=0;o<i.length;o++){var a=i[o].split("#").length-1;r=isNaN(t[o])?t[o]:t[o].toFixed(a),n=n.replace(i[o],r)}return n}(r,e)}return t.getInfo?t.getInfo():"function"==typeof t?t():void 0},n.setFormat=function(e){r=e},n.isChanged=function(){return!0},n.registerProperties=function(e){EJSS_DRAWING2D.InfoText.registerProperties(n,e)},n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Knob={registerProperties:function(e,t){EJSS_DRAWING2D.Meter.registerProperties(e,t),t.registerAction("OnPress",e.getValue),t.registerAction("OnRelease",e.getValue),t.registerAction("OnChange",e.getValue)}},EJSS_DRAWING2D.knob=function(e){var t,r,n,i=EJSS_DRAWING2D.meter(e),o=Math.PI/5,a=[0,0];function s(e,t){var r=i.getController();r&&r.invokeImmediateAction("OnPress");e=t.point;var n=t.element.getAbsolutePosition(!0);a=[e[0]-n[0],e[1]-n[1]]}function l(e,t){var r=i.getController();r&&r.invokeImmediateAction("OnRelease")}function u(e,t){e=t.point;var r=t.element,n=[e[0]-a[0],e[1]-a[1]],s=i.getAbsolutePosition(!0),l=i.getSize();n[0]=n[0]-s[0],n[1]=(n[1]-s[1])*(l[0]/l[1]);var u=i.interpolateAngle(i.getValue()),g=Math.atan2(-n[0],n[1])+Math.PI/2;if(!(Math.abs(g-u)>o)){g=i.valueFromAngle(g),r.setPosition([.3*Math.cos(g),.3*Math.sin(g)]);var c=i.getController();c&&(c.immediatePropertyChanged("Value"),c.invokeImmediateAction("OnChange"))}}return i.super_setRadius=i.setRadius,i.setRadius=function(e){i.super_setRadius(e),t.setChanged(!0),r.setChanged(!0),n.setChanged(!0)},i.setFillColor=function(e){n.getStyle().setFillColor(e)},i.registerProperties=function(e){EJSS_DRAWING2D.Knob.registerProperties(i,e)},i.super_addParticularChildren=i.addParticularChildren,i.addParticularChildren=function(){i.super_addParticularChildren(),t.setParent(i),r.setParent(i),n.setParent(i)},i.createBasics=function(){var o=document.getElementById(e+".dummy_container");null===o&&((o=document.createElement("div")).setAttribute("id",e+".dummy_container"),o.style.width="0px",o.style.height="0px",document.body.appendChild(o),o.innerHTML="<svg xmlns='http://www.w3.org/2000/svg' width='0' height='0' version='1.1'>  <defs>    <linearGradient id='KnobExteriorGradient' x1='0%' y1='0%' x2='100%' y2='100%'>      <stop offset='0%'   stop-color='rgb(250,250,250)' />      <stop offset='100%' stop-color='rgb(100,100,100)' />    </linearGradient>    <linearGradient id='KnobMiddleGradient' x1='0%' y1='0%' x2='100%' y2='100%'>      <stop offset='0%'   stop-color='rgb(200,200,200)' />      <stop offset='100%' stop-color='rgb(150,150,150)' />    </linearGradient>    <linearGradient id='KnobInteriorGradient' x1='0%' y1='0%' x2='100%' y2='100%'>      <stop offset='0%'   stop-color='rgb(127,127,127)' />      <stop offset='100%' stop-color='rgb(250,250,250)' />    </linearGradient>    <filter id='KnobFilter' x='0' y='0' width='200%' height='200%'>      <feOffset result='offOut' in='SourceGraphic' dx='1' dy='1' />      <feGaussianBlur result='blurOut' in='offOut' stdDeviation='2' />      <feBlend in='SourceGraphic' in2='blurOut' mode='normal' />    </filter>  </defs></svg>"),(t=EJSS_DRAWING2D.shape(e+".exterior_shape")).setSize([1,1]),t.getStyle().setDrawLines(!1),t.getStyle().setAttributes({fill:"url(#KnobExteriorGradient)",filter:"url(#KnobFilter)"}),(r=EJSS_DRAWING2D.shape(e+".middle_shape")).setSize([.9,.9]),r.getStyle().setDrawLines(!1),r.getStyle().setAttributes({fill:"url(#KnobMiddleGradient)"}),(n=EJSS_CORE.promoteToControlElement(EJSS_DRAWING2D.shape(e+".inner_shape"),i.getView(),e+".inner_shape")).setY(.3),n.setSize([.2,.2]),n.getStyle().setDrawLines(!1),n.getStyle().setAttributes({fill:"url(#KnobInteriorGradient)"}),n.setProperty("EnabledPosition","ENABLED_NO_MOVE"),n.setProperty("Sensitivity",10),n.setProperty("OnDrag",u),n.setProperty("OnPress",s),n.setProperty("OnRelease",l)},i.super_createForeground=i.createForeground,i.createForeground=function(){i.super_createForeground(),i.getElement("brand").setPosition([0,-.7]),i.getElement("units").setPosition([0,.9])},i.adjustPosition=function(){var e=i.getValue();e<i.getMinimum()?e=i.getMinimum():e>i.getMaximum()&&(e=i.getMaximum());var t=i.interpolateAngle(e);n.setPosition([.3*Math.cos(t),.3*Math.sin(t)])},i.foregroundIsInside=function(){return!1},i};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.KnobOld={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Minimum",e.setMinimum,e.getMinimum),t.registerProperty("Maximum",e.setMaximum,e.getMaximum),t.registerAction("OnPress",e.getValue),t.registerAction("OnRelease",e.getValue),t.registerAction("OnChange",e.getValue),t.registerProperty("Size",e.setSize)}},EJSS_DRAWING2D.knobOld=function(e){var t,r,n,i,o=EJSS_DRAWING2D.group(e),a=0,s=1,l=-1,u=(Math.PI,Math.PI,Math.PI,Math.PI,.7*-Math.PI),g=.7*Math.PI,c=Math.PI/5;function S(){a=Math.max(Math.min(s,a),l);var e=g-(a-l)/(s-l)*(g-u)+Math.PI/2;n.setPosition([.3*Math.cos(e),.3*Math.sin(e)])}function f(e,t){var r=o.getController();r&&r.invokeImmediateAction("OnPress")}function E(e,t){var r=o.getController();r&&r.invokeImmediateAction("OnRelease")}function d(e,t){e=t.point;var r=t.element,n=o.getAbsolutePosition(!0);e[0]-=n[0],e[1]-=n[1];var i=g-(a-l)/(s-l)*(g-u),S=Math.atan2(-e[0],e[1]);if(!(Math.abs(S-i)>c)){S=Math.min(Math.max(S,u),g),a=s-(S-u)/(g-u)*(s-l);i=S+Math.PI/2;r.setPosition([.3*Math.cos(i),.3*Math.sin(i)]);var f=o.getController();f&&(f.immediatePropertyChanged("Value"),f.invokeImmediateAction("OnChange"))}}return o.setValue=function(e){a!=e&&(a=e,S())},o.getValue=function(){return a},o.setMinimum=function(e){l!=e&&(l=e,S())},o.getMinimum=function(){return l},o.setMaximum=function(e){s!=e&&(s=e,S())},o.getMaximum=function(){return s},o.setSize=function(e){o.setSizeX(e),o.setSizeY(e)},o.registerProperties=function(a){i=document.createElement("div"),document.body.appendChild(i),i.innerHTML="<svg xmlns='http://www.w3.org/2000/svg' version='1.1'>  <defs>    <linearGradient id='KnobExteriorGradient' x1='0%' y1='0%' x2='100%' y2='100%'>      <stop offset='0%'   stop-color='rgb(250,250,250)' />      <stop offset='100%' stop-color='rgb(100,100,100)' />    </linearGradient>    <linearGradient id='KnobMiddleGradient' x1='0%' y1='0%' x2='100%' y2='100%'>      <stop offset='0%'   stop-color='rgb(200,200,200)' />      <stop offset='100%' stop-color='rgb(150,150,150)' />    </linearGradient>    <linearGradient id='KnobInteriorGradient' x1='0%' y1='0%' x2='100%' y2='100%'>      <stop offset='0%'   stop-color='rgb(127,127,127)' />      <stop offset='100%' stop-color='rgb(250,250,250)' />    </linearGradient>    <filter id='KnobFilter' x='0' y='0' width='200%' height='200%'>      <feOffset result='offOut' in='SourceGraphic' dx='1' dy='1' />      <feGaussianBlur result='blurOut' in='offOut' stdDeviation='2' />      <feBlend in='SourceGraphic' in2='blurOut' mode='normal' />    </filter>  </defs></svg>",(t=EJSS_DRAWING2D.shape(e+".exterior_shape")).setSize([1,1]),t.getStyle().setDrawLines(!1),t.getStyle().setAttributes({fill:"url(#KnobExteriorGradient)",filter:"url(#KnobFilter)"}),(r=EJSS_DRAWING2D.shape(e+".middle_shape")).setSize([.9,.9]),r.getStyle().setDrawLines(!1),r.getStyle().setAttributes({fill:"url(#KnobMiddleGradient)"}),(n=EJSS_CORE.promoteToControlElement(EJSS_DRAWING2D.shape(e+".inner_shape"),o.getView(),e+".inner_shape")).setY(.3),n.setSize([.2,.2]),n.getStyle().setDrawLines(!1),n.getStyle().setAttributes({fill:"url(#KnobInteriorGradient)"}),n.setProperty("EnabledPosition","ENABLED_NO_MOVE"),n.setProperty("Sensitivity",10),n.setProperty("OnDrag",d),n.setProperty("OnPress",f),n.setProperty("OnRelease",E),EJSS_DRAWING2D.Knob.registerProperties(o,a)},o.superSetParent=o.setParent,o.setParent=function(e,i){o.superSetParent(e,i),t.setParent(o),r.setParent(o),n.setParent(o)},o};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Mesh={copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData),t.registerProperty("DataType",e.setDataType),t.registerProperty("Mesh",e.setMesh),t.registerProperty("Points",e.setPoints),t.registerProperty("Cells",e.setCells),t.registerProperty("FieldAtPoints",e.setFieldAtPoints),t.registerProperty("FieldAtCells",e.setFieldAtCells),t.registerProperty("VectorLength",e.setVectorLength),t.registerProperty("Boundary",e.setBoundary),t.registerProperty("BoundaryLabels",e.setBoundaryLabels),t.registerProperty("BoundaryColors",e.setBoundaryColors),t.registerProperty("BoundaryWidth",e.setBoundaryLineWidth),t.registerProperty("DrawBoundary",e.setDrawBoundary)}},EJSS_DRAWING2D.mesh=function(e){var t,r,n,i,o,a,s=EJSS_DRAWING2D.element(e),l=-1,u=!0,g=.03,c=null,S=1,f=!0,E=EJSS_DRAWING2D.colorCoded(16,EJSS_DRAWING2D.ColorMapper.SPECTRUM);return s.getClass=function(){return"ElementMesh"},s.setDataType=function(e){switch(e){case"MESH_2D":l=0;break;case"MESH_3D":l=1;break;case"SCALAR_2D_FIELD":l=2;break;case"SCALAR_3D_FIELD":l=3;break;case"VECTOR_2D_FIELD":l=4;break;case"VECTOR_3D_FIELD":l=5;break;default:l=e}s.setChanged(!0)},s.getDataType=function(){return l},s.setData=function(e){if(!e)return!1;switch((l<0||l>5)&&s.setDataType(e.type),l){case 0:case 1:return s.setMesh(e.problem_mesh),!0;case 2:case 3:case 4:case 5:return s.setMesh(e.solution_mesh),s.setFieldAtCells(e.solution_values),!0}return!1},s.setMesh=function(e){s.setPoints(e.points),s.setCells(e.cells),s.setBoundary(e.boundary),s.setBoundaryLabels(e.boundary_labels),s.setChanged(!0)},s.setPoints=function(e){t=e,s.setChanged(!0)},s.getPoints=function(){return t},s.setFieldAtPoints=function(e){r=e,n=null,u&&null!=r&&E.setAutoscaleArray2(r),s.setChanged(!0)},s.getFieldAtPoints=function(){return r},s.setCells=function(e){i=e,s.setChanged(!0)},s.getCells=function(){return i},s.setFieldAtCells=function(e){n=e,r=null,u&&null!=n&&E.setAutoscaleArray3(n),s.setChanged(!0)},s.getFieldAtCells=function(){return n},s.setVectorLength=function(e){g!==e&&(g=e,s.setChanged(!0))},s.getVectorLength=function(){return g},s.setBoundary=function(e){o=e,s.setChanged(!0)},s.getBoundary=function(){return o},s.setBoundaryLabels=function(e){a=e,s.setChanged(!0)},s.getBoundaryLabels=function(){return a},s.setBoundaryColors=function(e){c=e,s.setChanged(!0)},s.getBoundaryColors=function(){return c},s.setBoundaryLineWidth=function(e){S=Math.max(1,e),s.setChanged(!0)},s.getBoundaryLineWidth=function(){return S},s.setBoundaryStroke=function(e){S=e,s.setChanged(!0)},s.getBoundaryStroke=function(){return S},s.setDrawBoundary=function(e){f=e,s.setChanged(!0)},s.getDrawBoundary=function(){return f},s.getColorCoded=function(){return E},s.setAutoscaleZ=function(e,t,i){(u=e)?null!=r?E.setAutoscaleArray2(r):null!=n&&E.setAutoscaleArray3(n):E.setScale(t,i),s.setChanged(!0)},s.isAutoscaleZ=function(){return u},s.getBounds=function(e){var t=0,r=0,n=0,i=0,o=s.getPoints();if(o&&o.length>0){var a=o.length;r=t=o[0][0],i=n=o[0][1];for(var l=1;l<a;l++){(u=o[l][0])>r&&(r=u),(g=o[l][1])>i&&(i=g),u<t&&(t=u),g<n&&(n=g)}}var u=s.getX(),g=s.getY(),c=s.getSizeX(),S=s.getSizeY(),f=c/2,E=S/2,d=s.getRelativePositionOffset(c,S);return{left:u+d[0]-f+t*c,right:u+d[0]-f+r*c,top:g+d[1]-E+i*S,bottom:g+d[1]-E+n*S}},s.registerProperties=function(e){EJSS_DRAWING2D.Mesh.registerProperties(s,e)},s.setSize([1,1]),s.setRelativePosition("SOUTH_WEST"),s};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Meter={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Minimum",e.setMinimum,e.getMinimum),t.registerProperty("Maximum",e.setMaximum,e.getMaximum),t.registerProperty("AngleForMinimum",e.setAngleForMinimum,e.getAngleForMinimum),t.registerProperty("AngleForMaximum",e.setAngleForMaximum,e.getAngleForMaximum),t.registerProperty("NumberOfMarks",e.setNumberOfMarks,e.getNumberOfMarks),t.registerProperty("BigMark",e.setBigMark,e.getBigMark),t.registerProperty("MediumMark",e.setMediumMark,e.getMediumMark),t.registerProperty("Digits",e.setDigits,e.getDigits),t.registerProperty("Radius",e.setRadius),t.registerProperty("CircleColor",e.setCircleColor),t.registerProperty("CircleWidth",e.setCircleWidth),t.registerProperty("FillColor",e.setFillColor),t.registerProperty("Foreground",e.setForeground),t.registerProperty("LineWidth",e.setLineWidth),t.registerProperty("ArrowColor",e.setArrowColor),t.registerProperty("ArrowWidth",e.setArrowWidth),t.registerProperty("DrawLines",e.setDrawLines),t.registerProperty("DrawText",e.setDrawText),t.registerProperty("Brand",e.setBrand),t.registerProperty("Units",e.setUnits),t.registerProperty("MarksFont",e.setMarksFont),t.registerProperty("BrandFont",e.setBrandFont),t.registerProperty("UnitsFont",e.setUnitsFont)}},EJSS_DRAWING2D.meter=function(e){var t,r,n,i,o,a,s=EJSS_DRAWING2D.group(e),l=0,u=0,g=100,c=21,S=4,f=2,E=0,d=Math.PI/2+1.5*Math.PI/2,p=Math.PI/2-1.5*Math.PI/2,h="Black",m="Red",A=!1,_=[];return s.getElement=function(e){return _[e]},s.setValue=function(e){l!=e&&(l=e,s.adjustPosition())},s.getValue=function(){return l},s.setMinimum=function(e){u!=e&&(u=e,s.setChanged(!0))},s.getMinimum=function(){return u},s.setMaximum=function(e){g!=e&&(g=e,s.setChanged(!0))},s.getMaximum=function(){return g},s.setAngleForMinimum=function(e){d!=e&&(d=e,s.setChanged(!0))},s.getAngleForMinimum=function(){return d},s.setAngleForMaximum=function(e){p!=e&&(p=e,s.setChanged(!0))},s.getAngleForMaximum=function(){return p},s.setNumberOfMarks=function(e){e!=c&&(c=e,s.setChanged(!0))},s.getNumberOfMarks=function(){return c},s.setBigMark=function(e){e!=S&&(S=e,s.setChanged(!0))},s.getBigMark=function(){return S},s.setMediumMark=function(e){e!=f&&(f=e,s.setChanged(!0))},s.getMediumMark=function(){return f},s.setDigits=function(e){e!=E&&(E=e,s.setChanged(!0))},s.getDigits=function(){return E},s.setRadius=function(e){s.setSizeX(2*e),s.setSizeY(2*e),r&&r.setChanged(!0),t&&t.setChanged(!0),n.setToEach((function(e){e.setChanged(!0)})),i.setToEach((function(e){e.setChanged(!0)})),o&&o.setChanged(!0),a&&a.setChanged(!0)},s.setCircleColor=function(e){r.getStyle().setLineColor(e)},s.setCircleWidth=function(e){r.getStyle().setLineWidth(e)},s.setFillColor=function(e){r.getStyle().setFillColor(e)},s.setArrowColor=function(e){m="Red"==e?"Yellow":"Red",h=e,t.getStyle().setLineColor(e),t.getStyle().setFillColor(e)},s.setArrowWidth=function(e){t.getStyle().setLineWidth(e)},s.setForeground=function(e){n.setToEach((function(t){t.getStyle().setLineColor(e)})),i.setToEach((function(t){t.getFont().setFillColor(e)})),o.getFont().setFillColor(e),a.getFont().setFillColor(e)},s.setLineWidth=function(e){n.setToEach((function(t){t.getStyle().setLineWidth(e)}))},s.setDrawLines=function(e){n.setToEach((function(e,t){e.setVisible(t)}),e)},s.setDrawText=function(e){i.setToEach((function(e,t){e.setVisible(t)}),e)},s.setFont=function(e){i.setToEach((function(t){t.getFont().setFont(e)})),o.getFont().setFont(e),a.getFont().setFont(e)},s.setFont=function(e){i.setToEach((function(t){t.getFont().setFont(e)})),o.getFont().setFont(e),a.getFont().setFont(e)},s.setMarksFont=function(e){i.setToEach((function(t){t.getFont().setFont(e)}))},s.setBrandFont=function(e){o.getFont().setFont(e)},s.setUnitsFont=function(e){a.getFont().setFont(e)},s.setBrand=function(e){o.setText(e)},s.setUnits=function(e){a.setText(e)},s.registerProperties=function(e){EJSS_DRAWING2D.Meter.registerProperties(s,e)},s.superSetParent=s.setParent,s.setParent=function(e,t){s.superSetParent(e,t),A||(s.createBasics(),s.createForeground(),A=!0),s.addParticularChildren(),s.adjustForeground()},s.dataCollected=function(){s.isChanged()&&(s.adjustForeground(),s.setChanged(!1))},s.addParticularChildren=function(){r&&r.setParent(s),n&&n.setToEach((function(e){e.setParent(s)})),i&&i.setToEach((function(e){e.setParent(s)})),o&&o.setParent(s),a&&a.setParent(s),t&&t.setParent(s)},s.createBasics=function(){(r=EJSS_DRAWING2D.shape(e+".circle")).setSize([1,1]),r.setShapeType("ELLIPSE"),r.getStyle().setLineWidth(3),r.getStyle().setLineColor("Grey"),r.getStyle().setFillColor("White"),_.circle=r,(t=EJSS_DRAWING2D.arrow(e+".arrow")).setSize([.45,0]),t.getStyle().setLineWidth(2),t.setMarkStart("WEDGE"),t.setMarkEnd("POINTED"),_.arrow=t},s.createForeground=function(){(n=EJSS_DRAWING2D.segmentSet(e+".segments")).setToEach((function(e){e.setRelativePosition("SOUTH_WEST")})),_.segments=n,(i=EJSS_DRAWING2D.textSet(e+".texts")).setToEach((function(e){e.getFont().setFont('normal bold 12px "Courier New", Courier, monospace')})),_.texts=i,(o=EJSS_DRAWING2D.text(e+".brand")).setPosition([0,.2]),o.setText("Meter"),o.getFont().setFont('normal bold 12px "Courier New", Courier, monospace'),_.brand=o,(a=EJSS_DRAWING2D.text(e+".Units")).setPosition([0,-.25]),a.setText("%"),a.getFont().setFont('normal bold 12px "Courier New", Courier, monospace'),_.units=a},s.interpolateAngle=function(e){return d+(e-u)/(g-u)*(p-d)},s.valueFromAngle=function(e){return e=Math.max(Math.min(e,d),p),l=g-(e-p)/(d-p)*(g-u),e},s.adjustPosition=function(){var e=l;l<u?(e=u,t.getStyle().setLineColor(m),t.getStyle().setFillColor(m)):l>g?(e=g,t.getStyle().setLineColor(m),t.getStyle().setFillColor(m)):(e=l,t.getStyle().setLineColor(h),t.getStyle().setFillColor(h));var r=d+(e-u)/(g-u)*(p-d);t.setTransformation(r)},s.foregroundIsInside=function(){return!0},s.adjustForeground=function(){n.setNumberOfElements(c);for(var e=(p-d)/(c-1),t=d,r=0,o=s.foregroundIsInside()?-1/12:1/12,a=0;a<c;a++){var l=n.getElement(a),h=Math.cos(t)/2,m=Math.sin(t)/2;l.setPosition([h,m]),a%S==0?(r++,l.setSize([2*o*h,2*o*m])):a%f==0?(l.setSize([1.5*o*h,1.5*o*m])):l.setSize([o*h,o*m]),t+=e}i.setNumberOfElements(r);var A=0,_=i.getElement(0).getFont().getFontSize();for(o=s.foregroundIsInside()?1.7:2.5,_>30?o*=1.5:_>20?o*=1.3:_>15&&(o*=1.1),a=0;a<c;a++){l=n.getElement(a);if(a%S==0){var D=i.getElement(A),I=l.getPosition(),P=l.getSize();D.setPosition([I[0]+o*P[0],I[1]+o*P[1]]);var C=((c-1-a)*u+a*g)/(c-1);D.setText(""+C.toFixed(E)),A++}}s.adjustPosition()},s};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Pipe={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("PipeWidth",e.setPipeWidth,e.getPipeWidth)},copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setPoints(e.getPoints()),t.setPipeWidth(e.getPipeWidth())}},EJSS_DRAWING2D.pipe=function(e){var t=EJSS_DRAWING2D.element(e),r=[[.1,.2],[.1,.3]],n=5;return t.getClass=function(){return"ElementPipe"},t.setPoints=function(e){r=e,t.setChanged(!0)},t.getPoints=function(){return r},t.setPipeWidth=function(e){n=e,t.setChanged(!0)},t.getPipeWidth=function(){return n},t.registerProperties=function(e){EJSS_DRAWING2D.Pipe.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Pipe.copyTo(t,e)},t.setSize([1,1]),t.setRelativePosition("SOUTH_WEST"),t.getStyle().setLineWidth(1),t.getStyle().setFillColor("Blue"),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.PlottingPanel={registerProperties:function(e,t){EJSS_DRAWING2D.DrawingPanel.registerProperties(e,t),t.registerProperty("Title",e.getTitle().setText),t.registerProperty("TitleFont",e.getTitle().getFont().setFont),t.registerProperty("TitleColor",e.getTitle().getFont().setFillColor),t.registerProperty("TitleMargin",e.getTitle().setMarginY),t.registerProperty("TitleX",e.getTitleX().setText),t.registerProperty("TitleXFont",e.getTitleX().getFont().setFont),t.registerProperty("TitleXColor",e.getTitleX().getFont().setFillColor),t.registerProperty("TitleXMargin",e.getTitleX().setMarginY),t.registerProperty("TitleY",e.getTitleY().setText),t.registerProperty("TitleYFont",e.getTitleY().getFont().setFont),t.registerProperty("TitleYColor",e.getTitleY().getFont().setFillColor),t.registerProperty("TitleYMargin",e.getTitleY().setMarginX),t.registerProperty("GridXShow",e.getGrid().setShowX,e.getGrid().getShowX),t.registerProperty("GridXTicks",e.getGrid().setTicksX,e.getGrid().getTicksX),t.registerProperty("GridXStep",e.getGrid().setStepX,e.getGrid().getStepX),t.registerProperty("GridXAutoStepMin",e.getGrid().setAutoStepXMin,e.getGrid().getAutoStepXMin),t.registerProperty("GridXAutoTicksRange",e.getGrid().setAutoTicksXRange,e.getGrid().getAutoTicksXRange),t.registerProperty("GridXScale",e.getGrid().setScaleX,e.getGrid().getScaleX),t.registerProperty("GridXScalePrecision",e.getGrid().setScalePrecisionX,e.getGrid().getScalePrecisionX),t.registerProperty("GridXFixedTick",e.getGrid().setFixedTickX,e.getGrid().getFixedTickX),t.registerProperty("GridXAutoTicks",e.getGrid().setAutoTicksX,e.getGrid().getAutoTicksX),t.registerProperty("GridXLineColor",e.getGrid().setLineColorX),t.registerProperty("GridXLineWidth",e.getGrid().setLineWidthX),t.registerProperty("GridXShapeRendering",e.getGrid().setShapeRenderingX),t.registerProperty("GridYShow",e.getGrid().setShowY,e.getGrid().getShowY),t.registerProperty("GridYTicks",e.getGrid().setTicksY,e.getGrid().getTicksY),t.registerProperty("GridYStep",e.getGrid().setStepY,e.getGrid().getStepY),t.registerProperty("GridYAutoStepMin",e.getGrid().setAutoStepYMin,e.getGrid().getAutoStepYMin),t.registerProperty("GridYAutoTicksRange",e.getGrid().setAutoTicksYRange,e.getGrid().getAutoTicksYRange),t.registerProperty("GridYScale",e.getGrid().setScaleY,e.getGrid().getScaleY),t.registerProperty("GridYScalePrecision",e.getGrid().setScalePrecisionY,e.getGrid().getScalePrecisionY),t.registerProperty("GridYFixedTick",e.getGrid().setFixedTickY,e.getGrid().getFixedTickY),t.registerProperty("GridYAutoTicks",e.getGrid().setAutoTicksY,e.getGrid().getAutoTicksY),t.registerProperty("GridYLineColor",e.getGrid().setLineColorY),t.registerProperty("GridYLineWidth",e.getGrid().setLineWidthY),t.registerProperty("GridYShapeRendering",e.getGrid().setShapeRenderingY),t.registerProperty("AxisXShow",e.getAxisX().setShow),t.registerProperty("AxisXLineColor",e.getAxisX().getStyle().setLineColor),t.registerProperty("AxisXLineWidth",e.getAxisX().getStyle().setLineWidth),t.registerProperty("AxisXShapeRendering",e.getAxisX().getStyle().setShapeRendering),t.registerProperty("AxisXFixedTick",e.getAxisX().setFixedTick,e.getAxisX().getFixedTick),t.registerProperty("AxisXAutoTicks",e.getAxisX().setAutoTicks,e.getAxisX().getAutoTicks),t.registerProperty("AxisXTicks",e.getAxisX().setTicks,e.getAxisX().getTicks),t.registerProperty("AxisXStep",e.getAxisX().setStep,e.getAxisX().getStep),t.registerProperty("AxisXTickStep",e.getAxisX().setTickStep,e.getAxisX().getTickStep),t.registerProperty("AxisXAutoStepMin",e.getAxisX().setAutoStepMin,e.getAxisX().getAutoStepMin),t.registerProperty("AxisXAutoTicksRange",e.getAxisX().setAutoTicksRange,e.getAxisX().getAutoTicksRange),t.registerProperty("AxisXScale",e.getAxisX().setScale,e.getAxisX().getScale),t.registerProperty("AxisXScalePrecision",e.getAxisX().setScalePrecision,e.getAxisX().getScalePrecision),t.registerProperty("AxisXFont",e.getAxisX().getFont().setFont),t.registerProperty("AxisXFontColor",e.getAxisX().getFont().setFillColor),t.registerProperty("AxisYShow",e.getAxisY().setShow),t.registerProperty("AxisYLineColor",e.getAxisY().getStyle().setLineColor),t.registerProperty("AxisYLineWidth",e.getAxisY().getStyle().setLineWidth),t.registerProperty("AxisYShapeRendering",e.getAxisY().getStyle().setShapeRendering),t.registerProperty("AxisYFixedTick",e.getAxisY().setFixedTick,e.getAxisY().getFixedTick),t.registerProperty("AxisYAutoTicks",e.getAxisY().setAutoTicks,e.getAxisY().getAutoTicks),t.registerProperty("AxisYTicks",e.getAxisY().setTicks,e.getAxisY().getTicks),t.registerProperty("AxisYStep",e.getAxisY().setStep,e.getAxisY().getStep),t.registerProperty("AxisYTickStep",e.getAxisY().setTickStep,e.getAxisY().getTickStep),t.registerProperty("AxisYAutoStepMin",e.getAxisY().setAutoStepMin,e.getAxisY().getAutoStepMin),t.registerProperty("AxisYAutoTicksRange",e.getAxisY().setAutoTicksRange,e.getAxisY().getAutoTicksRange),t.registerProperty("AxisYScale",e.getAxisY().setScale,e.getAxisY().getScale),t.registerProperty("AxisYScalePrecision",e.getAxisY().setScalePrecision,e.getAxisY().getScalePrecision),t.registerProperty("AxisYFont",e.getAxisY().getFont().setFont),t.registerProperty("AxisYFontColor",e.getAxisY().getFont().setFillColor),t.registerProperty("XFixedTick",(function(t){e.getAxisX().setFixedTick(t),e.getGrid().setFixedTickX(t)})),t.registerProperty("YFixedTick",(function(t){e.getAxisY().setFixedTick(t),e.getGrid().setFixedTickY(t)})),t.registerProperty("XTicks",(function(t){e.getAxisX().setTicks(t),e.getGrid().setTicksX(t)})),t.registerProperty("YTicks",(function(t){e.getAxisY().setTicks(t),e.getGrid().setTicksY(t)})),t.registerProperty("XStep",(function(t){e.getAxisX().setStep(t),e.getGrid().setStepX(t)})),t.registerProperty("YStep",(function(t){e.getAxisY().setStep(t),e.getGrid().setStepY(t)})),t.registerProperty("XTickStep",(function(t){e.getAxisX().setTickStep(t),e.getGrid().setTickStepX(t)})),t.registerProperty("YTickStep",(function(t){e.getAxisY().setTickStep(t),e.getGrid().setTickStepY(t)})),t.registerProperty("XAutoStepMin",(function(t){e.getAxisX().setAutoStepMin(t),e.getGrid().setAutoStepXMin(t)})),t.registerProperty("YAutoStepMin",(function(t){e.getAxisY().setAutoStepMin(t),e.getGrid().setAutoStepYMin(t)})),t.registerProperty("XAutoTicksRange",(function(t){e.getAxisX().setAutoTicksRange(t),e.getGrid().setAutoTicksXRange(t)})),t.registerProperty("YAutoTicksRange",(function(t){e.getAxisY().setAutoTicksRange(t),e.getGrid().setAutoTicksyRange(t)})),t.registerProperty("XScale",(function(t){e.getAxisX().setScale(t),e.getGrid().setScaleX(t)})),t.registerProperty("YScale",(function(t){e.getAxisY().setScale(t),e.getGrid().setScaleY(t)})),t.registerProperty("XScalePrecision",(function(t){e.getAxisX().setScalePrecision(t),e.getGrid().setScalePrecisionX(t)})),t.registerProperty("YScalePrecision",(function(t){e.getAxisY().setScalePrecision(t),e.getGrid().setScalePrecisionY(t)})),t.registerProperty("XAutoTicks",(function(t){e.getAxisX().setAutoTicks(t),e.getGrid().setAutoTicksX(t)})),t.registerProperty("YAutoTicks",(function(t){e.getAxisY().setAutoTicks(t),e.getGrid().setAutoTicksY(t)}))}},EJSS_DRAWING2D.plottingPanel=function(e,t){var r=EJSS_DRAWING2D.drawingPanel(e,t);r.getGrid=function(){return i},r.getAxisX=function(){return a},r.getAxisY=function(){return s},r.getTitleX=function(){return l},r.getTitleY=function(){return u},r.getTitle=function(){return g},r.getFixedTickX=function(){return getGrid().getFixedTickX()},r.getFixedTickY=function(){return getGrid().getFixedTickY()},r.registerProperties=function(e){EJSS_DRAWING2D.PlottingPanel.registerProperties(r,e)};var n=EJSS_DRAWING2D.group(e+".bottomgroup");n.setRelativePosition("SOUTH_WEST"),n.panelChangeListener=function(e){if("bounds"==e){var t=r.getRealWorldXMin(),i=r.getRealWorldXMax(),o=r.getRealWorldYMin(),a=r.getRealWorldYMax(),s=Math.abs(i-t),l=Math.abs(a-o);return n.setSize([s,l]),n.setPosition([t,o]),!0}},n.panelChangeListener("bounds");var i=EJSS_DRAWING2D.grid(e+".grid");i.setGroup(n),i.setRelativePosition("SOUTH_WEST"),i.setLineColorX("lightgray"),i.setShapeRenderingX("RENDER_CRISPEDGES"),i.setLineColorY("lightgray"),i.setShapeRenderingY("RENDER_CRISPEDGES"),i.setSize([1,1]),i.setPosition([0,0]),i.panelChangeListener=function(e){if("bounds"==e){var t=r.getRealWorldXMin(),n=r.getRealWorldXMax();i.setScaleX([t,n]),i.setTicksXMode(r.getTypeScaleX());var o=r.getRealWorldYMin(),a=r.getRealWorldYMax();return i.setScaleY([o,a]),i.setTicksYMode(r.getTypeScaleY()),!0}};var o=EJSS_DRAWING2D.group(e+".topgroup");o.setRelativePosition("SOUTH_WEST"),o.panelChangeListener=function(e){if("bounds"==e){var t=r.getRealWorldXMin(),n=r.getRealWorldXMax(),i=r.getRealWorldYMin(),a=r.getRealWorldYMax(),s=Math.abs(n-t),l=Math.abs(a-i);return o.setSize([s,l]),o.setPosition([t,i]),!0}},o.panelChangeListener("bounds");var a=EJSS_DRAWING2D.axis(e+".axisX");a.setGroup(o),a.setRelativePosition("WEST"),a.getStyle().setLineColor("black"),a.getStyle().setShapeRendering("RENDER_CRISPEDGES"),a.getFont().setFontSize(10),a.setSize([1,1]),a.setPosition([0,0]),a.setOrient("AXIS_HORIZONTAL"),a.panelChangeListener=function(e){if("bounds"==e){var t=r.getRealWorldXMin(),n=r.getRealWorldXMax();return a.setScale([t,n]),a.setTicksMode(r.getTypeScaleX()),r.getInvertedScaleY()?(a.setTextPosition("TICKS_DOWN"),l.setMarginY(-30),g.setMarginY(20)):(a.setTextPosition("TICKS_UP"),l.setMarginY(30),g.setMarginY(-20)),!0}},a.setTicksMode(r.getTypeScaleX());var s=EJSS_DRAWING2D.axis(e+".axisY");s.setGroup(o),s.setRelativePosition("SOUTH"),s.getStyle().setLineColor("black"),s.getStyle().setShapeRendering("RENDER_CRISPEDGES"),s.getFont().setFontSize(10),s.setSize([1,1]),s.setPosition([0,0]),s.setOrient("AXIS_VERTICAL"),s.panelChangeListener=function(e){if("bounds"==e){var t=r.getRealWorldYMin(),n=r.getRealWorldYMax();return s.setScale([t,n]),s.setTicksMode(r.getTypeScaleY()),s.setInvertedScaleY(r.getInvertedScaleY()),!0}},s.setTicksMode(r.getTypeScaleY());var l=EJSS_DRAWING2D.text(e+".titleX");l.setGroup(o),l.setRelativePosition("CENTER"),l.getFont().setFontSize(12),l.setPosition([.5,0]),l.setMarginY(30),l.setText("x");var u=EJSS_DRAWING2D.text(e+".titleY");u.setGroup(o),u.setRelativePosition("CENTER"),u.getFont().setFontSize(12),u.setWritingMode("MODE_DOWNTOP"),u.setPosition([0,.5]),u.setMarginX(-40),u.setText("y");var g=EJSS_DRAWING2D.text(e+".title");return g.setGroup(o),g.setRelativePosition("CENTER"),g.getFont().setFontSize(12),g.setPosition([.5,1]),g.setMarginY(-20),g.setText("Plot"),r.getStyle().setLineColor("black"),r.getStyle().setFillColor("white"),r.getStyle().setShapeRendering("RENDER_CRISPEDGES"),r.setGutters([50,50,50,50]),r.getGuttersStyle().setLineColor("black"),r.getGuttersStyle().setFillColor("rgb(211,216,255)"),r.getGuttersStyle().setShapeRendering("RENDER_CRISPEDGES"),r.addDecoration(n),r.addDecoration(i),r.addDecoration(o,-1,!0),r.addDecoration(a,-1,!0),r.addDecoration(s,-1,!0),r.addDecoration(l,-1,!0),r.addDecoration(u,-1,!0),r.addDecoration(g,-1,!0),r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Polygon={NO_CONNECTION:0,LINE_CONNECTION:1,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setPoints(e.getPoints())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("PointsX",e.setPointsX),t.registerProperty("PointsY",e.setPointsY),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint)}},EJSS_DRAWING2D.polygon=function(e){var t=EJSS_DRAWING2D.element(e),r=[],n=null,i=null;function o(e,t,n){isNaN(e)||isNaN(t)||(r[r.length]=[e,t,n])}return t.getClass=function(){return"ElementPolygon"},t.addPoint=function(e,r,n){e instanceof Array?o(e[0],e[1],e[2]):o(e,r,n),t.setChanged(!0)},t.addPoints=function(e,r){if(null!=e&&null!=e&&null!=e[0]){if(e[0]instanceof Array)for(var n=0,i=e.length;n<i;n++)o(e[n][0],e[n][1],e[n][2]);else for(i=Math.min(e.length,r.length),n=0;n<i;n++)o(e[n],r[n]);t.setChanged(!0)}},t.setPoints=function(e,r){t.clear(),t.addPoints(e,r),t.setChanged(!0)},t.setPointsX=function(e){null==i?n=e:(t.setPoints(e,i),i=null)},t.setPointsY=function(e){null==n?i=e:(t.setPoints(n,e),n=null)},t.getPoints=function(){return r},t.getLastPoint=function(){return r.length>0?r[r.length-1]:[]},t.clear=function(){r=[],t.setChanged(!0)},t.getBounds=function(e){var r,n,i,o,a=t.getPoints(),s=a.length;if(0==s)r=n=i=o=0;else{n=r=a[0][0],o=i=a[0][1];for(var l=1;l<s;l++){(u=a[l][0])>n&&(n=u),(g=a[l][1])>o&&(o=g),u<r&&(r=u),g<i&&(i=g)}}var u=t.getX(),g=t.getY(),c=t.getSizeX(),S=t.getSizeY(),f=S/2,E=S/2,d=t.getRelativePositionOffset(c,S);return{left:u+d[0]-f+r*c,right:u+d[0]-f+n*c,top:g+d[1]-E+o*S,bottom:g+d[1]-E+i*S}},t.registerProperties=function(e){EJSS_DRAWING2D.Polygon.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Polygon.copyTo(t,e)},t.setSize([1,1]),t.setRelativePosition("SOUTH_WEST"),t},EJSS_DRAWING2D.PolygonSet={registerProperties:function(e,t){EJSS_DRAWING2D.ElementSet.registerProperties(e,t),t.registerProperty("Points",(function(t){e.setToEach((function(e,t){e.setPoints(t)}),t)})),t.registerProperty("LastPoint",(function(t){e.setToEach((function(e,t){e.addPoint(t)}),t)}))}},EJSS_DRAWING2D.polygonSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.polygon,e),r=EJSS_DRAWING2D.PolygonSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Ruler={sROTATE_ICON:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGgAAAB3CAYAAADvnAXvAAAAAXNSR0IArs4c6QAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAAGuVJREFUeAHtXQl0HMWZ7qqeGY0kyzaHDYvBNgSzS4zBxEiyzSWwLc3IxiHJOglJFgK5s9nkhU3yICFgcl+b+yAHZMNCksVsSACdxmAIIEu2A0sSctnBa8xlA7Yj2ZJG01X7/T3T456e6p7unp6R8h71nlRVf/3111/11V3VNUybeoadn04fOybEWZzHLpBSrmGadnZYNaWm7UT8X0vDeETyxIBIaE9tv+eeUchD0NQ30H3yzbJly+rF9KPaGdM+gVJrroVGUsjtjMvr68fG7t+8efNYLdIMk8ZkAsSa0+kLuGQ/geLz3JS3KxhFlVfJE5r2PJPsjUN9XQ9DjyiScctOYLpd38CRQ0bgLR3p9zPGvuUVX6VYJSXnV56U2vuG+rq/D90qSc4ra4HCVHoHEhCEuSWVep2m8TuRKPeKl1PKXj6sotIKKg8pC6aJCwd7e6lFTaqpCUDLOjqOFkz/DXI6r1xuVVBIzV1NIYShcf4018RTmuRPC67t50IelIwJJqWOhnA0uq9jGBdzDI0t4Bo73ktekX5CdA/2914CGnrByTHuOY9In9ZU5zUQ9Xk/4oKAw5j8HZfyqkd7e7f6kE35ZOvWrWN7NC1hDI8uZlr2zdLQXst0Xq7SvJiN66dj5veij3QiZ6kaQAvXrUs0DR96GN2Fr1lZEHCsUhCa/I2e5W/bcl/XHyxaULt1xdrjRGziBk2yqzjX6lTxqcuLiexZj/b3/04VXk1aVQBamkrNFxr/I4QrM+zMUBhwbDImMLC/HQP7T220wM62trbkofrGz6BVfhCR43YBln5M8HMH+rsetYdV2x05QABnrdT4r8oqjsEDY8c2VM79GJAN4hcSdVgyjhleHLOCJownp2A2cXRZWWDAgvazQ3091/nh9eJZcsklx8YmJn6GecxK4rPAseJIyS8e7Ot6wPJX244UoNaO9PUaYzeWUfo5FOcu8BhSiDM45zPt/EUDuDAOCK4nAVLSzuPmltL43lBf3/vdwoPQz2lPU5f3HWfapJ8Q7NytNWpJkQHU3N7xXc7197kWAgobedslJJsFUOY4aybFKwInLwjt7DbOtDsR9+MgteTJJZYlDzsE38fM670lDCEIy9vbz8jqeheX2lyKbtcP4J050N392xBiA0WJBKDWjtRPNcYv80j5KQzodZjinkA8VmHa+e2ZJzp6wGfiWX7uo/d3/5/F19reuQoN7w6N60WtzilPCvblwf7uj1nxKrHPW736qIxhPMA0fpZTTlYaJ2zv60OPUD1TMUDnrEp/T9eZssai9o+jpu1Fac/BeGMuTp2FSVlzgiM1sWleU1PHhg0bzLHJnn1z327GzE2AeRnRXeVJ+ZHBvp7/sMcN616yZEk8Nmv2g1aalhzM7sYbxg7PrOZeXkUANbenrkO5f9pS2G4TOGgHGYQ3WXTXwrQYyJby6yjYD9tJCjdrTa2+CaPBu51hRWALuW6wv+dOJ08YP9ZQ+u6RkUFMYpY44u8d7O0+HjTgFb0JDdDSVelzpc7ct0JyszSz1ZDavsDRxOexvUJjjR/DlrWnPic5o4WwaYrAydMMwRZt6++KZP2yZMm743zWnj8jU/Pz4i1rC0AyW7RFiMoOBVBrOj0dNemgXyX8gANFvralt/tqHzJJZ6u2sqUd6S8A/Y+pwCnIYnLGYE/P3wr+Chznrl3blBnNvMB1Xm8XYwhx9bb+3q/ZaVG4CzU8gDAmDPmyX34/4GACcbdPcChZ2YZFZT59uaWv5xrE/y9PfST7E8LD5LVE7CN33z3MY+wcZ4DO+VdpDeWkV+oPrHRrR+ctGFewCVne+AFHk8bjW5umvb68tCMcNCjTmJCnyKHe3iuYoXntyR2PI44fHpFQmQut8Uk04xudUuIT2X1OWqV+6i58m+b29pNwDL3bTwRf4GjawQyTCx7r6ak4Y6em03XHZOUeTefutZjJhVS4fvT3wcOa2ztfwNx0FvFa+ZVSXD/Y16ecOPmQWcISpAUxrvEdJRIUBEtZe5B6jGDvjQIcSmdHT884Z+J8e5olbkNieh5NVwc5ErtSaygNe34Z459CFxwjehTG6ibKylqaTn8Ri9ELyjHalbV4leBI7dbBvu7PWDx+7DRayY4dO0rWRlbcPTt3vnjiglORJ3ahRSuyGZt20qtOTR43c8aDzz33nDXRKGIJ4nl255+fPfHUU05jGltkjzcRjw8/s2NHJJuqvrq4trZ100aTh4btSqjcfsHBGmlfbHj/vIGBAbpdE9SQzl6Fy7DjsBvt5ESnYNIPJ2+HEvrEmclx7SWUo+zpGRwBX5gDOavsJDaIsSBm5gw0XxkNTLsjaUW+urhDyZHbnZl1+v2CY8ZjxkUhwaHoXuCY4RzyzXRs/yz9kOHGrBH7UATgkB6WLub9CltPoWtHJjE2LYI7ywO0fj3GQbbWS7SVeTuPTVk7GR23dsfWvr7fFxEj9gz09e1AyRWOPJz6oQVftXeiiVpA2JZjAWNqrhtGxpnf1pHDN0SRrbIAtQ4MXeGVkDPzxOtU1h7fSOhX2v3VcscTsX+hHVeVfozzafF43eUh0iZQi8CBnz2ycePzWC48VCRPyk9qqNxFtBCecgLQeLRb3OSqMu8FDmruN3G2f9hNXpR0WlBCXsnax9IPxxIfCJieChwSkW+J+jed8s7ZMvQVJy2o3xOg1lT6e24Cg4JDcjAxKOybucmNkh5LJj4qBK6G5I0Fjull2mnL2lcvt8LK2GXA0bS50xt/iQ5zj10OE4KOzysyngChcrxLJT0MOELK/65gYqBSoyyNWhG2YH5KjEXg5GNii+itZYXkWoizW6NoRaDR0QjT2a12ebTjQkcVdlpQtytAdJctr0SRzDDgkIC4NCquTUWK+PTEmPx3FThmdCne6GNRWRYcSxWZZf9puS1bP2a29+LZYnSxXQHKMl7Sp4YFRzO0J3Flaa+LDlUl/9rcRhIPKBPBttDLiYSvm0eO+CrQtMGN9/4Fs9THHLzfcPgDeV0BwuygqPmHBgfqSCb/LZBWETNnOf+Qm0hjxowJt7AwdHyhscEeD3eUzoCfusNQRgkQXeazS6sEHEx1M/NmTHvQLq/W7u10uUOI51XpNh48OEdFD01j8jvOuEs6OujENZRRAsT4kfGiInCgEu623aG6WxBK2woiCcaUU16u6ysrEFsSlQ4G6fqXFUDll9C0d1r+oLYSIKnLj5KgSsEhGdyIfYrsyTaJuvgPlDpI/iYlvQIidmvNC5RW+WHX+9qw4koAwqlgA4TFLeF2wa6zITuTzY2F/DAGTl9HFLZoVXHmF650slpkpCZXgBB6jCgSlvdgq+lllJ99c7nex2xRJQp7vg6jZ8SSKMAhsQD0LtNypDFZXnyPcoMqbVTKovsFKp6gNJTht+1xDtfVLbT7/bpLAOJMXuWMHLTlWPEZi33Jck8Fe9ww7nXqQZUxNjYW7UQBieCaeWGz1iw/xj/sTNuPvwQgiC6aXocFB92b0Tg+XNKl+FGqWjxP9Pcfws7PC5b8Qk/B46+2aFHZycMJM+9W+eFQ74owsosAoitFEFLYmrCEhxGsS/YbXO7IholbzTj4dOLrJL8ATs69LOo0Z83CaaBjaAuz7VMEUCaT+SdLUadwi+7Hpszjk0OzIPzw15IHe3M/s4Njps1kKmod8kuLUbvc2DHHn2n3+3EXAYRav4oiVQoOycgkEv1kTzUz/sILzzp1wvdMZ4EW6Uwul4Ys3mLi4iPOtMv5iwDCNsVbogCHtvhx7vNyucQnI3z79u0TGB4PWGlb+cUnm4Wu3Qqr1JZMe6hYBntDsb+8zw4QExoLNRWkZOzdBmaCj4MU5ji5vMYRcDCmP0FiLHDInRgZmUF2lAafTA455MWDrocKAC1ZuXK6Q5hvrx0cMxLn3/cdeRIY0Zc9YQeHVIgL/YSoVdF1+VenzEPJprOdNC9/ASBd1+d7MbqFlYADRmwP3+/GP9n0/EzKbEFFuojsaUX+CDwj2eyLTjFcMwKth2KWAM70s5WHHBaDwlaBQzUzcaCxZCBWRI+UdGZ7e2O90BdpXM7HpZDZED4d3w814uPiwuCPj5NxFYFlDMlOwWeVRQbvJdAMq+iooIghhOeJ5ctHW7c4ejkhLlqa6lxPemEoSFj64bENHCVpYxgs9mq6tocZsb9kXnp2ZwEgBC4NooMbOJAhBwY2IKHamnqu/4/GWYc1GpJ+ZjeGmY9lMMaaczUnOBTOpLbY4ovMXr9eaKnOvZBHFSZnOMdLJ9oNpJZdP6pGhW4XDJIbmj7rOBwGHDGdR5zeLg9wcPtI7EZsJFFbw2P6O6wUvfSzeJw2Cij0BMkpy+5HQdxm95Pbv37sZ3aATnIKUvnLCUdXsVMVr9q0gXvvfUYKbbCcfh562MvCgy1YEJfG7fYYQfQz9j1/ZU4pnxfs/AhHT7rNrlAt3ei3X+tMr9BtOANyfsxntKfxd1s8rl+gZqmMuqWv7zG8HfFpSBn2U35Wahg/L6I1m9lBY26eHE02FG1LWIyW7V+4uAzfmf7cildru7kj3a0zLU3pOsFhhjzvpJnTtkzyCS9b3NY2I5ms3+/UzyorwxBd2zb2riG/2YIO63qjFaiy/YOD2IztUsmoFU0YE5dRWqrMxxL8yUkGx1QtmUzOVOmXL6NRgHNJ3m0d2NUdYxGcdiBwKHJWf8kpo5b+7ffddxDwfEuV5kQ2e5WKXlMahhPs/bmuE8fHErRgLkyycmNQQpZ8S0NKBwYHcXSWQQFNrhlualJvSjL9mvyRyqQpiHXRZ5D4ySoFMO684fHNvyzsExJPDqCsKFlFhwGHBI7X1Y2QPZnm9xs2ZPBdw78qdDg2O5Y5sLCtbZoirOqk1pVpWmteq0oIq7buLb29v3CGmQCxWKxoHyosOCQcu9g1X6Q6M0X+rcubbxLocEvCcGG6ob5+dQm9yoRFePNHxtgjqmTwxsLIUG+POSlwhucA0rSjrIBKwIEMmraiXKaAwSoe51vmbM6pDW7N3uSkVdNPO9gNhvxfTJlzPZYjsdHM2D+AVBh37MFmBOwHmZOECsEhuTX59seeAS/3lr6u+zQpaKul2Eht5rKL18wpJlbNx0brGu6GdOVGAK13fr95s+uwkG9BbHYE4KDpyENVy2ZYwSJ2njJqwvi6kh4xEY/q4uv43LrMKVpI8SOMO5uddLs/1+SkKBk0Pebp9vgON8uAYC5+HQGT5qUvDlBxBuwKUGVEf/LP9BacnR61G6+bXA6Z5i1dp2zcetqzta/3XU66059rQUxSwRZMOHBy0dHf6gVBU8RRp/PCpMDeU0wYpRfdo1IZn+a34XjjJ27yxEv7TnELs9NNgABIAaBKwMFxCx8expbTFDMPd3Xtxz2JH9jBIRXhv2zJykvmRq3uOek0ztb4A65yDX4a7bO5htsC8l2cZgJUETjqSYgtqcl1HqtrH8SzwkUzTMpvLG7cB82CVipX/paOjvN1w33DGE9pXE3drt/SyAHEtIlIwJEy4TfhWvP14C0fbHN8wEq3kF+pLWhelb6ZNoytsDI2gaOaErNla9bMwa8R4OCQ58rVKUjIAbzM9TUn2ctvdXG05R7K2LsNrC8aQgmpUaRUaytdZjlcACefLtfZlaP1jQXwPNRxBYfGXiObvQPQzFLGF2IMz3OeqwzzIOaQFrL0EoVHJCvIDg7R0H80oG8tXb1bESbZXo/FqyH4KpUa+Ar9Wtxs8rp65QoO5MnDyYYv4mXg5SrZRMuK7PHE5xbuRjcBElwGPgV1gkMJ4IJ4DA/tqZu3mwY1ppsPkgu2w5kslD46FoupN1lzY5SqcE3QWlJrXgfH1U6Zlh83VVbkdtktin/bLEykvMd/FHP2U8JudRt/OnjQb19eIqNmBF1cpE6LfxiPmR+54JFj8mw5eK7gVOwG/FgtD03G0G4a6u+53y28HN0EqJ4x39d0VS3HAocSq08mSxa95ZSodTi+I92DXxe6S5FuY5br19nonuDQxAK/i3Qn+JVdIxaju4Y2dr/PJi+w0wQoe2Ca616QXWI5cIg3lsnMtMeZqu6JOv42lW5MyPfY30NV8BRAG0s0fBvhZyl4MCAL0ZgZW6AMC0A0ARroWDheLo4fcEhGxmA0GE55Yz7qJBRnM5wn/rp/v1svUAAHlw/fLrn2DreMZuviJ0fxfZQJEJ7NKlrAORP1Cw7F0zmruNY406+Wf3B5y5fwAldJ5YwxXTXgF8BZ1tm5CBc7vuuqF5PvQAXY7RoeICAHkEeEIOCQGCDd6iFuagXRmRFja+xKUX5xt+/6hesW2hfdBXDoyBy/dnSn82Hzggxp9GCMu6Xgr9BRAAgzuZKpdlBwSBdcoT2jQp1qGp3OjLAB9Iypu22Z0jQy9xv0Qx6UJfwVpthGJnszKCVXBCg+hp2X8SRzYWOWaJWaAkC4cHirXVgYcCg+LhMrlbfLnmpuzsV5JfmV2nuzM2b2QNcCOBh3PgjPOjf9RV2cDuUK/G58QegFgPBbOHdYEUuUNVOlilTeQODRUTwFWT6l6DhwaLYLv0vUbZdISwdsXV3YklqNC/not9PppSj5r9h57G4jK19jTjzsxAjcBYCaMpldJK8ScCx9Fm9+PPTHYJaMWtvJscybrDTt6zrsPn/O/E0GyagCxy2eIlvK67fd1/NYES0iTwEgTAnHowCH9IonK5//R5Q/32KQ/xEA83E7OBQZreg1sQljCE7qvkqMoYmH8XtHdPe6KqYAEKRT3zlsT8WprD3Myw1Bb/YKn6phg0tbvohZqGqz92SVzuA9tG3p0gtVYVHR7AABoSPvy4QFhxRDrbsyKgVrKgfTbiaNi/2mySbq5pVbQ/qV5cZXBBCmAT8gxkrAoW4SQo+ifSq3RKcyHT/z+Wu8vl72xBOz1QuHNt1V9XvoRQCd1NT0dKXgWIU/GquP/pNCS3i17WzmfK8kMHG4cWt390NePFGFFQFkfprBtKLL234Tck4wsE/1Mb9xpxrf4KZNL2iC/VClFy6fPIRj6/WqsGrQigCiBITUvhQ0ISc4FB8//kfXbv0tnoImWAP+7EvPl16+R+WdP2PaxTVIvpBECUAxadC5vW+jBMdc5GnJlvb2+b4FTTFG81qUIYq2bbITmfm1/gCsBCB6zhHTZMwgyxs3cKyYeK/gGsv992gPbuyl3YU/ku54fuiMsMfWleS9BCAShn055Rdq9oTKgZPj5W+FrUzDLmsqu2OJWAsmTqlq/6SOWxkox4hyPyboD5xckpjxLMegWnQ32k2ZV+ilJaCs3Vv7+zHdLj3IouhBwMnxa58tTfYVit8SUAKUj/xJp5Cg4OTi84taVqwwvz9yynvFX74EXAEaE9miI91w4OQUYPHE58qr8gqHqgRcAaIXchHhtxSpEnAoPh4xuvzvdeuH9J9MU3jtSqWEIY13xhgfdIYF3Q5CLUiOJRuoFakuYzjFV8XfvKpzsWTiq3hUFnmWMfwkCx4AxuNl9IftQ8yWqLLiarXkWGPEKCy3rYjncfPLDvDQTvcY6GMI/Zv5g/NS2w/6Pmw074WkZ7jQd+sx+Rf65CWKjChncXbB+Jm0ETA1WrSg4Fjx6FdQ6jNjx+HcJdRWUkFOCAf9jDSe9nhR15jbdSpTaqU9RUE1yT492Nd1fcFfgcO1i7NkSkO+q+CuYOcG9TUxnqyjca1spbDSi8o+SmpdNQMHSgOcG6LSvSxAQxt7f047C6FbDjS1aiZ6kstaU6lFUSnvR05Le+oKnE+t8OK19LPzhM0vNon/EXJQZNGYsgBRYuijrw2bnDPz+G7zTsiqSSuiBTdK6mYv3Z36EW9YcDAb+vJQd/efvdILGuYHIK1hfPSr1IqCCldmXrIFrR3p64LKCsqPd7ATGo9to19idIur1C9s3RFix2B/d+RHLL4AojvGqPmBbul7Zp6xG5euXH26W8FFQGcNBw8NInOz3WR56ucWyYWOyjs+2N9LXVvkxhdAlOpga/OPYHk++mdp5yPzzODywTRmV1acKO2WdPoXmC+7nuj60C+QOg1jh2ciQuAexk8ivgGiyxHY+KTdaU/jN/MowFn7DEbXmfzr4JlyLrC5o/MWPHF8qRurX/3c4jvpusjS0mHMSY/KH3iwxtMmu5D4PJUCYTIP0O/BbvdalbygtJaOztuxwHyLW7ww+rnJIjq+Oz19e3+/eV7kxVdJWODaq+M2iyrBsJnHgv2S5vbVt6lk+qWtxyuGre2dm2oJDh2jVBscyn/gFkSR0Ip+DOvt5CYTFpxc7Nx/zOX7hvp6OuEL1JcvvvTSmXVjGfpKXXnzk6RHoR/JsQweiV8x1BP+u1NLjh87FEAQzFtSnfRkMPawMIdxmLDrCOxnPdkwNtpK13AdIpVevIezFotfWlep70wjIEr9SAmuidRAb28fuWthAndxeaXw7SxriT7z2qsPJ5L7lqdSzV6Zb+7sPL61o+MxgPMr8NUMHPqcvpbgUBmEbUFm+S1NpR+Ao8304F/YlkPxnWDj0/ZfCcYvp1/2zcvnLR1rFoHv27g0cV6e5mo55RFjRfrhze0tG3secU2wSgEVAQSdOEAySLeKMu/STeKLNQM7AXdgVMKJrDgPhwENfsohanB0TbQ82tu71U/aUfN4ngf5SEwwYZwueOwPPniVLF6Fmd+muSy3UvLXG3vJUypQhojzndMf7e+u6lTaSwXXfSqvSPawPTt3vnjiqQteBZr6vQA7s8MddWFGLQ9fHZ4w1N+9y6F2Tb2VdnEFZTH1/is8JxcIZRxRF2bE8kbrxw7P9jubLJPVioL99Rs+kuAH9y8EG91jKGsiLsySCQYpUMGY+BTAmT4VwKF8RNaCSNjiNiwak5ndcDaRX2WmMjh4reuuLb1db4DepYs7VWZqQIusBZGu9LsDc5sa8ZKufFile2ltILhKqaq4KlppzArkSe1ygPN6pDNlwKE8l+ZRVRIhaGen07Pigm3D/thct4QqKQmV4iHlDcuJ8ZOHNm2q+tdyIYqxegBZyuA9taMNpn8CBfoe/Jm3g0IWpCXStO0AhZWHD1LXbu3puadI8BTz2PNZddXo+tOMWOy4eDZ7kiHYHM7ZXHxJcQIuNs7Gk86z8YwMbkdp03ELogk/FEXfuNKBXgI0/KjWkXMj+AX8Rt7OgIcOEkfROR1Gix3BXbcDkHUA4fQO3j6cBu9FlL2I8zx2YneOTJu2l34hBWGvmFdKoLIS+H9hvd/wFvfEggAAAABJRU5ErkJggg==",sMOVE_ICON:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAAsTAAALEwEAmpwYAAABWWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDx0aWZmOk9yaWVudGF0aW9uPjE8L3RpZmY6T3JpZW50YXRpb24+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgpMwidZAAAJEUlEQVR4Ae2af4xdRRXH37vv5/7o7nZ/1GZ3K2u7LYWFLVq1bER9aaDYBEKiWf9QNBKw8W8g8Q//WWKIiQaVGBNjFENjjH80xZQoJgoxSKLEBihQWjQVSBGppbu1sd12d7uPz3d2zuWm6bv3Prq7j33uJC8z99w5M+d75syZM+e+TGa1rGpgVQOrGmiMBgKmvaVQKHxjeHi41BgRGjTr+Ph4kamfzGaz1SDIVmm/snXr1p4GibO803rwT3nw55l9OpcLnBIGBwe7l1ea5Z8ty5QG/gJtLMCBn1lQSHAUWm75xVqGGScmJrTnDbxWft6DrwKedla0aj6ff45aimqesmfPngJoDPw0bVv5eYHX6nuavTuyfft28TRFiZr9ORAJ/BT13wXcgz+ey+XeWniXPetph/v7+1ubQQM/FiBM3MBrtbfh+PZ6oDL7Z6BtRDGnPe2sd4wvQc+vZCX0ePD/BYSZfUWA8vncExHaIdE6Ozs3Uk168Kd1RBIn3K13K7K0tbWtt1UG1DwgbooA2W9OkPp5o69bt24T7XcE3vPutHcrtf5qsVj4FcILWGZkZERBEBaQP0ClrSGgz4pmpa+vbzM+4RGex43WjPVjWmG/yn9oFECdzQ0pAJ/Lcj5Uq9UMq/16Q4Ro5KQ4t08yf9U7vFsbKUvD5m5padEe/ya/5or8GqbR1Ynr10Cjbl4DpVLpplKpsHN2dm6wu7s9Nz09cxbxZ+uHsII4FOnh+X/PCXBW5z+iW3So4/Acp4GOw90fZEiymEpXV/mqOoXMEvh8Hx537gP+Iu0LRIBa8VmeaTuanQoHent719Q5R2dHR8dwnTzpu5O366D3ywpc/OqlTWHlAPoKvOKbFv9C2yVCLBJ0NH8kuj7w/Jt+aQFdA+//NC5WpKhzccuWLf29jHjUgz9Nu9ra2vqJFLOAIziu/oA/58GfKJWK34N2c29v58e4L4zS3oVP+C71W34Od3MEzElomju2lMvlb9NBc5zxc+yPZajn5ejopnX0f9ULJkclM/0PdaID5canPR2CD4LMo9wFaub9ZGWAftTPYUp4iuekch3g5/jJkvAlzrp+ncSU+N6Dt5V34FnRSRg/lMTc3t7+RfqE4Gn/zHhGR0fbKpVKmedg167RNuqcaD5tlikWiz+HFuXdZLy1aubTrXHeg3fWhjJ/Uat/Iv2SlbdUle71Q4nMRHZ4++dkNQu/zD/HxsZaxCfglu4ymp49Lbd79259I0DP2WPipa2EyZ+oEwunzHY6maN1MhcKuVDxiQNYh5ERl562lXfJSiQ6xvs+65NQb5PwgJihX5WQ93711yrHgHfKoZvLBeIT7hMvK+rGMDp1bOnq6roBWU/RifkDJzuWsDeWKfqyUnEpqCMRAJa9PYgwe9nX++i/j1X5DfV++j3uLzbhMDx/3a/eDEJoFUf0Uquv+jIrH9KsD92u8+bMGNkqjm6jeCNlLTJ8jud7Cah+EASZh5jrYbbPBLSn/bwX4b3gZfkd3yQS/ZbG/4IHbysvAC5z6weSZp1p+n6uvXZty4fFrFIuF79DZf2mNmzY0O9esDXiwMs6xscXEiZbtgwOwDPFHJY1vsWPwfjlT19OlktoUZnPe2X+yMaoWaPJe6VxOpyPADUhDBR1mMyw4CXqqB40XupJsrvuKAOgy/IKaMxWyE5MVJQIXQsglxqjXWVL3G5Ct7WVtPKad051VBabV8qIKMR9hMFi/mxj1KzXrFkjYU+Z+TGIgf8HA/yVdy8yySHof6P9OLQJ6s38wuL3vAQj6eH8wCYSH7ryBgngM6YkorrN4oeHSNFZ3PXhBDSKxfy3qCZ5d4I53qZ9Apnfof4XtLehOcukHSqptTVjlki3mLJ+/Xrt2VMaBCHsi80L0OSh05SK53Wa7+ho+7KYZP4xK5/x+1+rnyFAupOK+QM3Ro3QWHs60G9sbFCnTIu+L+Kn/hLllYXglz4KLX3p6em5BkZ9wJAQ5g+O8uwETBgpC89xz6uVUEAUrm6CH7CPIX9kDFvFN8WfpmCRT9IvVJzAQ/tUHG9cNkbZWRf6MlD4xYbBpPmkMua30TkJUS4X7hHDjh07dKfIKTtsGWKvkLyOST/oXR684xWbp8dWANUJJfA+bnHgPxPLlOLlVbIEv6fsi81B+OIUZ8O+5reCbn9VzPpr9sKiPrMGo1N/yYPXESZHdiTyrmYT8A/zUuBdCC1eaJ+tyVDPi+7u7g30N8c4pcHZU4q6YgvhaZ/60kkhqlMCFrUfRdwMrcNHfRntW6I4HXP7IuDN+bbHTsJLLmZ3UOlUOKO6XvBpVjKDY1QUeFKDe2u4gec05UZA+7383nUYYU/CfJixXgK0vLdWT/2mI3NcnWYC+nzFbzcDH7vnU4552W4BK/9x3qQVzAa5GnCTXnGyBufZ9ewtRODlaPU/ASlYCql3jh0o+qccwWFAZpMn1aksIGmQFO91ejyAkM5MBd4rxFZe9Rl+P6SfuzilGPOKuywX+KigOfbstpmZmc/Pzc1txlEF1G/gFw4Rxx+YmprSjXO1LJsG7DhatglXJ3pPA+3txWs5YhUYNa6kvSMvgYRDdgIwthzk/1fB2z8IYrtKL07E9j5UqJtUthFWMD8/fz1KyFy8OK9/i9z2PmRfMSxlJHV/i4lKDOiDPLtAiHjA5fHtqjw0NETSp/wR3jfimI6KecXtYQtRCYDcbTAy4vMWDJFBfszoC/f54GWe2R6516iXXAlLNgGBjU9qhF9sHjKggH/BnCDW8FvRBwYGeoiLXqUp36CASF+g0mVxNMAVFClB/mCxSzsg3bWWge2LzU80CaurlJqFwb+UH8InHPM0+wijC5O20MotNb7YPAKiQwB2t0SU8TS/Z6FJIQb+NPnJei9EH0xFcdfX/d/S1JZeE3jR7N4v8D6TEzQPeEt7yRJszwM0vA7LEUoRRqMOwZMkbboAiTzhQnIE4EqZuy0A6FmUIAsIwVt6HHrTFb7dhbkAfTpz1hAFH0mONh14B4iPHjfSsE/ZWvkpc3iXSZI2pxJwjDtBdlgRoYHneSmO4uZU4GKiWrJIcDGFXKqxzOSyzXjkpFaaB2+WcGmtcYyWesyV0vFd4FDB1mOmmM4AAAAASUVORK5CYII=",registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Minimum",e.setMinimum),t.registerProperty("Maximum",e.setMaximum),t.registerProperty("NumberOfMarks",e.setNumberOfMarks,e.getNumberOfMarks),t.registerProperty("BigMark",e.setBigMark),t.registerProperty("MediumMark",e.setMediumMark),t.registerProperty("MarkFactor",e.setMarkFactor),t.registerProperty("Digits",e.setDigits),t.registerProperty("BorderWidth",e.setBorderWidth),t.registerProperty("BorderColor",e.setBorderColor),t.registerProperty("FillColor",e.setFillColor),t.registerProperty("LineWidth",e.setLineWidth),t.registerProperty("LineColor",e.setLineColor),t.registerProperty("TextColor",e.setTextColor),t.registerProperty("TextFont",e.setTextFont),t.registerProperty("Width",e.setWidth),t.registerProperty("Length",e.setLength),t.registerProperty("DrawLines",e.setDrawLines),t.registerProperty("DrawText",e.setDrawText),t.registerProperty("Enabled",e.setEnabled),t.registerProperty("Rotates",e.setRotates),t.registerAction("OnDrag",e.getOnRotationInformation),t.registerAction("OnRotation",e.getOnRotationInformation)}},EJSS_DRAWING2D.ruler=function(e){var t,r,n,i,o,a,s,l,u=EJSS_DRAWING2D.group(e),g=1.1,c=.2,S=0,f=1,E=101,d=10,p=5,h=.1,m=0,A=!1,_=[],D=!0;function I(e,t){var r=u.getController();r&&r.invokeImmediateAction("OnDrag")}function P(e,t){e=t.point;var r=t.element,n=u.getAbsolutePosition(!0);e[0]-=n[0],e[1]-=n[1];var i=u.computeRotation(r==l,e);u.setTransformation(i),u.setChanged(!0);var o=u.getController();o&&o.invokeImmediateAction("OnRotation")}return u.getElement=function(e){return _[e]},u.superSetChanged=u.setChanged,u.setChanged=function(e){if(u.superSetChanged(e),e)for(var t=0,r=_.length;t<r;t++)_[t].setChanged(e)},u.setWidth=function(e){e!=c&&(c=e,u.mustAdjust())},u.getWidth=function(){return c},u.setLength=function(e){e!=g&&(g=e,u.mustAdjust())},u.getLength=function(){return g},u.setMinimum=function(e){S!=e&&(S=e,D=!0)},u.getMinimum=function(){return S},u.setMaximum=function(e){f!=e&&(f=e,D=!0)},u.getMaximum=function(){return f},u.setNumberOfMarks=function(e){e!=E&&(E=e,D=!0)},u.getNumberOfMarks=function(){return E},u.setBigMark=function(e){e!=d&&(d=e,D=!0)},u.getBigMark=function(){return d},u.setMediumMark=function(e){e!=p&&(p=e,D=!0)},u.getMediumMark=function(){return p},u.setMarkFactor=function(e){e!=h&&(h=e,D=!0)},u.getMarkFactor=function(){return h},u.setMaximumMark=function(e){e!=mMaximumMark&&(mMaximumMark=e,D=!0)},u.getMaximumMark=function(){return mMaximumMark},u.setDigits=function(e){e!=m&&(m=e,D=!0)},u.getDigits=function(){return m},u.mustAdjust=function(){D=!0},u.setBorderWidth=function(e){r.getStyle().setLineWidth(e)},u.setBorderColor=function(e){r.getStyle().setLineColor(e)},u.setFillColor=function(e){r.getStyle().setFillColor(e)},u.setLineWidth=function(e){n.setToEach((function(t){t.getStyle().setLineWidth(e)}))},u.setLineColor=function(e){n.setToEach((function(t){t.getStyle().setLineColor(e)}))},u.setDrawLines=function(e){n.setToEach((function(e,t){e.setVisible(t)}),e)},u.setTextColor=function(e){i.setToEach((function(t){t.getFont().setFillColor(e)}))},u.setTextFont=function(e){i.setToEach((function(t){t.getFont().setFont(e)}))},u.setDrawText=function(e){i.setToEach((function(e,t){e.setVisible(t)}),e)},u.setEnabled=function(e){o.setVisible(e),a.setVisible(e)},u.setRotates=function(e){s.setVisible(e),l.setVisible(e)},u.registerProperties=function(e){EJSS_DRAWING2D.Ruler.registerProperties(u,e)},u.superSetParent=u.setParent,u.setParent=function(e,t){u.superSetParent(e,t),A||(u.createRuler(),A=!0),u.addParticularChildren(),u.adjustForeground()},u.dataCollected=function(){D&&(u.adjustForeground(),D=!1)},u.addParticularChildren=function(){t.setParent(u),r.setParent(t),n.setToEach((function(e){e.setParent(t)})),i.setToEach((function(e){e.setParent(t)})),o.setParent(u),a.setParent(u),s.setParent(u),l.setParent(u)},u.createBody=function(){var t=EJSS_DRAWING2D.shape(e+".body");return t.setShapeType("ROUND_RECTANGLE"),t.setCornerRadius(5),t},u.createRuler=function(){t=EJSS_DRAWING2D.group(e+".group"),_.group=t,(r=u.createBody()).getStyle().setFillColor("rgba(0,255,0,0.2)"),_.body=r,(n=EJSS_DRAWING2D.segmentSet(e+".segments")).setToEach((function(e){e.setRelativePosition("SOUTH_WEST")})),n.setToEach((function(e){e.getStyle().setLineWidth(.5)})),_.segments=n,(i=EJSS_DRAWING2D.textSet(e+".texts")).setToEach((function(e){e.getFont().setFont('normal normal 8px "Courier New", Courier, monospace')})),i.setToEach((function(e){e.setRelativePosition("NORTH")})),_.texts=i,(o=EJSS_CORE.promoteToControlElement(EJSS_DRAWING2D.image(e+".left_handle"),u.getView(),e+".left_handle")).setImageUrl(EJSS_DRAWING2D.Ruler.sMOVE_ICON),o.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setMotionEnabled("ENABLED_ANY"),o.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setAffectsGroup(!0),o.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setSensitivity(10),o.setSize([10,10]),o.setPixelSize(!0),o.setProperty("OnDrag",I),_.left_handle=o,(a=EJSS_CORE.promoteToControlElement(EJSS_DRAWING2D.image(e+".right_handle"),u.getView(),e+".right_handle")).setImageUrl(EJSS_DRAWING2D.Ruler.sMOVE_ICON),a.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setMotionEnabled("ENABLED_ANY"),a.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setAffectsGroup(!0),a.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setSensitivity(10),a.setProperty("OnDrag",I),a.setSize([10,10]),a.setPixelSize(!0),_.right_handle=a,(s=EJSS_CORE.promoteToControlElement(EJSS_DRAWING2D.image(e+".left_rotate"),u.getView(),e+".left_rotate")).setImageUrl(EJSS_DRAWING2D.Ruler.sROTATE_ICON),s.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setMotionEnabled("ENABLED_NO_MOVE"),s.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setSensitivity(10),s.setSize([8,8]),s.setPixelSize(!0),s.setProperty("OnDrag",P),_.left_rotate=s,(l=EJSS_CORE.promoteToControlElement(EJSS_DRAWING2D.image(e+".right_rotate"),u.getView(),e+".right_rotate")).setImageUrl(EJSS_DRAWING2D.Ruler.sROTATE_ICON),l.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setMotionEnabled("ENABLED_NO_MOVE"),l.getInteractionTarget(EJSS_DRAWING2D.PanelInteraction.TARGET_POSITION).setSensitivity(10),l.setSize([8,8]),l.setPixelSize(!0),l.setProperty("OnDrag",P),_.right_rotate=l},u.adjustBody=function(){r.setSize([g,c])},u.adjustForeground=function(){o.setPosition([-.125*g,0]),a.setPosition([.125*g,0]),s.setPosition([-.35*g,0]),l.setPosition([.35*g,0]),t.setY(.3*c),u.adjustBody();var e=(g-Math.abs(f-S))/2,r=c/6;n.setNumberOfElements(E);for(var A=Math.abs(f-S)/(E-1),_=-g/2+e,D=0,I=0;I<E;I++){(C=n.getElement(I)).setPosition([_,c/2]),I%d==0?(D++,C.setSize([0,-2*r])):I%p==0?(C.setSize([0,-1.5*r])):C.setSize([0,-r]),_+=A}i.setNumberOfElements(D);var P=0;for(I=0;I<E;I++){var C=n.getElement(I);if(I%d==0){var T=i.getElement(P);T.setX(C.getX()),T.setY(c/2+1.1*C.getSizeY());var y=((E-1-I)*S+I*f)/(E-1)/h;T.setText(""+y.toFixed(m)),P++}}},u.getOnRotationInformation=function(){return{position:u.getPosition(),element:u,point:u.getGroupPanel().getPanelInteraction().getInteractionPoint(),angle:u.getTransformation()}},u.computeRotation=function(e,t){return e?Math.atan2(t[1],t[0]):Math.atan2(-t[1],-t[0])},u};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ScalarField={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("ZData",e.setData,e.getData),t.registerProperty("MinimumZ",e.setMinimumZ,e.getMinimumZ),t.registerProperty("MaximumZ",e.setMaximumZ,e.getMaximumZ),t.registerProperty("NumColors",e.getColorMapper().setNumberOfColors),t.registerProperty("Colors",e.getColorMapper().setColorPalette),t.registerProperty("Palette",e.getColorMapper().setPaletteType),t.registerProperty("AutoUpdate",e.setAutoupdate),t.registerProperty("ParallelDrawing",e.setParallelDrawing)}},EJSS_DRAWING2D.scalarField=function(e){var t=EJSS_DRAWING2D.element(e),r=EJSS_DRAWING2D.colorCoded(16,EJSS_DRAWING2D.ColorMapper.SPECTRUM),n=r.getCeilColor(),i=r.getFloorColor(),o=!0,a=[],s=!0,l=1,u=-1,g=!0,c=!1,S=!1;return t.getClass=function(){return"ElementScalarField"},t.setParallelDrawing=function(e){S!=e&&(S=e,t.setChanged(!0))},t.getParallelDrawing=function(){return S},t.setFloorColor=function(e){i!=e&&(i=e,r.setFloorCeilColor(i,n),t.setChanged(!0))},t.getFloorColor=function(){return i},t.setCeilColor=function(e){n!=e&&(n=e,r.setFloorCeilColor(i,n),t.setChanged(!0))},t.getCeilColor=function(){return n},t.setData=function(e){(s||a!=e)&&(a=e,mDataChanged=!0,t.setChanged(!0))},t.getData=function(){return a},t.setAutoupdate=function(e){(s=e)&&(mDataChanged=!0)},t.getMaximumZ=function(){return l},t.setMaximumZ=function(e){l!=e&&(l=e,g||r.setScale(u,l),t.setChanged(!0))},t.getMinimumZ=function(){return u},t.setMinimumZ=function(e){u!=e&&(u=e,g||r.setScale(u,l),t.setChanged(!0))},t.setAutoscaleZ=function(e){g!=e&&(g=e,t.setChanged(!0))},t.getAutoscaleZ=function(){return g},t.setSymmetricZ=function(e){c!=e&&(c=e,r.setSymmetricZ(c),t.setChanged(!0))},t.getSymmetricZ=function(){return c},t.setColorMapper=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getColorMapper=function(){return r},t.setShowGrid=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getShowGrid=function(){return o},t.registerProperties=function(e){EJSS_DRAWING2D.ScalarField.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Segment={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Offset",e.setRelativePosition,e.getRelativePosition)}},EJSS_DRAWING2D.segment=function(e){var t=EJSS_DRAWING2D.element(e);return t.getClass=function(){return"ElementSegment"},t.registerProperties=function(e){EJSS_DRAWING2D.Segment.registerProperties(t,e)},t.setSize([.1,.1]),t.setRelativePosition("SOUTH_WEST"),t},EJSS_DRAWING2D.SegmentSet={registerProperties:function(e,t){EJSS_DRAWING2D.ElementSet.registerProperties(e,t),t.registerProperty("Offset",(function(t){e.setToEach((function(e,t){e.setRelativePosition(t)}),t)}))}},EJSS_DRAWING2D.segmentSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.segment,e);return t.registerProperties=function(e){EJSS_DRAWING2D.SegmentSet.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.SetSquare={registerProperties:function(e,t){EJSS_DRAWING2D.Ruler.registerProperties(e,t),t.registerProperty("Height",e.setHeight)}},EJSS_DRAWING2D.setSquare=function(e){var t=EJSS_DRAWING2D.ruler(e),r=t.getLength();return t.setHeight=function(e){e!=r&&(r=e,t.mustAdjust())},t.getHeight=function(){return r},t.registerProperties=function(e){EJSS_DRAWING2D.SetSquare.registerProperties(t,e)},t.createBody=function(){return EJSS_DRAWING2D.polygon(e+".body")},t.adjustBody=function(){for(var e=t.getWidth(),r=t.getLength(),n=t.getHeight(),i=Math.sqrt(r*r+n*n),o=(n-e)*r/n-e-e*i/n,a=[[0,0,1],[r,0,1],[0,-n,1],[0,0,1],[e,-e,0],[e,-e-(n-e-e*n/r-e*i/r),1],[e+o,-e,1],[e,-e,1]],s=0;s<a.length;s++)a[s][0]-=r/2,a[s][1]+=e/2;t.getElement("body").setPoints(a),t.getElement("left_handle").setPosition([e+o/4-r/2,0]),t.getElement("right_handle").setPosition([e+3*o/4-r/2,0]),t.getElement("left_rotate").setPosition([e/2-r/2,0]),t.getElement("right_rotate").setPosition([e+o+e/2-r/2,0])},t.setMaximum(.99),t.setNumberOfMarks(100),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Shape={NONE:0,ELLIPSE:1,RECTANGLE:2,ROUND_RECTANGLE:3,WHEEL:4,POINT:5,registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("ShapeType",e.setShapeType),t.registerProperty("CornerRadius",e.setCornerRadius)},copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setShapeType(e.getShapeType()),t.setCornerRadius(e.getCornerRadius())}},EJSS_DRAWING2D.shape=function(e){var t=EJSS_DRAWING2D.element(e),r=10,n=EJSS_DRAWING2D.Shape.ELLIPSE;return t.setShapeType=function(e){n="string"==typeof e?EJSS_DRAWING2D.Shape[e.toUpperCase()]:e},t.getShapeType=function(){return n},t.setCornerRadius=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getCornerRadius=function(){return r},t.getClass=function(){return"ElementShape"},t.registerProperties=function(e){EJSS_DRAWING2D.Shape.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Shape.copyTo(t,e)},t.setSize([.1,.1]),t.setRelativePosition("CENTER"),t.getStyle().setFillColor("Blue"),t.getStyle().setLineColor("Black"),t},EJSS_DRAWING2D.ShapeSet={registerProperties:function(e,t){EJSS_DRAWING2D.ElementSet.registerProperties(e,t),t.registerProperty("ShapeType",(function(t){e.setToEach((function(e,t){e.setShapeType(t)}),t)})),t.registerProperty("CornerRadius",(function(t){e.setToEach((function(e,t){e.setCornerRadius(t)}),t)}))}},EJSS_DRAWING2D.shapeSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.shape,e),r=EJSS_DRAWING2D.ShapeSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.SimplePanel={GRAPHICS2D_SVG:"SVG",GRAPHICS2D_CANVAS:"Canvas",registerProperties:function(e,t){t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("MarginX",e.setMarginX,e.getMarginX),t.registerProperty("MarginY",e.setMarginY,e.getMarginY),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("Width",e.getGraphics().setWidth,e.getGraphics().getWidth),t.registerProperty("Height",e.getGraphics().setHeight,e.getGraphics().getHeight),t.registerProperty("Graphics",e.setGraphics),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getStyle().setLineColor),t.registerProperty("LineColor",e.getStyle().setLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("ShapeRendering",e.getStyle().setShapeRendering),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS)}},EJSS_DRAWING2D.simplePanel=function(e){var t={},r=EJSS_GRAPHICS.svgGraphics(e),n=EJSS_DRAWING2D.style(e),i=[],o=!1,a=[],s={xminPreferred:-1,xmaxPreferred:1,yminPreferred:-1,ymaxPreferred:1,xorigin:0,yorigin:0,xscale:1,yscale:1},l=!0,u=!0;return t.getName=function(){return e},t.getGraphics=function(){return r},t.importGraphics=function(e){return r.importSVG(e)},t.getStyle=function(){return n},t.setGraphics=function(t){t==EJSS_DRAWING2D.SimplePanel.GRAPHICS2D_SVG?r=EJSS_GRAPHICS.svgGraphics(e):t==EJSS_DRAWING2D.SimplePanel.GRAPHICS2D_CANVAS?console.log("WARNING: setGraphics() - Canvas not supported"):console.log("WARNING: setGraphics() - Graphics not supported")},t.setWorldXMin=function(e){e!==s.xminPreferred&&(s.xminPreferred=e,u=!0)},t.getWorldXMin=function(){return s.xminPreferred},t.setWorldXMax=function(e){e!==s.xmaxPreferred&&(s.xmaxPreferred=e,u=!0)},t.getWorldXMax=function(){return s.xmaxPreferred},t.setWorldYMin=function(e){e!==s.yminPreferred&&(s.yminPreferred=e,u=!0)},t.getWorldYMin=function(){return s.yminPreferred},t.setWorldYMax=function(e){e!==s.ymaxPreferred&&(s.ymaxPreferred=e,u=!0)},t.getWorldYMax=function(){return s.ymaxPreferred},t.setWorldCoordinates=function(e){t.setWorldXMin(e[0]),t.setWorldXMax(e[1]),t.setWorldYMin(e[2]),t.setWorldYMax(e[3])},t.getWorldCoordinates=function(){return[t.getWorldXMin(),t.getWorldXMax(),t.getWorldYMin(),t.getWorldYMax()]},t.addElement=function(e,r){EJSS_TOOLS.addToArray(i,e,r),e.setPanel(t),e.dataCollected&&a.push(e),o=!0},t.removeElement=function(e){EJSS_TOOLS.removeFromArray(i,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(a,e),o=!0},t.getElements=function(){return i},t.indexOfElement=function(e){return i.indexOf(e)},t.toPixelAxisY=function(e){return s.yorigin-e-s.yscale*s.yminPreferred},t.toPixelAxisX=function(e){return s.xorigin+e-s.xscale*s.xminPreferred},t.toPixelPosition=function(e){var t=[];return t[0]=s.xorigin+s.xscale*(e[0]-s.xminPreferred),t[1]=s.yorigin+s.yscale*(e[1]-s.yminPreferred),t},t.toPixelMod=function(e){var t=[];return t[0]=e[0]*s.xscale,t[1]=e[1]*s.yscale,t},t.toPanelPosition=function(e){var t=[];return t[0]=s.xminPreferred+(e[0]-s.xorigin)/s.xscale,t[1]=s.yminPreferred+(e[1]-s.yorigin)/s.yscale,t},t.toPanelMod=function(e){var t=[];return t[0]=0==s.xscale?0:e[0]/s.xscale,t[1]=0==s.yscale?0:e[1]/s.yscale,t},t.getPixelPositionWorldOrigin=function(){return[s.xorigin,s.yorigin]},t.recomputeScales=function(){var e=r.getWidth(),t=r.getHeight(),n=e/(s.xmaxPreferred-s.xminPreferred),i=t/(s.ymaxPreferred-s.yminPreferred);s.xscale=n,s.yscale=-i,s.xorigin=.5,s.yorigin=t+.5,u=!1},t.reset=function(){r.reset()},t.render=function(){var e=!1;o&&(r.reset(),e=!0,o=!1);for(var n=0,s=a.length;n<s;n++)a[n].dataCollected();u&&t.recomputeScales(),(l||e)&&r.drawPanel(t),r.draw(i,e),l=!1;for(n=0,s=i.length;n<s;n++)i[n].setChanged(!1)},t.registerProperties=function(e){EJSS_DRAWING2D.SimplePanel.registerProperties(t,e)},n.setLineColor("black"),n.setFillColor("rgb(239,239,255)"),n.setChangeListener((function(e){l=!0})),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Spring={DEF_RADIUS:.05,DEF_LOOPS:8,DEF_PPL:15,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setRadius(e.getRadius()),t.setSolenoid(e.getSolenoid()),t.setThinExtremes(e.getThinExtremes()),t.setLoops(e.getLoops()),t.setPointsPerLoop(e.getPointsPerLoop())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Radius",e.setRadius,e.getRadius),t.registerProperty("Solenoid",e.setSolenoid,e.getSolenoid),t.registerProperty("ThinExtremes",e.setThinExtremes,e.getThinExtremes),t.registerProperty("Loops",e.setLoops,e.getLoops),t.registerProperty("PointsPerLoop",e.setPointsPerLoop,e.getPointsPerLoop)}},EJSS_DRAWING2D.spring=function(e){var t,r,n=EJSS_DRAWING2D.element(e),i=EJSS_DRAWING2D.Spring.DEF_RADIUS,o=0,a=!0;return n.getClass=function(){return"ElementSpring"},n.setRadius=function(e){i!=e&&(i=e,n.setChanged(!0))},n.getRadius=function(){return i},n.setSolenoid=function(e){o!=e&&(o=e,n.setChanged(!0))},n.getSolenoid=function(){return o},n.setThinExtremes=function(e){a!=e&&(a=e,n.setChanged(!0))},n.getThinExtremes=function(){return a},n.setLoops=function(e){t!=e&&(t=e,n.setChanged(!0))},n.getLoops=function(){return t},n.setPointsPerLoop=function(e){r!=e&&(r=e,n.setChanged(!0))},n.getPointsPerLoop=function(){return r},n.registerProperties=function(e){EJSS_DRAWING2D.Spring.registerProperties(n,e)},n.copyTo=function(e){EJSS_DRAWING2D.Spring.copyTo(n,e)},n.setSize([.1,.1]),n.setLoops(EJSS_DRAWING2D.Spring.DEF_LOOPS),n.setPointsPerLoop(EJSS_DRAWING2D.Spring.DEF_PPL),n.setRelativePosition("SOUTH_WEST"),n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.SpringSet={registerProperties:function(e,t){EJSS_DRAWING2D.ElementSet.registerProperties(e,t),t.registerProperty("Radius",(function(t){e.setToEach((function(e,t){e.setRadius(t)}),t)})),t.registerProperty("Solenoid",(function(t){e.setToEach((function(e,t){e.setSolenoid(t)}),t)})),t.registerProperty("ThinExtremes",(function(t){e.setToEach((function(e,t){e.setThinExtremes(t)}),t)})),t.registerProperty("Loops",(function(t){e.setToEach((function(e,t){e.setLoops(t)}),t)})),t.registerProperty("PointsPerLoop",(function(t){e.setToEach((function(e,t){e.setPointsPerLoop(t)}),t)}))}},EJSS_DRAWING2D.springSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.spring,e),r=EJSS_DRAWING2D.SpringSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Tank={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("LevelColor",e.setLevelColor),t.registerProperty("Level",e.setLevel),t.registerProperty("Closed",e.setClosed)},copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setLevel(e.getLevel()),t.setLevelColor(e.getLevelColor())}},EJSS_DRAWING2D.tank=function(e){var t=EJSS_DRAWING2D.element(e),r=0,n="blue",i=EJSS_DRAWING2D.Tank;return t.getClass=function(){return"ElementTank"},t.setLevel=function(e){r=e,t.setChanged(!0)},t.getLevel=function(){return r},t.setLevelColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=n&&(n=e,t.setChanged(!0)),t},t.getLevelColor=function(){return n},t.registerProperties=function(e){i.registerProperties(t,e)},t.copyTo=function(e){i.copyTo(t,e)},t.setSize([.1,.1]),t.setRelativePosition("CENTER"),t.getStyle().setFillColor("White"),t.getStyle().setLineColor("Black"),t.getStyle().setDrawFill(!1),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Text={MODE_TOPDOWN:0,MODE_RIGTHLEFT:1,MODE_DOWNTOP:2,MODE_LEFTRIGHT:3,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),EJSS_DRAWING2D.Font.copyTo(e.getFont(),t.getFont()),t.setText(e.getText()),t.setWritingMode(e.getWritingMode())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Framed",e.setFramed),t.registerProperty("WritingMode",e.setWritingMode),t.registerProperty("Font",(function(t){e.setDrawingSize([-1,-1]),e.getFont().setFont(t)})),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",(function(t){e.setDrawingSize([-1,-1]),e.getFont().setFontSize(t)})),t.registerProperty("LetterSpacing",e.getFont().setLetterSpacing),t.registerProperty("OutlineColor",e.getFont().setOutlineColor),t.registerProperty("FontWeight",e.getFont().setFontWeight),t.registerProperty("FillColor",e.getFont().setFillColor),t.registerProperty("FontStyle",e.getFont().setFontStyle),t.registerProperty("MarginX",e.getMarginX().setMarginX),t.registerProperty("MarginY",e.getMarginY().setMarginY)}},EJSS_DRAWING2D.text=function(e){var t=EJSS_DRAWING2D.element(e),r="",n=EJSS_DRAWING2D.Text.MODE_LEFTRIGHT,i=EJSS_DRAWING2D.font(e),o=!1,a=0,s=0,l=[-1,-1];return t.getClass=function(){return"ElementText"},t.setText=function(e){r!=(e+="")&&(r=e,t.setChanged(!0),l=[-1,-1])},t.getText=function(){return r},t.setDrawingSize=function(e){l=e},t.getDrawingSize=function(){return l},t.getSizeX=function(){return l[0]},t.getSizeY=function(){return l[1]},t.setMarginX=function(e){a!=e&&(a=e,t.setChanged(!0))},t.getMarginX=function(){return a},t.setMarginY=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getMarginY=function(){return s},t.getFont=function(){return i},t.setFramed=function(e){o!=e&&(o=e,t.setChanged(!0))},t.getFramed=function(){return o},t.setWritingMode=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Text[e.toUpperCase()]),n!=e&&(n=e,t.setChanged(!0))},t.getWritingMode=function(){return n},t.registerProperties=function(e){EJSS_DRAWING2D.Text.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Text.copyTo(t,e)},i.setChangeListener((function(e){t.setChanged(!0)})),t.setPixelSize(!0),t},EJSS_DRAWING2D.TextSet={registerProperties:function(e,t){EJSS_DRAWING2D.ElementSet.registerProperties(e,t),t.registerProperty("Text",(function(t){e.setToEach((function(e,t){e.setText(t)}),t)})),t.registerProperty("Framed",(function(t){e.setToEach((function(e,t){e.setFramed(t)}),t)})),t.registerProperty("WritingMode",(function(t){e.setToEach((function(e,t){e.setWritingMode(t)}),t)})),t.registerProperty("Font",(function(t){e.setToEach((function(e,t){e.getFont().setFont(t)}),t)})),t.registerProperty("FontFamily",(function(t){e.setToEach((function(e,t){e.getFont().setFontFamily(t)}),t)})),t.registerProperty("FontSize",(function(t){e.setToEach((function(e,t){e.getFont().setFontSize(t)}),t)})),t.registerProperty("LetterSpacing",(function(t){e.setToEach((function(e,t){e.getFont().setLetterSpacing(t)}),t)})),t.registerProperty("OutlineColor",(function(t){e.setToEach((function(e,t){e.getFont().setOutlineColor(t)}),t)})),t.registerProperty("FontWeight",(function(t){e.setToEach((function(e,t){e.getFont().setFontWeight(t)}),t)})),t.registerProperty("FillColor",(function(t){e.setToEach((function(e,t){e.getFont().setFillColor(t)}),t)}))}},EJSS_DRAWING2D.textSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.text,e),r=EJSS_DRAWING2D.TextSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Trace={ELLIPSE:0,RECTANGLE:1,AREA:2,BAR:3,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),EJSS_DRAWING2D.Trail.copyTo(e,t),EJSS_DRAWING2D.Style.copyTo(e.getMarkStyle(),t.getMarkStyle()),t.setMarkType(e.getMarkType()),t.setMarkSize(e.getMarkSize())},registerProperties:function(e,t){EJSS_DRAWING2D.Trail.registerProperties(e,t),t.registerProperty("MarkType",e.setMarkType,e.getMarkType),t.registerProperty("MarkAxisY",e.setMarkAxisY,e.getMarkAxisY),t.registerProperty("MarkSize",e.setMarkSize,e.getMarkSize),t.registerProperty("MarkLineColor",e.getMarkStyle().setLineColor),t.registerProperty("MarkLineWidth",e.getMarkStyle().setLineWidth),t.registerProperty("MarkDrawLines",e.getMarkStyle().setDrawLines),t.registerProperty("MarkFillColor",e.getMarkStyle().setFillColor),t.registerProperty("MarkDrawFill",e.getMarkStyle().setDrawFill)}},EJSS_DRAWING2D.trace=function(e){var t=EJSS_DRAWING2D.trail(e),r=EJSS_DRAWING2D.Trace.ELLIPSE,n=EJSS_DRAWING2D.style(e),i=EJSS_DRAWING2D.Element.CENTER,o=0,a=0,s=0,l=[];return t.getClass=function(){return"ElementTrace"},t.setMarkStyleList=function(e){null==e?l=[]:Array.isArray(e)&&(l=e.slice(),t.setChanged(!0))},t.getMarkStyleList=function(){return l},t.setMarkRelativePosition=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Element[e.toUpperCase()]),i!=e&&(i=e,t.setChanged(!0))},t.getMarkRelativePosition=function(){return i},t.getMarkStyle=function(){return n},t.setMarkSize=function(e){o==e[0]&&a==e[1]||(o=e[0],a=e[1],t.setChanged(!0))},t.getMarkSize=function(){return[o,a]},t.setMarkType=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Trace[e.toUpperCase()]),r!=e&&(r=e,t.setChanged(!0))},t.getMarkType=function(){return r},t.setMarkAxisY=function(e){s!=e&&(s=e,t.setChanged(!0))},t.getMarkAxisY=function(){return s},t.formatPoint=function(e){var t=e.length;return e[t++]=r,e[t]=EJSS_DRAWING2D.style(),EJSS_DRAWING2D.Style.copyTo(n,e[t++]),e[t++]=o,e[t++]=a,e[t]=s,e},t.registerProperties=function(e){EJSS_DRAWING2D.Trace.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Trace.copyTo(t,e)},t},EJSS_DRAWING2D.TraceSet={registerProperties:function(e,t){EJSS_DRAWING2D.TrailSet.registerProperties(e,t),t.registerProperty("MarkType",(function(t){e.setToEach((function(e,t){e.setMarkType(t)}),t)})),t.registerProperty("MarkSize",(function(t){e.setToEach((function(e,t){e.setMarkSize(t)}),t)})),t.registerProperty("MarkLineColor",(function(t){e.setToEach((function(e,t){e.getMarkStyle().setLineColor(t)}),t)})),t.registerProperty("MarkLineWidth",(function(t){e.setToEach((function(e,t){e.getMarkStyle().setLineWidth(t)}),t)})),t.registerProperty("MarkDrawLines",(function(t){e.setToEach((function(e,t){e.getMarkStyle().setDrawLines(t)}),t)})),t.registerProperty("MarkFillColor",(function(t){e.setToEach((function(e,t){e.getMarkStyle().setFillColor(t)}),t)})),t.registerProperty("MarkDrawFill",(function(t){e.setToEach((function(e,t){e.getMarkStyle().setDrawFill(t)}),t)})),t.registerProperty("MarkRelativePosition",(function(t){e.setToEach((function(e,t){e.setMarkRelativePosition(t)}),t)}))}},EJSS_DRAWING2D.traceSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.trace,e),r=EJSS_DRAWING2D.TraceSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Trail={NO_CONNECTION:0,LINE_CONNECTION:1,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setActive(e.getActive()),t.setNoRepeat(e.getNoRepeat()),t.setClearAtInput(e.getClearAtInput()),t.setSkip(e.getSkip()),t.setInputLabels(e.getInputLabels()),t.setMaximumPoints(e.getMaximumPoints()),t.setConnectionType(e.getConnectionType()),t.setPoints(e.getPoints())},registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.getNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("ColumnNames",e.setInputLabels,e.getInputLabels),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("ConnectionType",e.setConnectionType,e.getConnectionType),t.registerProperty("Connected",e.setConnected,e.isConnected),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint),t.registerProperty("Input",e.addPoints),t.registerProperty("InputX",e.addXPoints),t.registerProperty("InputY",e.addYPoints)}},EJSS_DRAWING2D.trail=function(e){var t=EJSS_DRAWING2D.element(e),r=!0,n=!1,i=!1,o=0,a=["x","y"],s=0,l=EJSS_DRAWING2D.Trail.LINE_CONNECTION,u=0,g=0,c=0,S=[],f=[],E=[],d=[],p=0,h=0;function m(e,r,i){isNaN(e)||isNaN(r)?!0:n&&g[0]==e&&g[1]==r||(null==i&&(i=l),c=0,g=t.formatPoint([e,r,i]),o>0&&(u>0&&(c=t.formatPoint([e,r,i])),++u>=o&&(u=0)),0==c&&(s>2&&S.length>=s&&S.splice(0,1),S[S.length]=t.formatPoint([e,r,i]),!1))}return t.getClass=function(){return"ElementTrail"},t.setActive=function(e){r!=e&&(r=e,t.setChanged(!0))},t.getActive=function(){return r},t.setNoRepeat=function(e){n!=e&&(n=e,t.setChanged(!0))},t.getNoRepeat=function(){return n},t.setClearAtInput=function(e){i!=e&&(i=e,t.setChanged(!0))},t.getClearAtInput=function(){return i},t.setSkip=function(e){o!=e&&(o=e,u=0,t.setChanged(!0))},t.getSkip=function(){return o},t.setInputLabels=function(e){a[0]==e[0]&&a[1]==e[1]||(a[0]=e[0],a[1]=e[1],t.setChanged(!0))},t.getInputLabels=function(){return a},t.setMaximumPoints=function(e){var r=Math.max(e,2);s!=r&&(s=r,t.setChanged(!0))},t.getMaximumPoints=function(){return s},t.setConnected=function(e){e?t.setConnectionType(EJSS_DRAWING2D.Trail.LINE_CONNECTION):t.setConnectionType(EJSS_DRAWING2D.Trail.NO_CONNECTION)},t.isConnected=function(){return l===EJSS_DRAWING2D.Trail.LINE_CONNECTION},t.setConnectionType=function(e){"string"==typeof e&&(e=EJSS_DRAWING2D.Trail[e.toUpperCase()]),l!=e&&(l=e,t.setChanged(!0))},t.getConnectionType=function(){return l},t.addPoint=function(e,n,o){r&&(i&&t.initialize(),e instanceof Array?m(e[0],e[1],e[2]):m(e,n,o),t.setChanged(!0))},t.addPoints=function(e,n,o){if(r){if(i&&t.initialize(),void 0===o&&(o=Number.MAX_SAFE_INTEGER),null==n)if(e[0]instanceof Array)for(var a=0,s=Math.min(o,e.length);a<s;a++)m(e[a][0],e[a][1],e[a][2]);else m(e[0],e[1]);else for(a=0,s=Math.min(o,e.length,n.length);a<s;a++)m(e[a],n[a]);t.setChanged(!0)}},t.addXPoints=function(e){if(r){var t=0;if(e instanceof Array){for(var n=e.length;t<n;t++)d[t]?d[t]=[e[t],d[t][1],d[t][2]]:d[t]=[e[t],h,l];p=e[t]}else d[t]?d[t]=[e,d[t][1],d[t][2]]:d[t]=[e,h,l],t++,p=e;for(;d[t];)d[t]=[p,d[t][1],d[t][2]],t++}},t.addYPoints=function(e){if(r){var t=0;if(e instanceof Array){for(var n=e.length;t<n;t++)d[t]?d[t]=[d[t][0],e[t],d[t][2]]:d[t]=[p,e[t],l];h=e[t]}else d[t]?d[t]=[d[t][0],e,d[t][2]]:d[t]=[p,e,l],t++,h=e;for(;d[t];)d[t]=[d[t][0],h,d[t][2]],t++}},t.dataCollected=function(){d.length>0&&(t.addPoints(d),d=[],t.setChanged(!0))},t.setPoints=function(e,n){r&&(t.clear(),t.addPoints(e,n),t.setChanged(!0))},t.moveToPoint=function(e,n){r&&(i&&t.initialize(),e instanceof Array?m(e[0],e[1],EJSS_DRAWING2D.Trail.NO_CONNECTION):m(e,n,EJSS_DRAWING2D.Trail.NO_CONNECTION),t.setChanged(!0))},t.getSegmentsCount=function(){return f.length},t.getSegmentPoints=function(e){return f[e]},t.getSegmentStyle=function(e){return E[e]},t.getCurrentPoints=function(){return S},t.getPoints=function(){for(var e=[],t=f.length,r=0;r<t;r++)e=e.concat(f[r]);return e=e.concat(S)},t.getLastPoint=function(){return g},t.reset=function(){t.clear()},t.clear=function(){f=[],E=[],t.initialize()},t.clearLastSegment=function(){S.length<=0&&(f.pop(),E.pop(),t.setChanged(!0)),t.initialize()},t.initialize=function(){d=[],S=[],c=0,!0,u=0,g=0,t.setChanged(!0)},t.newSegment=function(){if(0!=c){var e=S.length;S[e]=t.formatPoint(c)}e=f.length;f[e]=S;var r=EJSS_DRAWING2D.style(t.getName()+" #"+e);EJSS_DRAWING2D.Style.copyTo(t.getStyle(),r),E[e]=r,t.initialize()},t.getBounds=function(e){var r,n,i,o,a=t.getPoints(),s=a.length;if(0==s)r=n=i=o=0;else{n=r=a[0][0],o=i=a[0][1];for(var l=1;l<s;l++){(u=a[l][0])>n&&(n=u),(g=a[l][1])>o&&(o=g),u<r&&(r=u),g<i&&(i=g)}}var u=t.getX(),g=t.getY(),c=t.getSizeX(),S=t.getSizeY(),f=c/2,E=S/2,d=t.getRelativePositionOffset(c,S);return{left:u+d[0]-f+r*c,right:u+d[0]-f+n*c,top:g+d[1]-E+o*S,bottom:g+d[1]-E+i*S}},t.formatPoint=function(e){return e},t.registerProperties=function(e){EJSS_DRAWING2D.Trail.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Trail.copyTo(t,e)},t.setSize([1,1]),t.setRelativePosition("SOUTH_WEST"),t},EJSS_DRAWING2D.TrailSet={registerProperties:function(e,t){EJSS_DRAWING2D.ElementSet.registerProperties(e,t),t.registerProperty("Active",(function(t){e.setToEach((function(e,t){e.setActive(t)}),t)})),t.registerProperty("NoRepeat",(function(t){e.setToEach((function(e,t){e.setNoRepeat(t)}),t)})),t.registerProperty("ClearAtInput",(function(t){e.setToEach((function(e,t){e.setClearAtInput(t)}),t)})),t.registerProperty("Skip",(function(t){e.setToEach((function(e,t){e.setSkip(t)}),t)})),t.registerProperty("ColumnNames",(function(t){e.setToEach((function(e,t){e.setInputLabels(t)}),t)})),t.registerProperty("Maximum",(function(t){e.setToEach((function(e,t){e.setMaximumPoints(t)}),t)})),t.registerProperty("ConnectionType",(function(t){e.setToEach((function(e,t){e.setConnectionType(t)}),t)})),t.registerProperty("Connected",(function(t){e.setToEach((function(e,t){e.setConnected(t)}),t)})),t.registerProperty("Points",(function(t){e.setToEach((function(e,t){e.setPoints(t)}),t)})),t.registerProperty("LastPoint",(function(t){e.setToEach((function(e,t){e.addPoint(t)}),t)})),t.registerProperty("Input",(function(t){e.setToEach((function(e,t){e.addPoints(t)}),t)})),t.registerProperty("InputX",(function(t){e.setToEach((function(e,t){e.addXPoints(t)}),t)})),t.registerProperty("InputY",(function(t){e.setToEach((function(e,t){e.addYPoints(t)}),t)}))}},EJSS_DRAWING2D.trailSet=function(e){var t=EJSS_DRAWING2D.elementSet(EJSS_DRAWING2D.trail,e),r=EJSS_DRAWING2D.TrailSet;return t.reset=function(){for(var e=t.getElements(),r=0,n=e.length;r<n;r++)e[r].reset()},t.initialize=function(){for(var e=t.getElements(),r=0,n=e.length;r<n;r++)e[r].initialize()},t.clear=function(){for(var e=t.getElements(),r=0,n=e.length;r<n;r++)e[r].clear()},t.newSegment=function(e){t.getElements()[e].newSegment()},t.moveToPoint=function(e,r,n){t.getElements()[e].moveToPoint(r,n)},t.addPoint=function(e,r,n,i){t.getElements()[e].addPoint(r,n,i)},t.addPoints=function(e,r,n){t.getElements()[e].addPoints(r,n)},t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.colorCoded=function(e,t){var r=EJSS_DRAWING2D.colorMapper(e,t),n=!1;return r.setSymmetricZ=function(e){n=e},r.isSymmetricZ=function(){return n},r.setAutoscale=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0,a=e.length;o<a;o++){var s=e[o];i=Math.max(i,s),t=Math.min(t,s)}var l=i,u=t;n&&(u=-(l=Math.max(Math.abs(t),Math.abs(i)))),r.setScale(u,l)},r.setAutoscaleArray2=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0,a=e.length;o<a;o++)for(var s=0,l=e[o].length;s<l;s++){var u=e[o][s];i=Math.max(i,u),t=Math.min(t,u)}var g=i,c=t;n&&(c=-(g=Math.max(Math.abs(t),Math.abs(i)))),r.setScale(c,g)},r.setAutoscaleArray3=function(e){for(var t=Number.MAX_VALUE,i=Number.MIN_VALUE,o=0,a=e.length;o<a;o++)for(var s=0,l=e[o].length;s<l;s++)for(var u=0,g=e[o][s].length;u<g;u++){var c=e[o][s][u];i=Math.max(i,c),t=Math.min(t,c)}var S=i,f=t;n&&(f=-(S=Math.max(Math.abs(t),Math.abs(i)))),r.setScale(f,S)},r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.ColorMapper={CUSTOM:-1,SPECTRUM:0,GRAYSCALE:1,DUALSHADE:2,RED:3,GREEN:4,BLUE:5,BLACK:6,WIREFRAME:7,NORENDER:8,REDBLUESHADE:9,toRGB:function(e){for(var t=[],r=0,n=e.length-4;r<n;r+=4){var i=e[r];t.push("rgb("+i[0]+","+i[1]+","+i[2]+")")}return t},getColorPalette:function(e,t){function r(e,t,r){var n={h:Math.round(360*e),s:t,b:r},i={r:0,g:0,b:0};if(0===n.s)return i.r=i.g=i.b=n.h,i;var o=Math.floor(n.h/60),a=n.h/60-o,s=n.b*(1-n.s),l=n.b*(1-a*n.s),u=n.b*(1-(1-a)*n.s);switch(o){case 0:i.r=n.b,i.g=u,i.b=s;break;case 1:i.r=l,i.g=n.b,i.b=s;break;case 2:i.r=s,i.g=n.b,i.b=u;break;case 3:i.r=s,i.g=l,i.b=n.b;break;case 4:i.r=u,i.g=s,i.b=n.b;break;case 5:i.r=n.b,i.g=s,i.b=l}return i.r=Math.round(255*i.r),i.g=Math.round(255*i.g),i.b=Math.round(255*i.b),i}var n=EJSS_DRAWING2D.ColorMapper,i=[];e<2&&(e=2);for(var o=0;o<e;o++){var a=o/(e-1)*.8,s=1,l=0,u=0,g=0;switch(t){case n.REDBLUESHADE:l=Math.floor(255*Math.max(0,-e-1+2*o)/(e-1)),g=Math.floor(255*Math.max(0,e-1-2*o)/(e-1)),i[o]=[l,u,g];break;case n.SPECTRUM:var c=r(a=.8-a,1,s);i[o]=[c.r,c.g,c.b];break;case n.GRAYSCALE:case n.BLACK:l=u=g=Math.floor(255*o/(e-1)),i[o]=[l,u,g];break;case n.RED:l=Math.floor(255*o/(e-1)),i[o]=[l,u,g];break;case n.GREEN:u=Math.floor(255*o/(e-1)),i[o]=[l,u,g];break;case n.BLUE:g=Math.floor(255*o/(e-1)),i[o]=[l,u,g];break;case n.DUALSHADE:default:var S=o/(e-1);c=r(a=.8*(1-S),1,s=.2+1.6*Math.abs(.5-S));i[o]=[c.r,c.g,c.b]}}return i}},EJSS_DRAWING2D.colorMapper=function(e,t){var r,n,i,o=EJSS_DRAWING2D.ColorMapper,a={},s=[],l="darkgray",u="lightgray",g=-1,c=1;return a.setChangeListener=function(e){r=e},a.setPaletteType=function(t){"string"==typeof t&&(t=EJSS_DRAWING2D.ColorMapper[t.toUpperCase()]),l="darkgray",u="lightgray",(n=t)!=EJSS_DRAWING2D.ColorMapper.GRAYSCALE&&n!=EJSS_DRAWING2D.ColorMapper.BLACK||(l="rgb(64,64,128)",u="rgb(255,191,191)"),e=Math.max(2,e),s=o.getColorPalette(e,n),r&&r("palette")},a.getColors=function(e){return void 0!==e&&e&&Array.isArray(s)?EJSS_DRAWING2D.ColorMapper.toRGB(s):s},a.getFloorColor=function(){return l},a.getCeilColor=function(){return u},a.getNumColors=function(){return e},a.setFloorCeilColor=function(e,t){l=e,u=t},a.setScale=function(e,t){g=e,c=t,i=new Array(s.length+1);for(var r=(c-g)/s.length,n=0,o=s.length;n<o;n++)i[n]=g+n*r;i[s.length]=c},a.getPaletteType=function(){return n},a.setColorPalette=function(t){l="darkgray",u="lightgray",s=t,e=t.length,n=EJSS_DRAWING2D.ColorMapper.CUSTOM,r&&r("colors")},a.setNumberOfColors=function(t){if(t!=e){if(e=t,n==EJSS_DRAWING2D.ColorMapper.CUSTOM){for(var i=[],o=0,s=Math.min(colors.length,e);o<s;o++)i[o]=colors[o];for(o=colors.length;o<numColors;o++)i[o]=colors[colors.length-1];colors=i}else a.setPaletteType(n);r&&r("numColors")}},a.getNumberOfColors=function(){return e},a.doubleToIndex=function(e){if(g-e>Number.MIN_VALUE)return-1;if(e-c>Number.MIN_VALUE)return s.length;var t=0;return c!=g&&(t=Math.floor(s.length*(e-g)/(c-g))),t=Math.max(0,t),Math.min(t,s.length-1)},a.indexToColor=function(e,t){if(e<0)return l;if(e>=s.length)return u;var r=s[e];return t&&Array.isArray(r)?"rgb("+r[0]+","+r[1]+","+r[2]+")":s[e]},a.doubleToColor=function(e,t){return a.indexToColor(a.doubleToIndex(e),t)},a.getColorThresholds=function(){return i},a.setPaletteType(t),a.setScale(-1,1),a};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Font={FONTSTYLES:["normal","italic","oblique","initial"],FONTWEIGHTS:["normal","lighter","bold","bolder","initial","100","200","300","400","500","600","700","800","900"],copyTo:function(e,t){t.setFontFamily(e.getFontFamily()),t.setFontSize(e.getFontSizeString()),t.setLetterSpacing(e.getLetterSpacing()),t.setOutlineColor(e.getOutlineColor()),t.setOutlineWidth(e.getOutlineWidth()),t.setFontWeight(e.getFontWeight()),t.setFillColor(e.getFillColor())}},EJSS_DRAWING2D.font=function(e){var t,r={},n="Arial",i="20",o="normal",a="none",s="1",l="normal",u="black",g="none";return r.setChangeListener=function(e){t=e},r.setFontFamily=function(e){n!=e&&(n=e,t&&t("fontFamily"))},r.getFontFamily=function(){return n},r.setFontSize=function(e){i!=e&&(i=e,t&&t("fontSize"))},r.getFontSize=function(){var e;if(isNaN(i))if(-1!=i.indexOf("em"))e=10*+i.substr(0,i.indexOf("em"));else if(-1!=i.indexOf("px"))e=+i.substr(0,i.indexOf("px"));else if(-1!=i.indexOf("vh")){e=Math.max(document.documentElement.clientHeight,window.innerHeight||0)/100*+i.substr(0,i.indexOf("vh"))}else if(-1!=i.indexOf("vw")){e=Math.max(document.documentElement.clientWidth,window.innerWidth||0)/100*+i.substr(0,i.indexOf("vw"))}else e=0;else e=+i;return e},r.getFontSizeString=function(){return i},r.setLetterSpacing=function(e){o!=e&&(o=e,t&&t("letterSpacing"))},r.getLetterSpacing=function(){return o},r.getNumberLetterSpacing=function(){return isNaN(o)?-1!=o.indexOf("px")?+o.substr(0,o.indexOf("px")):1:+o},r.setOutlineColor=function(e){a!=e&&(a=e,t&&t("lineColor"))},r.getOutlineColor=function(){return a},r.setOutlineWidth=function(e){s!=e&&(s=e,t&&t("lineWidth"))},r.getOutlineWidth=function(){return s},r.setFontWeight=function(e){e=e.toLowerCase(),l!=e&&EJSS_DRAWING2D.Font.FONTWEIGHTS.indexOf(e)>-1&&(l=e,t&&t("fontWeight"))},r.getFontWeight=function(){return l},r.setFillColor=function(e){u!=e&&(u=e,t&&t("fillColor"))},r.getFillColor=function(){return u},r.setFontStyle=function(e){e=e.toLowerCase(),g!=e&&EJSS_DRAWING2D.Font.FONTSTYLES.indexOf(e)>-1&&(g=e,t&&t("fontstyle"))},r.getFontStyle=function(){return g},r.getFont=function(){return g+" "+s+" "+i+" "+n},r.setFont=function(e){if(!("string"!=typeof e||e.length<=0)){var t=e.split(" ");g=t[0],l=t[1];var r=t[2].split("/");i=r[0],t[3]&&(n=e.substring(e.indexOf(t[3])))}},r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.functionsParser=function(){var e={};function t(e){function t(){}return t.prototype=e,new t}function r(e,t,r,n){this.type_=e,this.index_=t||0,this.prio_=r||0,this.number_=null!=n?n:0,this.toString=function(){switch(this.type_){case 0:return this.number_;case 1:case 2:case 3:return this.index_;case 4:return"CALL";default:return"Invalid Token"}}}function n(e,t,r,n){this.tokens=e,this.ops1=t,this.ops2=r,this.functions=n}var i=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function a(e){return"string"==typeof e?(i.lastIndex=0,i.test(e)?"'"+e.replace(i,(function(e){var t=o[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}))+"'":"'"+e+"'"):e}function s(e,t){return Number(e)+Number(t)}function l(e,t){return e-t}function u(e,t){return e*t}function g(e,t){return e/t}function c(e,t){return e%t}function S(e,t){return""+e+t}function f(e){return-e}function E(e){return Math.random()*(e||1)}function d(e){for(var t=e=Math.floor(e);e>1;)t*=--e;return t}function p(e,t){return Math.sqrt(e*e+t*t)}function h(e,t,r){return e?t:r}function m(e){return e<0?0:1}function A(e,t){return"[object Array]"!=Object.prototype.toString.call(e)?[e,t]:((e=e.slice()).push(t),e)}function _(e,t){return e>t?1:0}function D(e,t){return e<t?1:0}function I(e,t){return e==t?1:0}function P(e,t){return e!=t?1:0}function C(){this.success=!1,this.errormsg="",this.expression="",this.pos=0,this.tokennumber=0,this.tokenprio=0,this.tokenindex=0,this.tmpprio=0,this.ops1={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,"-":f,neg:f,exp:Math.exp},this.ops2={"+":s,"-":l,"*":u,"/":g,"%":c,"^":Math.pow,",":A,"||":S,">":_,"<":D,"==":I,"!=":P},this.functions={random:E,fac:d,min:Math.min,max:Math.max,pyt:p,step:m,pow:Math.pow,atan2:Math.atan2,if:h},this.consts={E:Math.E,pi:Math.PI,PI:Math.PI}}n.prototype={simplify:function(e){e=e||{};var i,o,a,s=[],l=[],u=this.tokens.length,g=0;for(g=0;g<u;g++){var c=(a=this.tokens[g]).type_;if(0===c)s.push(a);else if(3===c&&a.index_ in e)a=new r(0,0,0,e[a.index_]),s.push(a);else if(2===c&&s.length>1)o=s.pop(),i=s.pop(),a=new r(0,0,0,(0,this.ops2[a.index_])(i.number_,o.number_)),s.push(a);else if(1===c&&s.length>0)i=s.pop(),a=new r(0,0,0,(0,this.ops1[a.index_])(i.number_)),s.push(a);else{for(;s.length>0;)l.push(s.shift());l.push(a)}}for(;s.length>0;)l.push(s.shift());return new n(l,t(this.ops1),t(this.ops2),t(this.functions))},substitute:function(e,i){i instanceof n||(i=(new C).parse(String(i)));var o,a=[],s=this.tokens.length,l=0;for(l=0;l<s;l++){if(3===(o=this.tokens[l]).type_&&o.index_===e)for(var u=0;u<i.tokens.length;u++){var g=i.tokens[u],c=new r(g.type_,g.index_,g.prio_,g.number_);a.push(c)}else a.push(o)}return new n(a,t(this.ops1),t(this.ops2),t(this.functions))},evaluate:function(e){e=e||{};var t,r,n,i,o=[],a=this.tokens.length,s=0;for(s=0;s<a;s++){var l=(i=this.tokens[s]).type_;if(0===l)o.push(i.number_);else if(2===l)r=o.pop(),t=o.pop(),n=this.ops2[i.index_],o.push(n(t,r));else if(3===l)if(i.index_ in e)o.push(e[i.index_]);else{if(!(i.index_ in this.functions))throw new Error("undefined variable: "+i.index_);o.push(this.functions[i.index_])}else if(1===l)t=o.pop(),n=this.ops1[i.index_],o.push(n(t));else{if(4!==l)throw new Error("invalid Expression");if(t=o.pop(),!(n=o.pop()).apply||!n.call)throw new Error(n+" is not a function");"[object Array]"==Object.prototype.toString.call(t)?o.push(n.apply(void 0,t)):o.push(n.call(void 0,t))}}if(o.length>1)throw new Error("invalid Expression (parity)");return o[0]},toString:function(e){var t,r,n,i,o=[],s=this.tokens.length,l=0;for(l=0;l<s;l++){var u=(i=this.tokens[l]).type_;if(0===u)o.push(a(i.number_));else if(2===u)r=o.pop(),t=o.pop(),n=i.index_,e&&"^"==n?o.push("Math.pow("+t+","+r+")"):o.push("("+t+n+r+")");else if(3===u)o.push(i.index_);else if(1===u)t=o.pop(),"-"===(n=i.index_)?o.push("("+n+t+")"):o.push(n+"("+t+")");else{if(4!==u)throw new Error("invalid Expression");t=o.pop(),n=o.pop(),o.push(n+"("+t+")")}}if(o.length>1)throw new Error("invalid Expression (parity)");return o[0]},variables:function(){for(var e=this.tokens.length,t=[],r=0;r<e;r++){var n=this.tokens[r];3===n.type_&&-1==t.indexOf(n.index_)&&t.push(n.index_)}return t},toJSFunction:function(e,t){return new Function(e,"with(Parser.values) { return "+this.simplify(t).toString(!0)+"; }")}},e.parse=function(e){return(new C).parse(e)},e.evaluate=function(e,t){return C.parse(e).evaluate(t)},C.Expression=n,C.values={sign:Math.sign,sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:E,fac:d,exp:Math.exp,min:Math.min,max:Math.max,pyt:p,ifelse:h,step:m,pow:Math.pow,atan2:Math.atan2,E:Math.E,pi:Math.PI,PI:Math.PI};return C.prototype={parse:function(e){this.errormsg="",this.success=!0;var i=[],o=[];this.tmpprio=0;var a=77,s=0;for(this.expression=e,this.pos=0;this.pos<this.expression.length;)if(this.isOperator())this.isSign()&&64&a?(this.isNegativeSign()&&(this.tokenprio=2,this.tokenindex="-",s++,this.addfunc(o,i,1)),a=77):this.isComment()||(0==(2&a)&&this.error_parsing(this.pos,"unexpected operator"),s+=2,this.addfunc(o,i,2),a=77);else if(this.isNumber()){0==(1&a)&&this.error_parsing(this.pos,"unexpected number");var l=new r(0,0,0,this.tokennumber);o.push(l),a=50}else if(this.isString()){0==(1&a)&&this.error_parsing(this.pos,"unexpected string");l=new r(0,0,0,this.tokennumber);o.push(l),a=50}else if(this.isLeftParenth())0==(8&a)&&this.error_parsing(this.pos,'unexpected "("'),128&a&&(s+=2,this.tokenprio=-2,this.tokenindex=-1,this.addfunc(o,i,4)),a=333;else if(this.isRightParenth()){if(256&a){l=new r(0,0,0,[]);o.push(l)}else 0==(16&a)&&this.error_parsing(this.pos,'unexpected ")"');a=186}else if(this.isComma())0==(32&a)&&this.error_parsing(this.pos,'unexpected ","'),this.addfunc(o,i,2),s+=2,a=77;else if(this.isConst()){0==(1&a)&&this.error_parsing(this.pos,"unexpected constant");var u=new r(0,0,0,this.tokennumber);o.push(u),a=50}else if(this.isOp2())0==(4&a)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(o,i,2),s+=2,a=8;else if(this.isOp1())0==(4&a)&&this.error_parsing(this.pos,"unexpected function"),this.addfunc(o,i,1),s++,a=8;else if(this.isVar()){0==(1&a)&&this.error_parsing(this.pos,"unexpected variable");var g=new r(3,this.tokenindex,0,0);o.push(g),a=186}else this.isWhite()||(""===this.errormsg?this.error_parsing(this.pos,"unknown character"):this.error_parsing(this.pos,this.errormsg));for((this.tmpprio<0||this.tmpprio>=10)&&this.error_parsing(this.pos,'unmatched "()"');i.length>0;){var c=i.pop();o.push(c)}return s+1!==o.length&&this.error_parsing(this.pos,"parity"),new n(o,t(this.ops1),t(this.ops2),t(this.functions))},evaluate:function(e,t){return this.parse(e).evaluate(t)},error_parsing:function(e,t){throw this.success=!1,this.errormsg="parse error [column "+e+"]: "+t,new Error(this.errormsg)},addfunc:function(e,t,n){for(var i=new r(n,this.tokenindex,this.tokenprio+this.tmpprio,0);t.length>0&&i.prio_<=t[t.length-1].prio_;)e.push(t.pop());t.push(i)},isNumber:function(){for(var e=!1,t="";this.pos<this.expression.length;){var r=this.expression.charCodeAt(this.pos);if(!(r>=48&&r<=57||46===r))break;t+=this.expression.charAt(this.pos),this.pos++,this.tokennumber=parseFloat(t),e=!0}return e},unescape:function(e,t){for(var r=[],n=!1,i=0;i<e.length;i++){var o=e.charAt(i);if(n){switch(o){case"'":r.push("'");break;case"\\":r.push("\\");break;case"/":r.push("/");break;case"b":r.push("\b");break;case"f":r.push("\f");break;case"n":r.push("\n");break;case"r":r.push("\r");break;case"t":r.push("\t");break;case"u":var a=parseInt(e.substring(i+1,i+5),16);r.push(String.fromCharCode(a)),i+=4;break;default:throw this.error_parsing(t+i,"Illegal escape sequence: '\\"+o+"'")}n=!1}else"\\"==o?n=!0:r.push(o)}return r.join("")},isString:function(){var e=!1,t="",r=this.pos;if(this.pos<this.expression.length&&"'"==this.expression.charAt(this.pos))for(this.pos++;this.pos<this.expression.length;){if("'"==this.expression.charAt(this.pos)&&"\\"!=t.slice(-1)){this.pos++,this.tokennumber=this.unescape(t,r),e=!0;break}t+=this.expression.charAt(this.pos),this.pos++}return e},isConst:function(){for(var e in this.consts){var t=e.length;if(e===this.expression.substr(this.pos,t))return this.tokennumber=this.consts[e],this.pos+=t,!0}return!1},isOperator:function(){var e=this.expression.charCodeAt(this.pos);if(43===e)this.tokenprio=0,this.tokenindex="+";else if(45===e)this.tokenprio=0,this.tokenindex="-";else if(124===e){if(124!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="||"}else if(61===e){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="=="}else if(33===e){if(61!==this.expression.charCodeAt(this.pos+1))return!1;this.pos++,this.tokenprio=0,this.tokenindex="!="}else if(42===e)this.tokenprio=1,this.tokenindex="*";else if(47===e)this.tokenprio=2,this.tokenindex="/";else if(37===e)this.tokenprio=2,this.tokenindex="%";else if(94===e)this.tokenprio=3,this.tokenindex="^";else if(60===e)this.tokenprio=2,this.tokenindex="<";else{if(62!==e)return!1;this.tokenprio=2,this.tokenindex=">"}return this.pos++,!0},isSign:function(){var e=this.expression.charCodeAt(this.pos-1);return 45===e||43===e},isPositiveSign:function(){return 43===this.expression.charCodeAt(this.pos-1)},isNegativeSign:function(){return 45===this.expression.charCodeAt(this.pos-1)},isLeftParenth:function(){return 40===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio+=10,!0)},isRightParenth:function(){return 41===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tmpprio-=10,!0)},isComma:function(){return 44===this.expression.charCodeAt(this.pos)&&(this.pos++,this.tokenprio=-1,this.tokenindex=",",!0)},isWhite:function(){var e=this.expression.charCodeAt(this.pos);return(32===e||9===e||10===e||13===e)&&(this.pos++,!0)},isOp1:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!=r&&(r<"0"||r>"9")))break;e+=r}return e.length>0&&e in this.ops1&&(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0)},isOp2:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!=r&&(r<"0"||r>"9")))break;e+=r}return e.length>0&&e in this.ops2&&(this.tokenindex=e,this.tokenprio=5,this.pos+=e.length,!0)},isVar:function(){for(var e="",t=this.pos;t<this.expression.length;t++){var r=this.expression.charAt(t);if(r.toUpperCase()===r.toLowerCase()&&(t===this.pos||"_"!=r&&(r<"0"||r>"9")))break;e+=r}return e.length>0&&(this.tokenindex=e,this.tokenprio=4,this.pos+=e.length,!0)},isComment:function(){return 47===this.expression.charCodeAt(this.pos-1)&&42===this.expression.charCodeAt(this.pos)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)}},e};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.InteractionTarget={ENABLED_FIXED:0,ENABLED_NONE:0,ENABLED_ANY:1,ENABLED_X:2,ENABLED_Y:3,ENABLED_NO_MOVE:4,SENSITIVITY_BOTH:0,SENSITIVITY_HORIZONTAL:1,SENSITIVITY_VERTICAL:2,SENSITIVITY_ANY:3,copyTo:function(e,t){t.setMotionEnabled(e.getMotionEnabled()),t.setAffectsGroup(e.getAffectsGroup()),t.setActionCommand(e.getActionCommand()),t.setDataObject(e.getDataObject()),t.setSensitivity(e.getSensitivity())}},EJSS_DRAWING2D.interactionTarget=function(e,t,r){var n=EJSS_DRAWING2D.InteractionTarget,i={},o=EJSS_DRAWING2D.Element,a=n.ENABLED_NONE,s=!1,l=null,u=null,g=20,c=n.SENSITIVITY_BOTH;return i.getElement=function(){return e},i.getType=function(){return t},i.setMotionEnabled=function(e){"string"==typeof e?(value=n[e.toUpperCase()],a="undefined"==typeof value?n.ENABLED_NONE:value):a=e},i.getMotionEnabled=function(){return a},i.setSensitivityType=function(e){c="string"==typeof e?n[e.toUpperCase()]:e},i.getSensitivityType=function(){return c},i.isEnabled=function(){return a!=n.ENABLED_NONE},i.setPositionOffset=function(e){r=e},i.getPositionOffset=function(){return r},i.getPixelPosition=function(){var t=e.getPixelPosition(!0),n=e.getPixelSizes(!0),i=e.getRelativePositionOffset(n),a=t[0]+i[0],s=t[1]+i[1],l=e.getPanel().getInvertedScaleY(),u=o.getRelativePositionOffset(r,n[0],n[1],l);return[a-u[0],s-u[1]]},i.getPosition=function(){var t=e.getAbsolutePosition(!0),n=e.getAbsoluteSize(),i=e.getPanel().getInvertedScaleY(),a=o.getRelativePositionOffset(r,n[0],n[1],i),s=e.getRelativePositionOffset(n);return[t[0]+s[0]-a[0],t[1]+s[1]-a[1]]},i.setAffectsGroup=function(e){s=e},i.getAffectsGroup=function(){return s},i.setSensitivity=function(e){g=e},i.getSensitivity=function(){return g},i.setActionCommand=function(e){l=e},i.getActionCommand=function(){return l},i.setDataObject=function(e){u=e},i.getDataObject=function(){return u},i};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.PanelInteraction={TARGET_POSITION:0,TARGET_SIZE:1},EJSS_DRAWING2D.panelInteraction=function(e){var t={},r=EJSS_DRAWING2D.PanelInteraction,n=!1,i=!1,o=!1,a=[],s=[],l=[],u=null,g=!1,c=!1,S=0,f=0,E=[0,0],d=[0,0],p=0,h="move",m=0;function A(t,r,n,i){var o=EJSS_DRAWING2D.InteractionTarget,a=EJSS_DRAWING2D.PanelInteraction;if(r.getType()===a.TARGET_POSITION){var s=n[0]-i[0],l=n[1]-i[1];switch(r.getMotionEnabled()){case o.ENABLED_ANY:t.setX(t.getX()+s),t.setY(t.getY()+l),t.getController().propertiesChanged("Position","X","Y"),r.getElement().setChanged(!0),t.setChanged(!0);break;case o.ENABLED_X:t.setX(t.getX()+s),t.getController().propertiesChanged("Position","X"),r.getElement().setChanged(!0),t.setChanged(!0);break;case o.ENABLED_Y:t.setY(t.getY()+l),t.getController().propertiesChanged("Position","Y"),r.getElement().setChanged(!0),t.setChanged(!0)}}else if(r.getType()===a.TARGET_SIZE){if(2==f){var u=e.toPanelMod(d);s=u[0],l=-u[1]}else s=n[0]-i[0],l=n[1]-i[1];var g=r.getElement().getAbsoluteSize();0===g[0]&&(g[0]=1e-5),0===g[1]&&(g[1]=1e-5);var c=[s/g[0],l/g[1]],S=t.getSize();switch(0===S[0]&&0!==c[0]&&(S[0]=1e-5),0===S[1]&&0!==c[0]&&(S[1]=1e-5),r.getMotionEnabled()){case o.ENABLED_ANY:t.setSizeX(S[0]+S[0]*c[0]),t.setSizeY(S[1]+S[1]*c[1]),t.getController().propertiesChanged("Size","SizeX","SizeY"),r.getElement().setChanged(!0),t.setChanged(!0);break;case o.ENABLED_X:t.setSizeX(S[0]+S[0]*c[0]),t.getController().propertiesChanged("Size","SizeX"),r.getElement().setChanged(!0),t.setChanged(!0);break;case o.ENABLED_Y:t.setSizeY(S[1]+S[1]*c[1]),t.getController().propertiesChanged("Size","SizeY"),r.getElement().setChanged(!0),t.setChanged(!0)}}}function _(t){var r=e.getGraphics().getBox(),n=r.left,i=r.top,o=[];if(void 0!==t.changedTouches)for(var a=0;a<t.changedTouches.length;a++)o[a]=[],o[a][0]=t.changedTouches[a].clientX-n,o[a][1]=t.changedTouches[a].clientY-i;else o[0]=[],o[0][0]=(t.clientX||t.x)-n,o[0][1]=(t.clientY||t.y)-i;return o}t.reload=function(){a=[],s=[],l=[],u=null,c=!1,S=0,f=0,E=[0,0],d=[0,0],p=0,m=0,n=!n,t.setEnabled(!n),i=!i,t.setStopGestures(!i)},t.getPanel=function(){return e},t.getEnabled=function(){return n},t.setStopMoveEvents=function(e){o!=e&&((o=e)?t.setHandler("move",(function(){return!0})):t.setHandler("move",t.handleMouseMoveEvent))},t.setStopGestures=function(e){i!=e&&((i=e)?(t.setHandler("gesturestart",(function(e){return e.preventDefault(),e.stopPropagation(),!1})),t.setHandler("gesturechange",(function(e){return e.preventDefault(),e.stopPropagation(),!1})),t.setHandler("gestureend",(function(e){return e.preventDefault(),e.stopPropagation(),!1}))):(t.setHandler("gesturestart",(function(){return!0})),t.setHandler("gesturechange",(function(){return!0})),t.setHandler("gestureend",(function(){return!0}))))},t.setEnabled=function(e){n!=e&&((n=e)?(o||t.setHandler("move",t.handleMouseMoveEvent),t.setHandler("down",t.handleMouseDownEvent),t.setHandler("up",t.handleMouseUpEvent),t.setHandler("mousewheel",t.handleMouseWheelEvent)):(t.setHandler("move",(function(){return!0})),t.setHandler("down",(function(){return!0})),t.setHandler("up",(function(){return!0})),t.setHandler("mousewheel",(function(){return!0}))))},t.setCursorTypeForMove=function(e){h=e},t.getInteractionPoint=function(){return e.toPanelPosition(a)},t.getInteractionDistance=function(){if(0==l.length||0==a.length)return[];var t=e.toPanelPosition(l),r=e.toPanelPosition(a);return[t[0]-r[0],t[1]-r[1]]},t.getInteractionBounds=function(){if(0==s.length||0==a.length)return[];var t=e.toPanelPosition(s),r=e.toPanelPosition(a);return[t[0],r[0],t[1],r[1]]},t.getInteractionZoomDelta=function(){return 0==p&&0==d[0]?0:p>0||d[0]>0?1:-1},t.getInteractionElement=function(){return u},t.clearInteractionElement=function(e){u&&e===u.getElement()&&(u=null)},t.getOrientation=function(){return window.orientation},t.handleMouseMoveEvent=function(r){if(i&&(r.preventDefault(),r.stopPropagation()),2==(void 0!==r.touches?r.touches.length:1)){var o=r.touches[0],s=r.touches[1],S=o.clientX||o.x,p=o.clientY||o.y,m=s.clientX||s.x,D=s.clientY||s.y;if(0!=f){var I=[Math.abs(S-m),Math.abs(p-D)],P=[E[0]-I[0],E[1]-I[1]];P[0]<8&&P[0]>-8&&P[1]<8&&P[1]>-8?d=[0,0]:(d=P,E=I)}else f=1,E=[Math.abs(S-m),Math.abs(p-D)],d=[0,0]}else f=0,E=[0,0];var C=_(r);if(l=a,a=C[C.length-1],c)if(null!=u){var T=u.getElement();if(u.getAffectsGroup()){var y=T.getGroup();null!=y&&(T=y)}var R=e.toPanelPosition(a),N=e.toPanelPosition(l);A(T,u,R,N),T.getController().invokeAction("OnDrag"),n&&e.getController().invokeAction("OnMove")}else if(g)n&&e.getController().invokeAction("OnDrag");else{for(var v=[],O=0;O<C.length;O++){var M;if(null!=(M=t.findInteractionTarget(e.getElements(),C[O])))v.push(M),A(T=M.getAffectsGroup()?M.getElement().getGroup():M.getElement(),M,R=e.toPanelPosition(C[O]),M.getPosition()),T.getController().invokeAction("OnDrag"),n&&e.getController().invokeAction("OnMove")}n&&(0==f?e.getController().invokeAction("OnDrag"):1==f&&0==v.length&&e.getController().invokeAction("OnZoom"))}else null===(M=t.findInteractionTarget(e.getElements(),C[0]))?(null!=u&&u.getElement().getController().invokeAction("OnExit"),n&&e.getController().invokeAction("OnMove"),r.target.style.cursor="default"):(u!=M&&(null!=u&&u.getElement().getController().invokeAction("OnExit"),M.getElement().getController().invokeAction("OnEnter")),M.isEnabled()?r.target.style.cursor=h:r.target.style.cursor="default"),u=M;return e.getController().reportInteractions(),!1},t.handleMouseDownEvent=function(r){c=!0,o&&t.setHandler("move",t.handleMouseMoveEvent),i&&(r.preventDefault(),r.stopPropagation());var S=void 0!==r.touches?r.touches.length:1;2!=S&&(f=0);var E=_(r);s=E[0],l=s,a=E[E.length-1];for(var d=!1,p=null,m=0;m<E.length;m++)null!==(p=t.findInteractionTarget(e.getElements(),E[m]))?(p.getElement().getController().invokeAction("OnPress"),r.target.style.cursor=h):n&&(e.getController().invokeAction("OnPress"),d=!0);return 1==E.length&&1==S?(u=p,g=d):(u=null,g=!1),e.getController().reportInteractions(),!1},t.handleMouseUpEvent=function(r){c=!1,o&&t.setHandler("move",(function(){return!0})),i&&(r.preventDefault(),r.stopPropagation()),0!=f&&(f=0,d=[0,0],E=[0,0]);var s=_(r);l=a,a=s[s.length-1];var g=r.timeStamp-S<500;if(null!=u)u.getElement().getController().invokeAction("OnRelease"),g&&u.getElement().getController().invokeAction("OnDoubleClick");else for(var p=0;p<s.length;p++){var h=t.findInteractionTarget(e.getElements(),s[p]);null!==h?(h.getElement().getController().invokeAction("OnRelease"),g&&h.getElement().getController().invokeAction("OnDoubleClick")):n&&(e.getController().invokeAction("OnRelease"),g&&e.getController().invokeAction("OnDoubleClick"))}return S=r.timeStamp,r.target.style.cursor="default",e.getController().reportInteractions(),!1},t.handleMouseWheelEvent=function(t){0==(void 0!==t.touches?t.touches.length:0)&&(i&&(t.preventDefault(),t.stopPropagation()),p=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),e.getController().invokeAction("OnZoom"),e.getController().reportInteractions())},t.findInteractionTarget=function(n,i){for(var o=EJSS_DRAWING2D.InteractionTarget,a=null,s=n.length-1;s>=0;s--){var l=n[s];if(l.isGroupVisible())if(l.getElements){if(null!==(a=t.findInteractionTarget(l.getElements(),i)))return a}else{for(var u=l.getInteractionTargets(),g=0;g<u.length;g++)if(u[g].isEnabled()){var c=u[g].getSensitivity();if(c>0){var S=u[g].getPixelPosition(),E=!1;switch(u[g].getSensitivityType()){case o.SENSITIVITY_HORIZONTAL:E=Math.abs(S[1]-i[1])<c;break;case o.SENSITIVITY_VERTICAL:E=Math.abs(S[0]-i[0])<c;break;case o.SENSITIVITY_ANY:E=Math.abs(S[0]-i[0])<c||Math.abs(S[1]-i[1])<c;break;default:E=Math.abs(S[0]-i[0])<c&&Math.abs(S[1]-i[1])<c}if(E)return m=s,u[g]}}if(0!=f&&(a=l.getInteractionTarget(r.TARGET_SIZE)).isEnabled()&&!a.getSensitivity()){var d=l.getAbsoluteBounds(),p=e.toPanelPosition(i);if(d.left<p[0]&&d.right>p[0]&&d.bottom<p[1]&&d.top>p[1])return m=s,f=2,a}if((a=l.getInteractionTarget(r.TARGET_POSITION)).isEnabled()&&!a.getSensitivity()){d=l.getAbsoluteBounds(),p=e.toPanelPosition(i);if(d.left<p[0]&&d.right>p[0]&&d.bottom<p[1]&&d.top>p[1])return m=s,a}}}return null},t.getIndexElement=function(){return m},t.setHandler=function(t,r){var n=e.getGraphics().getEventContext();switch(t){case"move":n.addEventListener("mousemove",r,!1),n.addEventListener("touchmove",r,!1);break;case"down":n.addEventListener("mousedown",r,!1),n.addEventListener("touchstart",r,!1);break;case"up":n.addEventListener("mouseup",r,!1),n.addEventListener("touchend",r,!1);break;case"mousewheel":n.addEventListener("mousewheel",r,!1);break;case"gesturestart":n.addEventListener("gesturestart",r,!1);break;case"gesturechange":n.addEventListener("gesturechange",r,!1);break;case"gestureend":n.addEventListener("gestureend",r,!1)}return!1};var D=window.onorientationchange;window.onorientationchange=function(){D&&D(),e.getController().invokeAction("OnOrientationChange"),e.getController().reportInteractions()};var I=window.onresize;return window.onresize=function(){I&&I(),e.getController().invokeAction("OnResize"),e.getController().reportInteractions()},t.setStopGestures(!0),t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Style={RENDER_AUTO:"auto",RENDER_OPTSPEED:"optimizeSpeed",RENDER_CRISPEDGES:"crispEdges",RENDER_GEOPRECISION:"geometricPrecision",copyTo:function(e,t){t.setDrawLines(e.getDrawLines()),t.setLineColor(e.getLineColor()),t.setLineWidth(e.getLineWidth()),t.setDrawFill(e.getDrawFill()),t.setFillColor(e.getFillColor()),t.setAttributes(e.getAttributes()),t.setShapeRendering(e.getShapeRendering())}},EJSS_DRAWING2D.style=function(e){var t,r=EJSS_DRAWING2D.Style,n={},i=!0,o="black",a=.5,s=!0,l="none",u=r.RENDER_AUTO,g={};return n.setChangeListener=function(e){t=e},n.setDrawLines=function(e){e!=i&&(i=e,t&&t("drawlines"))},n.getDrawLines=function(){return i},n.setLineColor=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=o&&(o=e,t&&t("linecolor")),n},n.getLineColor=function(){return o},n.setLineWidth=function(e){e!=a&&(a=e,t&&t("linewidth"))},n.getLineWidth=function(){return a},n.setDrawFill=function(e){e!=s&&(s=e,t&&t("drawfill"))},n.getDrawFill=function(){return s},n.setFillColor=function(e){"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=l&&(l=e,t&&t("fillcolor"))},n.getFillColor=function(){return l},n.setShapeRendering=function(e){"RENDER"==e.substring(0,6)&&(e=r[e.toUpperCase()]),u!=e&&(u=e,t&&t("shaperendering"))},n.getShapeRendering=function(){return u},n.setAttributes=function(e){e!=g&&(g=e,t&&t("attributes"))},n.getAttributes=function(){return g},n.serialize=function(){return{mDrawLines:i,mLineColor:o,mLineWidth:a,mDrawFill:s,mFillColor:l,mShapeRendering:u,mAttributes:g}},n.unserialize=function(e){i=e.mDrawLines,o=e.mLineColor,a=e.mLineWidth,s=e.mDrawFill,l=e.mFillColor,u=e.mShapeRendering,g=e.mAttributes},n};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Transformation={compare:function(e,t){return e.radians==t.radians&&e.a==t.a&&e.b==t.b&&e.c==t.c&&e.d==t.d&&e.e==t.e&&e.f==t.f}},EJSS_DRAWING2D.transformation=function(e){var t={a:(e=e||{a:1,b:0,c:0,d:1,e:0,f:0}).a,c:e.c,e:e.e,b:e.b,d:e.d,f:e.f,radians:0,toString:function(){return"a="+t.a+", c="+t.c+", e="+t.e+"\nb="+t.b+", d="+t.d+", f="+t.f},setToIdentity:function(){t.a=1,t.c=0,t.e=0,t.b=0,t.d=1,t.f=0,radians=0},setTransform:function(e){Array.isArray(e)&&e.length>5?(t.a=e[0],t.c=e[2],t.e=e[4],t.b=e[1],t.d=e[3],t.f=e[5]):(t.a=e.a,t.c=e.c,t.e=e.e,t.b=e.b,t.d=e.d,t.f=e.f,t.radians=e.radians)},setToTranslation:function(e,r){t.a=1,t.c=0,t.e=e,t.b=0,t.d=1,t.f=r},setToRotation:function(e){var r=Math.cos(e),n=Math.sin(e);t.a=r,t.c=-n,t.e=0,t.b=n,t.d=r,t.f=0,t.radians=e},getRotation:function(){return t.radians},translate:function(e,r){t.e+=e,t.f+=r},scale:function(e,r){t.a*=e,t.b*=e,t.c*=r,t.d*=r},concatenate:function(e){var r=t.a,n=t.b,i=t.c,o=t.d,a=t.e,s=t.f;t.a=r*e.a+i*e.b,t.b=n*e.a+o*e.b,t.c=r*e.c+i*e.d,t.d=n*e.c+o*e.d,t.e=r*e.e+i*e.f+a,t.f=n*e.e+o*e.f+s,t.radians+=e.radians},transform:function(e){var r=e[0],n=e[1];return e[0]=t.a*r+t.c*n+t.e,e[1]=t.b*r+t.d*n+t.f,e},transformVector:function(e){var r=e[0],n=e[1];return e[0]=t.a*r+t.c*n,e[1]=t.b*r+t.d*n,e},inverseTransform:function(e){var r=t.a,n=t.b,i=t.c,o=t.d,a=t.e,s=t.f,l=r*o-n*i;if(0===l)return null;var u=e[0],g=e[1];return e[0]=(o*u-i*g+(i*s-o*a))/l,e[1]=(-n*u+r*g+(n*a-r*s))/l,e}};return t};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.Video={registerProperties:function(e,t){EJSS_DRAWING2D.Element.registerProperties(e,t),t.registerProperty("VideoUrl",e.setVideoUrl),t.registerProperty("CurrentTime",e.setCurrentTime),t.registerProperty("ShowControls",e.setControls),t.registerProperty("AutoPlay",e.setAutoPlay),t.registerProperty("Type",e.setType),t.registerProperty("Poster",e.setPoster),t.registerProperty("Loop",e.setLoop),t.registerProperty("WebCam",e.setWebCam)}},EJSS_DRAWING2D.video=function(e){var t,r=EJSS_DRAWING2D.element(e),n=!1,i=!1,o="",a="",s=!0,l=0,u=!0,g=!0;return r.getClass=function(){return"ElementVideo"},r.setLoop=function(e){n!=e&&(n=e,r.setChanged(!0))},r.getLoop=function(){return n},r.setPoster=function(e){a!=e&&(a=e,r.setChanged(!0))},r.getPoster=function(){return a},r.setType=function(e){o!=e&&(o=e,r.setChanged(!0))},r.getType=function(){return o},r.setAutoPlay=function(e){s!=e&&(s=e,g=e,r.setChanged(!0))},r.getAutoPlay=function(){return s},r.setWebCam=function(e){i!=e&&(i=e,r.setChanged(!0))},r.getWebCam=function(){return i},r.setVideoUrl=function(e){t!=e&&(t=e,r.setChanged(!0))},r.getVideoUrl=function(){return t},r.setCurrentTime=function(e){l!=e&&(l=e,r.setChanged(!0))},r.getCurrentTime=function(){return l},r.setControls=function(e){u!=e&&(u=e,r.setChanged(!0))},r.getControls=function(){return u},r.play=function(){g||(g=!0,r.setChanged(!0))},r.stop=function(){g&&(g=!1,s=!1,r.setChanged(!0))},r.isPlay=function(){return g},r.registerProperties=function(e){EJSS_DRAWING2D.Video.registerProperties(r,e)},r};var EJSS_DRAWING2D=EJSS_DRAWING2D||{};EJSS_DRAWING2D.WebCamImage={registerProperties:function(e,t){EJSS_DRAWING2D.Image.registerProperties(e,t),t.registerProperty("Url",e.setUrl),t.registerProperty("On",e.setOnOff,e.isOnOff)}},EJSS_DRAWING2D.webCamImage=function(e){var t=EJSS_DRAWING2D.image(e);navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;var r,n,i=!0;return t.setUrl=function(e){r=e},t.getUrl=function(){return r},t.setOnOff=function(e){e?i||t.play():i&&t.pause()},t.isOnOff=function(){return i},t.play=function(){r&&r!=t.getImageUrl()&&(n=t.getImageUrl(),"local:"==r?navigator.getUserMedia?navigator.getUserMedia({video:!0},(function(e){t.forceImageUrl(e)}),errorCallback):t.setImageUrl(n):t.setImageUrl(r)),i=!0},t.pause=function(){i=!1,n&&t.setImageUrl(n)},t.registerProperties=function(e){EJSS_DRAWING2D.WebCamImage.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.AnalyticCurve={registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("NumPoints",e.setNumPoints),t.registerProperty("MinValue",e.setMinValue),t.registerProperty("MaxValue",e.setMaxValue),t.registerProperty("Variable",e.setVariable),t.registerProperty("FunctionX",e.setExpressionX),t.registerProperty("FunctionY",e.setExpressionY),t.registerProperty("FunctionZ",e.setExpressionZ)}},EJSS_DRAWING3D.analyticCurve=function(e){var t=EJSS_DRAWING3D.element(e),r=EJSS_DRAWING2D.functionsParser(),n="t",i="t",o="0",a=screen.width/10,s=0,l=0,u="t";return t.getClass=function(){return"ElementAnalyticCurve"},t.setNumPoints=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.setMinValue=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.setMaxValue=function(e){l!=e&&(l=e,t.setMeshChanged(!0))},t.setVariable=function(e){u!=e&&(u=e,t.setMeshChanged(!0))},t.setExpressionX=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.setExpressionY=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.setExpressionZ=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getNumPoints=function(){return a},t.getMinValue=function(){return s},t.getMaxValue=function(){return l},t.getVariable=function(){return u},t.getExpressionX=function(){return r.parse(n)},t.getExpressionY=function(){return r.parse(i)},t.getExpressionZ=function(){return r.parse(o)},t.registerProperties=function(e){EJSS_DRAWING3D.AnalyticCurve.registerProperties(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!1),t.getStyle().setDrawLines(!0),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.AnalyticSurface={registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("NumPoints1",e.setNumPoints1),t.registerProperty("MinValue1",e.setMinValue1),t.registerProperty("MaxValue1",e.setMaxValue1),t.registerProperty("Variable1",e.setVariable1),t.registerProperty("NumPoints2",e.setNumPoints2),t.registerProperty("MinValue2",e.setMinValue2),t.registerProperty("MaxValue2",e.setMaxValue2),t.registerProperty("Variable2",e.setVariable2),t.registerProperty("FunctionX",e.setExpressionX),t.registerProperty("FunctionY",e.setExpressionY),t.registerProperty("FunctionZ",e.setExpressionZ)}},EJSS_DRAWING3D.analyticSurface=function(e){var t=EJSS_DRAWING3D.element(e),r=EJSS_DRAWING2D.functionsParser(),n="u",i="v",o="0",a=100,s=0,l=0,u="u",g=100,c=0,S=0,f="v";return t.getClass=function(){return"ElementAnalyticSurface"},t.setNumPoints1=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.setMinValue1=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.setMaxValue1=function(e){l!=e&&(l=e,t.setMeshChanged(!0))},t.setVariable1=function(e){u!=e&&(u=e,t.setMeshChanged(!0))},t.setNumPoints2=function(e){g!=e&&(g=e,t.setMeshChanged(!0))},t.setMinValue2=function(e){c!=e&&(c=e,t.setMeshChanged(!0))},t.setMaxValue2=function(e){S!=e&&(S=e,t.setMeshChanged(!0))},t.setVariable2=function(e){f!=e&&(f=e,t.setMeshChanged(!0))},t.setExpressionX=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.setExpressionY=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.setExpressionZ=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getNumPoints1=function(){return a},t.getMinValue1=function(){return s},t.getMaxValue1=function(){return l},t.getVariable1=function(){return u},t.getNumPoints2=function(){return g},t.getMinValue2=function(){return c},t.getMaxValue2=function(){return S},t.getVariable2=function(){return f},t.getExpressionX=function(){return r.parse(n)},t.getExpressionY=function(){return r.parse(i)},t.getExpressionZ=function(){return r.parse(o)},t.registerProperties=function(e){EJSS_DRAWING3D.AnalyticSurface.registerProperties(t,e)},t.setSize([1,1,1]),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Arrow={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setHeadHeight(e.getHeadHeight()),t.setHeadWidth(e.getHeadWidth()),t.setLineWidth(e.getLineWidth())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("HeadHeight",e.setHeadHeight),t.registerProperty("HeadWidth",e.setHeadWidth),t.registerProperty("LineWidth",e.setLineWidth,e.getLineWidth)}},EJSS_DRAWING3D.arrow=function(e){var t=EJSS_DRAWING3D.element(e),r=0,n=0,i=0,o=1,a=1,s=1,l=8,u=20,g=.01;return t.getClass=function(){return"ElementArrow"},t.setHeadHeight=function(e){l!=e&&(l=e,t.setMeshChanged(!0))},t.getHeadHeight=function(){return l},t.setHeadWidth=function(e){u!=e&&(u=e,t.setMeshChanged(!0))},t.getHeadWidth=function(){return u},t.setX=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getX=function(){return r},t.setY=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getY=function(){return n},t.setZ=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getZ=function(){return i},t.setPosition=function(e){t.setX(e[0]),t.setY(e[1]),t.setZ(e[2])},t.getPosition=function(){return[r,n,i]},t.setSizeX=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.setSizeY=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.setSizeZ=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.getSizeX=function(){return o},t.getSizeY=function(){return a},t.getSizeZ=function(){return s},t.setSize=function(e){t.setSizeX(e[0]),t.setSizeY(e[1]),t.setSizeZ(e[2])},t.getSize=function(){return[t.getSizeX(),t.getSizeY(),t.getSizeZ()]},t.setLineWidth=function(e){e!=g&&(g=e,t.setMeshChanged(!0))},t.getLineWidth=function(){return g},t.registerProperties=function(e){EJSS_DRAWING3D.Arrow.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Arrow.copyTo(t,e)},t.getStyle().setDrawFill(!0),t.getStyle().setDrawLines(!1),t.setResolution([10,2]),t},EJSS_DRAWING3D.ArrowSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t),t.registerProperty("HeadHeight",(function(t){e.setToEach((function(e,t){e.setHeadHeight(t)}),t)})),t.registerProperty("HeadWidth",(function(t){e.setToEach((function(e,t){e.setHeadWidth(t)}),t)})),t.registerProperty("LineWidth",(function(t){e.setToEach((function(e,t){e.setLineWidth(t)}),t)}))}},EJSS_DRAWING3D.arrowSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.arrow,e),r=EJSS_DRAWING3D.ArrowSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Basic={object_files:{},copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setVertices(e.getVertices()),t.setTriangles(e.getTriangles()),t.setNormals(e.getNormals()),t.setColors(e.getColors())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Description",e.setDescription),t.registerProperty("Vertices",e.setVertices),t.registerProperty("Triangles",e.setTriangles),t.registerProperty("Normals",e.setNormals),t.registerProperty("Colors",e.setColors)}},EJSS_DRAWING3D.basic=function(e){var t=EJSS_DRAWING3D.element(e),r=[],n=[],i=[],o=[];return t.getClass=function(){return"ElementBasic"},t.setDescription=function(e){var r=t.getPanel();if(r&&r.supportsWebGL())if("string"!=typeof e)e.vertices&&t.setVertices(e.vertices),e.triangles&&t.setTriangles(e.triangles),e.normals&&t.setNormals(e.normals),e.colors&&t.setColors(e.colors);else{var n="Object3D_"+EJSS_TOOLS.File.plainName(e);t.setDescription(window[n])}},t.setVertices=function(e){EJSS_TOOLS.compareArrays(r,e)||(r=e.slice(),t.setMeshChanged(!0))},t.getVertices=function(){return r},t.setTriangles=function(e){EJSS_TOOLS.compareArrays(n,e)||(n=e.slice(),t.setMeshChanged(!0))},t.getTriangles=function(){return n},t.setNormals=function(e){EJSS_TOOLS.compareArrays(i,e)||(i=e.slice(),t.setMeshChanged(!0))},t.getNormals=function(){return i},t.setColors=function(e){EJSS_TOOLS.compareArrays(o,e)||(o=e.slice(),t.setMeshChanged(!0))},t.getColors=function(){return o},t.registerProperties=function(e){EJSS_DRAWING3D.Basic.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Basic.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.BasicSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t),t.registerProperty("Description",(function(t){e.setToEach((function(e,t){e.setDescription(t)}),t)})),t.registerProperty("Vertices",(function(t){e.setToEach((function(e,t){e.setVertices(t)}),t)})),t.registerProperty("Triangles",(function(t){e.setToEach((function(e,t){e.setTriangles(t)}),t)})),t.registerProperty("Normals",(function(t){e.setToEach((function(e,t){e.setNormals(t)}),t)})),t.registerProperty("Colors",(function(t){e.setToEach((function(e,t){e.setColors(t)}),t)}))}},EJSS_DRAWING3D.basicSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.basic,e),r=EJSS_DRAWING3D.BasicSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Box={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setReduceZby(e.getReduceZby())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("ReduceZby",e.setReduceZby)}},EJSS_DRAWING3D.box=function(e){var t=EJSS_DRAWING3D.element(e),r=0;return t.getClass=function(){return"ElementBox"},t.setReduceZby=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getReduceZby=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Box.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Box.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.BoxSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t),t.registerProperty("ReduceZby",(function(t){e.setToEach((function(e,t){e.setReduceZby(t)}),t)}))}},EJSS_DRAWING3D.boxSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.box,e),r=EJSS_DRAWING3D.BoxSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Cone={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Cylinder.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Cylinder.registerProperties(e,t)}},EJSS_DRAWING3D.cone=function(e){var t=EJSS_DRAWING3D.cylinder(e);return t.getClass=function(){return"ElementCone"},t.registerProperties=function(e){EJSS_DRAWING3D.Cone.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Cone.copyTo(t,e)},t.setSize([1,1,1]),t.setTopRadius(0),t},EJSS_DRAWING3D.ConeSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t)}},EJSS_DRAWING3D.coneSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.cone,e),r=EJSS_DRAWING3D.ConeSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Cylinder={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setBottomRadius(e.getBottomRadius()),t.setTopRadius(e.getTopRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("BottomRadius",e.setBottomRadius),t.registerProperty("TopRadius",e.setTopRadius),t.registerProperty("MinAngleU",e.setMinAngleU),t.registerProperty("MaxAngleU",e.setMaxAngleU)}},EJSS_DRAWING3D.cylinder=function(e){var t=EJSS_DRAWING3D.element(e),r=0,n=360,i=1,o=1;return t.getClass=function(){return"ElementCylinder"},t.setOriginAndEnd=function(e,r){var n=(e[0]+r[0])/2,i=(e[1]+r[1])/2,o=(e[2]+r[2])/2,a=r[0]-e[0],s=r[1]-e[1],l=r[2]-e[2],u=Math.sqrt(a*a+s*s+l*l),g=Math.acos(l/u);t.setPosition([n,i,o]),t.setSizeZ(u),t.setFirstTransformation([[g,-s,a,0,n,i,o]])},t.setMinAngleU=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getMinAngleU=function(){return r},t.setMaxAngleU=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getMaxAngleU=function(){return n},t.setBottomRadius=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getBottomRadius=function(){return o},t.setTopRadius=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getTopRadius=function(){return i},t.registerProperties=function(e){EJSS_DRAWING3D.Cylinder.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Cylinder.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.CylinderSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t),t.registerProperty("MinAngleU",(function(t){e.setToEach((function(e,t){e.setMinAngleU(t)}),t)})),t.registerProperty("MaxAngleU",(function(t){e.setToEach((function(e,t){e.setMaxAngleU(t)}),t)})),t.registerProperty("BottomRadius",(function(t){e.setToEach((function(e,t){e.setBottomRadius(t)}),t)})),t.registerProperty("TopRadius",(function(t){e.setToEach((function(e,t){e.setTopRadius(t)}),t)}))}},EJSS_DRAWING3D.cylinderSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.cylinder,e),r=EJSS_DRAWING3D.CylinderSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Disk={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Cylinder.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Cylinder.registerProperties(e,t),t.registerProperty("Size",(function(t){t[2]=Math.min(t[0],t[1])/1e3,e.setSize(t)})),t.registerProperty("SizeX",(function(t){var r=e.getSizeY();e.setSizeZ(Math.min(r,t)/1e3),e.setSizeX(t)})),t.registerProperty("SizeY",(function(t){var r=e.getSizeX();e.setSizeZ(Math.min(t,r)/1e3),e.setSizeY(t)}))}},EJSS_DRAWING3D.disk=function(e){var t=EJSS_DRAWING3D.cylinder(e);return t.getClass=function(){return"ElementDisk"},t.registerProperties=function(e){EJSS_DRAWING3D.Disk.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Disk.copyTo(t,e)},t.setSize([1,1,.001]),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.DrawingPanel={GRAPHICS3D_WEBGL:"WebGL",registerProperties:function(e,t){e.setController(t),t.registerProperty("MinimumX",e.setWorldXMin,e.getWorldXMin),t.registerProperty("MaximumX",e.setWorldXMax,e.getWorldXMax),t.registerProperty("MinimumY",e.setWorldYMin,e.getWorldYMin),t.registerProperty("MaximumY",e.setWorldYMax,e.getWorldYMax),t.registerProperty("MinimumZ",e.setWorldZMin,e.getWorldZMin),t.registerProperty("MaximumZ",e.setWorldZMax,e.getWorldZMax),t.registerProperty("Bounds",e.setWorldCoordinates,e.getWorldCoordinates),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("SizeZ",e.setSizeZ,e.getSizeZ),t.registerProperty("CameraAzimuth",e.setCamAzimuth,e.getCamAzimuth),t.registerProperty("CameraAltitude",e.setCamAltitude,e.getCamAltitude),t.registerProperty("CameraTilt",e.setCamTilt,e.getCamTilt),t.registerProperty("CameraX",e.setCamLocX,e.getCamLocX),t.registerProperty("CameraY",e.setCamLocY,e.getCamLocY),t.registerProperty("CameraZ",e.setCamLocZ,e.getCamLocZ),t.registerProperty("CameraLocation",e.setCamLoc,e.getCamLoc),t.registerProperty("CameraFocusX",e.setCamFocusX,e.getCamFocusX),t.registerProperty("CameraFocusY",e.setCamFocusY,e.getCamFocusY),t.registerProperty("CameraFocusZ",e.setCamFocusZ,e.getCamFocusZ),t.registerProperty("CameraFocus",e.setCamFocus,e.getCamFocus),t.registerProperty("CameraUpVectorX",e.setCamUpVectorX,e.getCamUpVectorX),t.registerProperty("CameraUpVectorY",e.setCamUpVectorY,e.getCamUpVectorY),t.registerProperty("CameraUpVectorZ",e.setCamUpVectorZ,e.getCamUpVectorZ),t.registerProperty("CameraUpVector",e.setCamUpVector,e.getCamUpVector),t.registerProperty("CameraZoomRate",e.setZoomRate,e.getZoomRate),t.registerProperty("CameraNear",e.setNear,e.getNear),t.registerProperty("CameraFar",e.setFar,e.getFar),t.registerProperty("Projection",e.setProjection,e.getProjection),t.registerProperty("Perspective",e.setFOV,e.getFOV),t.registerProperty("FieldOfView",e.setFOV,e.getFOV),t.registerProperty("Lights",e.setLights,e.getLights),t.registerProperty("DecorationType",e.setDecorationType),t.registerProperty("VisibleDecorationBox",e.setVisibleDecorationBox),t.registerProperty("VisibleDecorationAxis",e.setVisibleDecorationAxis),t.registerProperty("VisibleDecorationBasicAxis",e.setVisibleDecorationBasicAxis),t.registerProperty("Parent",e.getGraphics().setParent,e.getGraphics().getParent),t.registerProperty("ClassName",e.getGraphics().setClassName),t.registerProperty("Width",e.getGraphics().setWidth,e.getGraphics().getWidth),t.registerProperty("Height",e.getGraphics().setHeight,e.getGraphics().getHeight),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("Graphics",e.setGraphics),t.registerProperty("Enabled",e.setEnabled),t.registerProperty("Draggable",e.setDraggable),t.registerProperty("Background",e.getStyle().setFillColor),t.registerProperty("Foreground",e.getGraphics().getStyle().setBorderColor),t.registerProperty("LineColor",e.getGraphics().getStyle().setBorderColor),t.registerProperty("LineWidth",e.getGraphics().getStyle().setBorderWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("DrawFill",e.getStyle().setDrawFill),t.registerProperty("Visibility",e.getGraphics().getStyle().setVisibility),t.registerProperty("Display",e.getGraphics().getStyle().setDisplay),t.registerProperty("CSS",e.getGraphics().getStyle().setCSS),t.registerAction("OnDoubleClick",e.getInteraction().getInteractionPoint),t.registerAction("OnMove",e.getInteraction().getInteractionPoint),t.registerAction("OnPress",e.getInteraction().getInteractionPoint),t.registerAction("OnDrag",e.getInteraction().getInteractionPoint,e.getOnDragHandler),t.registerAction("OnRelease",e.getInteraction().getInteractionBounds),t.registerAction("OnZoom",e.getInteraction().getZoomDelta,e.getOnZoomHandler)}},EJSS_DRAWING3D.drawingPanel=function(e){var t,r={},n=EJSS_GRAPHICS.webGLGraphics(e),i=EJSS_DRAWING3D.style(e),o=[],a=[],s=!0,l=1,u=!1,g=[],c={xminPreferred:-1,xmaxPreferred:1,yminPreferred:-1,ymaxPreferred:1,zminPreferred:-1,zmaxPreferred:1},S=!0,f=1.1,E={location:new Vector(4,0,0),focus:new Vector(0,0,0),upvector:new Vector(0,0,1),azimuth:0,altitude:0,tilt:0,delta:0},d=45,p=1,h=1e4,m=!1,A=4,_=1,D=1,I=1,P=[[1,2,3]],C=!0,T=!0,y={propertiesChanged:function(){},invokeAction:function(){}};r.getName=function(){return e},r.getGraphics=function(){return n},r.supportsWebGL=function(){return n.supportsWebGL()},r.getStyle=function(){return i},r.setGraphics=function(t){t==EJSS_DRAWING3D.DrawingPanel.GRAPHICS3D_WEBGL?n=EJSS_GRAPHICS.webGLGraphics(e):console.log("WARNING: setGraphics() - Graphics not supported")},r.setWorldXMin=function(e){e!==c.xminPreferred&&(c.xminPreferred=e,T=!0)},r.getWorldXMin=function(){return c.xminPreferred},r.setWorldXMax=function(e){e!==c.xmaxPreferred&&(c.xmaxPreferred=e,T=!0)},r.getWorldXMax=function(){return c.xmaxPreferred},r.setWorldYMin=function(e){e!==c.yminPreferred&&(c.yminPreferred=e,T=!0)},r.getWorldYMin=function(){return c.yminPreferred},r.setWorldYMax=function(e){e!==c.ymaxPreferred&&(c.ymaxPreferred=e,T=!0)},r.getWorldYMax=function(){return c.ymaxPreferred},r.setWorldZMin=function(e){e!==c.zminPreferred&&(c.zminPreferred=e,T=!0)},r.getWorldZMin=function(){return c.zminPreferred},r.setWorldZMax=function(e){e!==c.zmaxPreferred&&(c.zmaxPreferred=e,T=!0)},r.getWorldZMax=function(){return c.zmaxPreferred},r.setWorldCoordinates=function(e){r.setWorldXMin(e[0]),r.setWorldXMax(e[1]),r.setWorldYMin(e[2]),r.setWorldYMax(e[3]),r.setWorldZMin(e[4]),r.setWorldZMax(e[5])},r.getWorldCoordinates=function(){return[r.getWorldXMin(),r.getWorldXMax(),r.getWorldYMin(),r.getWorldYMax(),r.getWorldZMin(),r.getWorldZMax()]},r.getCamLocX=function(){return E.location.getx()},r.getCamLocY=function(){return E.location.gety()},r.getCamLocZ=function(){return E.location.getz()},r.getCamLoc=function(){return E.location.toArray()},r.setCamLocX=function(e){E.location.getx()!=e&&(E.location.setx(e),!0),S=!1},r.setCamLocY=function(e){E.location.gety()!=e&&(E.location.sety(e),!0),S=!1},r.setCamLocZ=function(e){E.location.getz()!=e&&(E.location.setz(e),!0),S=!1},r.setCamLoc=function(e){r.setCamLocX(e[0]),r.setCamLocY(e[1]),r.setCamLocZ(e[2])},r.setCamTilt=function(e){E.tilt!=e&&(E.tilt=e,!0)},r.getCamTilt=function(){return E.tilt},r.setCamAzimuth=function(e){E.azimuth!=e&&(E.azimuth=e,!0)},r.getCamAzimuth=function(){return E.azimuth},r.setCamAltitude=function(e){E.altitude!=e&&(E.altitude=e,!0)},r.getCamAltitude=function(){return E.altitude},r.getCamFocusX=function(){return E.focus.getx()},r.getCamFocusY=function(){return E.focus.gety()},r.getCamFocusZ=function(){return E.focus.getz()},r.getCamFocus=function(){E.focus.toArray()},r.setCamFocusX=function(e){E.focus.getx()!=e&&(E.focus.setx(e),!0),S=!1},r.setCamFocusY=function(e){E.focus.gety()!=e&&(E.focus.sety(e),!0),S=!1},r.setCamFocusZ=function(e){E.focus.getz()!=e&&(E.focus.setz(e),!0),S=!1},r.setCamFocus=function(e){r.setCamFocusX(e[0]),r.setCamFocusY(e[1]),r.setCamFocusZ(e[2])},r.getCamUpVectorX=function(){return E.upvector.getx()},r.getCamUpVectorY=function(){return E.upvector.gety()},r.getCamUpVectorZ=function(){return E.upvector.getz()},r.getCamUpVector=function(){E.upvector.toArray()},r.setCamUpVectorX=function(e){E.upvector.getx()!=e&&(E.upvector.setx(e),!0)},r.setCamUpVectorY=function(e){E.upvector.gety()!=e&&(E.upvector.sety(e),!0)},r.setCamUpVectorZ=function(e){E.upvector.getz()!=e&&(E.upvector.setz(e),!0)},r.setCamUpVector=function(e){r.setCamUpVectorX(e[0]),r.setCamUpVectorY(e[1]),r.setCamUpVectorZ(e[2])},r.getAutoCamera=function(){return S},r.setAutoCamera=function(e){S!=e&&(S=e,!0)},r.getZoomRate=function(){return f},r.setZoomRate=function(e){f=e},r.setLights=function(e){P=e},r.getLights=function(){return P},r.setSizeX=function(e){_!==e&&(_=e,T=!0)},r.getSizeX=function(){return _},r.setSizeY=function(e){D!==e&&(D=e,T=!0)},r.getSizeY=function(){return D},r.setSizeZ=function(e){I!==e&&(I=e,T=!0)},r.getSizeZ=function(){return I},r.setSize=function(e){r.setSizeX(e[0]),r.setSizeY(e[1]),r.setSizeZ(e[2])},r.getSize=function(){return[r.getSizeX(),r.getSizeY(),r.getSizeZ()]},r.setImageUrl=function(e){u=!0,null!=r.getResourcePath?e=r.getResourcePath(e):console.log("No getResourcePath function for panel. Texture = "+e),r.getGraphics().getStyle().setBackgroundImage(e)},r.isImageUrl=function(){return u},r.addDecoration=function(e,t){return EJSS_TOOLS.addToArray(o,e,t),e.setPanel&&e.setPanel(r),r},r.removeDecoration=function(e){return EJSS_TOOLS.removeFromArray(o,e),e.setPanel&&e.setPanel(null),r},r.setVisibleDecorationBasicAxis=function(e){M.setVisible(e),b.setVisible(e),G.setVisible(e)},r.setVisibleDecorationAxis=function(e){N.setVisible(e),v.setVisible(e),O.setVisible(e)},r.setVisibleDecorationBox=function(e){R.setVisible(e)},r.setDecorationType=function(e){if("string"==typeof e)switch(e){default:case"NONE":e=0;break;case"AXES":e=1;break;case"CUBE":e=2;break;case"CENTERED_AXES":e=3}switch(e){case 0:r.setVisibleDecorationBox(!1),r.setVisibleDecorationBasicAxis(!1),r.setVisibleDecorationAxis(!1);break;case 1:r.setVisibleDecorationBox(!1),r.setVisibleDecorationBasicAxis(!1),r.setVisibleDecorationAxis(!0);break;default:case 2:r.setVisibleDecorationBox(!0),r.setVisibleDecorationBasicAxis(!1),r.setVisibleDecorationAxis(!1);break;case 3:r.setVisibleDecorationBox(!1),r.setVisibleDecorationBasicAxis(!0),r.setVisibleDecorationAxis(!1)}},r.addElement=function(e,t){EJSS_TOOLS.addToArray(a,e,t),e.setPanel(r),e.dataCollected&&g.push(e),s=!0},r.removeElement=function(e){EJSS_TOOLS.removeFromArray(a,e),e.setPanel(null),e.dataCollected&&EJSS_TOOLS.removeFromArray(g,e),s=!0},r.getElements=function(){return a},r.indexOfElement=function(e){return a.indexOf(e)},r.getProjection=function(){return A},r.setProjection=function(e){if("string"==typeof e)switch(e){case"PLANAR_XY":e=0;break;case"PLANAR_XZ":e=1;break;case"PLANAR_YZ":e=2;break;case"PERSPECTIVE_OFF":e=3;break;default:case"PERSPECTIVE_ON":e=4}if(A!=e){switch(e){case 0:A=0,r.setOrthographic(!0),r.setCamUpVector([0,1,0]),r.setCamAzimuth(0),r.setCamAltitude(0),r.setCamTilt(0);break;case 1:A=1,r.setOrthographic(!0),r.setCamUpVector([0,0,-1]),r.setCamAzimuth(0),r.setCamAltitude(0),r.setCamTilt(0);break;case 2:A=2,r.setOrthographic(!0),r.setCamUpVector([0,1,0]),r.setCamAzimuth(0),r.setCamAltitude(0),r.setCamTilt(0);break;case 3:A=3,r.setOrthographic(!0),r.setCamUpVector([0,0,1]),r.setCamAzimuth(0),r.setCamAltitude(0),r.setCamTilt(0);break;default:case 4:A=4,r.setOrthographic(!1),r.setCamUpVector([0,0,1]),r.setCamAzimuth(0),r.setCamAltitude(0),r.setCamTilt(0)}T=!0}},r.getOrthographic=function(){return m},r.setOrthographic=function(e){m!==e&&(m=e,T=!0)},r.getFOV=function(){return d},r.setFOV=function(e){d!==e&&(d=e,T=!0)},r.getFar=function(){return h},r.setFar=function(e){h!==e&&(h=e,T=!0)},r.getNear=function(){return p},r.setNear=function(e){p!==e&&(p=e,T=!0)},r.reset=function(){var e={};if(m){var t=n.getAspect(),r=new Vector(_,D,I),i=new Vector(c.xminPreferred,c.yminPreferred,c.zminPreferred).multiply(r),o=new Vector(c.xmaxPreferred,c.ymaxPreferred,c.zmaxPreferred).multiply(r).subtract(i);switch(A){case 0:if((l=o.y/o.x*t)>=1)var a=o.x*l/2,s=o.y/2;else a=o.x/2,s=o.y*(1/l-1)/2;break;case 1:if((l=o.z/o.x*t)>=1)a=o.x*l/2,s=o.z/2;else a=o.x/2,s=o.z*(1/l-1)/2;break;case 2:if((l=o.y/o.z*t)>=1)a=o.z*l/2,s=o.y/2;else a=o.z/2,s=o.y*(1/l-1)/2;break;default:var l;if((l=o.z/o.y*t)>=1)a=o.y*l/2,s=o.z/2;else a=o.y/2,s=o.z*(1/l-1)/2}e={left:1.1*-a,right:1.1*a,bottom:1.1*-s,top:1.1*s}}n.reset(m,e,d,p,h)},r.render=function(){(s||T)&&r.reset();for(var e=0,t=g.length;e<t;e++)g[e].dataCollected();if((C||s)&&n.drawPanel(r),T){for(e=0,t=o.length;e<t;e++)o[e].panelChangeListener&&o[e].panelChangeListener("bounds");if(S){var i=new Vector(_,D,I),l=new Vector(c.xminPreferred,c.yminPreferred,c.zminPreferred).multiply(i),u=new Vector(c.xmaxPreferred,c.ymaxPreferred,c.zmaxPreferred).multiply(i);if(E.focus=u.add(l).divide(2),m)switch(E.location=E.focus.clone(),A){case 0:E.location.z=c.zmaxPreferred*I*4;break;case 1:E.location.y=c.ymaxPreferred*D*4;break;case 2:default:E.location.x=c.xmaxPreferred*_*4}else{var f=n.getAspect(),p=u.subtract(l),h=(p.z*f>p.y?p.z:p.y)/2*1.1/Math.tan(d*Math.PI/360);E.location=E.focus.clone(),E.location.x=u.x+h}}}0==E.upvector.cross(E.location.subtract(E.focus)).length()&&(E.upvector=E.upvector.rotate()),n.putCamera(m,E),n.draw(o),n.draw(a),T=!1,C=!1,!1,s=!1;for(e=0,t=a.length;e<t;e++)a[e].setProjChanged(!1),a[e].setMeshChanged(!1)},r.setEnabled=function(e){t.setEnabled(e)},r.setDraggable=function(e){if("string"==typeof e)switch(e){default:case"NONE":e=0;break;case"ANY":e=1;break;case"AZIMUTH":e=2;break;case"ALTITUDE":e=3}l=e},r.getPanelInteraction=function(){return t},r.getController=function(){return y},r.setController=function(e){y=e},r.getInteraction=function(){return t},r.registerProperties=function(e){EJSS_DRAWING3D.DrawingPanel.registerProperties(r,e)},r.getOnDragHandler=function(){if(l>0){var e=r.getPanelInteraction().getInteractionDeltas();switch(A){case 0:2!=l&&1!=l||(E.altitude+=e[0]);break;case 1:2!=l&&1!=l||(E.azimuth-=e[0]);break;case 2:2!=l&&1!=l||(E.altitude+=e[0]);break;default:2!=l&&1!=l||(E.azimuth+=e[0])}switch(A){case 0:case 1:3!=l&&1!=l||(E.tilt+=e[1]);break;case 2:3!=l&&1!=l||(E.azimuth-=e[1]);break;default:3!=l&&1!=l||(E.altitude+=e[1])}}r.getController().propertiesChanged("CameraAzimuth","CameraAltitude","CameraTilt"),!0},r.getOnZoomHandler=function(){var e=r.getPanelInteraction().getInteractionZoomDelta(),t=E.focus.subtract(E.location);e>0?(E.location=E.focus.subtract(t.divide(f)),E.delta=f):e<0&&(E.location=E.focus.subtract(t.multiply(f)),E.delta=2-f),r.getController().propertiesChanged("CameraLocation","CameraX","CameraY","CameraZ"),!0},i.setFillColor([.83,.85,1]),i.setMeshChangeListener((function(e){C=!0})),i.setProjChangeListener((function(e){C=!0}));var R=EJSS_DRAWING3D.box(e+"box");R.getStyle().setDrawFill(!1),R.getStyle().setDrawLines(!0),R.getStyle().setLineColor("black"),R.setVisible(!0),R.setSize([2,2,2]),R.panelChangeListener=function(e){if("bounds"==e){var t=(c.xmaxPreferred+c.xminPreferred)/2,r=(c.ymaxPreferred+c.yminPreferred)/2,n=(c.zmaxPreferred+c.zminPreferred)/2,i=Math.abs(c.xmaxPreferred-c.xminPreferred),o=Math.abs(c.ymaxPreferred-c.yminPreferred),a=Math.abs(c.zmaxPreferred-c.zminPreferred);R.setPosition([t,r,n]),R.setSize([i,o,a])}},r.addDecoration(R,0);var N=EJSS_DRAWING3D.arrow(e+"axisX");N.setColor("red"),N.setVisible(!1),N.panelChangeListener=function(e){if("bounds"==e){N.setPosition([c.xminPreferred,c.yminPreferred,c.zminPreferred]);var t=Math.abs(c.xmaxPreferred-c.xminPreferred);N.setSize([t,0,0])}},r.addDecoration(N,0);var v=EJSS_DRAWING3D.arrow(e+"axisY");v.setPosition([0,0,0]),v.setSize([0,1,0]),v.setColor("green"),v.setVisible(!1),v.panelChangeListener=function(e){if("bounds"==e){v.setPosition([c.xminPreferred,c.yminPreferred,c.zminPreferred]);var t=Math.abs(c.ymaxPreferred-c.yminPreferred);v.setSize([0,t,0])}},r.addDecoration(v,0);var O=EJSS_DRAWING3D.arrow(e+"axisZ");O.setPosition([0,0,0]),O.setSize([0,0,1]),O.setColor("blue"),O.setVisible(!1),O.panelChangeListener=function(e){if("bounds"==e){O.setPosition([c.xminPreferred,c.yminPreferred,c.zminPreferred]);var t=Math.abs(c.zmaxPreferred-c.zminPreferred);O.setSize([0,0,t])}},r.addDecoration(O,0);var M=EJSS_DRAWING3D.arrow(e+"baxisX");M.setPosition([0,0,0]),M.setSize([1,0,0]),M.setColor("red"),M.setVisible(!1),M.panelChangeListener=function(e){if("bounds"==e){var t=Math.abs(c.xmaxPreferred-c.xminPreferred)/2;M.setSize([t,0,0])}},r.addDecoration(M,0);var b=EJSS_DRAWING3D.arrow(e+"baxisY");b.setPosition([0,0,0]),b.setSize([0,1,0]),b.setColor("green"),b.setVisible(!1),b.panelChangeListener=function(e){if("bounds"==e){var t=Math.abs(c.ymaxPreferred-c.yminPreferred)/2;b.setSize([0,t,0])}},r.addDecoration(b,0);var G=EJSS_DRAWING3D.arrow(e+"baxisZ");return G.setPosition([0,0,0]),G.setSize([0,0,1]),G.setColor("blue"),G.setVisible(!1),G.panelChangeListener=function(e){if("bounds"==e){var t=Math.abs(c.zmaxPreferred-c.zminPreferred)/2;G.setSize([0,0,t])}},r.addDecoration(G,0),t=EJSS_DRAWING3D.panelInteraction(r),r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Element={copyTo:function(e,t){EJSS_DRAWING3D.Style.copyTo(e.getStyle(),t.getStyle()),t.setVisible(e.isVisible()),t.setMeasured(e.isMeasured()),t.setPosition(e.getPosition()),t.setSize(e.getSize()),t.setTransformation(e.getTransformation()),t.setExtraTransformation(e.getExtraTransformation()),t.setTextureUrl(e.getTextureUrl()),t.setResolution(e.getResolution()),t.setParent(e.getParent())},registerProperties:function(e,t){e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("X",e.setX,e.getX),t.registerProperty("Y",e.setY,e.getY),t.registerProperty("Z",e.setZ,e.getZ),t.registerProperty("Position",e.setPosition,e.getPosition),t.registerProperty("SizeX",e.setSizeX,e.getSizeX),t.registerProperty("SizeY",e.setSizeY,e.getSizeY),t.registerProperty("SizeZ",e.setSizeZ,e.getSizeZ),t.registerProperty("Size",e.setSize,e.getSize),t.registerProperty("TextureUrl",e.setTextureUrl,e.getTextureUrl),t.registerProperty("Transformation",e.setTransformation),t.registerProperty("Visibility",e.setVisible,e.isVisible),t.registerProperty("Measured",e.setMeasured,e.isMeasured),t.registerProperty("AlwaysUpdated",e.setAlwaysUpdated,e.isAlwaysUpdated),t.registerProperty("Transparency",e.getStyle().setTransparency,e.getStyle().getTransparency),t.registerProperty("AmbientColor",e.getStyle().setAmbientColor,e.getStyle().getAmbientColor),t.registerProperty("FillColor",e.getStyle().setFillColor,e.getStyle().getFillColor),t.registerProperty("SpecularColor",e.getStyle().setSpecularColor,e.getStyle().getSpecularColor),t.registerProperty("AmbientReflection",e.getStyle().setAmbientReflection,e.getStyle().getAmbientReflection),t.registerProperty("ColorReflection",e.getStyle().setColorReflection,e.getStyle().getColorReflection),t.registerProperty("SpecularReflection",e.getStyle().setSpecularReflection,e.getStyle().getSpecularReflection),t.registerProperty("Shininess",e.getStyle().setShininessVal,e.getStyle().getShininessVal),t.registerProperty("PaletteFloor",e.getStyle().setPaletteFloor,e.getStyle().getPaletteFloor),t.registerProperty("PaletteCeil",e.getStyle().setPaletteCeil,e.getStyle().getPaletteCeil),t.registerProperty("PaletteFloorColor",e.getStyle().setPaletteFloorColor,e.getStyle().getPaletteFloorColor),t.registerProperty("PaletteCeilColor",e.getStyle().setPaletteCeilColor,e.getStyle().getPaletteCeilColor),t.registerProperty("LineColor",e.getStyle().setLineColor,e.getStyle().getLineColor),t.registerProperty("LineWidth",e.getStyle().setLineWidth,e.getStyle().getLineWidth),t.registerProperty("DrawLines",e.getStyle().setDrawLines,e.getStyle().getDrawLines),t.registerProperty("DrawFill",e.getStyle().setDrawFill,e.getStyle().getDrawFill),t.registerProperty("ClosedTop",e.getStyle().setClosedTop,e.getStyle().getClosedTop),t.registerProperty("ClosedBottom",e.getStyle().setClosedBottom,e.getStyle().getClosedBottom),t.registerProperty("ClosedLeft",e.getStyle().setClosedLeft,e.getStyle().getClosedLeft),t.registerProperty("ClosedRight",e.getStyle().setClosedRight,e.getStyle().getClosedRight),t.registerProperty("Resolution",e.setResolution),t.registerProperty("Color",e.setColor),t.registerProperty("EnabledPosition",(function(e){})),t.registerProperty("MovesGroup",(function(e){})),t.registerProperty("EnabledSize",(function(e){})),t.registerProperty("ResizesGroup",(function(e){})),t.registerAction("OnEnter",e.getPosition),t.registerAction("OnExit",e.getPosition),t.registerAction("OnPress",e.getPosition),t.registerAction("OnDrag",e.getPosition),t.registerAction("OnRelease",e.getPosition),t.registerAction("OnLoadTexture",null,null,(function(){e.setProjChanged(!0)}))}},EJSS_DRAWING3D.element=function(e){var t={},r=EJSS_DRAWING3D.Element,n=EJSS_DRAWING3D.style(e),i=!0,o=!0,a="",s=0,l=0,u=0,g=1,c=1,S=1,f=[],E=[],d=[],p=null,h=null,m=null,A=-1,_=!0,D=!0,I=!1,P=20,C=20,T=0,y={propertiesChanged:function(){},invokeAction:function(){}};function R(e){for(var r=[],n=0;n<e.length;n++){var i=e[n];i.length>4?r.push(i):r.push(i.concat(t.getPosition()))}return r}return t.copyTo=function(e){r.copyTo(t,e)},t.getName=function(){return e.replace(/\[|\]/g,"")},t.setTextureUrl=function(e){var r=null!=m?m.getResourcePath:t.getResourcePath;null!=r?e=r(e):console.log("No getResourcePath function for "+t.getName()+". Texture = "+e),a=e},t.getTextureUrl=function(){return a},t.setVisible=function(e){i=e},t.isVisible=function(){return i},t.isGroupVisible=function(){for(var e=h;null!=e;){if(!e.isVisible())return!1;e=e.getGroup()}return i},t.getStyle=function(){return n},t.setMeasured=function(e){o=e},t.isMeasured=function(){return o},t.setColor=function(e){t.getStyle().setFillColor(e),t.getStyle().setLineColor(e)},t.setResolution=function(e){Array.isArray(e)?(t.setResolutionU(e[0]),t.setResolutionV(e[1]),e[2]&&t.setResolutionR(e[2])):(t.setResolutionU(e),t.setResolutionV(e))},t.getResolution=function(){return[P,C,T]},t.setResolutionU=function(e){P!=e&&(P=e,_=!0)},t.getResolutionU=function(){return P},t.setResolutionV=function(e){C!=e&&(C=e,_=!0)},t.getResolutionV=function(){return C},t.setResolutionR=function(e){T!=e&&(T=e,_=!0)},t.getResolutionR=function(){return T},t.setX=function(e){s!=e&&(s=e,D=!0)},t.getX=function(){return s},t.setY=function(e){l!=e&&(l=e,D=!0)},t.getY=function(){return l},t.setZ=function(e){u!=e&&(u=e,D=!0)},t.getZ=function(){return u},t.setPosition=function(e){t.setX(e[0]),t.setY(e[1]),t.setZ(e[2])},t.getPosition=function(){return[s,l,u]},t.setSizeX=function(e){g!=e&&(g=e,D=!0)},t.getSizeX=function(){return g},t.setSizeY=function(e){c!=e&&(c=e,D=!0)},t.getSizeY=function(){return c},t.setSizeZ=function(e){S!=e&&(S=e,D=!0)},t.getSizeZ=function(){return S},t.setSize=function(e){t.setSizeX(e[0]),t.setSizeY(e[1]),t.setSizeZ(e[2])},t.getSize=function(){return[t.getSizeX(),t.getSizeY(),t.getSizeZ()]},t.setPanel=function(e){p=e,D=!0},t.getPanel=function(){return p},t.getGroupPanel=function(){for(var e=t;e.getGroup();)e=e.getGroup();return e.getPanel()},t.setGroup=function(e){h=e,D=!0},t.getGroup=function(){return h},t.setSet=function(e,t){m=e,A=t},t.getSetIndex=function(){return A},t.setParent=function(e){e.render?(t.setGroup(null),e.addElement(t),t.setPanel(e)):"ElementGroup"==e.getClass()?(t.setGroup(e),t.getGroupPanel().addElement(t),t.setPanel(t.getGroupPanel())):console.log("WARNING: setParent() - Parent not valid : "+e.getName())},t.getParent=function(){return null!==h?t.getGroup():t.getPanel()},t.setTransformation=function(e){null==e&&(e=[]),EJSS_TOOLS.compareArrays(f,e)||(f=e,D=!0)},t.setFirstTransformation=function(e){null==e&&(e=[]),EJSS_TOOLS.compareArrays(f,e)||(d=e,D=!0)},t.setExtraTransformation=function(e){E=e},t.getExtraTransformation=function(){return E},t.addExtraTransformation=function(e){null!=e&&(E.push(e),D=!0)},t.removeExtraTransformation=function(e){if(null!=e)for(var t=0;t<E.length;t++){if(E[t]===e)return E.splice(t,1),void(D=!0)}},t.getFullTransformation=function(){for(var e=R(d).concat(R(f)),t=0;t<E.length;t++)e.push(E[t].getArray());return e},t.getTransformation=function(){return f},t.getGroupTransformation=function(){for(var e=EJSS_DRAWING3D.transformation(),r=t;null!=r;)e.concatenate(r.getFullTransformation()),r=r.getGroup();return e},t.isAlwaysUpdated=function(){return I},t.setAlwaysUpdated=function(e){I=e},t.isMeshChanged=function(){return _},t.setMeshChanged=function(e){_=e},t.isProjChanged=function(){return D},t.setProjChanged=function(e){D=e},t.isGroupChanged=function(){for(var e=t.getGroup();null!=e;){if(e.isChanged())return!0;e=e.getGroup()}return!1},t.getController=function(){return y},t.setController=function(e){y=e},t.registerProperties=function(e){r.registerProperties(t,e)},n.setMeshChangeListener((function(e){_=!0})),n.setProjChangeListener((function(e){D=!0})),t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.ElementSet={registerProperties:function(e,t){e.setController(t),e.setToEach((function(e,t){e.setController(t)}),t),t.registerProperty("Parent",(function(t){e.setParent(t),e.setToEach((function(e,t){e.setParent(t)}),e)})),t.registerProperty("NumberOfElements",e.setNumberOfElements),t.registerProperty("ElementInteracted",e.setElementInteracted,e.getElementInteracted),t.registerProperty("X",(function(t){e.setToEach((function(e,t){e.setX(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getX()}))})),t.registerProperty("Y",(function(t){e.setToEach((function(e,t){e.setY(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getY()}))})),t.registerProperty("Z",(function(t){e.setToEach((function(e,t){e.setZ(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getZ()}))})),t.registerProperty("Position",(function(t){e.setToEach((function(e,t){e.setPosition(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getPosition()}))})),t.registerProperty("SizeX",(function(t){e.setToEach((function(e,t){e.setSizeX(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getSizeX()}))})),t.registerProperty("SizeY",(function(t){e.setToEach((function(e,t){e.setSizeY(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getSizeY()}))})),t.registerProperty("SizeZ",(function(t){e.setToEach((function(e,t){e.setSizeZ(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getSizeZ()}))})),t.registerProperty("Size",(function(t){e.setToEach((function(e,t){e.setSize(t)}),t)}),(function(){return e.getFromEach((function(e){return e.getSize()}))})),t.registerProperty("TextureUrl",(function(t){e.setToEach((function(e,t){e.setTextureUrl(t)}),t)})),t.registerProperty("Transformation",(function(t){e.setToEach((function(e,t){e.setTransformation(t)}),t)})),t.registerProperty("Visibility",(function(t){e.setToEach((function(e,t){e.setVisible(t)}),t)})),t.registerProperty("Measured",(function(t){e.setToEach((function(e,t){e.setMeasured(t)}),t)})),t.registerProperty("Transparency",(function(t){e.setToEach((function(e,t){e.getStyle().setTransparency(t)}),t)})),t.registerProperty("AmbientColor",(function(t){e.setToEach((function(e,t){e.getStyle().setAmbientColor(t)}),t)})),t.registerProperty("FillColor",(function(t){e.setToEach((function(e,t){e.getStyle().setFillColor(t)}),t)})),t.registerProperty("SpecularColor",(function(t){e.setToEach((function(e,t){e.getStyle().setSpecularColor(t)}),t)})),t.registerProperty("AmbientReflection",(function(t){e.setToEach((function(e,t){e.getStyle().setAmbientReflection(t)}),t)})),t.registerProperty("ColorReflection",(function(t){e.setToEach((function(e,t){e.getStyle().setColorReflection(t)}),t)})),t.registerProperty("SpecularReflection",(function(t){e.setToEach((function(e,t){e.getStyle().setSpecularReflection(t)}),t)})),t.registerProperty("Shininess",(function(t){e.setToEach((function(e,t){e.getStyle().setShininessVal(t)}),t)})),t.registerProperty("LineColor",(function(t){e.setToEach((function(e,t){e.getStyle().setLineColor(t)}),t)})),t.registerProperty("LineWidth",(function(t){e.setToEach((function(e,t){e.getStyle().setLineWidth(t)}),t)})),t.registerProperty("DrawLines",(function(t){e.setToEach((function(e,t){e.getStyle().setDrawLines(t)}),t)})),t.registerProperty("FillColor",(function(t){e.setToEach((function(e,t){e.getStyle().setFillColor(t)}),t)})),t.registerProperty("DrawFill",(function(t){e.setToEach((function(e,t){e.getStyle().setDrawFill(t)}),t)})),t.registerProperty("ClosedTop",(function(t){e.setToEach((function(e,t){e.getStyle().setAttributes(t)}),t)})),t.registerProperty("ClosedBottom",(function(t){e.setToEach((function(e,t){e.getStyle().setAttributes(t)}),t)})),t.registerProperty("ClosedLeft",(function(t){e.setToEach((function(e,t){e.getStyle().setAttributes(t)}),t)})),t.registerProperty("ClosedRight",(function(t){e.setToEach((function(e,t){e.getStyle().setAttributes(t)}),t)})),t.registerProperty("Resolution",(function(t){e.setToEach((function(e,t){e.getStyle().setAttributes(t)}),t)})),t.registerProperty("Color",(function(t){e.setToEach((function(e,t){e.setColor(t)}),t)})),t.registerProperty("EnabledPosition",(function(t){e.setToEach((function(e,t){}),t)})),t.registerProperty("MovesGroup",(function(t){e.setToEach((function(e,t){}),t)})),t.registerProperty("EnabledSize",(function(t){e.setToEach((function(e,t){}),t)})),t.registerProperty("ResizesGroup",(function(t){e.setToEach((function(e,t){}),t)}));var r=function(){var r=e.getGroupPanel(),n=r.getPanelInteraction().getIndexElement(),i=r.getElements()[n],o=i.getSetIndex();return e.setElementInteracted(o),t.propertiesChanged("ElementInteracted"),{index:o,position:i.getPosition()}};t.registerAction("OnEnter",r),t.registerAction("OnExit",r),t.registerAction("OnPress",r),t.registerAction("OnDrag",r),t.registerAction("OnRelease",r)}},EJSS_DRAWING3D.elementSet=function(e,t){var r=EJSS_DRAWING3D.group(t),n=EJSS_DRAWING3D.ElementSet,i=[],o=!1,a=-1,s=[];function l(t){var n=r.getName?r.getName():"unnamed";t=Math.max(1,t);var o=i.length-t;if(o>0){s=i.splice(t,o);for(var a=0;a<s.length;a++){var l=s[a].getPanel();l&&l.removeElement(s[a])}}else if(o<0){s=[];for(var u=r.getController(),g=i[i.length-1],c=i.length;c<t;c++){var S=e(n+"["+c+"]");S.setSet(r,c),g.copyTo(S),S.setController(u),i.push(S)}}}r.setNumberOfElements=function(e){o=!0,l(e)},r.getElements=function(){return i},r.getLastElements=function(){var e=s.slice();return s=[],e},r.setElementInteracted=function(e){a=e},r.getElementInteracted=function(){return a};var u=r.setPanel;r.setPanel=function(e){u(e);for(var t=0,r=i.length;t<r;t++)i[t].setPanel(e)},r.setProjChanged=function(e){for(var t=0,r=i.length;t<r;t++)i[t].setProjChanged(e)},r.setToEach=function(e,t){if(Array.isArray(t)){o||i.length<t.length&&l(t.length);for(var r=0,n=Math.min(i.length,t.length);r<n;r++)e(i[r],t[r])}else for(r=0,n=i.length;r<n;r++)e(i[r],t)},r.getFromEach=function(e){for(var t=[],r=0,n=i.length;r<n;r++)t[r]=e(i[r]);return t},r.registerProperties=function(e){n.registerProperties(r,e)};var g=e(t+"[0]");return g.setController(r.getController()),g.setSet(r,0),i.push(g),r};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Ellipsoid={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setMinAngleU(e.getMinAngleU()),t.setMaxAngleU(e.getMaxAngleU()),t.setMinAngleV(e.getMinAngleV()),t.setMaxAngleV(e.getMaxAngleV())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("MinAngleU",e.setMinAngleU),t.registerProperty("MaxAngleU",e.setMaxAngleU),t.registerProperty("MinAngleV",e.setMinAngleV),t.registerProperty("MaxAngleV",e.setMaxAngleV)}},EJSS_DRAWING3D.ellipsoid=function(e){var t=EJSS_DRAWING3D.element(e),r=0,n=360,i=-90,o=90;return t.getClass=function(){return"ElementEllipsoid"},t.setMinAngleU=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getMinAngleU=function(){return r},t.setMaxAngleU=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getMaxAngleU=function(){return n},t.setMinAngleV=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getMinAngleV=function(){return i},t.setMaxAngleV=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getMaxAngleV=function(){return o},t.copyTo=function(e){EJSS_DRAWING3D.Ellipsoid.copyTo(t,e)},t.registerProperties=function(e){EJSS_DRAWING3D.Ellipsoid.registerProperties(t,e)},t.setSize([1,1,1]),t.setResolution([30,20]),t},EJSS_DRAWING3D.EllipsoidSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t),t.registerProperty("MinAngleU",(function(t){e.setToEach((function(e,t){e.setMinAngleU(t)}),t)})),t.registerProperty("MaxAngleU",(function(t){e.setToEach((function(e,t){e.setMaxAngleU(t)}),t)})),t.registerProperty("MinAngleV",(function(t){e.setToEach((function(e,t){e.setMinAngleV(t)}),t)})),t.registerProperty("MaxAngleV",(function(t){e.setToEach((function(e,t){e.setMaxAngleV(t)}),t)}))}},EJSS_DRAWING3D.ellipsoidSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.ellipsoid,e),r=EJSS_DRAWING3D.EllipsoidSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Group={},EJSS_DRAWING3D.group=function(e){var t=EJSS_DRAWING3D.element(e);return t.getClass=function(){return"ElementGroup"},t.isGroup=function(){return!0},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.panelInteraction=function(e){var t={},r=!1,n=[0,0],i=0,o=0,a=!1,s=0,l=0,u=0,g=0,c=!1,S=[0,0];function f(t){var r,n,i=e.getGraphics().getBox(),o=i.left,a=i.top;return void 0!==t.changedTouches&&1===t.changedTouches.length?(r=t.changedTouches[0].pageX,n=t.changedTouches[0].pageY):(r=t.x||t.clientX,n=t.y||t.clientY),[r-o,n-a]}return t.getPanel=function(){return e},t.getEnabled=function(){return r},t.setEnabled=function(e){r!=e&&((r=e)?(t.setHandler("move",t.handleMouseMoveEvent),t.setHandler("down",t.handleMouseDownEvent),t.setHandler("up",t.handleMouseUpEvent),t.setHandler("mousewheel",t.handleMouseWheelEvent)):(t.setHandler("move",(function(){})),t.setHandler("down",(function(){})),t.setHandler("up",(function(){})),t.setHandler("mousewheel",(function(){}))))},t.getInteractionPoint=function(){return n},t.getInteractionDeltas=function(){return[i,o]},t.getInteractionZoomDelta=function(){return u},t.handleMouseWheelEvent=function(t){0==(void 0!==t.touches?t.touches.length:0)&&(t.preventDefault(),u=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),e.getController().invokeAction("OnZoom"),e.getController().reportInteractions())},t.handlePinchGesture=function(t){t.timeStamp-l>100&&(t.preventDefault(),t.scale<g?u=1:t.scale>=g&&(u=-1),g=t.scale,e.getController().invokeAction("OnZoom"),e.getController().reportInteractions(),l=t.timeStamp)},t.handleMouseMoveEvent=function(t){var r=void 0!==t.touches?t.touches.length:1;if(1==r){var s=n[0],g=n[1];n=f(t),i=n[0]-s,o=n[1]-g,a?(e.getController().invokeAction("OnDrag"),t.target.style.cursor="move"):t.target.style.cursor="default"}if(2==r){if(t.timeStamp-l>25){t.preventDefault();var E=t.touches[0],d=t.touches[1],p=E.clientX||E.x,h=E.clientY||E.y,m=d.clientX||d.x,A=d.clientY||d.y;if(c){var _=[Math.abs(p-m),Math.abs(h-A)],D=_[0]-S[0];D<3&&D>-3?u=0:(u=D,S=_),e.getController().invokeAction("OnZoom")}else c=!0,S=[Math.abs(p-m),Math.abs(h-A)],u=0;l=t.timeStamp}}else c=!1,S=[0,0];e.getController().reportInteractions()},t.handleMouseDownEvent=function(r){1==(void 0!==r.touches?r.touches.length:1)&&(a=!0,n=f(r),e.getController().invokeAction("OnPress"),t.pick(n[0],n[1]),r.preventDefault(),e.getController().reportInteractions()),c=!1},t.handleMouseUpEvent=function(t){1==(void 0!==t.touches?t.touches.length:1)&&(a=!1,n=f(t),e.getController().invokeAction("OnRelease"),t.target.style.cursor="default",t.timeStamp-s<500&&e.getController().invokeAction("OnDoubleClick"),s=t.timeStamp,e.getController().reportInteractions()),c=!1},t.setHandler=function(t,r){var n=e.getGraphics().getEventContext();switch(t){case"move":n.addEventListener("mousemove",r,!1),n.addEventListener("touchmove",r,!1);break;default:case"down":n.addEventListener("mousedown",r,!1),n.addEventListener("touchstart",r,!1);break;case"up":n.addEventListener("mouseup",r,!1),n.addEventListener("touchend",r,!1);break;case"mousewheel":n.addEventListener("mousewheel",r,!1);break;case"pinch":n.addEventListener("gesturestart",(function(e){g=1}),!1),n.addEventListener("gesturechange",r,!1)}return!1},t.pick=function(t,r){var n=t-1,i=r-1,o=e.getGraphics().getContext();if(o){var a=new Uint8Array(4);o.readPixels(n,i,1,1,o.RGBA,o.UNSIGNED_BYTE,a),a.data&&(a=a.data)}},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Style={copyTo:function(e,t){t.setClosedTop(e.getClosedTop()),t.setClosedBottom(e.getClosedBottom()),t.setClosedLeft(e.getClosedLeft()),t.setClosedRight(e.getClosedRight()),t.setDrawLines(e.getDrawLines()),t.setLineColor(e.getLineColor()),t.setLineWidth(e.getLineWidth()),t.setDrawFill(e.getDrawFill()),t.setTransparency(e.getTransparency()),t.setAmbientColor(e.getAmbientColor()),t.setFillColor(e.getFillColor()),t.setSpecularColor(e.getSpecularColor()),t.setAmbientReflection(e.getAmbientReflection()),t.setColorReflection(e.getColorReflection()),t.setSpecularReflection(e.getSpecularReflection()),t.setShininessVal(e.getShininessVal()),t.setPaletteFloor(e.getPaletteFloor()),t.setPaletteCeil(e.getPaletteCeil()),t.setPaletteFloorColor(e.getPaletteFloorColor()),t.setPaletteCeilColor(e.getPaletteCeilColor())}},EJSS_DRAWING3D.style=function(e){var t,r,n,i,o={},a=!0,s=!0,l=!0,u=!0,g=[0,0,0],c=.5,S=[0,0,0],f=[0,0,0],E=[1,1,1],d=1,p=1,h=1,m=10,A=[1,0,-1],_=[-1,0,1],D=!1,I=!0,P=0;return o.setProjChangeListener=function(e){n=e},o.setMeshChangeListener=function(e){i=e},o.setClosedTop=function(e){e!=a&&(a=e,i&&i("closedtop"))},o.getClosedTop=function(){return a},o.setClosedBottom=function(e){e!=s&&(s=e,i&&i("closedbottom"))},o.getClosedBottom=function(){return s},o.setClosedLeft=function(e){e!=l&&(l=e,i&&i("closedleft"))},o.getClosedLeft=function(){return l},o.setClosedRight=function(e){e!=u&&(u=e,i&&i("closedright"))},o.getClosedRight=function(){return u},o.setDrawLines=function(e){e!=D&&(D=e,n&&n("drawlines"))},o.getDrawLines=function(){return D},o.setLineColor=function(e){return"string"==typeof e&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,g)||(g=e.slice(),n&&n("linecolor")),o},o.getLineColor=function(){return g},o.setLineWidth=function(e){e!=c&&(c=e,n&&n("linewidth"))},o.getLineWidth=function(){return c},o.setDrawFill=function(e){e!=I&&(I=e,n&&n("drawfill"))},o.getDrawFill=function(){return I},o.setFillColor=function(e){"string"==typeof e&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,f)||(f=e.slice(),n&&n("fillcolor"))},o.getFillColor=function(){return f},o.setAmbientColor=function(e){"string"==typeof e&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,S)||(S=e.slice(),n&&n("ambientcolor"))},o.getAmbientColor=function(){return S},o.setSpecularColor=function(e){"string"==typeof e&&(e=EJSS_TOOLS.DisplayColors.getArrayColor(e)),EJSS_TOOLS.compareArrays(e,E)||(E=e.slice(),n&&n("specularcolor"))},o.getSpecularColor=function(){return E},o.setAmbientReflection=function(e){d!=e&&(d=e,n&&n("ambientreflection"))},o.getAmbientReflection=function(){return d},o.setColorReflection=function(e){p!=e&&(p=e,n&&n("colorreflection"))},o.getColorReflection=function(){return p},o.setSpecularReflection=function(e){h!=e&&(h=e,n&&n("specularreflection"))},o.getSpecularReflection=function(){return h},o.setShininessVal=function(e){m!=e&&(m=e,n&&n("shininess"))},o.getShininessVal=function(){return m},o.setTransparency=function(e){e!=P&&(P=e,n&&n("transparency"))},o.getTransparency=function(){return P},o.setPaletteFloor=function(e){e&&!EJSS_TOOLS.compareArrays(e,t)&&(t=e.slice(),n&&n("palettefloor"))},o.getPaletteFloor=function(){return t},o.setPaletteCeil=function(e){e&&!EJSS_TOOLS.compareArrays(e,r)&&(r=e.slice(),n&&n("paletteceil"))},o.getPaletteCeil=function(){return r},o.setPaletteFloorColor=function(e){EJSS_TOOLS.compareArrays(e,A)||(A=e.slice(),n&&n("palettefloorcolor"))},o.getPaletteFloorColor=function(){return A},o.setPaletteCeilColor=function(e){EJSS_TOOLS.compareArrays(e,_)||(_=e.slice(),n&&n("paletteceilcolor"))},o.getPaletteCeilColor=function(){return _},o};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Transformation={registerProperties:function(e,t){e.setController(t),t.registerProperty("Parent",e.setParent,e.getParent),t.registerProperty("Axis",e.setAxis,e.getAxis),t.registerProperty("Angle",e.setAngle,e.getAngle),t.registerProperty("Origin",e.setOrigin,e.getOrigin)}},EJSS_DRAWING3D.rotationX=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([1,0,0]),t},EJSS_DRAWING3D.rotationY=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([0,1,0]),t},EJSS_DRAWING3D.rotationZ=function(e){var t=EJSS_DRAWING3D.transformation();return t.setAxis([0,0,1]),t},EJSS_DRAWING3D.transformation=function(e){var t={},r=null,n=[0,0,0,1,0,0,0],i={propertiesChanged:function(){},invokeAction:function(){}};return t.getArray=function(){return n},t.setChanged=function(e){e&&r.setProjChanged(!0)},t.setParent=function(e){r&&r.removeExtraTransformation(t),(r=e)&&r.addExtraTransformation(t)},t.getParent=function(){return r},t.setAngle=function(e){n[0]=e},t.getAngle=function(){return n[0]},t.setAxis=function(e){n[1]=e[0],n[2]=e[1],n[3]=e[2]},t.getAxis=function(){return n.slice(1,4)},t.setOrigin=function(e){n[4]=e[0],n[5]=e[1],n[6]=e[2]},t.getOrigin=function(){return n.slice(5)},t.getController=function(){return i},t.setController=function(e){i=e},t.registerProperties=function(e){EJSS_DRAWING3D.Transformation.registerProperties(t,e)},t};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.analyticCurve=function(e,t){evaluate=function(e,t,r,n,i){var o={};return o[t]=r,o[n]=i,e.evaluate(o)};for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!1,triangles:!1,lines:!0,colors:!1}),n=t.getNumPoints(),i=t.getMinValue(),o=t.getMaxValue(),a=Math.abs((o-i)/(n-1)),s=t.getExpressionX(),l=t.getExpressionY(),u=t.getExpressionZ(),g=t.getVariable(),c=i,S=0;S<n;S++){var f=evaluate(s,g,c),E=evaluate(l,g,c),d=evaluate(u,g,c);r.vertices.push([f,E,d]),0!=S&&r.lines.push([S-1,S]),c+=a}return r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.analyticSurface=function(e,t){createSurfaceBuffers=function(e,t,r,n){for(var i=0;i<e-1;i++)for(var o=0;o<t-1;o++){var a=r[o+i*t],s=r[o+i*t+t],l=r[o+i*t+t+1],u=r[o+i*t+1];n.vertices.push(a),n.vertices.push(s),n.vertices.push(l),n.vertices.push(u)}var g=(e-1)*(t-1)/2;for(i=0;i<8*g;i+=4)n.triangles.push([i,i+1,i+2]),n.triangles.push([i,i+2,i+3]),n.lines.push([i,i+1]),n.lines.push([i,i+3]),n.lines.push([i+2,i+3]),n.lines.push([i+2,i+1]),n.coords.push([0,0]),n.coords.push([0,1]),n.coords.push([1,0]),n.coords.push([1,1])},evaluate=function(e,t,r,n,i){var o={};return o[t]=r,o[n]=i,e.evaluate(o)};for(var r=t.getNumPoints1(),n=t.getMinValue1(),i=t.getMaxValue1(),o=t.getNumPoints2(),a=t.getMinValue2(),s=t.getMaxValue2(),l=Math.abs((i-n)/(r-1)),u=Math.abs((s-a)/(o-1)),g=t.getExpressionX(),c=t.getExpressionY(),S=t.getExpressionZ(),f=t.getVariable1(),E=t.getVariable2(),d=new Array,p=0,h=n,m=0;m<r;m++){for(var A=a,_=0;_<o;_++){var D=evaluate(g,f,h,E,A),I=evaluate(c,f,h,E,A),P=evaluate(S,f,h,E,A);d[p]=[D,I,P],p++,A+=u}h+=l}var C=EJSS_WEBGLGRAPHICS.mesh(e,t.getName());return createSurfaceBuffers(r,o,d,C),C.computeNormals(),C.compile(),e.addElement(t.getName()+".mesh",C),C};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.arrow=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!0,triangles:!0,lines:!1,colors:!1}),n=new Vector(t.getSize()),i=n.length(),o=t.getResolutionU(),a=t.getHeadWidth(),s=t.getHeadHeight(),l=[new Vector(0,0,0)],u=i/a,g=0;g<o;g++){var c=g/(o-1),S=u*Math.sin(c*Math.PI*2),f=u*Math.cos(c*Math.PI*2),E=-i/s;l.push(new Vector(S,f,E))}var d=[],p=t.getLineWidth()/2;for(g=0;g<o;g++){c=g/(o-1),S=p*Math.sin(c*Math.PI*2),f=p*Math.cos(c*Math.PI*2),E=-i/s;d.push(new Vector([S,f,E])),d.push(new Vector([S,f,0]))}var h=n.cross(new Vector(0,0,1));0==h.length()&&(h.y=1);var m=n.angle(new Vector(0,0,1)),A=new Matrix;Matrix.rotate(-m,h.x,h.y,h.z,0,0,0,A);for(var _=0;_<l.length;_++){var D=A.transformPoint(l[_]);r.vertices.push(D.add(n).toArray())}for(_=0;_<d.length;_++){D=A.transformPoint(d[_]);_%2==0?r.vertices.push(D.add(n).toArray()):r.vertices.push(D.toArray())}for(g=1;g<o;g++){var I=g,P=g+1;r.triangles.push([0,I,P])}for(g=0;g<o-1;g++){I=2*g+l.length;var C=2*g+2+l.length,T=(P=2*g+1+l.length,2*g+3+l.length);r.triangles.push([T,P,I]),r.triangles.push([C,T,I])}r.vertices.push([0,0,0]);for(_=0;_<o-1;_++){I=2*_+1+l.length,P=2*_+3+l.length,T=r.vertices.length-1;r.triangles.push([I,P,T])}return r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.basic=function(e,t){return mesh=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),mesh.setVertices(t.getVertices()),mesh.setCoords(t.getVertices()),mesh.setTriangles(t.getTriangles()),mesh.setColors(t.getColors()),0!=t.getNormals().length?mesh.setNormals(t.getNormals()):mesh.computeNormals(),mesh.computeWireframe(),mesh.compile(),e.addElement(t.getName()+".mesh",mesh),mesh};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.box=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],i=[[0,0],[1,0],[0,1],[1,1]],o=[[-1,0,0],[1,0,0],[0,-1,0],[0,1,0],[0,0,-1],[0,0,1]],a=[[0,2,4,6],[1,3,5,7],[0,4,1,5],[2,6,3,7],[0,2,1,3],[4,6,5,7]],s=t.getStyle().getClosedTop(),l=t.getStyle().getClosedBottom(),u=t.getStyle().getClosedRight(),g=t.getStyle().getClosedLeft(),c=t.getReduceZby(),S=0;S<a.length;S++){for(var f=a[S],E=4*S,d=0;d<4;d++){var p=f[d];6==p||7==p?r.vertices.push([n[p][0],n[p][1],n[p][2]-2*c]):r.vertices.push(n[p]),r.coords.push(i[d]),r.normals.push(o[S])}2==S&&!g||3==S&&!u||5==S&&!s||4==S&&!l||(r.triangles.push([E,E+1,E+2]),r.triangles.push([E+2,E+1,E]),r.triangles.push([E+2,E+1,E+3]),r.triangles.push([E+3,E+1,E+2])),r.lines.push([E,E+1]),r.lines.push([E,E+2]),r.lines.push([E+2,E+3]),r.lines.push([E+1,E+3])}return r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.cylinder=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=t.getResolutionV(),i=t.getResolutionU()+1,o=t.getTopRadius(),a=t.getBottomRadius(),s=t.getMinAngleU(),l=t.getMaxAngleU(),u=0,g=0,c=0;c<n;c++){var S=c/(n-1),f=S*(a-o)+o;g=Math.floor(s*i/360),u=Math.floor(l*i/360);for(var E=g;E<u;E++){var d=E/(i-1),p=f*Math.sin(d*Math.PI*2),h=f*Math.cos(d*Math.PI*2),m=2*-S+1;r.vertices.push([p,h,m]),r.coords.push([d,S])}}for(c=0;c<n;c++){m=c*(2/(n-1))-1;r.vertices.push([0,0,m]),r.coords.push([1,c/(n-1)])}var A=u-g;for(c=0;c<n-1;c++){for(E=0;E<A-1;E++){var _=c*A+E,D=(c+1)*A+E,I=(c+1)*A+E+1,P=c*A+E+1;r.triangles.push([I,D,_]),r.triangles.push([P,I,_]),r.lines.push([I,D]),r.lines.push([P,I]),r.lines.push([_,P])}if(0!=s||360!=l){var C=r.vertices.length-(c+1);if(t.getStyle().getClosedLeft()&&(r.triangles.push([I,P,C-1]),r.triangles.push([P,C,C-1]),r.lines.push([I,C-1]),r.lines.push([P,C]),r.lines.push([C,C-1])),t.getStyle().getClosedRight()){var T=c*A,y=(c+1)*A;r.triangles.push([C-1,T,y]),r.triangles.push([C-1,C,T]),r.lines.push([y,T]),r.lines.push([y,C-1]),r.lines.push([T,C]),r.lines.push([C,C-1])}}}if(t.getStyle().getClosedTop()&&o>0){r.vertices.push([0,0,1]);for(var R=0;R<A-1;R++)r.triangles.push([r.vertices.length-1,R+1,R]),r.coords.push([1,R/(A-2)]),r.lines.push([r.vertices.length-1,R]),r.lines.push([R,R+1])}if(t.getStyle().getClosedBottom()&&a>0){r.vertices.push([0,0,-1]);for(R=(n-1)*A;R<A*n;R++)r.triangles.push([R,R+1,r.vertices.length-1]),r.coords.push([1,R/(A-2)]),r.lines.push([r.vertices.length-1,R]),r.lines.push([R,R+1])}return 0==s&&360==l?r.normals=r.vertices:r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.ellipsoid=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=(EJSS_WEBGLGRAPHICS.indexer(),t.getResolutionV()),i=t.getResolutionU(),o=0;o<=n;o++)for(var a=o*Math.PI/n,s=Math.sin(a),l=Math.cos(a),u=0;u<=i;u++){var g=2*u*Math.PI/i,c=Math.sin(g),S=Math.cos(g)*s,f=-l,E=-c*s,d=1-u/i,p=o/n;r.vertices.push([-E,S,f]),r.coords.push([d,p])}for(o=0;o<=n;o++){p=o/n,a=o*Math.PI/n,f=-Math.cos(a);r.vertices.push([0,0,f]),r.coords.push([0,p])}var h,m=t.getMinAngleU(),A=t.getMaxAngleU(),_=t.getMinAngleV()+90,D=t.getMaxAngleV()+90,I=Math.floor(_*n/180),P=Math.floor(D*n/180);for(o=I;o<P;o++){var C,T,y=Math.floor(m*i/360),R=Math.floor(A*i/360);for(u=y;u<R;u++)T=(C=o*(i+1)+u)+i+1,r.triangles.push([C,T,C+1]),r.triangles.push([T,T+1,C+1]),r.lines.push([C,T]),r.lines.push([C,C+1]),r.lines.push([T,T+1]);if(0!=m||360!=A){var N=r.vertices.length-(n-o+1);if(t.getStyle().getClosedLeft()&&(r.triangles.push([C+1,T+1,N]),r.triangles.push([T+1,N+1,N]),r.lines.push([C+1,T+1]),r.lines.push([C+1,N]),r.lines.push([T+1,N+1]),r.lines.push([N,N+1])),t.getStyle().getClosedRight()){var v=o*(i+1)+y,O=v+i+1;r.triangles.push([N,O,v]),r.triangles.push([N,N+1,O]),r.lines.push([v,O]),r.lines.push([v,N]),r.lines.push([O,N+1]),r.lines.push([N,N+1])}}}if(t.getStyle().getClosedBottom()&&_>0)for(u=y;u<R;u++)C=I*(i+1)+u,h=r.vertices.length-(n-I+1),r.triangles.push([C+1,h,C]),r.lines.push([C+1,h]),r.lines.push([C,C+1]);if(t.getStyle().getClosedTop()&&D<180)for(u=y;u<R;u++)C=P*(i+1)+u,h=r.vertices.length-(n-P+1),r.triangles.push([C,h,C+1]),r.lines.push([C+1,h]),r.lines.push([C,C+1]);return 0==m&&360==A?r.normals=r.vertices:r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var hasFloat32Array="undefined"!=typeof Float32Array;function Matrix(){var e=Array.prototype.concat.apply([],arguments);e.length?9==e.length&&(e=[e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1]):e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.m=hasFloat32Array?new Float32Array(e):e}Matrix.prototype={inverse:function(){return Matrix.inverse(this,new Matrix)},transpose:function(){return Matrix.transpose(this,new Matrix)},multiply:function(e){return Matrix.multiply(this,e,new Matrix)},transformPoint:function(e){var t=this.m;return new Vector(t[0]*e.x+t[1]*e.y+t[2]*e.z+t[3],t[4]*e.x+t[5]*e.y+t[6]*e.z+t[7],t[8]*e.x+t[9]*e.y+t[10]*e.z+t[11]).divide(t[12]*e.x+t[13]*e.y+t[14]*e.z+t[15])},transformVector:function(e){var t=this.m;return new Vector(t[0]*e.x+t[1]*e.y+t[2]*e.z,t[4]*e.x+t[5]*e.y+t[6]*e.z,t[8]*e.x+t[9]*e.y+t[10]*e.z)}},Matrix.inverse=function(e,t){t=t||new Matrix;var r=e.m,n=t.m;n[0]=r[5]*r[10]*r[15]-r[5]*r[14]*r[11]-r[6]*r[9]*r[15]+r[6]*r[13]*r[11]+r[7]*r[9]*r[14]-r[7]*r[13]*r[10],n[1]=-r[1]*r[10]*r[15]+r[1]*r[14]*r[11]+r[2]*r[9]*r[15]-r[2]*r[13]*r[11]-r[3]*r[9]*r[14]+r[3]*r[13]*r[10],n[2]=r[1]*r[6]*r[15]-r[1]*r[14]*r[7]-r[2]*r[5]*r[15]+r[2]*r[13]*r[7]+r[3]*r[5]*r[14]-r[3]*r[13]*r[6],n[3]=-r[1]*r[6]*r[11]+r[1]*r[10]*r[7]+r[2]*r[5]*r[11]-r[2]*r[9]*r[7]-r[3]*r[5]*r[10]+r[3]*r[9]*r[6],n[4]=-r[4]*r[10]*r[15]+r[4]*r[14]*r[11]+r[6]*r[8]*r[15]-r[6]*r[12]*r[11]-r[7]*r[8]*r[14]+r[7]*r[12]*r[10],n[5]=r[0]*r[10]*r[15]-r[0]*r[14]*r[11]-r[2]*r[8]*r[15]+r[2]*r[12]*r[11]+r[3]*r[8]*r[14]-r[3]*r[12]*r[10],n[6]=-r[0]*r[6]*r[15]+r[0]*r[14]*r[7]+r[2]*r[4]*r[15]-r[2]*r[12]*r[7]-r[3]*r[4]*r[14]+r[3]*r[12]*r[6],n[7]=r[0]*r[6]*r[11]-r[0]*r[10]*r[7]-r[2]*r[4]*r[11]+r[2]*r[8]*r[7]+r[3]*r[4]*r[10]-r[3]*r[8]*r[6],n[8]=r[4]*r[9]*r[15]-r[4]*r[13]*r[11]-r[5]*r[8]*r[15]+r[5]*r[12]*r[11]+r[7]*r[8]*r[13]-r[7]*r[12]*r[9],n[9]=-r[0]*r[9]*r[15]+r[0]*r[13]*r[11]+r[1]*r[8]*r[15]-r[1]*r[12]*r[11]-r[3]*r[8]*r[13]+r[3]*r[12]*r[9],n[10]=r[0]*r[5]*r[15]-r[0]*r[13]*r[7]-r[1]*r[4]*r[15]+r[1]*r[12]*r[7]+r[3]*r[4]*r[13]-r[3]*r[12]*r[5],n[11]=-r[0]*r[5]*r[11]+r[0]*r[9]*r[7]+r[1]*r[4]*r[11]-r[1]*r[8]*r[7]-r[3]*r[4]*r[9]+r[3]*r[8]*r[5],n[12]=-r[4]*r[9]*r[14]+r[4]*r[13]*r[10]+r[5]*r[8]*r[14]-r[5]*r[12]*r[10]-r[6]*r[8]*r[13]+r[6]*r[12]*r[9],n[13]=r[0]*r[9]*r[14]-r[0]*r[13]*r[10]-r[1]*r[8]*r[14]+r[1]*r[12]*r[10]+r[2]*r[8]*r[13]-r[2]*r[12]*r[9],n[14]=-r[0]*r[5]*r[14]+r[0]*r[13]*r[6]+r[1]*r[4]*r[14]-r[1]*r[12]*r[6]-r[2]*r[4]*r[13]+r[2]*r[12]*r[5],n[15]=r[0]*r[5]*r[10]-r[0]*r[9]*r[6]-r[1]*r[4]*r[10]+r[1]*r[8]*r[6]+r[2]*r[4]*r[9]-r[2]*r[8]*r[5];for(var i=r[0]*n[0]+r[1]*n[4]+r[2]*n[8]+r[3]*n[12],o=0;o<16;o++)n[o]/=i;return t},Matrix.transpose=function(e,t){t=t||new Matrix;var r=e.m,n=t.m;return n[0]=r[0],n[1]=r[4],n[2]=r[8],n[3]=r[12],n[4]=r[1],n[5]=r[5],n[6]=r[9],n[7]=r[13],n[8]=r[2],n[9]=r[6],n[10]=r[10],n[11]=r[14],n[12]=r[3],n[13]=r[7],n[14]=r[11],n[15]=r[15],t},Matrix.multiply=function(e,t,r){r=r||new Matrix;var n=e.m,i=t.m,o=r.m;return o[0]=n[0]*i[0]+n[1]*i[4]+n[2]*i[8]+n[3]*i[12],o[1]=n[0]*i[1]+n[1]*i[5]+n[2]*i[9]+n[3]*i[13],o[2]=n[0]*i[2]+n[1]*i[6]+n[2]*i[10]+n[3]*i[14],o[3]=n[0]*i[3]+n[1]*i[7]+n[2]*i[11]+n[3]*i[15],o[4]=n[4]*i[0]+n[5]*i[4]+n[6]*i[8]+n[7]*i[12],o[5]=n[4]*i[1]+n[5]*i[5]+n[6]*i[9]+n[7]*i[13],o[6]=n[4]*i[2]+n[5]*i[6]+n[6]*i[10]+n[7]*i[14],o[7]=n[4]*i[3]+n[5]*i[7]+n[6]*i[11]+n[7]*i[15],o[8]=n[8]*i[0]+n[9]*i[4]+n[10]*i[8]+n[11]*i[12],o[9]=n[8]*i[1]+n[9]*i[5]+n[10]*i[9]+n[11]*i[13],o[10]=n[8]*i[2]+n[9]*i[6]+n[10]*i[10]+n[11]*i[14],o[11]=n[8]*i[3]+n[9]*i[7]+n[10]*i[11]+n[11]*i[15],o[12]=n[12]*i[0]+n[13]*i[4]+n[14]*i[8]+n[15]*i[12],o[13]=n[12]*i[1]+n[13]*i[5]+n[14]*i[9]+n[15]*i[13],o[14]=n[12]*i[2]+n[13]*i[6]+n[14]*i[10]+n[15]*i[14],o[15]=n[12]*i[3]+n[13]*i[7]+n[14]*i[11]+n[15]*i[15],r},Matrix.identity=function(e){var t=(e=e||new Matrix).m;return t[0]=t[5]=t[10]=t[15]=1,t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,e},Matrix.perspective=function(e,t,r,n,i){var o=Math.tan(e*Math.PI/360)*r,a=o*t;return Matrix.frustum(-a,a,-o,o,r,n,i)},Matrix.frustum=function(e,t,r,n,i,o,a){var s=(a=a||new Matrix).m;return s[0]=2*i/(t-e),s[1]=0,s[2]=(t+e)/(t-e),s[3]=0,s[4]=0,s[5]=2*i/(n-r),s[6]=(n+r)/(n-r),s[7]=0,s[8]=0,s[9]=0,s[10]=-(o+i)/(o-i),s[11]=-2*o*i/(o-i),s[12]=0,s[13]=0,s[14]=-1,s[15]=0,a},Matrix.ortho=function(e,t,r,n,i,o,a){var s=(a=a||new Matrix).m;return s[0]=2/(t-e),s[1]=0,s[2]=0,s[3]=-(t+e)/(t-e),s[4]=0,s[5]=2/(n-r),s[6]=0,s[7]=-(n+r)/(n-r),s[8]=0,s[9]=0,s[10]=-2/(o-i),s[11]=-(o+i)/(o-i),s[12]=0,s[13]=0,s[14]=0,s[15]=1,a},Matrix.scale=function(e,t,r,n){var i=(n=n||new Matrix).m;return i[0]=e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=r,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},Matrix.translate=function(e,t,r,n){var i=(n=n||new Matrix).m;return i[0]=1,i[1]=0,i[2]=0,i[3]=e,i[4]=0,i[5]=1,i[6]=0,i[7]=t,i[8]=0,i[9]=0,i[10]=1,i[11]=r,i[12]=0,i[13]=0,i[14]=0,i[15]=1,n},Matrix.rotate=function(e,t,r,n,i,o,a,s){if(!e||!t&&!r&&!n)return Matrix.identity(s);var l=(s=s||new Matrix).m,u=Math.sqrt(t*t+r*r+n*n);t/=u,r/=u,n/=u;var g=Math.cos(e),c=Math.sin(e),S=1-g;return l[0]=t*t*S+g,l[1]=t*r*S-n*c,l[2]=t*n*S+r*c,l[3]=i-l[0]*i-l[1]*o-l[2]*a,l[4]=r*t*S+n*c,l[5]=r*r*S+g,l[6]=r*n*S-t*c,l[7]=o-l[4]*i-l[5]*o-l[6]*a,l[8]=n*t*S-r*c,l[9]=n*r*S+t*c,l[10]=n*n*S+g,l[11]=a-l[8]*i-l[9]*o-l[10]*a,l[12]=0,l[13]=0,l[14]=0,l[15]=1,s},Matrix.lookAt=function(e,t,r,n,i,o,a,s,l,u){var g=(u=u||new Matrix).m,c=new Vector(e,t,r),S=new Vector(n,i,o),f=new Vector(a,s,l),E=c.subtract(S).unit(),d=f.cross(E).unit(),p=E.cross(d).unit();return g[0]=d.x,g[1]=d.y,g[2]=d.z,g[3]=-d.dot(c),g[4]=p.x,g[5]=p.y,g[6]=p.z,g[7]=-p.dot(c),g[8]=E.x,g[9]=E.y,g[10]=E.z,g[11]=-E.dot(c),g[12]=0,g[13]=0,g[14]=0,g[15]=1,u};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.mesh=function(e,t,r){var n={};r=r||{coords:!0,normals:!0,triangles:!0,lines:!0,colors:!0},t=t||"mesh";var i={},o={};return n.getId=function(){return t},n.getVertexBuffers=function(){return i},n.getIndexBuffers=function(){return o},n.setVertices=function(e){n.vertices=e},n.getVertices=function(){return n.vertices},n.setCoords=function(e){n.coords=e},n.getCoords=function(){return n.coords},n.setNormals=function(e){n.normals=e},n.getNormals=function(){return n.normals},n.setColors=function(e){n.colors=e},n.getColors=function(){return n.colors},n.setTriangles=function(e){n.triangles=e},n.getTriangles=function(){return n.triangles},n.setLines=function(e){n.lines=e},n.getLines=function(){return n.lines},n.setBuffer=function(e,t){n[e]=t},n.addVertexBuffer=function(t,r){(i[r]=EJSS_WEBGLGRAPHICS.buffer(e,e.ARRAY_BUFFER,Float32Array)).setName(t),n[t]=[]},n.addIndexBuffer=function(t){o[t]=EJSS_WEBGLGRAPHICS.buffer(e,e.ELEMENT_ARRAY_BUFFER,Uint16Array);n[t]=[]},n.compile=function(){for(var e in i){(r=i[e]).setData(n[r.getName()]),r.compile()}for(var t in o){var r;(r=o[t]).setData(n[t]),r.compile()}},n.transform=function(e){if(n.vertices=n.vertices.map((function(t){return e.transformPoint(Vector.fromArray(t)).toArray()})),n.normals){var t=e.inverse().transpose();n.normals=n.normals.map((function(e){return t.transformVector(Vector.fromArray(e)).unit().toArray()}))}return n.compile(),n},n.computeNormals=function(){n.normals||n.addVertexBuffer("normals","gl_Normal");for(var e=0;e<n.vertices.length;e++)n.normals[e]=new Vector;for(e=0;e<n.triangles.length;e++){var t=n.triangles[e],r=Vector.fromArray(n.vertices[t[0]]),i=Vector.fromArray(n.vertices[t[1]]),o=Vector.fromArray(n.vertices[t[2]]),a=i.subtract(r).cross(o.subtract(r)).unit();n.normals[t[0]]=n.normals[t[0]].add(a),n.normals[t[1]]=n.normals[t[1]].add(a),n.normals[t[2]]=n.normals[t[2]].add(a)}for(e=0;e<n.vertices.length;e++)n.normals[e]=n.normals[e].unit().toArray();return n.compile(),n},n.computeWireframe=function(){for(var e=EJSS_WEBGLGRAPHICS.indexer(),t=0;t<n.triangles.length;t++)for(var r=n.triangles[t],i=0;i<r.length;i++){var o=r[i],a=r[(i+1)%r.length];e.add([Math.min(o,a),Math.max(o,a)])}return n.lines||n.addIndexBuffer("lines"),n.lines=e.getUnique(),n.compile(),n},n.getAABB=function(){var e={min:new Vector(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)};e.max=e.min.negative();for(var t=0;t<n.vertices.length;t++){var r=Vector.fromArray(n.vertices[t]);e.min=Vector.min(e.min,r),e.max=Vector.max(e.max,r)}return e},n.getBoundingSphere=function(){for(var e=n.getAABB(),t={center:e.min.add(e.max).divide(2),radius:0},r=0;r<n.vertices.length;r++)t.radius=Math.max(t.radius,Vector.fromArray(n.vertices[r]).subtract(t.center).length());return t},n.addVertexBuffer("vertices","gl_Vertex"),r.coords&&n.addVertexBuffer("coords","gl_TexCoord"),r.normals&&n.addVertexBuffer("normals","gl_Normal"),r.colors&&n.addVertexBuffer("colors","gl_Color"),"triangles"in r&&!r.triangles||n.addIndexBuffer("triangles"),r.lines&&n.addIndexBuffer("lines"),n},EJSS_WEBGLGRAPHICS.indexer=function(){var e={},t=[],r={};return e.getUnique=function(){return t},e.add=function(e){var n=JSON.stringify(e);return n in r||(r[n]=t.length,t.push(e)),r[n]},e},EJSS_WEBGLGRAPHICS.buffer=function(e,t,r){var n={},i=null,o=(t=t,r=r,""),a=[];return n.setData=function(e){a=e},n.setName=function(e){o=e},n.getBuffer=function(){return i},n.getName=function(){return o},n.compile=function(n){for(var o=[],s=0;s<a.length;s+=1e4)o=Array.prototype.concat.apply(o,a.slice(s,s+1e4));var l=a.length?o.length/a.length:0;if(l!=Math.round(l))throw"buffer elements not of consistent size, average size is "+l;(i=i||e.createBuffer()).length=o.length,i.spacing=l,e.bindBuffer(t,i),e.bufferData(t,new r(o),n||e.STATIC_DRAW)},n};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.plane=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=t.getDirectionA(),i=t.getDirectionB(),o=t.getSizeA(),a=t.getSizeB(),s=Vector.cross(new Vector(n),new Vector(i),new Vector).unit().toArray(),l=new Matrix([n[0],i[0],s[0],0,n[1],i[1],s[1],0,n[2],i[2],s[2],0,0,0,0,1]),u=t.getResolutionU(),g=0;g<=u;g++)for(var c=g/u*a,S=0;S<=u;S++){var f=S/u*o,E=new Vector([2*f-1,2*c-1,0]),d=l.transformVector(E);if(r.vertices.push(d.toArray()),r.coords.push([f,c]),r.normals.push([0,0,1]),S<u&&g<u){var p=S+g*(u+1);r.triangles.push([p+u+1,p+1,p]),r.triangles.push([p+u+2,p+1,p+u+1]),r.lines.push([p+u+1,p]),r.lines.push([p+1,p]),r.lines.push([p+u+2,p+1]),r.lines.push([p+u+2,p+u+1])}}return r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.segment=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!0,triangles:!0,lines:!1,colors:!1}),n=t.getResolutionU(),i=t.getLineWidth()/2,o=[],a=0;a<n;a++){var s=a/(n-1),l=i*Math.sin(s*Math.PI*2),u=i*Math.cos(s*Math.PI*2);o.push(new Vector([l,u,0])),o.push(new Vector([l,u,0]))}var g=new Vector(t.getSize()),c=g.cross(new Vector(0,0,1));0==c.length()&&(c.y=1);var S=g.angle(new Vector(0,0,1)),f=new Matrix;Matrix.rotate(-S,c.x,c.y,c.z,0,0,0,f);for(var E=0;E<o.length;E++){var d=f.transformPoint(o[E]);E%2==0?r.vertices.push(d.add(g).toArray()):r.vertices.push(d.toArray())}for(a=0;a<n-1;a++){var p=2*a,h=2*a+2,m=2*a+1,A=2*a+3;r.triangles.push([A,m,p]),r.triangles.push([h,A,p])}r.vertices.push(g.toArray());for(E=0;E<n-1;E++){p=r.vertices.length-1,m=2*E+2,A=2*E;r.triangles.push([p,m,A])}r.vertices.push([0,0,0]);for(E=0;E<n-1;E++){p=2*E+1,m=2*E+3,A=r.vertices.length-1;r.triangles.push([p,m,A])}return r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Shader={BasicVS:["void main() {","  mat4 m = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix;","  gl_Position = m * vec4(gl_Vertex.xyz, 1.0);","}"].join("\r\n"),BasicFS:["uniform vec3 color;","uniform float opacity;","void main() {","    gl_FragColor = vec4(color, opacity);","}"].join("\r\n"),ColorVS:["varying vec4 color;","void main() {"," color = gl_Color;"," gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);","}"].join("\r\n"),ColorFS:["varying vec4 color;","void main() {"," gl_FragColor = color;","}"].join("\r\n"),LightVS:["uniform float ka;","uniform float kd;","uniform float ks;","uniform float shininessVal;","uniform vec3 ambientColor;","uniform vec3 diffuseColor;","uniform vec3 specularColor;","uniform vec3 lights[10];","uniform int numlight;","varying vec3 tmpcolor;","void main() {","  vec4 vmPos = gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);","  vec3 normal = normalize(gl_NormalMatrix * gl_Normal);","  tmpcolor = vec3(0);","\tfor(int i = 0; i < 10; i++) { ","\t\tif(i == numlight) break;","\t\tvec3 light = normalize(lights[i] - vmPos.xyz);","      float lambertian = abs(dot(normal, light));","      float specular = 0.0;","      if(lambertian > 0.0) {","        vec3 reflect = reflect(-light, normal);","        vec3 vector = normalize(-vmPos.xyz);","        float specAngle = max(dot(reflect, vector), 0.0);","        specular = pow(specAngle, shininessVal);","      }","      tmpcolor += vec3(ka * ambientColor +","        kd * lambertian * diffuseColor +","        ks * specular * specularColor);","\t} ","  gl_Position = gl_ProjectionMatrix * vmPos;","}"].join("\r\n"),LightFS:["uniform float opacity;","varying vec3 tmpcolor;","void main() {","  gl_FragColor = vec4(tmpcolor, opacity);","}"].join("\r\n"),LightAndColorVS:["uniform float ka;","uniform float kd;","uniform float ks;","uniform float shininessVal;","uniform vec3 ambientColor;","uniform vec3 specularColor;","uniform vec3 lights[10];","uniform int numlight;","varying vec3 tmpcolor;","void main() {","  vec4 vmPos = gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);","  vec3 normal = normalize(gl_NormalMatrix * gl_Normal);","  tmpcolor = vec3(0);","\tfor(int i = 0; i < 10; i++) { ","\t\tif(i == numlight) break;","\t\tvec3 light = normalize(lights[i] - vmPos.xyz);","      float lambertian = abs(dot(normal, light));","      float specular = 0.0;","      if(lambertian > 0.0) {","        vec3 reflect = reflect(-light, normal);","        vec3 vector = normalize(-vmPos.xyz);","        float specAngle = max(dot(reflect, vector), 0.0);","        specular = pow(specAngle, shininessVal);","      }","      tmpcolor += vec3(ka * ambientColor +","        kd * lambertian * vec3(gl_Color) +","        ks * specular * specularColor);","\t} ","  gl_Position = gl_ProjectionMatrix * vmPos;","}"].join("\r\n"),LightAndColorFS:["uniform float opacity;","varying vec3 tmpcolor;","void main() {","  gl_FragColor = vec4(tmpcolor, opacity);","}"].join("\r\n"),PaletteColorVS:["uniform vec3 floor;","uniform vec3 ceil;","uniform vec3 floorColor;","uniform vec3 ceilColor;","varying vec3 tmpcolor;","void main() {","  vec4 vmPos = gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);","  vec3 normal = normalize(gl_NormalMatrix * gl_Normal);","  vec3 diff = ceil - floor;","  vec3 diffFloor = vmPos.xyz - floor;","  vec3 diffCeil = vmPos.xyz - ceil;","  float value1 = dot(diff, diffFloor);","  if(value1 < 0.0) {","    tmpcolor = floorColor;","  } else {","    float value2 = dot(diff, diffCeil);","    if(value2 > 0.0) {","      tmpcolor = ceilColor;","    } else {","      float value = length(diffFloor) / (length(diffFloor) + length(diffCeil));","      tmpcolor = floorColor + value * (ceilColor - floorColor);","    }","  }","  gl_Position = gl_ProjectionMatrix * vmPos;","}"].join("\r\n"),PaletteColorFS:["uniform float opacity;","varying vec3 tmpcolor;","void main() {","  gl_FragColor = vec4(tmpcolor, opacity);","}"].join("\r\n"),BasicVSwithTex:["varying vec2 coord;","void main() {","  coord = gl_TexCoord.xy;","  gl_Position = gl_ProjectionMatrix * gl_ViewMatrix * gl_ModelMatrix * vec4(gl_Vertex.xyz, 1.0);","}"].join("\r\n"),BasicFSwithTex:["uniform sampler2D texture;","varying vec2 coord;","void main() {","  gl_FragColor = texture2D(texture, coord);","}"].join("\r\n")},EJSS_WEBGLGRAPHICS.shader=function(e,t,r,n){var i={},o=["uniform mat3 gl_NormalMatrix;","uniform mat4 gl_ModelMatrix;","uniform mat4 gl_ViewMatrix;","uniform mat4 gl_ProjectionMatrix;",""].join("\r\n"),a=[o,"attribute vec4 gl_Vertex;","attribute vec4 gl_TexCoord;","attribute vec3 gl_Normal;","attribute vec4 gl_Color;",""].join("\r\n"),s=["precision highp float;",o].join("\r\n"),l={},u={};function g(e,r){var n={},i=/^((\s*\/\/.*\n|\s*#extension.*\n)+)[^]*$/.exec(r);return r=i?i[1]+e+r.substr(i[1].length):e+r,EJSS_WEBGLGRAPHICS.Utils.regexMap(/\bgl_\w+\b/g,e,(function(e){e in n||(r=r.replace(new RegExp("\\b"+e+"\\b","g"),t+e),n[e]=!0)})),r}function c(t,r){var n=e.createShader(t);if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw"compile error: "+e.getShaderInfoLog(n);return n}i.uniforms=function(t){for(var r in e.useProgram(S),t){var n=u[r]||e.getUniformLocation(S,r);if(n){u[r]=n;var i=t[r];if(i instanceof Vector?i=[i.x,i.y,i.z]:i instanceof Matrix&&(i=i.m),EJSS_WEBGLGRAPHICS.Utils.isArray(i))if(EJSS_WEBGLGRAPHICS.Utils.isArray(i[0])){for(var o=[],a=0;a<i.length;a++)o.push(i[a][0]),o.push(i[a][1]),o.push(i[a][2]);e.uniform3fv(n,new Float32Array(o))}else switch(i.length){case 1:e.uniform1fv(n,new Float32Array(i));break;case 2:e.uniform2fv(n,new Float32Array(i));break;case 3:e.uniform3fv(n,new Float32Array(i));break;case 4:e.uniform4fv(n,new Float32Array(i));break;case 9:e.uniformMatrix3fv(n,!1,new Float32Array([i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]]));break;case 16:e.uniformMatrix4fv(n,!1,new Float32Array([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]]));break;default:throw"don't know how to load uniform \""+r+'" of length '+i.length}else{if(!EJSS_WEBGLGRAPHICS.Utils.isNumber(i))throw'attempted to set uniform "'+r+'" to invalid value '+i;(-1!=r.indexOf("texture")||-1!=r.indexOf("num")?e.uniform1i:e.uniform1f).call(e,n,i)}}}},i.draw=function(t,r){i.drawBuffers(t.getVertexBuffers(),t.getIndexBuffers()[r==e.LINES?"lines":"triangles"],arguments.length<2?e.TRIANGLES:r)},i.drawBuffers=function(a,s,u){var g=function(e,r){var n=e+r,i={};return EJSS_WEBGLGRAPHICS.Utils.regexMap(/\b(gl_[^;]*)\b;/g,o,(function(e){var r=e[1];if(-1!=n.indexOf(r)){var o=r.replace(/[a-z_]/g,"");i[o]=t+r}})),i}(r,n),c=e.modelMatrix,f=e.viewMatrix,E=e.projectionMatrix,d={};if(g.MM&&(d[g.MM]=c),g.VM&&(d[g.VM]=f),g.PM&&(d[g.PM]=E),g.NM){var p=f.multiply(c).inverse().m;d[g.NM]=[p[0],p[4],p[8],p[1],p[5],p[9],p[2],p[6],p[10]]}i.uniforms(d);var h=0;for(var m in a){var A=a[m],_=l[m]||e.getAttribLocation(S,m.replace(/^(gl_.*)$/,t+"$1"));-1!=_&&A.getBuffer()&&(l[m]=_,e.bindBuffer(e.ARRAY_BUFFER,A.getBuffer()),e.enableVertexAttribArray(_),e.vertexAttribPointer(_,A.getBuffer().spacing,e.FLOAT,!1,0,0),h=A.getBuffer().length/A.getBuffer().spacing)}for(var m in l)m in a||e.disableVertexAttribArray(l[m]);!h||s&&!s.getBuffer()||(s?(e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s.getBuffer()),e.drawElements(u,s.getBuffer().length,e.UNSIGNED_SHORT,0)):e.drawArrays(u,0,h))};var S=e.createProgram();if(e.attachShader(S,c(e.VERTEX_SHADER,g(a,r))),e.attachShader(S,c(e.FRAGMENT_SHADER,g(s,n))),e.linkProgram(S),!e.getProgramParameter(S,e.LINK_STATUS))throw"link error: "+e.getProgramInfoLog(S);return i};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.spring=function(e,t){var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=new Vector(t.getSize()),i=new Vector([0,0,0]),o=0;return function(e,t,r,n,i,o,a,s,l){var u=e*t,g=2*Math.PI/t;r<0&&(g*=-1);for(var c=t/2,S=EJSS_TOOLS.Mathematics.normalTo([a.x,a.y,a.z]),f=EJSS_TOOLS.Mathematics.normalize(EJSS_TOOLS.Mathematics.crossProduct([a.x,a.y,a.z],S)),E=0;E<=u;E++){var d;d=i?E<c?0:E<t?E-c:E>u-c?0:E>u-t?u-E-c:c:c;var p=Math.PI/2+E*g,h=Math.cos(p),m=Math.sin(p),A=o.x+E*a.x/u+d*r*(h*S[0]+m*f[0])/c,_=o.y+E*a.y/u+d*r*(h*S[1]+m*f[1])/c,D=o.z+E*a.z/u+d*r*(h*S[2]+m*f[2])/c;if(0!=n){var I=d*Math.cos(2*E*Math.PI/t)/c;A+=n*I*a.x,_+=n*I*a.y,D+=n*I*a.z}0==E?s(A,_,D):l(A,_,D)}}(t.getLoops(),t.getPointsPerLoop(),t.getRadius(),t.getSolenoid(),t.getThinExtremes(),i,n,(function(e,t,n){r.vertices.push([e,t,n]),o++}),(function(e,t,n){r.vertices.push([e,t,n]),r.lines.push([o-1,o]),o++})),r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.surface=function(e,t){createSurfaceBuffers=function(e,t,r,n){for(var i=0;i<e-1;i++)for(var o=0;o<t-1;o++){var a=r[o+i*t],s=r[o+i*t+t],l=r[o+i*t+t+1],u=r[o+i*t+1];n.vertices.push(a),n.vertices.push(s),n.vertices.push(l),n.vertices.push(u)}var g=(e-1)*(t-1)/2;for(i=0;i<8*g;i+=4)n.triangles.push([i,i+1,i+2]),n.triangles.push([i,i+2,i+3]),n.lines.push([i,i+1]),n.lines.push([i,i+3]),n.lines.push([i+2,i+3]),n.lines.push([i+2,i+1]),n.coords.push([0,0]),n.coords.push([0,1]),n.coords.push([1,0]),n.coords.push([1,1])};var r=t.getData();if(r||r.length>0){for(var n=r.length,i=r[0].length,o=new Array,a=0,s=0;s<n;s++)for(var l=0;l<i;l++)o[a]=r[s][l],a++;var u=EJSS_WEBGLGRAPHICS.mesh(e,t.getName());createSurfaceBuffers(n,i,o,u),u.computeNormals(),u.compile(),e.addElement(t.getName()+".mesh",u)}return u};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.text=function(e,t){var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName()),n=t.getFont(),i=t.getBackground(),o=t.getText(),a=n.getFillColor(),s=document.createElement("canvas"),l=s.getContext("2d");l=s.getContext("2d");var u=n.getFontSize();t.getFitText()&&(u=Math.max(s.height,u));var g="";g+="none"!=n.getFontStyle()?n.getFontStyle()+" ":"",g+="none"!=n.getFontWeight()?n.getFontWeight()+" ":"",g+=u+"px ",g+=n.getFontFamily(),l.font=g,i&&(l.fillStyle=i,l.fillRect(0,0,s.width,s.height)),l.textAlign="center",l.textBaseline="middle",l.fillStyle=a,l.fillText(o,s.width/2,s.height/2,s.width);var c=EJSS_WEBGLGRAPHICS.Texture.fromImage(e,s);e.addElement(t.getName()+".texture",c);for(var S=0;S<=1;S++)for(var f=S/1,E=0;E<=1;E++){var d=E/1;if(r.vertices.push([0,2*f-1,2*d-1]),r.coords.push([f,d]),E<1&&S<1){var p=E+2*S;r.triangles.push([p,p+1,p+1+1]),r.triangles.push([p+1+1,p+1,p+1+2])}}return r.computeNormals(),r.computeWireframe(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.Texture={fromImage:function(e,t,r){r=r||{};var n=EJSS_WEBGLGRAPHICS.texture(e,t.width,t.height,r);try{e.texImage2D(e.TEXTURE_2D,0,n.getFormat(),n.getFormat(),n.getType(),t)}catch(e){throw"file:"==location.protocol?'image not loaded for security reasons (serve this page over "http://" instead)':"image not loaded for security reasons (image must originate from the same domain as this page or use Cross-Origin Resource Sharing)"}return r.minFilter&&r.minFilter!=e.NEAREST&&r.minFilter!=e.LINEAR&&e.generateMipmap(e.TEXTURE_2D),n},fromURL:function(e,t,r,n){checkerboardCanvas=function(){var e=document.createElement("canvas").getContext("2d");e.canvas.width=e.canvas.height=128;for(var t=0;t<e.canvas.height;t+=16)for(var r=0;r<e.canvas.width;r+=16)e.fillStyle=16&(r^t)?"#FFF":"#DDD",e.fillRect(r,t,16,16);return e.canvas}();var i=EJSS_WEBGLGRAPHICS.Texture.fromImage(e,checkerboardCanvas,r),o=new Image;return o.onload=function(){EJSS_WEBGLGRAPHICS.Texture.fromImage(e,o,r).swapWith(i),n()},o.src=t,i}},EJSS_WEBGLGRAPHICS.texture=function(e,t,r,n){var i,o,a={};n=n||{};var s=e.createTexture(),l=n.format||e.RGBA,u=n.type||e.UNSIGNED_BYTE;return a.getId=function(){return s},a.setId=function(e){s=e},a.getFormat=function(){return l},a.setFormat=function(e){l=e},a.getType=function(){return u},a.setType=function(e){u=e},a.getWidth=function(){return t},a.setWidth=function(e){t=e},a.getHeight=function(){return r},a.setHeight=function(e){r=e},a.bind=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,s)},a.unbind=function(t){e.activeTexture(e.TEXTURE0+(t||0)),e.bindTexture(e.TEXTURE_2D,null)},a.drawTo=function(n){var a=e.getParameter(e.VIEWPORT);i=i||e.createFramebuffer(),o=o||e.createRenderbuffer(),e.bindFramebuffer(e.FRAMEBUFFER,i),e.bindRenderbuffer(e.RENDERBUFFER,o),t==o.width&&r==o.height||(o.width=t,o.height=r,e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t,r)),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,s,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,o),e.viewport(0,0,t,r),n(),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.viewport(a[0],a[1],a[2],a[3])},a.swapWith=function(e){var n;n=e.getId(),e.setId(s),s=n,n=e.getWidth(),e.setWidth(t),t=n,n=e.getHeight(),e.setHeight(r),r=n},e.bindTexture(e.TEXTURE_2D,s),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n.filter||n.magFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n.filter||n.minFilter||e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,n.wrap||n.wrapS||e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,n.wrap||n.wrapT||e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,l,t,r,0,l,u,null),a};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};EJSS_WEBGLGRAPHICS.trail=function(e,t){for(var r=EJSS_WEBGLGRAPHICS.mesh(e,t.getName(),{coords:!1,normals:!0,triangles:!0,lines:!1,colors:!1}),n=t.getResolutionU(),i=t.getLineWidth()/2,o=t.getPoints(),a=0;a<o.length-1;a++){for(var s=new Vector(o[a]),l=new Vector(o[a+1]),u=l.subtract(s),g=[],c=0;c<n;c++){var S=c/(n-1),f=i*Math.sin(S*Math.PI*2),E=i*Math.cos(S*Math.PI*2);g.push(new Vector([f,E,0])),g.push(new Vector([f,E,0]))}var d=u.cross(new Vector(0,0,1));0==d.length()&&(d.y=1);var p=u.angle(new Vector(0,0,1)),h=new Matrix;Matrix.rotate(-p,d.x,d.y,d.z,0,0,0,h);for(var m=0;m<g.length;m++){var A=h.transformPoint(g[m]);m%2==0?r.vertices.push(A.add(l).toArray()):r.vertices.push(A.add(s).toArray())}for(c=0;c<n-1;c++){var _=2*(c+a*n),D=2*(c+a*n)+2,I=2*(c+a*n)+1,P=2*(c+a*n)+3;r.triangles.push([P,I,_]),r.triangles.push([D,P,_])}}r.vertices.push(new Vector(o[o.length-1]).toArray());for(m=0;m<n-1;m++){_=r.vertices.length-1,I=2*m+2+2*(o.length-2)*n,P=2*m+2*(o.length-2)*n;r.triangles.push([_,I,P])}r.vertices.push(new Vector(o[0]).toArray());for(m=0;m<n-1;m++){_=2*m+1,I=2*m+3,P=r.vertices.length-1;r.triangles.push([_,I,P])}for(a=1;a<o.length-1;a++)for(c=0;c<n-1;c++){_=2*(c+(a-1)*n),D=2*(c+(a-1)*n)+2,I=2*(c+a*n)+1,P=2*(c+a*n)+3;r.triangles.push([P,I,_]),r.triangles.push([D,P,_])}return r.computeNormals(),r.compile(),e.addElement(t.getName()+".mesh",r),r};var EJSS_WEBGLGRAPHICS=EJSS_WEBGLGRAPHICS||{};function Vector(e,t,r){"object"==typeof e?(this.x=e[0]||0,this.y=e[1]||0,this.z=e[2]||0):(this.x=e||0,this.y=t||0,this.z=r||0)}EJSS_WEBGLGRAPHICS.Utils={},EJSS_WEBGLGRAPHICS.Utils.regexMap=function(e,t,r){for(;null!=(result=e.exec(t));)r(result)},EJSS_WEBGLGRAPHICS.Utils.isArray=function(e){var t=Object.prototype.toString.call(e);return"[object Array]"==t||"[object Float32Array]"==t},EJSS_WEBGLGRAPHICS.Utils.isNumber=function(e){var t=Object.prototype.toString.call(e);return"[object Number]"==t||"[object Boolean]"==t},Vector.prototype={setx:function(e){this.x=e},sety:function(e){this.y=e},setz:function(e){this.z=e},getx:function(){return this.x},gety:function(){return this.y},getz:function(){return this.z},rotate:function(){return new Vector(this.z,this.x,this.y)},negative:function(){return new Vector(-this.x,-this.y,-this.z)},add:function(e){return e instanceof Vector?new Vector(this.x+e.x,this.y+e.y,this.z+e.z):new Vector(this.x+e,this.y+e,this.z+e)},subtract:function(e){return e instanceof Vector?new Vector(this.x-e.x,this.y-e.y,this.z-e.z):new Vector(this.x-e,this.y-e,this.z-e)},multiply:function(e){return e instanceof Vector?new Vector(this.x*e.x,this.y*e.y,this.z*e.z):new Vector(this.x*e,this.y*e,this.z*e)},divide:function(e){return e instanceof Vector?new Vector(this.x/e.x,this.y/e.y,this.z/e.z):new Vector(this.x/e,this.y/e,this.z/e)},equals:function(e){return this.x==e.x&&this.y==e.y&&this.z==e.z},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},cross:function(e){return new Vector(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.divide(this.length())},min:function(){return Math.min(Math.min(this.x,this.y),this.z)},max:function(){return Math.max(Math.max(this.x,this.y),this.z)},angle:function(e){return Math.acos(this.dot(e)/(this.length()*e.length()))},toAngles:function(){return{theta:Math.atan2(this.z,this.x),phi:Math.asin(this.y/this.length())}},toArray:function(e){return[this.x,this.y,this.z].slice(0,e||3)},clone:function(){return new Vector(this.x,this.y,this.z)},init:function(e,t,r){return this.x=e,this.y=t,this.z=r,this}},Vector.negative=function(e,t){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},Vector.add=function(e,t,r){return t instanceof Vector?(r.x=e.x+t.x,r.y=e.y+t.y,r.z=e.z+t.z):(r.x=e.x+t,r.y=e.y+t,r.z=e.z+t),r},Vector.subtract=function(e,t,r){return t instanceof Vector?(r.x=e.x-t.x,r.y=e.y-t.y,r.z=e.z-t.z):(r.x=e.x-t,r.y=e.y-t,r.z=e.z-t),r},Vector.multiply=function(e,t,r){return t instanceof Vector?(r.x=e.x*t.x,r.y=e.y*t.y,r.z=e.z*t.z):(r.x=e.x*t,r.y=e.y*t,r.z=e.z*t),r},Vector.divide=function(e,t,r){return t instanceof Vector?(r.x=e.x/t.x,r.y=e.y/t.y,r.z=e.z/t.z):(r.x=e.x/t,r.y=e.y/t,r.z=e.z/t),r},Vector.cross=function(e,t,r){return r.x=e.y*t.z-e.z*t.y,r.y=e.z*t.x-e.x*t.z,r.z=e.x*t.y-e.y*t.x,r},Vector.unit=function(e,t){var r=e.length();return t.x=e.x/r,t.y=e.y/r,t.z=e.z/r,t},Vector.fromAngles=function(e,t){return new Vector(Math.cos(e)*Math.cos(t),Math.sin(t),Math.sin(e)*Math.cos(t))},Vector.randomDirection=function(){return Vector.fromAngles(Math.random()*Math.PI*2,Math.asin(2*Math.random()-1))},Vector.min=function(e,t){return new Vector(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.min(e.z,t.z))},Vector.max=function(e,t){return new Vector(Math.max(e.x,t.x),Math.max(e.y,t.y),Math.max(e.z,t.z))},Vector.lerp=function(e,t,r){return t.subtract(e).multiply(r).add(e)},Vector.fromArray=function(e){return new Vector(e[0],e[1],e[2])};var EJSS_GRAPHICS=EJSS_GRAPHICS||{};EJSS_GRAPHICS.WebGLGraphics={getOffsetRect:function(e){return EJSS_GRAPHICS.GraphicsUtils.getOffsetRect(e)}},EJSS_GRAPHICS.webGLGraphics=function(e){var t=EJSS_INTERFACE.webGLCanvas(e),r=t.getDOMElement(),n=t.getContext(),o={},a=0;function s(e){var t=new Vector(e.getPosition()),r=n.viewMatrix.transformVector(t).z;o[e.getName()]=r;for(var i,a,s=1,l=!1,u=Math.floor(mBlendingElements.length/2);!l;)if(i=0===u||o[mBlendingElements[u-1].getName()]<=r,a=u>=mBlendingElements.length||o[mBlendingElements[u].getName()]>=r,i&&a)mBlendingElements.splice(u,0,e),l=!0;else{s++;var g=Math.ceil(mBlendingElements.length/Math.pow(2,s));u=i?Math.min(mBlendingElements.length,u+g):Math.max(0,u-g)}}function u(e){if(e&&e.length>0)if(EJSS_WEBGLGRAPHICS.Utils.isArray(e[0]))for(var t=0;t<e.length;t++)7==e[t].length?n.rotate(e[t][0],e[t][1],e[t][2],e[t][3],e[t][4],e[t][5],e[t][6]):n.applyMatrix(e[t]);else 7==e.length?n.rotate(e[0],e[1],e[2],e[3],e[4],e[5],e[6]):n.applyMatrix(e)}t.supportsWebGL=function(){return n},t.getEventContext=function(){return r},t.getBox=function(){var e=EJSS_GRAPHICS.WebGLGraphics.getOffsetRect(t);return r.width=e.width,r.height=e.height,e.width-=1,e.height-=1,e},t.getAspect=function(){var e=EJSS_GRAPHICS.WebGLGraphics.getOffsetRect(t),r=Math.max(1,e.height);return e.width/r},t.setTransformationOrder=function(e){a=e},t.getTransformationOrder=function(){return a},t.remove=function(e){},t.reset=function(e,r,i,o,a){if(n){!function(){n.MODEL=305397761,n.VIEW=305397762,n.PROJECTION=305397763;var e=new Matrix,t=new Matrix;n.modelMatrix=new Matrix,n.viewMatrix=new Matrix,n.projectionMatrix=new Matrix;var r,i,o=[],a=[],s=[];n.elements={},n.addElement=function(e,t){n.elements[e]=t},n.getElement=function(e){return n.elements[e]},n.removeElement=function(e){delete n.elements[e]},n.matrixMode=function(e){switch(e){case n.MODEL:r="modelMatrix",i=o;break;case n.VIEW:r="viewMatrix",i=a;break;case n.PROJECTION:r="projectionMatrix",i=s;break;default:throw"invalid matrix mode "+e}},n.loadIdentity=function(){Matrix.identity(n[r])},n.loadMatrix=function(e){for(var t=e.m,i=n[r].m,o=0;o<16;o++)i[o]=t[o]},n.multMatrix=function(e){n.loadMatrix(Matrix.multiply(n[r],e,t))},n.perspective=function(t,r,i,o){n.multMatrix(Matrix.perspective(t,r,i,o,e))},n.frustum=function(t,r,i,o,a,s){n.multMatrix(Matrix.frustum(t,r,i,o,a,s,e))},n.ortho=function(t,r,i,o,a,s){n.multMatrix(Matrix.ortho(t,r,i,o,a,s,e))},n.scale=function(t,r,i){n.multMatrix(Matrix.scale(t,r,i,e))},n.translate=function(t,r,i){n.multMatrix(Matrix.translate(t,r,i,e))},n.applyMatrix=function(e){n.multMatrix(new Matrix(e))},n.rotate=function(t,r,i,o,a,s,l){a=a||0,s=s||0,l=l||0,n.multMatrix(Matrix.rotate(t,r,i,o,a,s,l,e))},n.lookAt=function(t,r,i,o,a,s,l,u,g){n.multMatrix(Matrix.lookAt(t,r,i,o,a,s,l,u,g,e))},n.pushMatrix=function(){i.push(Array.prototype.slice.call(n[r].m))},n.popMatrix=function(){var e=i.pop();n[r].m=hasFloat32Array?new Float32Array(e):e},n.matrixMode(n.MODEL)}();var s=t.getBox(),l=Math.max(1,s.height);n.viewport(0,0,s.width,l),n.matrixMode(n.PROJECTION),n.loadIdentity(),e?n.ortho(r.left,r.right,r.bottom,r.top,-o,a):n.perspective(i,s.width/l,o,a),n.matrixMode(n.VIEW),n.disable(n.CULL_FACE),n.enable(n.POLYGON_OFFSET_FILL),n.enable(n.DEPTH_TEST),n.depthFunc(n.LESS),n.depthMask(!0),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)}},t.putCamera=function(e,t){n&&(n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),e&&(n.matrixMode(n.PROJECTION),0!=t.delta&&(n.scale(t.delta,t.delta,t.delta),t.delta=0)),n.matrixMode(n.VIEW),n.loadIdentity(),n.lookAt(t.location.x,t.location.y,t.location.z,t.focus.x,t.focus.y,t.focus.z,t.upvector.x,t.upvector.y,t.upvector.z),n.rotate(EJSS_TOOLS.Mathematics.radians(t.tilt),1,0,0,t.focus.x,t.focus.y,t.focus.z),n.rotate(EJSS_TOOLS.Mathematics.radians(t.altitude),0,1,0,t.focus.x,t.focus.y,t.focus.z),n.rotate(EJSS_TOOLS.Mathematics.radians(t.azimuth),0,0,1,t.focus.x,t.focus.y,t.focus.z))},t.draw=function(e,r){if(n){o={},mBlendingElements=[];for(var a=[],u=e.slice();u.length;){if((f=u.shift()).getElements){for(var g=f.getLastElements(),c=0,S=g.length;c<S;c++)n.removeElement(g[c].getName()+".mesh");u=f.getElements().concat(u)}else f.getStyle().getTransparency()>0?s(f):a.push(f)}for(i=0,l=a.length;i<l;i++){var f=a[i];t.drawElement(f,r)}for(n.depthMask(!1),n.enable(n.BLEND),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),i=0,l=mBlendingElements.length;i<l;i++){f=mBlendingElements[i];t.drawElement(f,r)}n.disable(n.BLEND),n.depthMask(!0)}},t.drawElement=function(e,r){var i=null;if(e.isGroupVisible()){if(!(i=n.getElement(e.getName()+".mesh"))||e.isMeshChanged()||e.isAlwaysUpdated())switch(e.getClass()){case"ElementArrow":i=EJSS_WEBGLGRAPHICS.arrow(n,e);break;case"ElementSegment":i=EJSS_WEBGLGRAPHICS.segment(n,e);break;case"ElementSphere":case"ElementEllipsoid":i=EJSS_WEBGLGRAPHICS.ellipsoid(n,e);break;case"ElementBox":i=EJSS_WEBGLGRAPHICS.box(n,e);break;case"ElementCylinder":case"ElementCone":case"ElementTetrahedron":case"ElementDisk":i=EJSS_WEBGLGRAPHICS.cylinder(n,e);break;case"ElementBasic":i=EJSS_WEBGLGRAPHICS.basic(n,e);break;case"ElementPlane":i=EJSS_WEBGLGRAPHICS.plane(n,e);break;case"ElementSurface":i=EJSS_WEBGLGRAPHICS.surface(n,e);break;case"ElementAnalyticSurface":i=EJSS_WEBGLGRAPHICS.analyticSurface(n,e);break;case"ElementText":i=EJSS_WEBGLGRAPHICS.text(n,e);break;case"ElementTrail":i=EJSS_WEBGLGRAPHICS.trail(n,e);break;case"ElementAnalyticCurve":i=EJSS_WEBGLGRAPHICS.analyticCurve(n,e);break;case"ElementSpring":i=EJSS_WEBGLGRAPHICS.spring(n,e)}if(i){n.matrixMode(n.MODEL),n.loadIdentity();for(var o=[],s=e;s.getGroup();)s=s.getGroup(),o.unshift(s);for(var l=0;l<o.length;l++){var g=(s=o[l]).getFullTransformation();0!=a&&u(g),n.translate(s.getX()*e.getPanel().getSizeX(),s.getY()*e.getPanel().getSizeY(),s.getZ()*e.getPanel().getSizeZ()),n.scale(s.getSizeX(),s.getSizeY(),s.getSizeZ()),0==a&&u(g)}var c=e.getFullTransformation();0!=a&&u(c),n.translate(e.getX()*e.getPanel().getSizeX(),e.getY()*e.getPanel().getSizeY(),e.getZ()*e.getPanel().getSizeZ()),0==a&&u(c),"ElementArrow"==e.getClass()||"ElementSegment"==e.getClass()||"ElementSpring"==e.getClass()?n.scale(e.getPanel().getSizeX(),e.getPanel().getSizeY(),e.getPanel().getSizeZ()):"ElementTrail"==e.getClass()||"ElementSurface"==e.getClass()?n.scale(e.getPanel().getSizeX()*e.getSizeX(),e.getPanel().getSizeY()*e.getSizeY(),e.getPanel().getSizeZ()*e.getSizeZ()):n.scale(e.getPanel().getSizeX()*e.getSizeX()/2,e.getPanel().getSizeY()*e.getSizeY()/2,e.getPanel().getSizeZ()*e.getSizeZ()/2),t.drawMesh(n,e,i),n.matrixMode(n.VIEW)}}return i},t.drawPanel=function(e){if(n){var r=e.getStyle();if(e.isImageUrl())n.clearColor(0,0,0,1);else{var i=r.getFillColor();n.clearColor(i[0],i[1],i[2],void 0!==i[3]?i[3]:1)}return t}},t.drawMesh=function(e,t,r){var n=1-t.getStyle().getTransparency()/255,i=t.getTextureUrl();if("ElementText"==t.getClass()||i&&i.length>0){var o=e.getElement(r.getId()+".shader_tex"),a=e.getElement(r.getId()+".texture");if(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_tex",EJSS_WEBGLGRAPHICS.Shader.BasicVSwithTex,EJSS_WEBGLGRAPHICS.Shader.BasicFSwithTex),a)a.bind(),o.uniforms({texture:0}),o.draw(r),a.unbind(),e.addElement(r.getId()+".texture",a);else{var s=EJSS_WEBGLGRAPHICS.Texture.fromURL(e,i,{},(function(e){t.getController().invokeAction("OnLoadTexture"),t.getController().reportInteractions()}));s.bind(),o.uniforms({texture:0}),o.draw(r),s.unbind(),e.addElement(r.getId()+".texture",s)}e.addElement(r.getId()+".shader_tex",o)}else{if(t.getStyle().getDrawLines())(o=(o=e.getElement(r.getId()+".shader_lines"))||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_lines",EJSS_WEBGLGRAPHICS.Shader.BasicVS,EJSS_WEBGLGRAPHICS.Shader.BasicFS)).uniforms({color:t.getStyle().getLineColor(),opacity:n}),o.draw(r,e.LINES),e.addElement(r.getId()+".shader_lines",o);if(t.getStyle().getDrawFill()){o=e.getElement(r.getId()+".shader_fill");var l=void 0!==t.getColors&&t.getColors().length>0,u=t.getGroupPanel().getLights().length>0;void 0!==t.getStyle().getPaletteFloor()?(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.PaletteColorVS,EJSS_WEBGLGRAPHICS.Shader.PaletteColorFS)).uniforms({floor:t.getStyle().getPaletteFloor(),ceil:t.getStyle().getPaletteCeil(),floorColor:t.getStyle().getPaletteFloorColor(),ceilColor:t.getStyle().getPaletteCeilColor()}):l?u?(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.LightAndColorVS,EJSS_WEBGLGRAPHICS.Shader.LightAndColorFS)).uniforms({ambientColor:t.getStyle().getAmbientColor(),specularColor:t.getStyle().getSpecularColor(),ka:t.getStyle().getAmbientReflection(),kd:t.getStyle().getColorReflection(),ks:t.getStyle().getSpecularReflection(),shininessVal:t.getStyle().getShininessVal()}):o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.ColorVS,EJSS_WEBGLGRAPHICS.Shader.ColorFS):u?(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.LightVS,EJSS_WEBGLGRAPHICS.Shader.LightFS)).uniforms({ambientColor:t.getStyle().getAmbientColor(),diffuseColor:t.getStyle().getFillColor(),specularColor:t.getStyle().getSpecularColor(),ka:t.getStyle().getAmbientReflection(),kd:t.getStyle().getColorReflection(),ks:t.getStyle().getSpecularReflection(),shininessVal:t.getStyle().getShininessVal()}):(o=o||EJSS_WEBGLGRAPHICS.shader(e,r.getId()+"_fill",EJSS_WEBGLGRAPHICS.Shader.BasicVS,EJSS_WEBGLGRAPHICS.Shader.BasicFS)).uniforms({color:t.getStyle().getFillColor()});var g=t.getGroupPanel().getLights(),c=g.length;o.uniforms({numlight:c,light:g,opacity:n}),o.draw(r,e.TRIANGLES),e.addElement(r.getId()+".shader_fill",o)}}};return t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Plane={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setDirectionA(e.getDirectionA()),t.setDirectionB(e.getDirectionB()),t.setSizeA(e.getSizeA()),t.setSizeB(e.getSizeB())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("DirectionA",e.setDirectionA),t.registerProperty("DirectionB",e.setDirectionB),t.registerProperty("SizeA",e.setSizeA),t.registerProperty("SizeB",e.setSizeB)}},EJSS_DRAWING3D.plane=function(e){var t=EJSS_DRAWING3D.element(e),r=[1,0,0],n=[0,1,0],i=1,o=1;return t.getClass=function(){return"ElementPlane"},t.setDirectionA=function(e){EJSS_TOOLS.compareArrays(r,e)||(r=e.slice(),t.setMeshChanged(!0))},t.getDirectionA=function(){return r},t.setDirectionB=function(e){EJSS_TOOLS.compareArrays(n,e)||(n=e.slice(),t.setMeshChanged(!0))},t.getDirectionB=function(){return n},t.setSizeA=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getSizeA=function(){return i},t.setSizeB=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getSizeB=function(){return o},t.registerProperties=function(e){EJSS_DRAWING3D.Plane.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Plane.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.PlaneSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t),t.registerProperty("DirectionA",(function(t){e.setToEach((function(e,t){e.setDirectionA(t)}),t)})),t.registerProperty("DirectionB",(function(t){e.setToEach((function(e,t){e.setDirectionB(t)}),t)})),t.registerProperty("SizeA",(function(t){e.setToEach((function(e,t){e.setSizeA(t)}),t)})),t.registerProperty("SizeB",(function(t){e.setToEach((function(e,t){e.setSizeB(t)}),t)}))}},EJSS_DRAWING3D.planeSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.plane,e),r=EJSS_DRAWING3D.PlaneSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Segment={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setLineColor(e.getLineColor()),t.setLineWidth(e.getLineWidth())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("LineColor",e.setLineColor,e.getLineColor),t.registerProperty("LineWidth",e.setLineWidth,e.getLineWidth)}},EJSS_DRAWING3D.segment=function(e){var t=EJSS_DRAWING3D.element(e),r=0,n=0,i=0,o=1,a=1,s=1,l=.01;return t.getClass=function(){return"ElementSegment"},t.setX=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getX=function(){return r},t.setY=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getY=function(){return n},t.setZ=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getZ=function(){return i},t.setPosition=function(e){t.setX(e[0]),t.setY(e[1]),t.setZ(e[2])},t.getPosition=function(){return[r,n,i]},t.setSizeX=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.setSizeY=function(e){a!=e&&(a=e,t.setMeshChanged(!0))},t.setSizeZ=function(e){s!=e&&(s=e,t.setMeshChanged(!0))},t.getSizeX=function(){return o},t.getSizeY=function(){return a},t.getSizeZ=function(){return s},t.setSize=function(e){t.setSizeX(e[0]),t.setSizeY(e[1]),t.setSizeZ(e[2])},t.getSize=function(){return[t.getSizeX(),t.getSizeY(),t.getSizeZ()]},t.setLineColor=function(e){t.getStyle().setFillColor(e)},t.getLineColor=function(){return t.getStyle().getFillColor()},t.setLineWidth=function(e){e!=l&&(l=e,t.setMeshChanged(!0))},t.getLineWidth=function(){return l},t.registerProperties=function(e){EJSS_DRAWING3D.Segment.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Segment.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!0),t.getStyle().setDrawLines(!1),t.setResolution([24,2]),t},EJSS_DRAWING3D.SegmentSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t),t.registerProperty("LineWidth",(function(t){e.setToEach((function(e,t){e.setLineWidth(t)}),t)})),t.registerProperty("LineColor",(function(t){e.setToEach((function(e,t){e.setLineColor(t)}),t)}))}},EJSS_DRAWING3D.segmentSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.segment,e),r=EJSS_DRAWING3D.SegmentSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Sphere={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Ellipsoid.copyTo(e,t),t.setRadius(e.getRadius())},registerProperties:function(e,t){EJSS_DRAWING3D.Ellipsoid.registerProperties(e,t),t.registerProperty("Radius",e.setRadius)}},EJSS_DRAWING3D.sphere=function(e){var t=EJSS_DRAWING3D.ellipsoid(e),r=.5;return t.getClass=function(){return"ElementSphere"},t.setRadius=function(e){r=e,t.setSize([2*e,2*e,2*e])},t.getRadius=function(){return r},t.copyTo=function(e){EJSS_DRAWING3D.Sphere.copyTo(t,e)},t.registerProperties=function(e){EJSS_DRAWING3D.Sphere.registerProperties(t,e)},t.setSize([1,1,1]),t.setResolution([30,20]),t},EJSS_DRAWING3D.SphereSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t),t.registerProperty("Radius",(function(t){e.setToEach((function(e,t){e.setRadius(t)}),t)}))}},EJSS_DRAWING3D.sphereSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.sphere,e),r=EJSS_DRAWING3D.SphereSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Spring={DEF_RADIUS:1,DEF_LOOPS:8,DEF_PPL:50,copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setRadius(e.getRadius()),t.setSolenoid(e.getSolenoid()),t.setThinExtremes(e.getThinExtremes()),t.setLoops(e.getLoops()),t.setPointsPerLoop(e.getPointsPerLoop())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Radius",e.setRadius,e.getRadius),t.registerProperty("ThinExtremes",e.setThinExtremes,e.getThinExtremes),t.registerProperty("Solenoid",e.setSolenoid,e.getSolenoid),t.registerProperty("Loops",e.setLoops,e.getLoops),t.registerProperty("PointsPerLoop",e.setPointsPerLoop,e.getPointsPerLoop)}},EJSS_DRAWING3D.spring=function(e){var t,r,n=EJSS_DRAWING3D.element(e),i=EJSS_DRAWING3D.Spring.DEF_RADIUS,o=0,a=!0,s=0,l=0,u=0,g=1,c=1,S=1;return n.getClass=function(){return"ElementSpring"},n.setRadius=function(e){i!=e&&(i=e,n.setMeshChanged(!0))},n.getRadius=function(){return i},n.setSolenoid=function(e){o!=e&&(o=e,n.setMeshChanged(!0))},n.getSolenoid=function(){return o},n.setThinExtremes=function(e){a!=e&&(a=e,n.setMeshChanged(!0))},n.getThinExtremes=function(){return a},n.setLoops=function(e){t!=e&&(t=e,n.setMeshChanged(!0))},n.getLoops=function(){return t},n.setPointsPerLoop=function(e){r!=e&&(r=e,n.setMeshChanged(!0))},n.getPointsPerLoop=function(){return r},n.setX=function(e){s!=e&&(s=e,n.setMeshChanged(!0))},n.getX=function(){return s},n.setY=function(e){l!=e&&(l=e,n.setMeshChanged(!0))},n.getY=function(){return l},n.setZ=function(e){u!=e&&(u=e,n.setMeshChanged(!0))},n.getZ=function(){return u},n.setPosition=function(e){n.setX(e[0]),n.setY(e[1]),n.setZ(e[2])},n.getPosition=function(){return[s,l,u]},n.setSizeX=function(e){g!=e&&(g=e,n.setMeshChanged(!0))},n.setSizeY=function(e){c!=e&&(c=e,n.setMeshChanged(!0))},n.setSizeZ=function(e){S!=e&&(S=e,n.setMeshChanged(!0))},n.getSizeX=function(){return g},n.getSizeY=function(){return c},n.getSizeZ=function(){return S},n.setSize=function(e){n.setSizeX(e[0]),n.setSizeY(e[1]),n.setSizeZ(e[2])},n.getSize=function(){return[n.getSizeX(),n.getSizeY(),n.getSizeZ()]},n.registerProperties=function(e){EJSS_DRAWING3D.Spring.registerProperties(n,e)},n.copyTo=function(e){EJSS_DRAWING3D.Spring.copyTo(n,e)},n.setSize([1,1,1]),n.getStyle().setDrawFill(!0),n.getStyle().setDrawLines(!0),n.setLoops(EJSS_DRAWING2D.Spring.DEF_LOOPS),n.setPointsPerLoop(EJSS_DRAWING2D.Spring.DEF_PPL),n},EJSS_DRAWING3D.SpringSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t),t.registerProperty("Radius",(function(t){e.setToEach((function(e,t){e.setRadius(t)}),t)})),t.registerProperty("ThinExtremes",(function(t){e.setToEach((function(e,t){e.setThinExtremes(t)}),t)})),t.registerProperty("Solenoid",(function(t){e.setToEach((function(e,t){e.setSolenoid(t)}),t)})),t.registerProperty("Loops",(function(t){e.setToEach((function(e,t){e.setLoops(t)}),t)})),t.registerProperty("PointsPerLoop",(function(t){e.setToEach((function(e,t){e.setPointsPerLoop(t)}),t)}))}},EJSS_DRAWING3D.springSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.spring,e),r=EJSS_DRAWING3D.SpringSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Surface={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),t.setData(e.getData())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Data",e.setData)}},EJSS_DRAWING3D.surface=function(e){var t=EJSS_DRAWING3D.element(e),r=[];return t.getClass=function(){return"ElementSurface"},t.setData=function(e){EJSS_TOOLS.compareArrays(r,e)||(r=e.slice(),t.setMeshChanged(!0))},t.getData=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Surface.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Surface.copyTo(t,e)},t.setSize([1,1,1]),t},EJSS_DRAWING3D.SurfaceSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t),t.registerProperty("Data",(function(t){e.setToEach((function(e,t){e.setData(t)}),t)}))}},EJSS_DRAWING3D.surfaceSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.surface,e),r=EJSS_DRAWING3D.SurfaceSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Tetrahedron={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING3D.Cylinder.copyTo(e,t)},registerProperties:function(e,t){EJSS_DRAWING3D.Cylinder.registerProperties(e,t)}},EJSS_DRAWING3D.tetrahedron=function(e){var t=EJSS_DRAWING3D.cylinder(e);return t.getClass=function(){return"ElementTetrahedron"},t.registerProperties=function(e){EJSS_DRAWING3D.Tetrahedron.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Tetrahedron.copyTo(t,e)},t.setSize([1,1,1]),t.setTopRadius(0),t.setResolutionU(4),t},EJSS_DRAWING3D.TetrahedronSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t)}},EJSS_DRAWING3D.tetrahedronSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.tetrahedron,e),r=EJSS_DRAWING3D.TetrahedronSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Text={copyTo:function(e,t){EJSS_DRAWING3D.Element.copyTo(e,t),EJSS_DRAWING2D.Font.copyTo(e.getFont(),t.getFont()),t.setText(e.getText()),t.setBackground(e.getBackground())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Background",e.setBackground),t.registerProperty("FitText",e.setFitText),t.registerProperty("Font",e.getFont().setFont),t.registerProperty("FontFamily",e.getFont().setFontFamily),t.registerProperty("FontSize",e.getFont().setFontSize),t.registerProperty("FontColor",e.getFont().setFillColor),t.registerProperty("FontStyle",e.getFont().setFontStyle)}},EJSS_DRAWING3D.text=function(e){var t=EJSS_DRAWING3D.element(e),r=EJSS_DRAWING2D.font(e),n="",i="rgba(255,255,255,0)",o=!1;return t.getClass=function(){return"ElementText"},t.setBackground=function(e){return"string"!=typeof e&&(e=EJSS_TOOLS.DisplayColors.getLineColor(e)),e!=i&&(i=e,t.setMeshChanged(!0)),t},t.getBackground=function(){return i},t.setText=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getText=function(){return n},t.setFitText=function(e){o!=e&&(o=e,t.setMeshChanged(!0))},t.getFitText=function(){return o},t.getFont=function(){return r},t.registerProperties=function(e){EJSS_DRAWING3D.Text.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING3D.Text.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setTransparency(255),t},EJSS_DRAWING3D.TextSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t),t.registerProperty("Text",(function(t){e.setToEach((function(e,t){e.setText(t)}),t)})),t.registerProperty("Background",(function(t){e.setToEach((function(e,t){e.setBackground(t)}),t)})),t.registerProperty("Font",(function(t){e.setToEach((function(e,t){e.getFont().setFont(t)}),t)})),t.registerProperty("FontFamily",(function(t){e.setToEach((function(e,t){e.getFont().setFontFamily(t)}),t)})),t.registerProperty("FontSize",(function(t){e.setToEach((function(e,t){e.getFont().setFontSize(t)}),t)})),t.registerProperty("FontColor",(function(t){e.setToEach((function(e,t){e.getFont().setFillColor(t)}),t)})),t.registerProperty("FontStyle",(function(t){e.setToEach((function(e,t){e.getFont().setFontStyle(t)}),t)}))}},EJSS_DRAWING3D.textSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.text,e),r=EJSS_DRAWING3D.TextSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_DRAWING3D=EJSS_DRAWING3D||{};EJSS_DRAWING3D.Trail={NO_CONNECTION:0,LINE_CONNECTION:1,copyTo:function(e,t){EJSS_DRAWING2D.Element.copyTo(e,t),t.setActive(e.getActive()),t.setNoRepeat(e.getNoRepeat()),t.setClearAtInput(e.getClearAtInput()),t.setSkip(e.getSkip()),t.setInputLabels(e.getInputLabels()),t.setMaximumPoints(e.getMaximumPoints()),t.setConnectionType(e.getConnectionType()),t.setPoints(e.getPoints()),t.setLineColor(e.getLineColor()),t.setLineWidth(e.getLineWidth())},registerProperties:function(e,t){EJSS_DRAWING3D.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.getActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.getNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.getClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("ColumnNames",e.setInputLabels,e.getInputLabels),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("ConnectionType",e.setConnectionType,e.getConnectionType),t.registerProperty("Connected",e.setConnected,e.isConnected),t.registerProperty("Points",e.setPoints,e.getPoints),t.registerProperty("LastPoint",e.addPoint,e.getLastPoint),t.registerProperty("Input",e.addPoints),t.registerProperty("InputX",e.addXPoints),t.registerProperty("InputY",e.addYPoints),t.registerProperty("InputZ",e.addZPoints),t.registerProperty("LineColor",e.setLineColor,e.getLineColor),t.registerProperty("LineWidth",e.setLineWidth,e.getLineWidth)}},EJSS_DRAWING3D.trail=function(e){var t=EJSS_DRAWING3D.element(e),r=!0,n=!1,i=!1,o=0,a=["x","y","z"],s=0,l=EJSS_DRAWING3D.Trail.LINE_CONNECTION,u=0,g=0,c=0,S=[],f=[],E=[],d=0,p=0,h=0,m=.01;function A(e,r,i,a){isNaN(e)||isNaN(r)?!0:n&&g[0]==e&&g[1]==r&&g[2]==i||(null==a&&(a=l),c=0,g=t.formatPoint([e,r,i,a]),o>0&&(u>0&&(c=t.formatPoint([e,r,i,a])),++u>=o&&(u=0)),0==c&&(s>2&&S.length>=s&&S.splice(0,1),S[S.length]=t.formatPoint([e,r,i,a]),!1))}return t.getClass=function(){return"ElementTrail"},t.setLineColor=function(e){t.getStyle().setFillColor(e)},t.getLineColor=function(){return t.getStyle().getFillColor()},t.setLineWidth=function(e){e!=m&&(m=e,t.setMeshChanged(!0))},t.getLineWidth=function(){return m},t.setActive=function(e){r!=e&&(r=e,t.setMeshChanged(!0))},t.getActive=function(){return r},t.setNoRepeat=function(e){n!=e&&(n=e,t.setMeshChanged(!0))},t.getNoRepeat=function(){return n},t.setClearAtInput=function(e){i!=e&&(i=e,t.setMeshChanged(!0))},t.getClearAtInput=function(){return i},t.setSkip=function(e){o!=e&&(o=e,u=0,t.setMeshChanged(!0))},t.getSkip=function(){return o},t.setInputLabels=function(e){a[0]==e[0]&&a[1]==e[1]&&a[2]==e[2]||(a[0]=e[0],a[1]=e[1],a[2]=e[2],t.setMeshChanged(!0))},t.getInputLabels=function(){return a},t.setMaximumPoints=function(e){var r=Math.max(e,2);s!=r&&(s=r,t.setMeshChanged(!0))},t.getMaximumPoints=function(){return s},t.setConnected=function(e){e?t.setConnectionType(EJSS_DRAWING3D.Trail.LINE_CONNECTION):t.setConnectionType(EJSS_DRAWING3D.Trail.NO_CONNECTION)},t.isConnected=function(){return l===EJSS_DRAWING3D.Trail.LINE_CONNECTION},t.setConnectionType=function(e){"string"==typeof e&&(e=EJSS_DRAWING3D.Trail[e.toUpperCase()]),l!=e&&(l=e,t.setMeshChanged(!0))},t.getConnectionType=function(){return l},t.addPoint=function(e,r,n,o){i&&t.initialize(),e instanceof Array?A(e[0],e[1],e[2],o):A(e,r,n,o),t.setMeshChanged(!0)},t.addPoints=function(e,r,n){if(i&&t.initialize(),e[0]instanceof Array)for(var o=0,a=e.length;o<a;o++)A(e[o][0],e[o][1],e[o][2],l);else if(e&&r&&n)for(a=Math.min(e.length,r.length,n.length),o=0;o<a;o++)A(e[o],r[o],n[o],l);t.setMeshChanged(!0)},t.addXPoints=function(e){var t=0;if(e instanceof Array){for(var r=e.length;t<r;t++)E[t]?E[t]=[e[t],E[t][1],E[t][2],E[t][3]]:E[t]=[e[t],p,h,l];d=e[t]}else E[t]?E[t]=[e,E[t][1],E[t][2],E[t][3]]:E[t]=[e,p,h,l],t++,d=e;for(;E[t];)E[t]=[d,E[t][1],E[t][2],E[t][3]],t++},t.addYPoints=function(e){var t=0;if(e instanceof Array){for(var r=e.length;t<r;t++)E[t]?E[t]=[E[t][0],e[t],E[t][2],E[t][3]]:E[t]=[d,e[t],h,l];p=e[t]}else E[t]?E[t]=[E[t][0],e,E[t][2],E[t][3]]:E[t]=[d,e,h,l],t++,p=e;for(;E[t];)E[t]=[E[t][0],p,E[t][2],E[t][3]],t++},t.addZPoints=function(e){var t=0;if(e instanceof Array){for(var r=e.length;t<r;t++)E[t]?E[t]=[E[t][0],E[t][1],e[t],E[t][3]]:E[t]=[d,p,e[t],l];h=e[t]}else E[t]?E[t]=[E[t][0],E[t][1],e,E[t][3]]:E[t]=[d,p,e,l],t++,h=e;for(;E[t];)E[t]=[E[t][0],E[t][1],h,E[t][3]],t++},t.dataCollected=function(){E.length>0&&(t.addPoints(E),E=[],t.setMeshChanged(!0))},t.setPoints=function(e,r,n,i){t.clear(),t.addPoints(e,r,n,i),t.setMeshChanged(!0)},t.moveToPoint=function(e,r,n){i&&t.initialize(),e instanceof Array?A(e[0],e[1],e[2],EJSS_DRAWING3D.Trail.NO_CONNECTION):A(e,r,n,EJSS_DRAWING3D.Trail.NO_CONNECTION),t.setMeshChanged(!0)},t.getPoints=function(){for(var e=[],t=f.length,r=0;r<t;r++)e=e.concat(f[r]);return e=e.concat(S)},t.getLastPoint=function(){return g},t.reset=function(){t.clear()},t.clear=function(){f=[],mCurrentSegment=0,t.initialize()},t.initialize=function(){S=[],c=0,!0,u=0,g=0,t.setMeshChanged(!0)},t.newSegment=function(){if(0!=c){var e=S.length;S[e]=t.formatPoint(c)}e=f.length;f[e]=S,t.initialize()},t.formatPoint=function(e){return e},t.registerProperties=function(e){EJSS_DRAWING3D.Trail.registerProperties(t,e)},t.copyTo=function(e){EJSS_DRAWING2D.Trail.copyTo(t,e)},t.setSize([1,1,1]),t.getStyle().setDrawFill(!0),t.getStyle().setDrawLines(!1),t.setResolution([24,2]),t},EJSS_DRAWING3D.TrailSet={registerProperties:function(e,t){EJSS_DRAWING3D.ElementSet.registerProperties(e,t),t.registerProperty("Active",(function(t){e.setToEach((function(e,t){e.setActive(t)}),t)})),t.registerProperty("NoRepeat",(function(t){e.setToEach((function(e,t){e.setNoRepeat(t)}),t)})),t.registerProperty("ClearAtInput",(function(t){e.setToEach((function(e,t){e.setClearAtInput(t)}),t)})),t.registerProperty("Skip",(function(t){e.setToEach((function(e,t){e.setSkip(t)}),t)})),t.registerProperty("ColumnNames",(function(t){e.setToEach((function(e,t){e.setInputLabels(t)}),t)})),t.registerProperty("Maximum",(function(t){e.setToEach((function(e,t){e.setMaximumPoints(t)}),t)})),t.registerProperty("ConnectionType",(function(t){e.setToEach((function(e,t){e.setConnectionType(t)}),t)})),t.registerProperty("Connected",(function(t){e.setToEach((function(e,t){e.setConnected(t)}),t)})),t.registerProperty("Points",(function(t){e.setToEach((function(e,t){e.setPoints(t)}),t)})),t.registerProperty("LastPoint",(function(t){e.setToEach((function(e,t){e.addPoint(t)}),t)})),t.registerProperty("Input",(function(t){e.setToEach((function(e,t){e.addPoints(t)}),t)})),t.registerProperty("InputX",(function(t){e.setToEach((function(e,t){e.addXPoints(t)}),t)})),t.registerProperty("InputY",(function(t){e.setToEach((function(e,t){e.addYPoints(t)}),t)})),t.registerProperty("InputZ",(function(t){e.setToEach((function(e,t){e.addZPoints(t)}),t)})),t.registerProperty("LineWidth",(function(t){e.setToEach((function(e,t){e.setLineWidth(t)}),t)})),t.registerProperty("LineColor",(function(t){e.setToEach((function(e,t){e.setLineColor(t)}),t)}))}},EJSS_DRAWING3D.trailSet=function(e){var t=EJSS_DRAWING3D.elementSet(EJSS_DRAWING3D.trail,e),r=EJSS_DRAWING3D.TrailSet;return t.registerProperties=function(e){r.registerProperties(t,e)},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ArrayPanel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Editable",e.setEditable,e.getEditable),t.registerProperty("Transpose",e.setTranspose,e.getTranspose),t.registerProperty("DataArray",e.setDataArray,e.getDataArray),t.registerProperty("ColumnsWidth",e.setColumnsWidth,e.getColumnsWidth),t.registerProperty("HeadersText",e.setHeadersText,e.getHeadersText),t.registerProperty("HeadersCSS",e.setHeadersCSS,e.getHeadersCSS),t.registerProperty("CellsFormat",e.setCellsFormat,e.getCellsFormat),t.registerProperty("CellsCSS",e.setCellsCSS,e.getCellsCSS),t.registerProperty("BodyHeight",e.setBodyHeight,e.getBodyHeight),t.registerProperty("EditableBkgd",e.setEditableBkgd,e.getEditableBkgd),t.registerProperty("NonEditableBkgd",e.setNonEditableBkgd,e.getNonEditableBkgd),t.registerAction("OnChange",e.getElementInteracted)}},EJSS_INTERFACE.arrayPanel=function(e){var t,r,n,i,o,a,s,l=EJSS_INTERFACE.element(e),u=!1,g="White",c="LightGrey",S={row:-1,column:-1},f=!0,E=!1,d="",p="";function h(e){var t=e.innerHTML.replace(/(<([^>]+)>)/gi,""),n=parseFloat(t);if(!isNaN(n)&&isFinite(t)){if(e.style.backgroundColor=p,d!=t){var i=e.cellIndex,o=e.parentNode.rowIndex;r&&(o-=1),u?a[i][o]=n:a[o][i]=n;var s=l.getController();s&&(s.propertiesChanged("DataArray"),u?(S.row=i,S.column=o):(S.row=o,S.column=i),s.invokeAction("OnChange"),s.reportInteractions())}}else e.style.backgroundColor="red"}function m(e,t){if(void 0!==t&&t.length>0){var r=t.indexOf("."),n=t.toUpperCase().indexOf("E");if(-1==n){var i=0;return r>=0&&(i=Number(t.length-r-1)),parseFloat(e).toFixed(i)}i=0;return r>=0&&(i=Number(n-r-1)),parseFloat(e).toExponential(i)}return e}l.enableEPub=function(){l.getDOMElement().disabled&&(l.getDOMElement().disabled=!1)},l.setTranspose=function(e){u!=e&&(u=e,f=!0)},l.getTranspose=function(){return u},l.setEditable=function(e){s=e},l.getEditable=function(){return s},l.setDataArray=function(e){EJSS_TOOLS.compareArrays(a,e)||(a=e.slice(),f=!0)},l.getDataArray=function(){return a},l.setColumnsWidth=function(e){t=e},l.getColumnsWidth=function(){return t},l.setHeadersText=function(e){r=e},l.getHeadersText=function(){return r},l.setCellsFormat=function(e){n=e},l.getCellsFormat=function(){return n},l.setHeadersCSS=function(e){i=e},l.getHeadersCSS=function(){return i},l.setCellsCSS=function(e){o=e},l.getCellsCSS=function(){return o},l.setEditableBkgd=function(e){g!=e&&(g=e,f=!0)},l.getEditableBkgd=function(e){return g},l.setNonEditableBkgd=function(e){c!=e&&(c=e,f=!0)},l.getNonEditableBkgd=function(e){return c},l.setBodyHeight=function(e){"string"!=typeof e&&(e+="px"),_.style.height=e},l.getBodyHeight=function(){return _.style.height},l.getElementInteracted=function(){return S},l.registerProperties=function(e){EJSS_INTERFACE.ArrayPanel.registerProperties(l,e)},l.enableEPub=function(){l.getDOMElement().disabled&&(l.getDOMElement().disabled=!1)},l.render=function(){f&&!E&&(!function(){if(_.innerHTML="",D.innerHTML="",r){(p=document.createElement("tr")).style.border="inherit";for(var e=r.length,S=0;S<e;S++){var f=document.createElement("th");t&&t[S]&&("number"==typeof t[S]?f.style.width=t[S]+"px":"string"==typeof t[S]&&(f.style.width[S]=t[S])),i&&i[S]&&EJSS_INTERFACE.Style.setCSS(f,i[S]),f.innerHTML=r[S],p.appendChild(f)}1==e&&(f.colSpan="100%"),D.appendChild(p)}if(a){var E=0,d=0;if(u){d=a.length;for(S=0;S<d;S++)E=Math.max(E,a[S].length)}else{E=a.length;for(S=0;S<E;S++)d=Math.max(d,a[S].length)}if(E<=0||d<=0)return;for(S=0;S<E;S++){var p;(p=document.createElement("tr")).style.border="inherit";for(var h=0;h<d;h++){var A,I,P=document.createElement("td");t&&t[h]&&("number"==typeof t[h]?P.style.width=t[h]+"px":"string"==typeof t[h]&&(P.style.width=t[h])),n&&(A=n instanceof Array?n[h]:n),I=s instanceof Array?s[h]:void 0===s||s,u?S>=a[h].length?I=!1:P.innerHTML=m(a[h][S],A):h>=a[S].length?I=!1:P.innerHTML=m(a[S][h],A),I?(P.contentEditable=!0,P.onblur=l.handleOnBlur,P.onfocus=l.handleOnFocus,P.onkeydown=l.handleOnKeydown,P.style.backgroundColor=g):P.style.backgroundColor=c,o&&o[h]&&EJSS_INTERFACE.Style.setCSS(P,o[h]),p.appendChild(P)}_.appendChild(p)}}}(),f=!1),"undefined"!=typeof _isEPub&&_isEPub&&l.enableEPub()},l.handleOnBlur=function(e){var t=e.target||e.srcElement;E&&(E=!1,h(t))},l.handleOnFocus=function(e){var t=e.target||e.srcElement;d=t.innerHTML,p=t.style.backgroundColor},l.handleOnKeydown=function(e){var t=e||window.event,r=t.which?t.which:t.keyCode,n=t.target||t.srcElement;13==r?(E=!1,h(n),d=n.innerHTML):27==r?n.innerHTML=d:(n.style.backgroundColor="yellow",E=!0)};var A=document.createElement("table"),_=document.createElement("tbody"),D=document.createElement("thead");return A.style.display="inline-block",A.appendChild(D),A.appendChild(_),A.id=e,document.body.appendChild(A),A.className="ArrayPanel",l.setDOMElement(A),l};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Audio={registerProperties:function(e,t){EJSS_INTERFACE.Media.registerProperties(e,t),t.registerProperty("AudioUrl",e.setUrl,e.getUrl)}},EJSS_INTERFACE.audio=function(e){var t=EJSS_INTERFACE.media(e);t.registerProperties=function(e){EJSS_INTERFACE.Audio.registerProperties(t,e)},t.setUrl=function(e){e=t.getResourcePath(e,!1),n.src=e},t.getUrl=function(){return n.src};var r=document.createElement("audio");r.id=e,document.body.appendChild(r);var n=document.createElement("source");return r.appendChild(n),t.setDOMElement(r),t.addDOMEvents(),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.BoxPanel={registerProperties:function(e,t){EJSS_INTERFACE.Panel.registerProperties(e,t),t.registerProperty("Draggable",e.setDraggable)},showOkDialog:function(e,t,r){var n=document.getElementById(".myBoxPanelOk")||EJSS_INTERFACE.boxPanel(".myBoxPanelOk").getDOMElement(),i=document.getElementById(".myBoxPanelOk.back"),o=document.getElementById(".myBoxPanelOk.msg");o.style.visibility="visible",o.innerHTML=e+"<br/>";var a=document.getElementById(".myBoxPanelOk.okbt");a.onclick=t,a.style.display="inline",n.style.width=r||"200px","fixed"==n.style.position&&(n.style.marginLeft=parseFloat(n.style.width)/-2+"px"),n.style.visibility="visible",i.style.visibility="visible"},showOkCancelDialog:function(e,t,r,n){var i=document.getElementById(".myBoxPanelCancelOk")||EJSS_INTERFACE.boxPanel(".myBoxPanelCancelOk").getDOMElement(),o=document.getElementById(".myBoxPanelCancelOk.back"),a=document.getElementById(".myBoxPanelCancelOk.msg");a.style.visibility="visible",a.innerHTML=e+"<br/>";var s=document.getElementById(".myBoxPanelCancelOk.okbt");s.onclick=t,s.style.display="inline";var l=document.getElementById(".myBoxPanelCancelOk.cancelbt");l.onclick=r,l.style.display="inline",i.style.width=n||"200px","fixed"==i.style.position&&(i.style.marginLeft=parseFloat(i.style.width)/-2+"px"),i.style.visibility="visible",o.style.visibility="visible"},showInputDialog:function(e,t,r,n){var i=document.getElementById(".BoxPanelInput")||EJSS_INTERFACE.boxPanel(".BoxPanelInput").getDOMElement(),o=document.getElementById(".BoxPanelInput.back"),a=document.getElementById(".BoxPanelInput.msg");a.style.visibility="visible",a.innerHTML=e;var s=document.getElementById(".BoxPanelInput.input");s.style.display="inline";var l=document.getElementById(".BoxPanelInput.okbt");l.onclick=function(){t(s.value)},l.style.display="inline";var u=document.getElementById(".BoxPanelInput.cancelbt");u.onclick=r,u.style.display="inline",i.style.width=n||"200px","fixed"==i.style.position&&(i.style.marginLeft=parseFloat(i.style.width)/-2+"px"),i.style.visibility="visible",o.style.visibility="visible"},showSelectDialog:function(e,t,r,n,i,o){var a=document.getElementById(".BoxPanelSelect")||EJSS_INTERFACE.boxPanel(".BoxPanelSelect").getDOMElement(),s=document.getElementById(".BoxPanelSelect.back"),l=document.getElementById(".BoxPanelSelect.msg");l.style.visibility="visible",l.innerHTML=e;var u=document.getElementById(".BoxPanelSelect.select");u.innerHTML="";for(var g=0;g<t.text.length;g++){var c=document.createElement("option");c.value&&c.value[g]&&c.setAttribute("value",t.value[g]),c.innerHTML=t.text[g],u.appendChild(c)}i&&(u.size=i),u.style.display="block",u.style.margin="0 auto";var S=document.getElementById(".BoxPanelSelect.okbt");S.onclick=function(){r(t.value[u.selectedIndex])},S.style.display="inline";var f=document.getElementById(".BoxPanelSelect.cancelbt");f.onclick=n,f.style.display="inline",a.style.width=o||"200px","fixed"==a.style.position&&(a.style.marginLeft=parseFloat(a.style.width)/-2+"px"),a.style.visibility="visible",s.style.visibility="visible"}},EJSS_INTERFACE.boxPanel=function(e){var t=EJSS_INTERFACE.panel(e),r={x:0,y:0};function n(){window.removeEventListener("mousemove",o,!0),window.removeEventListener("touchmove",o,!0)}function i(e){var n=t.getDOMElement().getBoundingClientRect();r.x=e.clientX-n.left,r.y=e.clientY-n.top,window.addEventListener("mousemove",o,!0)}function o(e){t.getDOMElement().style.position="absolute",t.getDOMElement().style.margin="0px";var n=e.clientY-r.y,i=e.clientX-r.x;t.getDOMElement().style.top=n+"px",t.getDOMElement().style.left=i+"px"}t.setVisibility=function(e){mElement.style.visibility=e,t.getStyle().setVisibility(e)},t.setDraggable=function(e){e?(t.getDOMElement().addEventListener("mousedown",i,!1),t.getDOMElement().addEventListener("touchstart",i,!1),window.addEventListener("mouseup",n,!1),window.addEventListener("touchend",n,!1)):(t.getDOMElement().removeEventListener("mousedown",i,!1),t.getDOMElement().removeEventListener("touchstart",i,!1),window.removeEventListener("mouseup",n,!1),window.removeEventListener("touchend",n,!1))},t.registerProperties=function(e){EJSS_INTERFACE.BoxPanel.registerProperties(t,e)};var a=document.createElement("div");document.body.appendChild(a),a.className="myBoxPanelBackground",a.id=e+".back",a.style.backgroundColor="rgba(255, 255, 255, 0.3)",a.style.position="fixed",a.style.top="1%",a.style.left="1%",a.style.width="98%",a.style.height="98%",a.style.zIndex="99998",a.style.visibility="hidden";var s=document.createElement("span");s.id=e+".msg",s.style.visibility="hidden",t.getDOMElement().appendChild(s);var l=document.createElement("input");l.id=e+".input",l.type="text",l.style.display="none",l.size="20",t.getDOMElement().appendChild(l);var u=document.createElement("select");u.id=e+".select",u.style.display="none",u.size="4",t.getDOMElement().appendChild(u);var g=document.createElement("button");g.id=e+".okbt",g.innerHTML="Ok",g.style.verticalAlign="middle",g.style.display="none",g.addEventListener("click",(function(){document.getElementById(e).style.visibility="hidden",document.getElementById(e+".back").style.visibility="hidden",document.getElementById(e+".msg").style.visibility="hidden",document.getElementById(e+".input").style.display="none",document.getElementById(e+".okbt").style.display="none",document.getElementById(e+".cancelbt").style.display="none"})),t.getDOMElement().appendChild(g);var c=document.createElement("button");return c.id=e+".cancelbt",c.innerHTML="Cancel",c.style.verticalAlign="middle",c.style.display="none",c.addEventListener("click",(function(){document.getElementById(e).style.visibility="hidden",document.getElementById(e+".back").style.visibility="hidden",document.getElementById(e+".msg").style.visibility="hidden",document.getElementById(e+".input").style.display="none",document.getElementById(e+".okbt").style.display="none",document.getElementById(e+".cancelbt").style.display="none"})),t.getDOMElement().appendChild(c),t.getDOMElement().className="BoxPanel",t.getStyle().setCSS({position:"fixed",top:"1px",left:"50%"}),t.getStyle().setCSS({zIndex:"99999",visibility:"hidden"}),t.getStyle().setCSS({marginLeft:"-250px",width:"500px"}),t.getStyle().setCSS({background:"lightgray"}),t.getStyle().setCSS({borderWidth:"1px"}),t.getStyle().setCSS({borderStyle:"solid"}),t.getStyle().setCSS({borderColor:"red"}),t.getStyle().setCSS({overflow:"hidden",wordWrap:"break-word"}),t.setDraggable(!0),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Button={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("ImageUrl",e.setImageUrl),t.registerAction("OnClick"),t.registerAction("OnPress"),t.registerAction("OnRelease")}},EJSS_INTERFACE.button=function(e){var t=EJSS_INTERFACE.element(e),r="",n="";function i(){if(t.getDOMElement().innerHTML="",r.length>0){var o=document.createElement("img");o.onclick=function(e){return e.preventDefault(),e.stopPropagation(),i(),!1},o.src=r,o.style="vertical-align:inherit;-webkit-touch-callout:none;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;",o.alt=e,t.getDOMElement().appendChild(o)}n.length>0&&(t.getDOMElement().innerHTML+='<span style="white-space:pre;-webkit-touch-callout:none;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;vertical-align:inherit;">'+n.toString()+"</span>")}t.setDisabled=function(e){t.getDOMElement().disabled=e,t.getDOMElement().style.pointerEvents=e?"none":""},t.getDisabled=function(){return t.getDOMElement().disabled},t.setText=function(e){n!=e&&(n=e,i())},t.getText=function(){return n},t.setImageUrl=function(e){var n=t.getResourcePath(e);n!=r&&(r=n,i())},t.getImageUrl=function(){return r},t.registerProperties=function(e){EJSS_INTERFACE.Button.registerProperties(t,e)};var o=document.createElement("button");return o.id=e,o.style.verticalAlign="middle",o.style.webkitTouchCallout="none",document.body.appendChild(o),t.setDOMElement(o),t.getDOMElement().oncontextmenu=function(e){return e.preventDefault(),e.stopPropagation(),!1},t.getDOMElement().onmousedown=function(e){var r=t.getController();return r&&r.invokeAction("OnPress").reportInteractions(),e.preventDefault(),e.stopPropagation(),!1},t.getDOMElement().addEventListener("touchstart",(function(e){var r=t.getController();return r&&r.invokeAction("OnPress").reportInteractions(),e.preventDefault(),e.stopPropagation(),!1})),t.getDOMElement().onmouseup=function(e){var r=t.getController();return r&&(r.invokeAction("OnRelease"),r.invokeAction("OnClick").reportInteractions()),e.preventDefault(),e.stopPropagation(),!1},t.getDOMElement().addEventListener("touchend",(function(e){var r=t.getController();return r&&(r.invokeAction("OnRelease"),r.invokeAction("OnClick").reportInteractions()),e.preventDefault(),e.stopPropagation(),!1})),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Canvas={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth),t.registerProperty("ImageData",e.setImageData),t.registerProperty("Enabled",e.setEnabled,e.isEnabled),t.registerAction("OnPress",e.getInteractionPoint),t.registerAction("OnDrag",e.getInteractionPoint),t.registerAction("OnRelease",e.getInteractionPoint),t.registerAction("OnEnter",e.getInteractionPoint),t.registerAction("OnExit",e.getInteractionPoint),t.registerAction("OnMove",e.getInteractionPoint)}},EJSS_INTERFACE.canvas=function(e){var t,r,n=EJSS_INTERFACE.element(e),i=0,o=0,a=[0,0],s=!1;function l(e){var t=EJSS_GRAPHICS.CanvasGraphics.getOffsetRect(n),r=[];if(void 0!==e.changedTouches)for(var i=0;i<e.changedTouches.length;i++)r[i]=[],r[i][0]=e.changedTouches[i].pageX-window.pageXOffset-t.left,r[i][1]=e.changedTouches[i].pageY-window.pageYOffset-t.top;else r[0]=[],r[0][0]=(e.clientX||e.x)-t.left,r[0][1]=(e.clientY||e.y)-t.top;return r[0]}function u(e){e.preventDefault();var t=n.getController();return t&&(a=l(e),t.invokeAction("OnPress").reportInteractions()),s=!0,!1}function g(e){e.preventDefault();var t=n.getController();return s&&t&&(a=l(e),t.invokeAction("OnRelease").reportInteractions()),s=!1,!1}function c(e){e.preventDefault();var t=n.getController();return s=!1,t&&(a=l(e),t.invokeAction("OnEnter").reportInteractions()),!1}function S(e){e.preventDefault();var t=n.getController();return s=!1,t&&(a=l(e),t.invokeAction("OnExit").reportInteractions()),!1}function f(e){e.preventDefault();var t=n.getController();return t&&(a=l(e),s?t.invokeAction("OnDrag").reportInteractions():t.invokeAction("OnMove").reportInteractions()),!1}n.render=function(){t&&d.putImageData(t,0,0)},n.setImageData=function(e){t||(t=d.createImageData(o,i)),e.data&&(e=e.data);for(var r=0;r<e.length;r++)t.data[r]=e[r]},n.clear=function(){d.clearRect(0,0,o,i)},n.setWidth=function(e){var t=n.getDOMElement();return o!=e&&(o=e,"string"==typeof e&&-1!=e.indexOf("%")&&t.parentNode&&t.parentNode.offsetWidth?e=t.parentNode.offsetWidth*parseFloat(e)/100:"string"==typeof e&&(e=parseFloat(e)),"number"==typeof e&&t.setAttribute("width",e),!0)},n.getWidth=function(){var e=n.getDOMElement();if("string"==typeof o&&-1!=o.indexOf("%")&&e.parentNode&&e.parentNode.offsetWidth){var t=e.parentNode.offsetWidth*parseFloat(o)/100;if("number"==typeof t)t!=e.getAttribute("width")&&e.setAttribute("width",t)}return o},n.setHeight=function(e){var t=n.getDOMElement();return i!=e&&(i=e,"string"==typeof e&&-1!=e.indexOf("%")&&t.parentNode&&t.parentNode.offsetHeight&&(e=t.parentNode.offsetHeight*parseFloat(e)/100),n.getDOMElement().setAttribute("height",e),!0)},n.getHeight=function(){var e=n.getDOMElement();if("string"==typeof i&&-1!=i.indexOf("%")&&e.parentNode&&e.parentNode.offsetHeight&&(value=e.parentNode.offsetHeight*parseFloat(i)/100,"number"==typeof value)){var t=e.getAttribute("height");value!=t&&e.setAttribute("height",value)}return i},n.getContext=function(){return d},n.registerProperties=function(e){EJSS_INTERFACE.Canvas.registerProperties(n,e)},n.setEnabled=function(e){r=e;var t=n.getDOMElement();r?(t.onmousedown=u,t.onmouseup=g,t.onmouseover=c,t.onmouseout=S,t.onmousemove=f,t.addEventListener("touchstart",u,!1),t.addEventListener("touchend",g,!1),t.addEventListener("touchmove",f,!1)):(t.onmousedown=void 0,t.onmouseup=void 0,t.onmouseover=void 0,t.onmouseout=void 0,t.onmousemove=void 0,t.removeEventListener("touchstart",u),t.removeEventListener("touchend",g),t.removeEventListener("touchmove",f))},n.isEnabled=function(){return r},n.getInteractionPoint=n.getMousePosition=function(){return a};var E=document.createElement("canvas");E.setAttribute("id",e),E.style.overflow="hidden";var d=E.getContext("2d");return document.body.appendChild(E),n.setDOMElement(E),n.setEnabled(!0),n.setWidth(500),n.setHeight(500),n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.CheckBox={OFF:!1,ON:!0,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageOnUrl),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageOffUrl),t.registerProperty("Checked",e.setChecked,e.getChecked),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("LabelCSS",e.setLabelCSS),t.registerProperty("CheckboxCSS",e.setCheckboxCSS),t.registerAction("OnChange",e.getChecked),t.registerAction("OnCheckOn"),t.registerAction("OnCheckOff")}},EJSS_INTERFACE.checkBox=function(e){var t=EJSS_INTERFACE.element(e),r=new Image,n=new Image,i=new Image,o="",a="",s="";function l(){c.innerHTML="",g.checked?n.src.length>0?c.appendChild(n):a.length>0?c.innerHTML=a.toString():r.src.length>0?c.appendChild(r):o.length>0&&(c.innerHTML=o.toString()):i.src.length>0?c.appendChild(i):s.length>0?c.innerHTML=s.toString():r.src.length>0?c.appendChild(r):o.length>0&&(c.innerHTML=o.toString())}t.setText=function(e){o=e,l()},t.setImageUrl=function(e){r.src=t.getResourcePath(e),l()},t.setTextOff=function(e){s=e,l()},t.getTextOff=function(){return s},t.setImageOffUrl=function(e){i.src=t.getResourcePath(e),l()},t.getImageUrlOff=function(){return i.src},t.setTextOn=function(e){a=e,l()},t.getTextOn=function(){return a},t.setImageOnUrl=function(e){n.src=t.getResourcePath(e),l()},t.getImageUrlOn=function(){return n.src},t.setChecked=function(e){g.checked!=e&&(g.checked=e,l())},t.getChecked=function(){return g.checked},t.setValue=function(e){g.value=e},t.getValue=function(){return g.value},t.setLabelCSS=function(e){EJSS_INTERFACE.Style.setCSS(c,e)},t.setCheckboxCSS=function(e){EJSS_INTERFACE.Style.setCSS(g,e)},t.registerProperties=function(e){EJSS_INTERFACE.CheckBox.registerProperties(t,e)};var u=document.createElement("fieldset");u.id=e,u.style.border=0,u.style.display="inline-block",document.body.appendChild(u),t.setDOMElement(u);var g=document.createElement("input");g.id=e+".checkbox",g.type="checkbox",u.appendChild(g),g.onchange=function(){l();var e=t.getController();e&&(e.propertiesChanged("Checked"),e.invokeAction("OnChange"),g.checked?e.invokeAction("OnCheckOn"):e.invokeAction("OnCheckOff"),e.reportInteractions())},g.ontouchend=function(e){e.stopPropagation()},g.onmouseup=function(e){e.stopPropagation()};var c=document.createElement("label");return c.id=e+".label",c.htmlFor=e+".checkbox",c.style.display="inline-block",u.appendChild(c),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ComboBox={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Options",e.setOptions,e.getOptions),t.registerProperty("SelectedOptions",e.setSelectedOptions,e.getSelectedOptions),t.registerProperty("Multiple",e.setMultiple),t.registerProperty("Size",e.setSize),t.registerAction("OnChange"),t.registerAction("OnFocus")}},EJSS_INTERFACE.comboBox=function(e){var t=EJSS_INTERFACE.element(e),r=[];t.registerProperties=function(e){EJSS_INTERFACE.ComboBox.registerProperties(t,e)},t.setSize=function(e){t.getDOMElement().size=e},t.getSize=function(){return t.getDOMElement().size},t.setMultiple=function(e){t.getDOMElement().multiple=e},t.getMultiple=function(){return t.getDOMElement().multiple},t.setSelectedOptions=function(e){for(var r=t.getDOMElement(),n=0;n<r.options.length;n++){r.options[n].selected=!1;for(var i=0;i<e.length;i++)if(r.options[n].value==e[i]){r.options[n].selected=!0;break}}},t.getSelectedOptions=function(){for(var e=[],r=t.getDOMElement(),n=0,i=0;i<r.options.length;i++)r.options[i].selected&&(e[n++]=r.options[i].value);return e},t.getSelectedOptionsIndexes=function(){for(var e=[],r=t.getDOMElement(),n=0,i=0;i<r.options.length;i++)r.options[i].selected&&(e[n++]=i);return e},t.setOptions=function(e){if(!EJSS_TOOLS.compareArrays(r,e)){r=[];var n=t.getSelectedOptions(),i=t.getDOMElement();i.innerHTML="";for(var o=0;o<e.length;o++){var a=document.createElement("option");a.setAttribute("value",e[o]),a.innerHTML=e[o],i.appendChild(a),r[o]=e[o]}t.setSelectedOptions(n)}},t.getOptions=function(){for(var e=[],r=t.getDOMElement(),n=0;n<r.options.length;n++)e[n]=r.options[n].value;return e},t.setEditable=function(e){t.getDOMElement().readOnly=!e},t.getEditable=function(){return!t.getDOMElement().readOnly};var n=document.createElement("select");return n.id=e,document.body.appendChild(n),t.setDOMElement(n),t.getDOMElement().onfocus=function(){var e=t.getController();t.getStyle().setBackgroundColor("white"),e&&(e.propertiesChanged("Options"),e.invokeAction("OnFocus"),e.reportInteractions())},t.getDOMElement().onchange=function(){var e=t.getController();t.getStyle().setBackgroundColor("white"),e&&(e.propertiesChanged("SelectedOptions"),e.invokeAction("OnChange"),e.reportInteractions())},t.getDOMElement().onkeydown=function(){t.getStyle().setBackgroundColor("yellow")},t.getDOMElement().ontouchend=function(e){e.stopPropagation()},t.getDOMElement().onmouseup=function(e){e.stopPropagation()},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.DataTable={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Active",e.setActive,e.isActive),t.registerProperty("NoRepeat",e.setNoRepeat,e.isNoRepeat),t.registerProperty("ClearAtInput",e.setClearAtInput,e.isClearAtInput),t.registerProperty("Skip",e.setSkip,e.getSkip),t.registerProperty("AddToTop",e.setAddToTop,e.isAddToTop),t.registerProperty("Maximum",e.setMaximumPoints,e.getMaximumPoints),t.registerProperty("Input",e.appendRow),t.registerProperty("ColumnsWidth",e.setColumnsWidth,e.getColumnsWidth),t.registerProperty("HeadersText",e.setHeadersText,e.getHeadersText),t.registerProperty("HeadersCSS",e.setHeadersCSS,e.getHeadersCSS),t.registerProperty("CellsFormat",e.setCellsFormat,e.getCellsFormat),t.registerProperty("CellsCSS",e.setCellsCSS,e.getCellsCSS),t.registerProperty("Width",e.setWidth,e.getStyle().getWidth),t.registerProperty("BodyHeight",e.setBodyHeight,e.getBodyHeight)}},EJSS_INTERFACE.dataTable=function(e){var t=EJSS_INTERFACE.element(e),r=!0,n=!1,i=!1,o=!1,a=0,s=0,l=[],u=[],g=[],c=[],S=[],f=[],E=[],d=0,p=0,h=!0,m=!0;function A(e){var t=document.createElement("tr");t.style.border="inherit";for(var r=0;r<e;r++){var n=document.createElement("td");l[r]&&("string"!=typeof l[r]?n.style.width=l[r]+"px":n.style.width=l[r]),S[r]&&EJSS_INTERFACE.Style.setCSS(n,S[r]),t.appendChild(n)}P.appendChild(t),d++}function _(){m=!1;for(var e=void 0!==g,t=0,r=f.length;t<r;t++){var i=f[t];t>=d&&A(i.length);var o=P.rows[t];if(e)for(var a=0,s=i.length;a<s;a++)o.cells[a].innerHTML=D(i[a],g[a]);else for(a=0,s=i.length;a<s;a++)o.cells[a].innerHTML=D(i[a])}if(n){if(f.length>=0){var l=P.rows[0];P.scrollTop=l.offsetBottom}}else if(f.length>0){var u=P.rows[f.length-1];P.scrollTop=u.offsetTop}}function D(e,t){if("number"!=typeof e)return e;if(void 0!==t){var r=t.indexOf("."),n=t.toUpperCase().indexOf("E");if(-1==n){var i=0;return r>=0&&(i=Number(t.length-r-1)),parseFloat(e).toFixed(i)}i=0;return r>=0&&(i=Number(n-r-1)),parseFloat(e).toExponential(i)}return parseFloat(e).toFixed(3)}t.setActive=function(e){r=e},t.isActive=function(){return r},t.setAddToTop=function(e){n=e},t.isAddToTop=function(){return n},t.setNoRepeat=function(e){i=e},t.isNoRepeat=function(){return norepeat},t.setClearAtInput=function(e){o=e},t.isClearAtInput=function(){return o},t.setSkip=function(e){a=e},t.getSkip=function(){return a},t.setMaximumPoints=function(e){s=e,f.length>s&&(n?f=f.slice(0,s):f.splice(0,f.length-s),h=!0)},t.getMaximumPoints=function(){return s},t.setColumnsWidth=function(e){EJSS_TOOLS.compareArrays(l,e)||(l=e,h=!0)},t.getColumnsWidth=function(){return l},t.setHeadersText=function(e){EJSS_TOOLS.compareArrays(u,e)||(u=e,h=!0)},t.getHeadersText=function(){return u},t.setCellsFormat=function(e){EJSS_TOOLS.compareArrays(g,e)||(g=e,m=!0)},t.getCellsFormat=function(){return g},t.setHeadersCSS=function(e){EJSS_TOOLS.compareArrays(c,e)||(c=e,h=!0)},t.getHeadersCSS=function(){return c},t.setCellsCSS=function(e){EJSS_TOOLS.compareArrays(S,e)||(S=e,h=!0)},t.getCellsCSS=function(){return S},t.setBodyHeight=function(e){"string"!=typeof e&&(e+="px"),P.style.height=e},t.getBodyHeight=function(){return P.style.height},t.setWidth=function(e){"string"!=typeof e&&(e+="px"),P.style.width=e,C.style.width=e,t.getStyle().setWidth(e)},t.registerProperties=function(e){EJSS_INTERFACE.DataTable.registerProperties(t,e)},t.reset=function(){t.clear()},t.initialize=function(){t.clear()},t.clear=function(e){f=[],p=0,h=!0},t.appendRow=function(e){if(r)if(o&&t.clear(),e[0]instanceof Array)for(var n=0,i=e.length;n<i;n++)t.addPoint(e[n]);else t.addPoint(e)},t.addPoint=function(e){if(a>0){if(p<a)return void p++;p=0}i&&EJSS_TOOLS.compareArrays(e,E)||(E=e.slice(0),n?(s>0&&f.length>=s&&f.pop(),f.unshift(E)):(s>0&&f.length>=s&&f.shift(),f.push(E)),m=!0)},t.dataCollected=function(){},t.render=function(){h?(!function(){if(P.innerHTML="",C.innerHTML="",void 0!==u&&u.length>0){var e=document.createElement("tr");e.style.border="inherit";for(var t=0,r=u.length;t<r;t++){var n=document.createElement("th");l[t]&&("string"!=typeof l[t]?n.style.width=l[t]+"px":n.style.width=l[t]),c[t]&&EJSS_INTERFACE.Style.setCSS(n,c[t]),n.innerHTML=u[t],e.appendChild(n)}C.appendChild(e)}d=0,h=!1}(),_()):m&&_()};var I=document.createElement("table"),P=document.createElement("tbody"),C=document.createElement("thead");return I.style.display="inline-block",I.appendChild(C),I.appendChild(P),I.className="DataTable",I.id=e,document.body.appendChild(I),t.setDOMElement(I),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Element={registerProperties:function(e,t){e.setController(t),t.registerProperty("Tooltip",e.setTitle),t.registerProperty("Foreground",e.getStyle().setColor),t.registerProperty("Background",e.getStyle().setBackgroundColor),t.registerProperty("BackgroundImage",e.getStyle().setBackgroundImage),t.registerProperty("BorderWidth",e.getStyle().setBorderWidth),t.registerProperty("BorderColor",e.getStyle().setBorderColor),t.registerProperty("BorderStyle",e.getStyle().setBorderStyle),t.registerProperty("Padding",e.getStyle().setPadding),t.registerProperty("Width",e.getStyle().setWidth,e.getStyle().getWidth),t.registerProperty("Height",e.getStyle().setHeight,e.getStyle().getHeight),t.registerProperty("LineHeight",e.getStyle().setLineHeight,e.getStyle().getLineHeight),t.registerProperty("TextAlign",e.getStyle().setTextAlign),t.registerProperty("VerticalAlign",e.getStyle().setVerticalAlign),t.registerProperty("Visibility",e.getStyle().setVisibility),t.registerProperty("Display",e.getStyle().setDisplay),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("Float",e.getStyle().setFloat),t.registerProperty("Position",e.getStyle().setPosition),t.registerProperty("Left",e.getStyle().setLeft),t.registerProperty("Top",e.getStyle().setTop),t.registerProperty("Bottom",e.getStyle().setBottom),t.registerProperty("Overflow",e.getStyle().setOverflow),t.registerProperty("BoxShadow",e.getStyle().setShadow),t.registerProperty("Margin",e.getStyle().setMargin),t.registerProperty("Parent",e.setParent),t.registerProperty("ClassName",e.setClassName),t.registerProperty("CSS",e.getStyle().setCSS),t.registerProperty("Font",e.getStyle().setFont),t.registerProperty("FontFamily",e.getStyle().setFontFamily),t.registerProperty("FontSize",e.getStyle().setFontSize),t.registerProperty("LetterSpacing",e.getStyle().setLetterSpacing),t.registerProperty("OutlineColor",e.getStyle().setOutlineColor),t.registerProperty("FontWeight",e.getStyle().setFontWeight),t.registerProperty("FillColor",e.getStyle().setFillColor),t.registerProperty("FontStyle",e.getStyle().setFontStyle),t.registerProperty("Transform",e.getStyle().setTransform),t.registerProperty("WhiteSpace",e.getStyle().setWhiteSpace)}},EJSS_INTERFACE.element=function(e){var t,r,n={},i=EJSS_INTERFACE.style(e),o=null;return n.getDOMElement=function(){return t},n.setDOMElement=function(e){t=e},n.setParent=function(e){(r=e,"string"==typeof e)?document.getElementById(e).appendChild(n.getDOMElement()):e.getDOMElement?e.appendChild(n):e.appendChild(n.getDOMElement())},n.getParent=function(){return r},n.getName=function(){return e},n.getResourcePath=function(e){return e},n.setClassName=function(e){n.getDOMElement().className=e},n.getClassName=function(){return n.getDOMElement().className},n.setDisabled=function(e){n.getDOMElement().disabled=e,n.getDOMElement().style.pointerEvents=e?"none":""},n.getDisabled=function(){return n.getDOMElement().disabled},n.setTitle=function(e){n.getDOMElement().title=e},n.getTitle=function(){return n.getDOMElement().title},n.getStyle=function(){return i},n.getController=function(){return o},n.setController=function(e){o=e},n.registerProperties=function(e){EJSS_INTERFACE.Element.registerProperties(n,e)},n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.FileUpload={registerProperties:function(e,t){EJSS_INTERFACE.Button.registerProperties(e,t),t.registerProperty("Accept",e.setAccept,e.getAccpet),t.registerProperty("Multiple",e.setMultiple,e.getMultiple),t.registerAction("OnChange")}},EJSS_INTERFACE.fileUpload=function(e){var t=EJSS_INTERFACE.button(e),r={};t.getValue=function(){return n.value},t.setValue=function(e){n.value=e},t.getTarget=function(){return r},t.getAccept=function(){return t.getDOMElement().accept},t.setAccept=function(e){t.getDOMElement().accept=e},t.getMultiple=function(){return t.getDOMElement().multiple},t.setMultiple=function(e){t.getDOMElement().multiple=e},t.click=function(){n.click()},t.registerProperties=function(e){EJSS_INTERFACE.FileUpload.registerProperties(t,e)};var n=document.createElement("input");return n.id=e+".file",n.type="file",n.style.display="none",t.getDOMElement().parentNode.appendChild(n),t.getDOMElement().onmousedown=function(e){return n.click(),e.preventDefault(),e.stopPropagation(),!1},t.getDOMElement().addEventListener("touchend",(function(e){return n.click(),e.stopPropagation(),!1}),{passive:!0}),n.addEventListener("change",(function(e){r=event.target;var n=t.getController();n&&(n.invokeAction("OnChange"),n.reportInteractions())}),{passive:!0}),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.FunctionField={registerProperties:function(e,t){EJSS_INTERFACE.TextField.registerProperties(e,t),t.registerAction("OnError")}},EJSS_INTERFACE.functionField=function(e){var t,r=EJSS_INTERFACE.textField(e),n=EJSS_DRAWING2D.functionsParser(),i=n.parse("0"),o=r.setValue,a={},s=r.getStyle().getBackgroundColor();return r.registerProperties=function(e){EJSS_INTERFACE.FunctionField.registerProperties(r,e)},r.setParameters=function(e){for(var t in e)a[t]=e[t]},r.parseValue=function(e){if(e){if(e!=t){try{i=n.parse(e),r.getStyle().setBackgroundColor(s)}catch(t){r.getController().invokeAction("OnError"),console.log('FunctionField: Error parsing function "'+e+'" : '+t.message+"\n"),r.getStyle().setBackgroundColor("red")}t=e}}else t="0",i=n.parse("0"),r.getStyle().setBackgroundColor(s)},r.setValue=function(e){o(e),r.parseValue(e)},r.evaluate=function(e){var t={};for(var n in a)t[n]=a[n];for(var o in e)t[o]=e[o];try{return i.evaluate(t)}catch(e){return r.getController().invokeAction("OnError"),NaN}},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Html={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Html",e.setHtml),t.registerProperty("Url",e.setUrl),t.registerProperty("InheritCSS",e.setInheritCSS)}},EJSS_INTERFACE.html=function(e){var t=EJSS_INTERFACE.element(e);t.setHtml=function(e){var r=t.getDOMElement().contentWindow,n=r.document;n.write(e)},t.getHtml=function(){return t.getDOMElement().contentWindow.document.body.innerHTML},t.setUrl=function(e){0==e.indexOf("http:")||0==e.indexOf("https:")||(e=t.getResourcePath(e)),t.getDOMElement().src=e},t.setInheritCSS=function(e){interitCSS=e},t.getInheritCSS=function(){return interitCSS},t.registerProperties=function(e){EJSS_INTERFACE.Html.registerProperties(t,e)};var r=document.createElement("iframe");return r.id=e,r.src="about:blank",r.width="100%",document.body.appendChild(r),t.setDOMElement(r),t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setBorderStyle("none"),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Image={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("ImageUrl",e.setImageUrl)}},EJSS_INTERFACE.image=function(e){var t=EJSS_INTERFACE.element(e);t.setImageUrl=function(e){var r=t.getResourcePath;null!=r?e=r(e.toString()):console.log("No getResourcePath function for "+t.getName()+". URL = "+e),t.getDOMElement().src=e.toString()},t.getImageUrl=function(){return t.getDOMElement().src},t.registerProperties=function(e){EJSS_INTERFACE.Image.registerProperties(t,e)};var r=document.createElement("img");return r.id=e,r.alt=e,document.body.appendChild(r),t.setDOMElement(r),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.ImageAndTextButton={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),t.registerAction("OnClick")}},EJSS_INTERFACE.imageAndTextButton=function(e){var t=EJSS_INTERFACE.element(e),r="",n="";t.setText=function(e){r=e.toString(),t.getDOMElement().innerHTML=n+r},t.getText=function(){return r},t.setImageUrl=function(i){n='<img alt="'+e+'" src="'+t.getResourcePath(i)+'"/>',t.getDOMElement().innerHTML=n+r},t.getImageUrl=function(){return n},t.registerProperties=function(e){EJSS_INTERFACE.ImageAndTextButton.registerProperties(t,e)};var i=document.createElement("button");return i.id=e,i.style.borderStyle="none",i.style.background="inherit",i.style.cursor="inherit",i.style.webkitBoxShadow="inset 0 0px 0 rgba(255,255,255,0),0 0px 0px rgba(0,0,0,0)",document.body.appendChild(i),t.setDOMElement(i),t.getDOMElement().onclick=function(e){var r=t.getController();return r&&r.invokeAction("OnClick").reportInteractions(),e.preventDefault(),e.stopPropagation(),!1},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Label={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText)}},EJSS_INTERFACE.label=function(e){var t=EJSS_INTERFACE.element(e);t.setText=function(e){t.getDOMElement().innerHTML='<span style="white-space:pre;">'+e.toString()+"</span>"},t.getText=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.Label.registerProperties(t,e)};var r=document.createElement("label");return r.id=e,r.style.display="inline-block",document.body.appendChild(r),t.setDOMElement(r),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.MathML={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Content",e.setContent,e.getContent)}},EJSS_INTERFACE.mathML=function(e){var t=EJSS_INTERFACE.element(e);t.setContent=function(e){t.getDOMElement().innerHTML=e},t.getContent=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.MathML.registerProperties(t,e)};var r=document.createElement("math");return r.setAttribute("id",e),document.body.appendChild(r),t.setDOMElement(r),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Media={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Url",e.setUrl),t.registerProperty("Controls",e.setControls),t.registerProperty("Loop",e.setLoop),t.registerProperty("CurrentTime",e.setCurrentTime,e.getCurrentTime),t.registerProperty("Volume",e.setVolume),t.registerProperty("Autoplay",e.setAutoplay),t.registerProperty("Type",e.setType),t.registerAction("OnEnded"),t.registerAction("OnLoadedData"),t.registerAction("OnPlay"),t.registerAction("OnPause")}},EJSS_INTERFACE.media=function(e){var t=EJSS_INTERFACE.element(e);return t.setUrl=function(e){t.getResourcePath&&(e=t.getResourcePath(e)),t.getDOMElement().src=e},t.getUrl=function(){return t.getDOMElement().src},t.setType=function(e){t.getDOMElement().type=e},t.getType=function(){return t.getDOMElement().type},t.setControls=function(e){e?t.getDOMElement().setAttribute("controls","controls"):t.getDOMElement().removeAttribute("controls")},t.play=function(){t.getDOMElement().play()},t.pause=function(){t.getDOMElement().pause()},t.getCurrentTime=function(){return t.getDOMElement().currentTime},t.setCurrentTime=function(e){t.getDOMElement().currentTime=e},t.setLoop=function(e){t.getDOMElement().loop=e},t.getVolume=function(){return t.getDOMElement().volume},t.setVolume=function(e){t.getDOMElement().volume=e},t.getAutoplay=function(){return t.getDOMElement().autoplay},t.setAutoplay=function(e){t.getDOMElement().autoplay=e},t.isPaused=function(){return t.getDOMElement().paused},t.isEnded=function(){return t.getDOMElement().ended},t.getDuration=function(){return t.getDOMElement().duration},t.addDOMEvents=function(){t.getDOMElement().onended=function(){var e=t.getController();e&&e.invokeAction("OnEnded").reportInteractions()},t.getDOMElement().onloadeddata=function(){var e=t.getController();e&&e.invokeAction("OnLoadedData").reportInteractions()},t.getDOMElement().onplay=function(){var e=t.getController();e&&e.invokeAction("OnPlay").reportInteractions()},t.getDOMElement().onpause=function(){var e=t.getController();e&&e.invokeAction("OnPause").reportInteractions()}},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.MotionJPEG={registerProperties:function(e,t){EJSS_INTERFACE.Canvas.registerProperties(e,t),t.registerProperty("Url",e.setUrl),t.registerProperty("AsBackground",e.setAsBackground,e.isAsBackground),t.registerProperty("On",e.setOnOff,e.isOnOff),t.registerProperty("UseWebCam",e.useWebCam),t.registerProperty("Flip",e.setFlip),t.registerProperty("UseFrontCam",e.setFrontCam)}},EJSS_INTERFACE.motionJPEG=function(e){var t,r,n=EJSS_INTERFACE.canvas(e),i=new Image,o=document.createElement("video"),a=!1,s=!0,l=!1,u=!1,g=!0;function c(){if(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia){if(t)for(var e=t.getTracks(),r=0;r<e.length;r++)e[r].stop();var n={facingMode:g?"user":"environment"};navigator.getUserMedia({video:n},(function(e){t=e,s&&(o.srcObject=t),console.log("Success = "+t)}),(function(e){console.log("Error = "+e)}))}}return n.useWebCam=function(e){l!=e&&((l=e)?c():(r=null,n.pause()))},n.setFrontCam=function(e){g!=e&&(g=e,l&&c())},n.getFrontCam=function(){return g},n.setUrl=function(e){n.getResourcePath&&(e=n.getResourcePath(e)),(r=e)&&s&&(i.src=r,i.crossOrigin="Anonymous"),l=!1},n.getUrl=function(){return l?t:r},n.setOnOff=function(e){e?s||n.play():s&&n.pause()},n.isOnOff=function(){return s},n.play=function(){r&&(l?o.srcObject=t:i.src=r),s=!0},n.pause=function(e){s=!1,void 0!==e&&e||n.clear()},n.getCanvasContext=function(){return n.getContext()},n.getSnapshot=function(){return n.getContext().getImageData(0,0,n.getWidth(),n.getHeight())},n.isAsBackground=function(){return a},n.setAsBackground=function(e){e!=a&&((a=e)?n.getStyle().setCSS({position:"absolute","z-index":"-100"}):n.getStyle().setCSS({position:" ","z-index":" "}))},n.render=function(){if(s&&(r||t)){var e=n.getDOMElement();n.getContext().save(),(g?u:!u)&&(n.getContext().translate(e.width,0),n.getContext().scale(-1,1)),l?o.readyState===o.HAVE_ENOUGH_DATA&&n.getContext().drawImage(o,0,0,e.width,e.height):n.getContext().drawImage(i,0,0,i.width,i.height,0,0,e.width,e.height),n.getContext().restore()}},n.setFlip=function(e){u=e},n.getFlip=function(){return u},n.registerProperties=function(e){EJSS_INTERFACE.MotionJPEG.registerProperties(n,e)},o.autoplay="true",o.style="display:none;",n.getStyle().setBackgroundColor("rgb(239,239,255)"),n.setEnabled(!1),n.setWidth(500),n.setHeight(500),n};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.NumberField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Format",e.setFormat),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.numberField=function(e){var t=EJSS_INTERFACE.element(e),r=3,n=!1,i=!1,o="";function a(){var e=t.getDOMElement().value;if(!isNaN(parseFloat(e))&&isFinite(e)){if(t.getStyle().setBackgroundColor("white"),o!=e){var r=t.getController();r&&(r.propertiesChanged("Value"),r.invokeAction("OnChange"),r.reportInteractions())}}else{if("∞"!==e&&"-∞"!==e&&"∅"!==e)return t.getStyle().setBackgroundColor("red"),!1;t.getStyle().setBackgroundColor("white")}return!0}t.registerProperties=function(e){EJSS_INTERFACE.NumberField.registerProperties(t,e)},t.enableEPub=function(){t.getDOMElement().disabled&&(t.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(t.render=function(){t.enableEPub()}),t.setValue=function(e){i||(void 0===e?t.getDOMElement().value="value undefined":!isNaN(parseFloat(e))&&isFinite(e)?t.getDOMElement().value=n?parseFloat(e).toExponential(r):parseFloat(e).toFixed(r):e===Number.POSITIVE_INFINITY?t.getDOMElement().value="∞":e===Number.NEGATIVE_INFINITY?t.getDOMElement().value="-∞":isNaN(e)&&(t.getDOMElement().value="∅"))},t.getValue=function(){var e=t.getDOMElement().value;return!isNaN(parseFloat(e))&&isFinite(e)?e=parseFloat(e):"∞"===e?e=Number.POSITIVE_INFINITY:"-∞"===e?e=Number.NEGATIVE_INFINITY:"∅"===e&&(e=Number.NaN),e},t.setEditable=function(e){t.getDOMElement().readOnly=!e,e?t.getStyle().setBackgroundColor("white"):t.getStyle().setBackgroundColor("lightgrey")},t.getEditable=function(){return!t.getDOMElement().readOnly},t.setSize=function(e){t.getDOMElement().size=e},t.getSize=function(){return t.getDOMElement().size},t.setFormat=function(e){var i=e.indexOf("."),o=e.toUpperCase().indexOf("E");if(-1==o){var a=0;i>=0&&(a=Number(e.length-i-1)),(n||r!=a)&&(r=a,n=!1,t.setValue(t.getValue()))}else{a=0;i>=0&&(a=Number(o-i-1)),n&&r==a||(r=a,n=!0,t.setValue(t.getValue()))}};var s=document.createElement("input");return s.type="number",s.id=e,s.value=0,document.body.appendChild(s),t.setDOMElement(s),t.getDOMElement().onkeydown=function(e){if(!t.getDOMElement().readOnly){var r=e||window.event,n=r.which?r.which:r.keyCode;13==n?(i=!1,a()&&(o=t.getDOMElement().value)):27==n?t.getDOMElement().value=o:(t.getStyle().setBackgroundColor("yellow"),i=!0)}},t.getDOMElement().onfocus=function(e){o=t.getDOMElement().value},t.getDOMElement().onblur=function(e){!e.readOnly&&i&&(i=!1,a())},t.getDOMElement().ontouchend=function(e){e.stopPropagation()},t.getDOMElement().onmouseup=function(e){e.stopPropagation()},"undefined"!=typeof _isEPub&&_isEPub&&(t.getDOMElement().ontouchstart=function(e){t.getDOMElement().disabled&&(t.getDOMElement().disabled=!1),e.stopPropagation()}),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Panel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Html",e.setHtml,e.getHtml),t.registerAction("OnClick"),t.registerAction("OnPress"),t.registerAction("OnRelease"),t.registerAction("OnMove")}},EJSS_INTERFACE.panel=function(e){var t=EJSS_INTERFACE.element(e);t.appendChild=function(e){var r=e.getDOMElement();t.getDOMElement().appendChild(r)},t.removeChild=function(e){var r=e.getDOMElement();t.getDOMElement().removeChild(r)},t.insertBefore=function(e,r){var n=e.getDOMElement(),i=r.getDOMElement();t.getDOMElement().insertBefore(n,i)},t.setHtml=function(e){t.getDOMElement().innerHTML=e},t.getHtml=function(){return t.getDOMElement().innerHTML},t.registerProperties=function(e){EJSS_INTERFACE.Panel.registerProperties(t,e)};var r=document.createElement("div");return r.id=e,r.contenteditable=!0,document.body.appendChild(r),t.setDOMElement(r),t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setTextAlign("TEXTA_CENTER"),t.getStyle().setCSS({display:"block","margin-left":"auto","margin-right":"auto"}),t.getDOMElement().addEventListener("touchstart",(function(e){for(var t=document.getElementsByTagName("input"),r=0;t.length>r;r++)t[r].disabled=!1})),t.getDOMElement().addEventListener("mousedown",(function(e){var r=t.getController();r&&r.invokeAction("OnPress").reportInteractions()})),t.getDOMElement().addEventListener("touchstart",(function(e){var r=t.getController();r&&r.invokeAction("OnPress").reportInteractions()})),t.getDOMElement().addEventListener("mouseup",(function(e){var r=t.getController();r&&(r.invokeAction("OnRelease"),r.invokeAction("OnClick").reportInteractions())})),t.getDOMElement().addEventListener("touchend",(function(e){var r=t.getController();r&&(r.invokeAction("OnRelease"),r.invokeAction("OnClick").reportInteractions())})),t.getDOMElement().addEventListener("mousemove",(function(e){var r=t.getController();r&&r.invokeAction("OnMove").reportInteractions()})),t.getDOMElement().addEventListener("touchmove",(function(e){var r=t.getController();r&&r.invokeAction("OnMove").reportInteractions()})),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.PasswordField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.passwordField=function(e){var t=EJSS_INTERFACE.element(e);t.registerProperties=function(e){EJSS_INTERFACE.PasswordField.registerProperties(t,e)},t.enableEPub=function(){t.getDOMElement().disabled&&(t.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(t.render=function(){t.enableEPub()}),t.setValue=function(e){t.getDOMElement().value=e},t.getValue=function(){return t.getDOMElement().value},t.setEditable=function(e){t.getDOMElement().readOnly=!e,e?t.getStyle().setBackgroundColor("white"):t.getStyle().setBackgroundColor("lightgrey")},t.getEditable=function(){return!t.getDOMElement().readOnly},t.setSize=function(e){t.getDOMElement().size=e},t.getSize=function(){return t.getDOMElement().size};var r=document.createElement("input");return r.id=e,r.type="password",document.body.appendChild(r),t.setDOMElement(r),t.getDOMElement().onkeydown=function(e){if(!t.getDOMElement().readOnly){var r=e||window.event;if(13==(r.which?r.which:r.keyCode)){t.getStyle().setBackgroundColor("white");var n=t.getController();n&&(n.propertiesChanged("Value"),n.invokeAction("OnChange"),n.reportInteractions())}else t.getStyle().setBackgroundColor("yellow")}},t.getDOMElement().onblur=function(e){e.readOnly||t.getStyle().setBackgroundColor("white")},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.RadioButton={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Text",e.setText),t.registerProperty("ImageUrl",e.setImageUrl),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageOnUrl),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageOffUrl),t.registerProperty("Checked",e.setChecked,e.getChecked),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("LabelCSS",e.setLabelCSS),t.registerProperty("RadioCSS",e.setRadioCSS),t.registerProperty("Parent",(function(t){e.setParent(t),e.setKey(e.getDOMElement().parentNode.id)})),t.registerAction("OnChange",e.getChecked),t.registerAction("OnCheckOn"),t.registerAction("OnCheckOff")}},EJSS_INTERFACE.radioButton=function(e){var t=EJSS_INTERFACE.element(e),r=new Image,n=new Image,i=new Image,o="",a="",s="";function l(){c.innerHTML="",g.checked?n.src.length>0?c.appendChild(n):a.length>0?c.innerHTML=a.toString():r.src.length>0?c.appendChild(r):o.length>0&&(c.innerHTML=o.toString()):i.src.length>0?c.appendChild(i):s.length>0?c.innerHTML=s.toString():r.src.length>0?c.appendChild(r):o.length>0&&(c.innerHTML=o.toString())}t.setKey=function(e){g.name=e},t.getKey=function(){return g.name},t.setText=function(e){o=e,l()},t.setImageUrl=function(e){r.src=t.getResourcePath(e),l()},t.setTextOff=function(e){s=e,l()},t.getTextOff=function(){return s},t.setImageOffUrl=function(e){i.src=t.getResourcePath(e),l()},t.getImageUrlOff=function(){return i.src},t.setTextOn=function(e){a=e,l()},t.getTextOn=function(){return a},t.setImageOnUrl=function(e){n.src=t.getResourcePath(e),l()},t.getImageUrlOn=function(){return n.src},t.setChecked=function(e){g.checked!=e&&(g.checked=e,l())},t.getChecked=function(){return g.checked},t.setValue=function(e){g.value=e},t.getValue=function(){return g.value},t.setLabelCSS=function(e){EJSS_INTERFACE.Style.setCSS(c,e)},t.setRadioCSS=function(e){EJSS_INTERFACE.Style.setCSS(g,e)},t.registerProperties=function(e){EJSS_INTERFACE.RadioButton.registerProperties(t,e)};var u=document.createElement("fieldset");u.id=e,u.style.border=0,u.style.display="inline-block",document.body.appendChild(u),t.setDOMElement(u);var g=document.createElement("input");g.id=e+".radio",g.type="radio",u.appendChild(g),g.onchange=function(){g.remoteonchange();for(var e=document.getElementsByTagName("fieldset"),t=0;t<e.length;t++)if(e[t].childNodes&&e[t].childNodes[0]){var r=e[t].childNodes[0];"radio"==r.type&&r.remoteonchange&&r.name==g.name&&r.id!=g.id&&r.remoteonchange()}},g.ontouchend=function(e){e.stopPropagation()},g.onmouseup=function(e){e.stopPropagation()},g.remoteonchange=function(e){l();var r=t.getController();r&&(r.propertiesChanged("Checked"),r.invokeAction("OnChange"),g.checked?r.invokeAction("OnCheckOn"):r.invokeAction("OnCheckOff"),r.reportInteractions())};var c=document.createElement("label");return c.id=e+".label",c.htmlFor=e+".radio",c.style.display="inline-block",u.appendChild(c),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Separator={HORIZONTAL:0,VERTICAL:1,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Orientation",e.setOrientation),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.separator=function(e){var t=EJSS_INTERFACE.element(e),r=EJSS_INTERFACE.Separator.HORIZONTAL,n="100%";t.setOrientation=function(e){"string"==typeof e&&(e=EJSS_INTERFACE.Separator[e.toUpperCase()]),r!=e&&((r=e)==EJSS_INTERFACE.Separator.VERTICAL?(t.getDOMElement().style.display="inline",t.getDOMElement().style.height=t.getDOMElement().style.width,t.getDOMElement().style.width="2px"):(t.getDOMElement().style.display="none",t.getDOMElement().style.width=t.getDOMElement().style.height,t.getDOMElement().style.height="2px"))},t.getOrientation=function(){return r},t.setWidth=function(e){n!=e&&(n=e,r==EJSS_INTERFACE.Separator.VERTICAL?t.getDOMElement().style.height=n:t.getDOMElement().style.width=n)},t.getWidth=function(){return n},t.registerProperties=function(e){EJSS_INTERFACE.Separator.registerProperties(t,e)};var i=document.createElement("hr");return i.id=e,i.style.height="2px",i.style.width=n,document.body.appendChild(i),t.setDOMElement(i),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Slider={PRECISION:1e5,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Minimum",e.setMin),t.registerProperty("Maximum",e.setMax),t.registerProperty("Step",e.setStep),t.registerProperty("TextWidth",e.setTextWidth),t.registerProperty("ShowText",e.setShowText),t.registerProperty("Format",e.setFormat),t.registerProperty("Disabled",e.setDisabled),t.registerProperty("LabelCSS",e.setLabelCSS),t.registerProperty("RangeCSS",e.setRangeCSS),t.registerAction("OnChange",e.getValue),t.registerAction("OnRelease",e.getValue)}},EJSS_INTERFACE.slider=function(e){var t=EJSS_INTERFACE.element(e),r=!1,n=3,i=!1;t.registerProperties=function(e){EJSS_INTERFACE.Slider.registerProperties(t,e)},t.setValue=function(e){void 0===e?l.value="value undefined":!isNaN(parseFloat(e))&&isFinite(e)&&(l.value=parseFloat(e),r&&(a.innerHTML=parseFloat(e).toFixed(n)))},t.getValue=function(){var e=l.value;return!isNaN(parseFloat(e))&&isFinite(e)?parseFloat(e):e},t.setFormat=function(e){var r=e.indexOf("."),i=0;r>=0&&(i=Number(e.length-r-1)),n!=i&&(n=i,t.setValue(t.getValue()))},t.setStep=function(e){isNaN(e)?(i=!1,l.step=(l.max-l.min)/EJSS_INTERFACE.Slider.PRECISION):(i=!0,l.step=e)},t.getStep=function(){return l.step},t.setMax=function(e){l.max=e,i||(l.step=(l.max-l.min)/EJSS_INTERFACE.Slider.PRECISION)},t.getMax=function(){return l.max},t.setMin=function(e){l.min=e,i||(l.step=(l.max-l.min)/EJSS_INTERFACE.Slider.PRECISION)},t.getMin=function(){return l.min},t.setShowText=function(e){(r=e)&&(a.innerHTML="")},t.getShowText=function(){return r},t.setTextWidth=function(e){a.style.width=e},t.getTextWidth=function(e){return a.style.width},t.setDisabled=function(e){l.disabled=e},t.getDisabled=function(){return l.disabled},t.setLabelCSS=function(e){EJSS_INTERFACE.Style.setCSS(a,e)},t.setRangeCSS=function(e){EJSS_INTERFACE.Style.setCSS(l,e)};var o=document.createElement("div");o.id=e,o.style.display="inline-block",o.style.overflow="hidden",o.style.textAlign="left",o.style.verticalAlign="middle",o.style.webkitTouchCallout="none",o.style.webkitUserSelect="none",o.style.userSelect="none",document.body.appendChild(o),t.setDOMElement(o);var a=document.createElement("label");a.id=e+".label",a.style.float="left",o.appendChild(a);var s=document.createElement("div");s.id=e+".div2",s.style.overflow="hidden",o.appendChild(s);var l=document.createElement("input");return l.style.verticalAlign="middle",l.style.width="98%",l.style.height="98%",l.type="range",l.id=e+".slider",l.value=0,s.appendChild(l),l.oninput=function(){var e=t.getController();return e&&(e.propertiesChanged("Value"),e.invokeAction("OnChange"),e.reportInteractions()),!1},l.onmouseup=function(e){var r=t.getController();r&&(r.invokeAction("OnRelease"),r.reportInteractions()),e.stopPropagation()},l.ontouchend=function(e){var r=t.getController();r&&(r.invokeAction("OnRelease"),r.reportInteractions()),e.stopPropagation()},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Style={BORDER_SOLID:"solid",BORDER_DOTTED:"dotted",BORDER_DASHED:"dashed",TEXTA_LEFT:"left",TEXTA_RIGHT:"right",TEXTA_CENTER:"center",TEXTA_JUSTIFY:"justify",VISIB_VISIBLE:"visible",VISIB_HIDDEN:"hidden",FLOAT_LEFT:"left",FLOAT_RIGHT:"right",FLOAT_NONE:"none",FLOAT_CENTER:"none",POSITION_STATIC:"static",POSITION_ABSOLUTE:"absolute",POSITION_FIXED:"fixed",POSITION_RELATIVE:"relative",POSITION_INHERIT:"inherit",OVERFLOW_VISIBLE:"visible",OVERFLOW_HIDDEN:"hidden",OVERFLOW_SCROLL:"scroll",OVERFLOW_AUTO:"auto",setCSS:function(e,t){var r=/-([\da-z])/gi,n=function(e,t){return(t+"").toUpperCase()},i=e.style;if("object"!=typeof t){var o=t.trim().split("{");if(o[0]&&o[0].length>0){var a,s=o[0].trim(),l=document.styleSheets[0].rules||document.styleSheets[0].cssRules;for(a=0;a<l.length&&l[a].selectorText!=s;a++);var u=l[a].cssText?l[a].cssText:l[a].style.cssText,g=(u=u.match(/{.*}/g)[0]).slice(1,u.length-2).split(";");for(elem in g){if(2==(E=g[elem].split(":")).length){var c=E[0].trim(),S=E[1].trim();i[c.replace(r,n)]=S}}}if(o[1]){var f=o[1].trim();g=f.slice(0,f.length-2).split(";");for(elem in g){var E;if(2==(E=g[elem].split(":")).length){c=E[0].trim(),S=E[1].trim();i[c.replace(r,n)]=S}}}}else for(var d in t){if("object"!=typeof t[d])i[d.replace(r,n)]=t[d];else try{var p=document.getElementById(e.id+d),h=t[d],m=p.style;for(var A in h){m[A.replace(r,n)]=h[A]}}catch(e){console.error(e)}}}},EJSS_INTERFACE.style=function(e){var t=EJSS_INTERFACE.Style,r={},n="white",i=0,o=t.BORDER_SOLID;return r.setCSS=function(r){t.setCSS(document.getElementById(e),r)},r.setVisibility=function(t){document.getElementById(e).style.visibility=t?"visible":"hidden"},r.getVisibility=function(){return"visible"==document.getElementById(e).style.visibility},r.setVerticalAlign=function(t){document.getElementById(e).style.verticalAlign=t},r.getVerticalAlign=function(){return document.getElementById(e).style.verticalAlign},r.setTextAlign=function(r){"TEXTA_"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.textAlign=r},r.getTextAlign=function(){return document.getElementById(e).style.textAlign},r.setLineHeight=function(t){"string"!=typeof t&&(t+="px"),document.getElementById(e).style.lineHeight=t},r.getLineHeight=function(){return document.getElementById(e).style.lineHeight},r.setHeight=function(t){"string"!=typeof t&&(t+="px"),document.getElementById(e).style.height=t},r.getHeight=function(){return document.getElementById(e).style.height},r.setWidth=function(t){"string"!=typeof t&&(t+="px"),document.getElementById(e).style.width=t},r.getWidth=function(){return document.getElementById(e).style.width},r.setOverflow=function(r){"OVERFL"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.overflow=r},r.getOverflow=function(){return document.getElementById(e).style.overflow},r.setPosition=function(r){"POSITI"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.position=r},r.getPosition=function(){return document.getElementById(e).style.position},r.setFloat=function(r){"FLOAT_"==r.substring(0,6)&&(r=t[r.toUpperCase()]),document.getElementById(e).style.float=r},r.getFloat=function(){return document.getElementById(e).style.float},r.setDisplay=function(t){document.getElementById(e).style.display=t},r.getDisplay=function(){return document.getElementById(e).style.display},r.setTop=function(t){document.getElementById(e).style.top=t},r.getTop=function(){return document.getElementById(e).style.top},r.setBottom=function(t){document.getElementById(e).style.bottom=t},r.getBottom=function(){return document.getElementById(e).style.bottom},r.setLeft=function(t){document.getElementById(e).style.left=t},r.getLeft=function(){return document.getElementById(e).style.left},r.setBorderStyle=function(r){"BORDER"==r.substring(0,6)&&(r=t[r.toUpperCase()]),o=r,document.getElementById(e).style.border=i+"px "+o+" "+n},r.getBorderStyle=function(){return o},r.setBorderWidth=function(t){i=t,document.getElementById(e).style.border=i+"px "+o+" "+n},r.getBorderWidth=function(){return i},r.setBorderColor=function(t){"string"!=typeof t&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),n=t,document.getElementById(e).style.border=i+"px "+o+" "+n},r.getBorderColor=function(){return n},r.setPadding=function(t){document.getElementById(e).style.padding=t},r.getPadding=function(){return document.getElementById(e).style.padding},r.setShadow=function(t){document.getElementById(e).style.boxShadow=t||""},r.getShadow=function(){return""!=document.getElementById(e).style.boxShadow},r.setMargin=function(t){document.getElementById(e).style.margin=t},r.getMargin=function(){return document.getElementById(e).style.margin},r.setBackgroundImage=function(t){document.getElementById(e).style.backgroundImage="url("+t+")",document.getElementById(e).style.backgroundSize="100% 100%"},r.getBackgroundImage=function(){return document.getElementById(e).style.backgroundImage},r.setBackgroundColor=function(t){"string"!=typeof t&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),document.getElementById(e).style.backgroundColor=t},r.getBackgroundColor=function(){return document.getElementById(e).style.backgroundColor},r.setColor=function(t){"string"!=typeof t&&(t=EJSS_TOOLS.DisplayColors.getLineColor(t)),document.getElementById(e).style.color=t},r.getColor=function(){return document.getElementById(e).style.color},r.getFont=function(){return document.getElementById(e).style.font},r.setFont=function(t){if(!("string"!=typeof t||t.length<=0)){var r=document.getElementById(e).style,n=t.split(" ");r.fontStyle=n[0],r.fontWeight=n[1];var i=n[2].split("/");r.fontSize=i[0],i[1]&&(r.lineHeight=i[1]),n[3]&&(r.fontFamily=t.substring(t.indexOf(n[3])))}},r.setFontStyle=function(t){document.getElementById(e).style.fontStyle=t},r.getFontStyle=function(){return document.getElementById(e).style.fontStyle},r.setFontFamily=function(t){document.getElementById(e).style.fontFamily=t},r.getFontFamily=function(){return document.getElementById(e).style.fontFamily},r.setFontSize=function(t){document.getElementById(e).style.fontSize=t},r.getFontSize=function(){return document.getElementById(e).style.fontSize},r.setLetterSpacing=function(t){document.getElementById(e).style.letterSpacing=t},r.getLetterSpacing=function(){return document.getElementById(e).style.letterSpacing},r.setOutlineColor=function(t){document.getElementById(e).style.stroke=t},r.getOutlineColor=function(){return document.getElementById(e).style.stroke},r.setFontWeight=function(t){document.getElementById(e).style.fontWeight=t},r.getFontWeight=function(){return document.getElementById(e).style.fontWeight},r.setFillColor=function(t){document.getElementById(e).style.fill=t},r.getFillColor=function(){return document.getElementById(e).style.fill},r.setTransform=function(t){document.getElementById(e).style.transform=t,document.getElementById(e).style["-ms-transform"]=t,document.getElementById(e).style["-webkit-transform"]=t},r.getTransform=function(){return document.getElementById(e).style.transform},r.setWhiteSpace=function(t){document.getElementById(e).style.whiteSpace=t},r.getWhiteSpace=function(){return document.getElementById(e).style.whiteSpace},r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.SvgGraphics={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.svgGraphics=function(e){var t=EJSS_INTERFACE.element(e),r=0,n=0;t.setWidth=function(e){return n!=e&&(n=e,t.getDOMElement().setAttribute("width",n),!0)},t.getWidth=function(){return n},t.setHeight=function(e){return r!=e&&(r=e,t.getDOMElement().setAttribute("height",r),!0)},t.getHeight=function(){return r},t.registerProperties=function(e){EJSS_INTERFACE.SvgGraphics.registerProperties(t,e)};var i=document.createElementNS("http://www.w3.org/2000/svg","svg");return i.setAttribute("id",e),i.style.overflow="hidden",i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),document.body.appendChild(i),t.setDOMElement(i),t.setWidth(500),t.setHeight(500),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TabbedPanel={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Titles",e.setTitles,e.getTitles),t.registerProperty("Selected",e.setSelected,e.getSelected),t.registerProperty("Font",e.setFont),t.registerProperty("Foreground",e.setColor),t.registerProperty("Background",e.setBackgroundColor),t.registerProperty("FillColor",e.setFillColor)}},EJSS_INTERFACE.tabbedPanel=function(e){var t=EJSS_INTERFACE.element(e),r=[],n=0,i=null;function o(){l.innerHTML="";for(var o=0;o<r.length;o++){var s=r[o],u=document.createElement("li");u.className="_TabbedPanel.li",u.id=e+".item",l.appendChild(u),u.style.background=i||t.getStyle().getBackgroundColor(),u.onmouseover=function(){this.style.cursor="pointer"},u.onmouseout=function(){this.style.cursor="auto"};var g=document.createElement("a");g.className="_TabbedPanel.a",g.id=e+".item.a."+o,g.innerHTML=s,u.appendChild(g),g.style.color=t.getStyle().getColor(),g.style.fontStyle=t.getStyle().getFontStyle(),g.style.fontWeight=t.getStyle().getFontWeight(),g.style.fontSize=t.getStyle().getFontSize(),g.style.fontFamily=t.getStyle().getFontFamily(),g.style.lineHeight=t.getStyle().getLineHeight(),g.onclick=function(){var e=this.id.split(".");n=parseInt(e[e.length-1]),a()},a()}}function a(){for(var e=0;e<u.childNodes.length;e++)u.childNodes[e].style.display="none";u.childNodes.length>n&&(u.childNodes[n].style.display="block");for(e=0;e<l.childNodes.length;e++)l.childNodes[e].firstChild.style.backgroundColor="transparent";l.childNodes.length>n&&(l.childNodes[n].firstChild.style.backgroundColor=t.getStyle().getFillColor())}t.appendChild=function(e){var t=e.getDOMElement();u.appendChild(t),a()},t.removeChild=function(e){var t=e.getDOMElement();u.removeChild(t),a()},t.insertBefore=function(e,t){var r=e.getDOMElement(),n=t.getDOMElement();u.insertBefore(r,n),a()},t.getTitles=function(){return r},t.setTitles=function(e){EJSS_TOOLS.compareArrays(r,e)||(r=e,o())},t.getSelected=function(){return n},t.setSelected=function(e){n!=e&&(n=e,a())},t.registerProperties=function(e){EJSS_INTERFACE.TabbedPanel.registerProperties(t,e)},t.setFont=function(e){t.getStyle().setFont(e),o()},t.setFillColor=function(e){t.getStyle().setFillColor(e),a()},t.setBackgroundColor=function(e){i=e,o()},t.setColor=function(e){t.getStyle().setColor(e),o()};var s=document.createElement("span");s.className="_TabbedPanel.span",s.id=e,document.body.appendChild(s),t.setDOMElement(s);var l=document.createElement("ul");l.className="_TabbedPanel.ul",l.id=e+".ul",s.appendChild(l);var u=document.createElement("span");return u.id=e+".divs",s.appendChild(u),o(),t.getStyle().setFillColor("#ccc"),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TextArea={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Rows",e.setRows),t.registerProperty("Columns",e.setCols),t.registerProperty("ChangeColorOnEdit",e.setChangeColorOnEdit),t.registerAction("OnChange")}},EJSS_INTERFACE.textArea=function(e){var t=EJSS_INTERFACE.element(e),r=!0;t.registerProperties=function(e){EJSS_INTERFACE.TextArea.registerProperties(t,e)},t.enableEPub=function(){t.getDOMElement().disabled&&(t.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(t.render=function(){t.enableEPub()}),t.setChangeColorOnEdit=function(e){r=e},t.setValue=function(e){t.getDOMElement().value=e},t.appendText=function(e){var r=t.getDOMElement();r.value+=e,r.scrollTop=r.scrollHeight},t.clear=function(){t.getDOMElement().value=""},t.getValue=function(){return t.getDOMElement().value},t.setEditable=function(e){t.getDOMElement().readOnly=!e,e||t.getStyle().setBackgroundColor("lightgrey")},t.getEditable=function(){return!t.getDOMElement().readOnly},t.setCols=function(e){t.getDOMElement().cols=e},t.getCols=function(){return t.getDOMElement().cols},t.setRows=function(e){t.getDOMElement().rows=e},t.getRows=function(){return t.getDOMElement().rows};var n=document.createElement("textarea");return n.id=e,n.style.verticalAlign="middle",document.body.appendChild(n),t.setDOMElement(n),t.getDOMElement().onkeydown=function(e){t.getDOMElement().readOnly||r&&t.getStyle().setBackgroundColor("yellow")},t.getDOMElement().onblur=function(e){if(!e.readOnly){r&&t.getStyle().setBackgroundColor("white");var n=t.getController();n&&(n.propertiesChanged("Value"),n.invokeAction("OnChange"),n.reportInteractions())}},t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TextField={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Value",e.setValue,e.getValue),t.registerProperty("Editable",e.setEditable),t.registerProperty("Size",e.setSize),t.registerAction("OnChange")}},EJSS_INTERFACE.textField=function(e){var t=EJSS_INTERFACE.element(e),r=!1,n="";function i(){var e=t.getDOMElement().value;if(t.getStyle().setBackgroundColor("white"),t.parseValue&&t.parseValue(e),n!=e){var r=t.getController();r&&(r.propertiesChanged("Value"),r.invokeAction("OnChange"),r.reportInteractions())}}t.registerProperties=function(e){EJSS_INTERFACE.TextField.registerProperties(t,e)},t.enableEPub=function(){t.getDOMElement().disabled&&(t.getDOMElement().disabled=!1)},"undefined"!=typeof _isEPub&&_isEPub&&(t.render=function(){t.enableEPub()}),t.setValue=function(e){r||(t.getDOMElement().value=void 0===e?"value undefined":e)},t.getValue=function(){return t.getDOMElement().value},t.setEditable=function(e){t.getDOMElement().readOnly=!e,e?t.getStyle().setBackgroundColor("white"):t.getStyle().setBackgroundColor("lightgrey")},t.getEditable=function(){return!t.getDOMElement().readOnly},t.setSize=function(e){t.getDOMElement().size=e},t.getSize=function(){return t.getDOMElement().size};var o=document.createElement("input");return o.id=e,o.type="text",document.body.appendChild(o),t.setDOMElement(o),t.getDOMElement().onkeydown=function(e){if(!t.getDOMElement().readOnly){var o=e||window.event,a=o.which?o.which:o.keyCode;13==a?(r=!1,i(),n=t.getDOMElement().value):27==a?t.getDOMElement().value=n:(t.getStyle().setBackgroundColor("yellow"),r=!0)}},t.getDOMElement().onfocus=function(e){n=t.getDOMElement().value},t.getDOMElement().onblur=function(e){!e.readOnly&&r&&(i(),r=!1)},t.getDOMElement().ontouchend=function(e){e.stopPropagation()},t.getDOMElement().onmouseup=function(e){e.stopPropagation()},"undefined"!=typeof _isEPub&&_isEPub&&(t.getDOMElement().ontouchstart=function(e){t.getDOMElement().disabled&&(t.getDOMElement().disabled=!1),e.stopPropagation()}),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.TwoStateButton={OFF:!1,ON:!0,registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("TextOn",e.setTextOn),t.registerProperty("ImageOnUrl",e.setImageUrlOn),t.registerProperty("TextOff",e.setTextOff),t.registerProperty("ImageOffUrl",e.setImageUrlOff),t.registerProperty("State",e.setState,e.getState),t.registerAction("OnClick"),t.registerAction("OffClick")}},EJSS_INTERFACE.twoStateButton=function(e){var t=EJSS_INTERFACE.TwoStateButton,r=EJSS_INTERFACE.element(e),n="",i="",o="",a="",s=-1;function l(){r.getDOMElement().innerHTML="",s?(n.length>0&&(r.getDOMElement().innerHTML='<img alt="'+e+'" style="vertical-align:inherit;-webkit-touch-callout:none;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;" src="'+n+'"/>'),o.length>0&&(r.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;-webkit-touch-callout:none;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;">'+o.toString()+"</span>")):(i.length>0&&(r.getDOMElement().innerHTML='<img alt="'+e+'" style="vertical-align:inherit;-webkit-touch-callout:none;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;" src="'+i+'"/>'),a.length>0&&(r.getDOMElement().innerHTML+='<span style="white-space:pre;vertical-align:inherit;-webkit-touch-callout:none;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;">'+a.toString()+"</span>"))}r.setTextOff=function(e){a=e,l()},r.getTextOff=function(){return a},r.setImageUrlOff=function(e){var t=r.getResourcePath(e);t!=i&&(i=t,l())},r.getImageUrlOff=function(){return i},r.setTextOn=function(e){o=e,l()},r.getTextOn=function(){return o},r.setImageUrlOn=function(e){var t=r.getResourcePath(e);t!=n&&(n=t,l())},r.getImageUrlOn=function(){return n},r.setState=function(e){"string"==typeof e&&(e=t[e.toUpperCase()]),e!=s&&(s=e,l())},r.getState=function(){return s},r.registerProperties=function(e){EJSS_INTERFACE.TwoStateButton.registerProperties(r,e)};var u=document.createElement("button");function g(e){var t=r.getState();r.setState(!t);var n=r.getController();return n&&(n.propertiesChanged("State"),t?n.invokeAction("OnClick"):n.invokeAction("OffClick"),n.reportInteractions()),e.preventDefault(),e.stopPropagation(),!1}return u.id=e,u.style.verticalAlign="middle",u.style.webkitTouchCallout="none",document.body.appendChild(u),r.setDOMElement(u),r.getDOMElement().oncontextmenu=function(e){return e.preventDefault(),e.stopPropagation(),!1},r.getDOMElement().addEventListener("mouseup",g),r.getDOMElement().addEventListener("touchend",g),r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.Video={registerProperties:function(e,t){EJSS_INTERFACE.Media.registerProperties(e,t),t.registerProperty("VideoUrl",e.setUrl),t.registerProperty("Background",e.setBackground,e.getBackground),t.registerProperty("PosterUrl",e.setPoster)}},EJSS_INTERFACE.video=function(e){var t=EJSS_INTERFACE.media(e),r=!1;t.setPoster=function(e){t.getResourcePath&&(e=t.getResourcePath(e)),t.getDOMElement().poster=e},t.getPoster=function(){return t.getDOMElement().poster},t.getBackground=function(){return r},t.setBackground=function(e){e!=r&&((r=e)?(t.getStyle().setWidth("100%"),t.getStyle().setHeight("100%"),t.getStyle().setCSS({position:"absolute","z-index":"-100"})):(t.getStyle().setWidth(" "),t.getStyle().setHeight(" "),t.getStyle().setCSS({position:" ","z-index":" "})))},t.registerProperties=function(e){EJSS_INTERFACE.Video.registerProperties(t,e)};var n=document.createElement("video");return n.id=e,document.body.appendChild(n),t.setDOMElement(n),t.addDOMEvents(),t};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.WebGLCanvas={registerProperties:function(e,t){EJSS_INTERFACE.Element.registerProperties(e,t),t.registerProperty("Height",e.setHeight),t.registerProperty("Width",e.setWidth)}},EJSS_INTERFACE.webGLCanvas=function(e){var t,r=EJSS_INTERFACE.element(e),n=0,i=0;r.setWidth=function(e){return i!=e&&(i=e,r.getStyle().setWidth(i),!0)},r.getWidth=function(){return i},r.setHeight=function(e){return n!=e&&(n=e,r.getStyle().setHeight(n),!0)},r.getHeight=function(){return n},r.getContext=function(){return t},r.registerProperties=function(e){EJSS_INTERFACE.WebGLCanvas.registerProperties(r,e)};var o=document.createElement("canvas");o.setAttribute("id",e),document.body.appendChild(o),r.setDOMElement(o),r.setWidth(500),r.setHeight(500);try{t=o.getContext("webgl")}catch(e){}try{t=t||o.getContext("experimental-webgl")}catch(e){}try{t=t||o.getContext("webkit-3d")}catch(e){}try{t=t||o.getContext("moz-webgl")}catch(e){}if(!t){r.getStyle().setBackgroundColor("rgb(239,239,255)");var a=o.getContext("2d");a.font="bold 16px Arial",a.fillText("WebGL not supported!",100,100)}return r};var EJSS_INTERFACE=EJSS_INTERFACE||{};EJSS_INTERFACE.WrappedPanel={registerProperties:function(e,t){EJSS_INTERFACE.Panel.registerProperties(e,t)}},EJSS_INTERFACE.wrappedPanel=function(e){if("undefined"==typeof _isEPub||!_isEPub)return EJSS_INTERFACE.panel(e);var t=EJSS_INTERFACE.panel(e);return t.registerProperties=function(e){EJSS_INTERFACE.WrappedPanel.registerProperties(t,e)},t.getStyle().setPadding("0px"),t.getStyle().setMargin("0px"),t.getStyle().setTextAlign("TEXTA_CENTER"),t.getStyle().setCSS({"page-break-inside":"avoid","margin-left":"auto","margin-right":"auto"}),t},function(){const e="undefined"!=typeof module&&module.exports,t=!("undefined"!=typeof window&&this===window);var r=r||function(e){setTimeout(e,0)};const n=t?require(__dirname+"/Worker.js"):self.Worker,i="undefined"!=typeof self?self.URL?self.URL:self.webkitURL:null,o=!(!t&&!self.Worker);function a(e,t){t||(t={});for(const r in e)void 0===t[r]&&(t[r]=e[r]);return t}function s(){this._callbacks=[],this._errCallbacks=[],this._resolved=0,this._result=null}s.prototype.resolve=function(e,t){if(e){this._resolved=2,this._result=e;for(let t=0;t<this._errCallbacks.length;++t)this._errCallbacks[t](e)}else{this._resolved=1,this._result=t;for(let e=0;e<this._callbacks.length;++e)this._callbacks[e](t)}this._callbacks=[],this._errCallbacks=[]},s.prototype.then=function(e,t){if(1!==this._resolved){if(2!==this._resolved)return e&&(this._callbacks[this._callbacks.length]=e),t&&(this._errCallbacks[this._errCallbacks.length]=t),this;t&&t(this._result)}else e&&e(this._result)};const l={evalPath:t?__dirname+"/eval.js":null,maxWorkers:t?require("os").cpus().length:navigator.hardwareConcurrency||4,synchronous:!0,env:{},envNamespace:"env"};function u(e,t){this.data=e,this.options=a(l,t),this.operation=new s,this.operation.resolve(null,this.data),this.requiredScripts=[],this.requiredFunctions=[]}u.isSupported=function(){return o},u.prototype.getWorkerSource=function(e,r){let n="",i=0;for(t||0===this.requiredScripts.length||(n+=`importScripts("${this.requiredScripts.join('","')}");\r\n`),i=0;i<this.requiredFunctions.length;++i)this.requiredFunctions[i].name?n+=`var ${this.requiredFunctions[i].name} = ${this.requiredFunctions[i].fn.toString()};`:n+=this.requiredFunctions[i].fn.toString();r=JSON.stringify(r||{});const o=this.options.envNamespace;return t?`${n}process.on("message", function(e) {global.${o} = ${r};process.send(JSON.stringify((${e.toString()})(JSON.parse(e).data)))})`:`${n}self.onmessage = function(e) {var global = {}; global.${o} = ${r};self.postMessage((${e.toString()})(e.data))}`},u.prototype.require=function(){const e=Array.prototype.slice.call(arguments,0);let t;for(let r=0;r<e.length;r++)t=e[r],"string"==typeof t?this.requiredScripts.push(t):"function"==typeof t?this.requiredFunctions.push({fn:t}):"object"==typeof t&&this.requiredFunctions.push(t);return this},u.prototype._spawnWorker=function(e,r){let o;const a=this.getWorkerSource(e,r);if(t)o=new n(this.options.evalPath),o.postMessage(a);else{if(void 0===n)return;try{if(0!==this.requiredScripts.length){if(null===this.options.evalPath)throw new Error("Can't use required scripts without eval.js!");o=new n(this.options.evalPath),o.postMessage(a)}else{if(!i)throw new Error("Can't create a blob URL in this browser!");{const e=new Blob([a],{type:"text/javascript"}),t=i.createObjectURL(e);o=new n(t)}}}catch(e){if(null===this.options.evalPath)throw e;o=new n(this.options.evalPath),o.postMessage(a)}}return o},u.prototype.spawn=function(e,t){const n=this,i=new s;return t=a(this.options.env,t||{}),this.operation.then(()=>{const o=n._spawnWorker(e,t);if(void 0!==o)o.onmessage=function(e){o.terminate(),n.data=e.data,i.resolve(null,n.data)},o.onerror=function(e){o.terminate(),i.resolve(e,null)},o.postMessage(n.data);else{if(!n.options.synchronous)throw new Error("Workers do not exist and synchronous operation not allowed!");r(()=>{try{n.data=e(n.data),i.resolve(null,n.data)}catch(e){i.resolve(e,null)}})}}),this.operation=i,this},u.prototype._spawnMapWorker=function(e,t,n,i,o){const a=this;if(o||(o=a._spawnWorker(t,i)),void 0!==o)o.onmessage=function(t){a.data[e]=t.data,n(null,o)},o.onerror=function(e){o.terminate(),n(e)},o.postMessage(a.data[e]);else{if(!a.options.synchronous)throw new Error("Workers do not exist and synchronous operation not allowed!");r(()=>{a.data[e]=t(a.data[e]),n()})}},u.prototype.map=function(e,t){if(t=a(this.options.env,t||{}),!this.data.length)return this.spawn(e,t);const r=this;let n=0,i=0;function o(a,s){a?l.resolve(a,null):++i===r.data.length?(l.resolve(null,r.data),s&&s.terminate()):n<r.data.length?r._spawnMapWorker(n++,e,o,t,s):s&&s.terminate()}var l=new s;return this.operation.then(()=>{for(;n-i<r.options.maxWorkers&&n<r.data.length;++n)r._spawnMapWorker(n,e,o,t)},e=>{l.resolve(e,null)}),this.operation=l,this},u.prototype._spawnReduceWorker=function(e,t,n,i,o){const a=this;if(o||(o=a._spawnWorker(t,i)),void 0!==o)o.onmessage=function(e){a.data[a.data.length]=e.data,n(null,o)},o.onerror=function(e){o.terminate(),n(e,null)},o.postMessage(e);else{if(!a.options.synchronous)throw new Error("Workers do not exist and synchronous operation not allowed!");r(()=>{a.data[a.data.length]=t(e),n()})}},u.prototype.reduce=function(e,t){if(t=a(this.options.env,t||{}),!this.data.length)throw new Error("Can't reduce non-array data");let r=0;const n=this;function i(a,s){--r,a?o.resolve(a,null):1===n.data.length&&0===r?(n.data=n.data[0],o.resolve(null,n.data),s&&s.terminate()):n.data.length>1?(++r,n._spawnReduceWorker([n.data[0],n.data[1]],e,i,t,s),n.data.splice(0,2)):s&&s.terminate()}var o=new s;return this.operation.then(()=>{if(1===n.data.length)o.resolve(null,n.data[0]);else{for(var a=0;a<n.options.maxWorkers&&a<Math.floor(n.data.length/2);++a)++r,n._spawnReduceWorker([n.data[2*a],n.data[2*a+1]],e,i,t);n.data.splice(0,2*a)}}),this.operation=o,this},u.prototype.then=function(e,t){const r=this,n=new s;return t="function"==typeof t?t:function(){},this.operation.then(()=>{let i;try{e&&(i=e(r.data),void 0!==i&&(r.data=i)),n.resolve(null,r.data)}catch(e){t?(i=t(e),void 0!==i&&(r.data=i),n.resolve(null,r.data)):n.resolve(null,e)}},e=>{if(t){const i=t(e);void 0!==i&&(r.data=i),n.resolve(null,r.data)}else n.resolve(null,e)}),this.operation=n,this},e?module.exports=u:self.Parallel=u}();var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.Model={},EJSS_CORE.createAnimation=function(){var self={},MINIMUM_DELAY=1,mStepsPerDisplay=1,mDelay=MINIMUM_DELAY,mMinimumDelay=10,mRunAlways=!1,mAbortSPDLoop=!1,mShouldUpdateView=!0,mAutoplay=!1,mOnloadFunc,mView=null,mCurrentTimeOut,mShouldBreak=!1,mIsPlaying=!1,mRunCount=0,mLastTime=+new Date,mRunTime=+new Date,mFocus=!0,mPendingTasks=[];function processSafeTasks(){if(0==mPendingTasks.length)return!1;var e=mPendingTasks.slice();mPendingTasks=[];for(var t=0;t<e.length;t++)e[t]();return!0}self._userSerialize=function(){return{}},self._readParameters=function(e){},self.setView=function(e){(mView=e)._setReportInteractionMethod((function(){mIsPlaying||mView._readInteractions(mRunCount,mRunTime,mIsPlaying)&&(self.automaticResetSolvers(),self.update())}))},self.getView=function(){return mView},self.serialize=function(){var e={model:self._userSerialize(),view:mView.serialize()};return JSON.stringify(e,(function(e,t){return"number"==typeof t&&(isNaN(t)?t="__NaN":isFinite(t)||(t="__Infinity")),t}))},self.unserialize=function(e){var t=JSON.parse(e,(function(e,t){return"__NaN"==t?t=NaN:"__Infinity"==t&&(t=1/0),t}));if(t.model){var r=t.model;self._userUnserialize(r)}if(t.view){var n=t.view;mView.unserialize(n)}},self._userUnserialize=function(e){self._readParameters(e),_model.resetSolvers&&_model.resetSolvers(),self.update()},self.setRunAlways=function(e){mRunAlways=e},self.setPauseOnPageExit=function(e){mRunAlways=!e},self.setFPS=function(e){mDelay=Math.max(1e3/e,MINIMUM_DELAY)},self.getFPS=function(){return Math.floor(1e3/mDelay)},self.setDelay=function(e){mDelay=Math.max(e,MINIMUM_DELAY)},self.getDelay=function(e){return mDelay},self.setMinimumDelay=function(e){mMinimumDelay=Math.max(e,0)},self.setStepsPerDisplay=function(e){e>=1&&(mStepsPerDisplay=e)},self.setUpdateView=function(e){mShouldUpdateView=e},self.setAutoplay=function(e){mAutoplay=e},self.isPlaying=function(){return mIsPlaying},self.isPaused=function(){return!mIsPlaying},self.getRunCount=function(){return mRunCount},self.getRunTime=function(){return mRunTime},self.initRunCountAndTime=function(){mRunCount=0,mRunTime=+new Date},self.resetRealTime=function(){var e=+Date();mInitialRealTime=1e3*self.getRealTime()-e},self.play=function(){mIsPlaying||(mLastTime=+new Date,mSleepTime=mDelay,mIsPlaying=!0,mCurrentTimeOut=window.setTimeout(self.run,mMinimumDelay))},self.pause=function(){mIsPlaying=!1,mAbortSPDLoop=!0,0!=mCurrentTimeOut&&(window.clearTimeout(mCurrentTimeOut),mCurrentTimeOut=0)},self.run=function(){var e=1;if(mRunCount++,mRunTime=+new Date,mIsPlaying){if(mFocus||mRunAlways){self.step(),mLastTime=+new Date,e=Math.max(mMinimumDelay,mDelay-(mLastTime-mRunTime));var t=mCurrentTimeOut;if(self._readCapturedInteractions(),(mView._readInteractions(mRunCount,mRunTime,mIsPlaying)||processSafeTasks())&&(self.automaticResetSolvers(),self.update()),t!=mCurrentTimeOut)return}else mLastTime=+new Date;(mView._readInteractions(mRunCount,mRunTime,mIsPlaying)||processSafeTasks())&&(self.automaticResetSolvers(),self.update()),mCurrentTimeOut=window.setTimeout(self.run,e)}},self.onExit=function(){self.pause(),mView._readInteractions(mRunCount,mRunTime,mIsPlaying),processSafeTasks(),self.freeMemory()},self.performTaskSafely=function(e){mIsPlaying?(console.log("Delaying the task! "),mPendingTasks.push(e)):(console.log("Calling the task now! "),e(),self.automaticResetSolvers(),self.update(!0))},self.reset=function(e){e||(self.pause(),self.resetModel()),mView._setReportNeeded(!1),mView._reset(),e||(mView._initValues(),mView._initialize(),self.initializeModel()),self.updateModel(),mShouldUpdateView?(mView._update(),mView._render()):mView._collectData(),mView._setReportNeeded(!0),mAutoplay&&self.play(),mView._resized()},self.initialize=function(){mView._initialize(),self.initializeModel(),self.updateModel(),mShouldUpdateView?(mView._update(),mView._render()):mView._collectData()},self.update=function(e){(mFocus||mRunAlways||e)&&(self.updateModel(),mShouldUpdateView?(mView._update(),mView._render()):mView._collectData(),processSafeTasks()&&(self.automaticResetSolvers(),self.updateModel(),mShouldUpdateView?(mView._update(),mView._render()):mView._collectData()))},self.step=function(e){var t=+new Date;e||(e=1);var r=Math.max(e,mStepsPerDisplay);if(r>1){mAbortSPDLoop=!1;for(var n=1;n<r;n++){if(mAbortSPDLoop)return void self.update();self.stepModel(),self.updateModel(),mView._collectData()}}self.stepModel();var i=+new Date-t;return self.update(),i},self.setShouldBreak=function(e){mShouldBreak=e},self.getShouldBreak=function(){return mShouldBreak},self._autoSelectView=function(e){for(var t=screen.height,r=screen.width,n=[],i=Number.MAX_VALUE,o=0;o<e.length;o++){(s=r-e[o].width)>=0&&(s<i?(i=s,n=[o]):s==i&&n.push(o))}var a=-1;i=Number.MAX_VALUE;for(o=0;o<n.length;o++){var s;(s=Math.abs(t-e[n[o]].height))<i&&(i=s,a=n[o])}return a},self.addToOnload=function(e){mOnloadFunc=e},self.onload=function(){"function"==typeof mOnloadFunc&&mOnloadFunc()},self.parseInputParameters=function(e){if("string"==typeof e||e instanceof String)try{e=EJSS_TOOLS.Decode.hex_to_ascii(e),("'"==(e=EJSS_TOOLS.Decode.decode(e))[0]&&"'"==e[e.length-1]||'"'==e[0]&&'"'==e[e.length-1])&&(e=e.substring(1,e.length-1)),e=JSON.parse(e)}catch(t){return console.log("Error trying to parse input parameters: "+e),null}return e};var mResetList=[],mInitializationList=[],mEvolutionList=[],mFixedRelationsList=[];function processFunctionList(e){for(var t=0,r=e.length;t<r;t++)if(mShouldBreak=!1,e[t](),mShouldBreak)return}self.getRealTime=function(){return NaN},self.automaticResetSolvers=function(){},self.freeMemory=function(){},self.addToReset=function(e){mResetList.push(e)},self.addToInitialization=function(e){mInitializationList.push(e)},self.addToEvolution=function(e){mEvolutionList.push(e)},self.addToFixedRelations=function(e){mFixedRelationsList.push(e)},self.addFixedRel=function(code){_model.addToFixedRelations((function(){eval(code)}))},self.resetModel=function(){processFunctionList(mResetList)},self.initializeModel=function(){processFunctionList(mInitializationList)},self.stepModel=function(){processFunctionList(mEvolutionList)},self.updateModel=function(){processFunctionList(mFixedRelationsList)},window.onblur=function(){mFocus=!1,mView&&mView._onBlur()},window.onfocus=function(){mFocus=!0,mView&&mView._onFocus()};var _super_onorientationchange=window.onorientationchange;window.onorientationchange=function(){_super_onorientationchange&&_super_onorientationchange(),mView&&mView._resized()};var _super_onresize=window.onresize;return window.onresize=function(){_super_onresize&&_super_onresize(),mView&&mView._resized()},self};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.createAnimationLMS=function(){var e,t,r,n,i,o=EJSS_CORE.createAnimation(),a="Choose a name for the file";o.sendCallback=function(){},o.setStatusParams=function(a,s,l,u,g,c){e=a,t=s,r=l,n=u,i=g,c&&(o.sendCallback=c),o.declareRegisterFuncs_UNED()},o.getUserID=function(){return t},o.getContextID=function(){return e},o.getActivityID=function(){return r},o.sendSnapshot=function(i,o,a,s){n&&i.importGraphics((function(i){var l=new XMLHttpRequest,u="user_file="+o+"&file="+encodeURIComponent(i)+"&type=png&context_id="+e+"&user_id="+t+"&ejsapp_id="+r;l.open("POST",n,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){4==l.readyState&&200==l.status?a&&a():s&&s()},l.send(u)}))},o.sendState=function(i,a,s){if(n){var l=o.serialize(),u=new XMLHttpRequest,g="user_file="+i+"&file="+encodeURIComponent(l)+"&type=json&context_id="+e+"&user_id="+t+"&ejsapp_id="+r;u.open("POST",n,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),u.onreadystatechange=function(){4==u.readyState&&200==u.status?a&&a():s&&s()},u.send(g)}},o.sendText=function(i,o,a,s,l){if(n){var u=new XMLHttpRequest,g="user_file="+i+"&file="+encodeURIComponent(o)+"&type="+a+"&context_id="+e+"&user_id="+t+"&ejsapp_id="+r;u.open("POST",n,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded"),u.onreadystatechange=function(){4==u.readyState&&200==u.status?s&&s():l&&l()},u.send(g)}},o.getState=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.setRequestHeader("Cache-Control","no-cache"),n.onreadystatechange=function(){4==n.readyState&&200==n.status?(o.unserialize(n.responseText),t&&t()):r&&r()},n.send()},o.getText=function(e,t,r){var n=new XMLHttpRequest;n.open("GET",e,!0),n.setRequestHeader("Cache-Control","no-cache"),n.onreadystatechange=function(){4==n.readyState&&200==n.status?t&&t(n.responseText):r&&r()},n.send()},o.getStateFiles=function(e,t,n){if(r){var o=new XMLHttpRequest,a=i+"?ejsapp_id="+r+"&type="+e;o.open("GET",a,!0),o.onreadystatechange=function(){if(4==o.readyState&&200==o.status){for(var e={name:[],url:[]},r=JSON.parse(o.responseText),i=0;i<r.file_names.length;i++)e.name.push(r.file_names[i].file_name),e.url.push(r.file_paths[i].file_path);t&&t(e)}else n&&n()},o.send()}},o.saveText=function(t,r,n){if(!n){n=r;r=null}e?EJSS_INTERFACE.BoxPanel.showInputDialog(a,(function(e){o.sendText(e,n,r,(function(){o.sendCallback()}))})):o.sendText(t,n,r,(function(){o.sendCallback()}))},o.saveState=function(t){e?EJSS_INTERFACE.BoxPanel.showInputDialog(a,(function(e){o.sendState(e,(function(){o.sendCallback()}))})):o.sendState(t,(function(){o.sendCallback()}))},o.saveImage=function(t,r){var n=o.getView();e?EJSS_INTERFACE.BoxPanel.showInputDialog(a,(function(e){o.sendSnapshot(n[r],e,(function(){o.sendCallback()}))})):o.sendSnapshot(n[r],t,(function(){o.sendCallback()}))},o.readState=function(e,t){if(e)o.getState(e);else{var r=void 0!==t?t:".json";o.getStateFiles(r,(function(e){var t={text:e.name,value:e.url};EJSS_INTERFACE.BoxPanel.showSelectDialog("Select a file to read",t,(function(e){o.getState(e)}))}))}},o.readText=function(e,t,r){e?o.getText(e,(function(e){if("function"==typeof r)r(e);else{var t={};t[r]=e,o._userUnserialize(t)}})):o.getStateFiles(t,(function(e){var t={text:e.name,value:e.url};EJSS_INTERFACE.BoxPanel.showSelectDialog("Select a file to read",t,(function(e){o.getText(e,(function(e){if("function"==typeof r)r(e);else{var t={};t[r]=e,o._userUnserialize(t)}}))}))}))};var s,l,u=[],g={},c=!1;o.getEventInteractionsStream=function(e){var t=e.target||e.srcElement,r={pageX:e.pageX,pageY:e.pageY,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,target:t.id,timeStamp:+new Date};r.runCount=o.getRunCount(),r.runTime=o.getRunTime(),r.type=e.type,r.event="touch",s.send(JSON.stringify(r))},o.startCaptureStream=function(e,t,r,n,i){var a=window.location,l="https:"===a.protocol?"wss:":"ws:";l+="//"+a.host+":"+e;try{s=new WebSocket(l),void 0!==t&&t(),s.onopen=function(){o.initRunCountAndTime(),o.getView().registerInteractions(s,!1),document.addEventListener("mousemove",o.getEventInteractionsStream),document.addEventListener("touchmove",o.getEventInteractionsStream),document.addEventListener("mousedown",o.getEventInteractionsStream),document.addEventListener("touchstart",o.getEventInteractionsStream)},s.onclose=function(e){o.stopCaptureStream(),i(e)},s.onmessage=function(e){console.log("Message is received: "+e.data)}}catch(e){return void(void 0!==r&&r(e))}},o.stopCaptureStream=function(){try{s.close()}catch(e){}o.getView().unregisterInteractions(),document.removeEventListener("mousemove",o.getEventInteractionsStream),document.removeEventListener("touchmove",o.getEventInteractionsStream),document.removeEventListener("mousedown",o.getEventInteractionsStream),document.removeEventListener("touchstart",o.getEventInteractionsStream)},o.playCaptureStream=function(e,t,r,n,i){if(!c){c=!0;var a=[];try{l=new EventSource(e),void 0!==t&&t(),l.onopen=n,l.onclose=function(e){var t=document.getElementById("_my_mouse");t&&document.body.removeChild(t),i(e)},l.onmessage=function(e){var t=JSON.parse(e.data);console.log("Now: "+Date.now()+"-"+t.timeStamp),a=a.concat(t.interactions)}}catch(e){return void(void 0!==r&&r(e))}setTimeout((function(){o.initRunCountAndTime(),p=[];var e=0,t=0,r=0,n=0,i=0,s=0,l=setInterval((function(){for(var u=o.getView(),S=e;S<a.length;){var f=a[S++];if(void 0!==f.isPlaying&&f.isPlaying)p.push(f),e++;else if(f.runCount==t&&r>=f.timeStamp-f.runTime&&n<=f.timeStamp-f.runTime){for(var E in e++,n=f.timeStamp-f.runTime,g){(_=u[E]).getDOMElement().style.border=g[E]}if(g={},void 0!==f.event){var d,h=f.pageX,m=f.pageY,A=f.target;if(void 0!==A&&A.length>0)null!=(_=document.getElementById(A))&&(i=f.offsetLeft-_.offsetLeft,s=f.offsetTop-_.offsetTop);if(h-=i,m+=s,!(d=document.getElementById("_my_mouse")))(d=document.createElement("div")).id="_my_mouse",d.style.position="absolute",d.style.margin="0",d.style.border="3px solid red",document.body.appendChild(d);d.style.left=h+"px",d.style.top=m+"px"}else if(void 0!==f.property){(_=u[f.element]).propertyChanged(f.property,f.data).reportInteractions()}else if(void 0!==f.action){var _;(_=u[f.element]).invokeAction(f.action).reportInteractions(),void 0===g[_.getName()]&&(g[_.getName()]=_.getDOMElement().style.border),_.getDOMElement().style.border="1px solid red"}}}var D=o.getRunCount();t!=D?(t=D,r=0,n=0):r+=10,c||clearInterval(l)}),10)}),1e3)}},o.pauseCaptureStream=function(){try{l.close()}catch(e){}c=!1},o.getEventInteractions=function(e){var t=e.target||e.srcElement,r={pageX:e.pageX,pageY:e.pageY,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,target:t.id,timeStamp:+new Date};r.runCount=o.getRunCount(),r.runTime=o.getRunTime(),r.type=e.type,r.event="touch",u.push(r)},o.startCapture=function(){o.initRunCountAndTime(),o.getView().registerInteractions(!1,!1),u=[],document.addEventListener("mousemove",o.getEventInteractions),document.addEventListener("touchmove",o.getEventInteractions),document.addEventListener("mousedown",o.getEventInteractions),document.addEventListener("touchstart",o.getEventInteractions)},o.getCapture=function(){return{interactions:o.getView().getRegInteractions(),events:u}},o.stopCapture=function(){return o.getView().unregisterInteractions(),document.removeEventListener("mousemove",o.getEventInteractions),document.removeEventListener("touchmove",o.getEventInteractions),document.removeEventListener("mousedown",o.getEventInteractions),document.removeEventListener("touchstart",o.getEventInteractions),o.getCapture()},o._readCapturedInteractions=function(){for(var e=o.getView(),t=p.length,r=0;r<t;r++){var n=p[r];if(n.runCount==o.getRunCount()&&n.isPlaying){var i;if("undefined"!==n.property)(i=e[n.element]).propertyChanged(n.property,n.data).reportInteractions();if("undefined"!==n.action)(i=e[n.element]).invokeAction(n.action).reportInteractions(),void 0===g[i.getName()]&&(g[i.getName()]=i.getDOMElement().style.border),i.getDOMElement().style.border="1px solid red";n.runCount=-1}}};var S=!1,f=!1,E=1,d=!1,p=[];o.playCapture=function(e,t,r){var n=e.interactions,i=n.length,a=0,s=e.events,l=s.length,u=0;if(!S){S=!0,f=!1,o.reset(),void 0!==r&&(E=r),o.setDelay(o.getDelay()/E),o.initRunCountAndTime(),p=n;var c=0,d=0,h=0,m=0,A=setInterval((function(){var e=o.getView();for(var r in g){(_=e[r]).getDOMElement().style.border=g[r]}if(g={},S){for(;a<i&&n[a].runCount<=c&&d>=n[a].timeStamp-n[a].runTime;){if(!n[a].isPlaying){if(void 0!==n[a].property)(_=e[n[a].element]).propertyChanged(n[a].property,n[a].data).reportInteractions();if(void 0!==n[a].action)(_=e[n[a].element]).invokeAction(n[a].action).reportInteractions(),void 0===g[_.getName()]&&(g[_.getName()]=_.getDOMElement().style.border),_.getDOMElement().style.border="1px solid red"}a++}for(;u<l&&s[u].runCount<=c&&d>=s[u].timeStamp-s[u].runTime;){var _,D=s[u].pageX,I=s[u].pageY,P=s[u].target;if(void 0!==P&&P.length>0)null!=(_=document.getElementById(P))&&(h=s[u].offsetLeft-_.offsetLeft,m=s[u].offsetTop-_.offsetTop);if(D-=h,I+=m,!(C=document.getElementById("_my_mouse")))(C=document.createElement("div")).id="_my_mouse",C.style.position="absolute",C.style.margin="0",C.style.border="3px solid red",document.body.appendChild(C);C.style.left=D+"px",C.style.top=I+"px",u++}var C,T=o.getRunCount();if(c!=T?(c=T,d=0):d+=10*E,u>=l&&a>=i)(C=document.getElementById("_my_mouse"))&&document.body.removeChild(C),clearInterval(A),S=!1,o.setDelay(o.getDelay()*E),p=[],t()}f&&(clearInterval(A),S=!1,o.setDelay(o.getDelay()*E),p=[],t())}),10)}},o.pauseCapture=function(){d=o.isPlaying(),o.pause(),S=!1},o.resumeCapture=function(){d&&o.play(),S=!0},o.resetCapture=function(){f=!0},o.changeCaptureStep=function(e){o.setDelay(o.getDelay()*E),E=e,o.setDelay(o.getDelay()/E)},o.declareRegisterFuncs_UNED=function(){var e=[],i=[],a=!1;o.pushRegModelCalls=function(t){var r={function:t,timeStamp:+new Date};r.runCount=o.getRunCount(),r.runTime=o.getRunTime(),e.push(r)},o.pushRegUserEvents=function(e){var t=e.target||e.srcElement,r={pageX:e.pageX,pageY:e.pageY,offsetLeft:t.offsetLeft,offsetTop:t.offsetTop,target:t.id,timeStamp:+new Date};r.runCount=o.getRunCount(),r.runTime=o.getRunTime(),r.type=e.type,r.event="touch",i.push(r)},o.startRegister=function(t){a||(a=!0,o.initRunCountAndTime(),o.getView().registerInteractions(!1,!1),e=[],i=[],t&&(document.addEventListener("mousemove",o.pushRegUserEvents),document.addEventListener("touchmove",o.pushRegUserEvents),document.addEventListener("mousedown",o.pushRegUserEvents),document.addEventListener("touchstart",o.pushRegUserEvents)))},o.getRegister=function(t){var r={interactions:o.getView().getRegInteractions(t),model:e,events:i};return t&&(e=[],i=[]),r},o.stopRegister=function(){return o.getView().unregisterInteractions(),a=!1,document.removeEventListener("mousemove",o.pushRegUserEvents),document.removeEventListener("touchmove",o.pushRegUserEvents),document.removeEventListener("mousedown",o.pushRegUserEvents),document.removeEventListener("touchstart",o.pushRegUserEvents),o.getRegister()},o.sendRegister=function(e,i,a){if(n){var s=JSON.stringify(o.getRegister(e),(function(e,t){return"number"==typeof t&&(isNaN(t)?t="__NaN":isFinite(t)||(t="__Infinity")),t})),l=new XMLHttpRequest,u="file="+encodeURIComponent(s)+"&type=actions&user_id="+t+"&ejsapp_id="+r;l.open("POST",n,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){4==l.readyState&&200==l.status?i&&i():a&&a()},l.send(u)}}};var h=new URL(document.location),m=void 0!==h.searchParams&&h.searchParams.get("view_id");if(m){var A=h.searchParams.get("user_id"),_=h.searchParams.get("wstoken"),D=h.searchParams.get("url"),I=h.searchParams.get("wsfunction"),P=[],C=[],T=!1;o.pushRegModelCalls=function(e){var t={function:e};P.push(t)},o.pushRegUserEvents=function(e){var t=e.target||e.srcElement,r={type:e.type,target:t.id};C.push(r)},o.startRegister=function(e){T||(T=!0,o.getView().registerInteractions(!1,!1),o.getView().setShortRegInteractions(!0),P=[],C=[],e&&(document.addEventListener("mousedown",o.pushRegUserEvents),document.addEventListener("touchstart",o.pushRegUserEvents)))},o.isRegisterStarted=function(){return T},o.getRegister=function(e){var t={interactions:o.getView().getRegInteractions(e),model:P,events:C};return e&&(P=[],C=[]),t},o.stopRegister=function(){return o.getView().unregisterInteractions(),T=!1,document.removeEventListener("mousedown",o.pushRegUserEvents),document.removeEventListener("touchstart",o.pushRegUserEvents),o.getRegister()},o.sendRegister=function(e,t,r){if(D){var n=o.getRegister(e);if(0!=n.interactions.length||0!=n.model.length||0!=n.events.length){var i=JSON.stringify(n,(function(e,t){return"number"==typeof t&&(isNaN(t)?t="__NaN":isFinite(t)||(t="__Infinity")),t})),a=new XMLHttpRequest,s="view_id="+m+"&info="+encodeURIComponent(i)+"&user_id="+A;a.open("POST",D+"?wstoken="+_+"&wsfunction="+I,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.onreadystatechange=function(){4==a.readyState&&200==a.status?t&&t():r&&r()},a.send(s)}}},setInterval((function(){_model&&(_model.isRegisterStarted()||_model.startRegister(),_model.sendRegister(!0))}),3e3)}return o.___play=o.play,o.play=function(){T&&o.pushRegModelCalls("play"),o.___play()},o.___pause=o.pause,o.pause=function(){T&&o.pushRegModelCalls("pause"),o.___pause()},o.___reset=o.reset,o.reset=function(e){T&&o.pushRegModelCalls("reset"),o.___reset()},o.___initialize=o.initialize,o.initialize=function(){T&&o.pushRegModelCalls("initialize"),o.___initialize()},o};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Bootstrap2IntervalData={},EJSS_ODE_INTERPOLATION.bootstrap2IntervalData=function(e,t,r,n,i){var o,a,s,l,u=EJSS_ODE_INTERPOLATION.bootstrapIntervalData(e,t,r,n,i);u.interpolate=function(e,t){var r=u.getDeltaTime(),n=u.getLeftState(),i=u.getLeftRate(),g=(e-u.getLeft())/r;return n[t]+g*(r*i[t]+g*(o[t]+g*(a[t]+g*(s[t]+g*l[t]))))},u.interpolateState=function(e,t,r,n){return u.bootstrap2((e-u.getLeft())/u.getDeltaTime(),t,r,n),t},u.bootstrap2=function(e,t,r,n){for(var i=u.getDeltaTime(),g=u.getLeftState(),c=u.getLeftRate(),S=r,f=0;f<n;f++)t[f]=g[S]+e*(i*c[S]+e*(o[S]+e*(a[S]+e*(s[S]+e*l[S])))),S++};var g=e.length,c=g-1,S=u.getDeltaTime(),f=new Array(g),E=new Array(g),d=new Array(g);o=new Array(g),a=new Array(g),s=new Array(g),l=new Array(g),u.bootstrap1(.7,f,0,c),f[c]=u.getLeft()+.7*S,i.getRate(f,E),u.bootstrap1(.85,f,0,c),f[c]=u.getLeft()+.85*S,i.getRate(f,d);for(var p=0;p<g;p++){var h=r[p]-e[p],m=S*t[p],A=S*n[p],_=S*E[p]+.7*(.7*-3+2)*A+(1.33-1)*m+-1.26*h,D=S*d[p]+.85*(2-2.55)*A+(.85*(4-2.55)-1)*m+-.765*h,I=(.85*(4-4.579375)*_- -.4095*D)/.009639000000000005,P=(.7*(2+.7*-3.2)*D-.85*(2-2.21)*_)/.009639000000000005,C=A+m-2*h-2*I-3*P;l[p]=P,s[p]=I,a[p]=C,o[p]=h-m-C-I-P}return u};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.BootstrapIntervalData={},EJSS_ODE_INTERPOLATION.bootstrapIntervalData=function(e,t,r,n,i){var o,a,s,l=EJSS_ODE_INTERPOLATION.hermiteIntervalData(e,t,r,n);l.interpolate=function(e,t){var r=l.getDeltaTime(),n=l.getLeftState(),i=l.getLeftRate(),u=(e-l.getLeft())/r;return n[t]+u*(r*i[t]+u*(o[t]+u*(a[t]+u*s[t])))},l.interpolateState=function(e,t,r,n){return l.bootstrap1((e-l.getLeft())/l.getDeltaTime(),t,r,n),t},l.bootstrap1=function(e,t,r,n){for(var i=l.getDeltaTime(),u=l.getLeftState(),g=l.getLeftRate(),c=r,S=0;S<n;S++)t[S]=u[c]+e*(i*g[c]+e*(o[c]+e*(a[c]+e*s[c]))),c++};var u=e.length,g=l.getDeltaTime(),c=new Array(u),S=new Array(u);o=new Array(u),a=new Array(u),s=new Array(u),l.hermite(.25,c,0,u-1),c[u-1]=l.getLeft()+.25*g,i.getRate(c,S);for(var f=0;f<u;f++){var E=r[f]-e[f],d=g*t[f],p=g*n[f],h=(g*S[f]+.3125*p+-.1875*d+-1.125*E)/.1875,m=p+d-2*E-2*h;s[f]=h,a[f]=m,o[f]=E-d-m-h}return l};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.ConstantConditionData={},EJSS_ODE_INTERPOLATION.constantConditionData=function(e){var t,r=EJSS_ODE_INTERPOLATION.intervalData(Number.NaN,Number.NaN);r.interpolate=function(e,r){return t[r]},r.interpolateState=function(e,r,n,i){for(var o=n,a=0;a<i;a++)r[a]=t[o],o++;return r};var n=e.length;t=new Array(n);for(var i=0;i<n;i++)t[i]=e[i];return r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Dopri5IntervalData={},EJSS_ODE_INTERPOLATION.dopri5IntervalData=function(e,t,r){var n=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,t,r);return n.interpolate=function(e,t){var r=(e-n.getLeft())/n.getDeltaTime(),i=1-r,o=n.getCoeffs();return o[0][t]+r*(o[1][t]+i*(o[2][t]+r*(o[3][t]+i*o[4][t])))},n.interpolateState=function(e,t,r,i){for(var o=(e-n.getLeft())/n.getDeltaTime(),a=1-o,s=n.getCoeffs(),l=r,u=0;u<i;u++)t[u]=s[0][l]+o*(s[1][l]+a*(s[2][l]+o*(s[3][l]+a*s[4][l]))),l++;return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Dopri853IntervalData={},EJSS_ODE_INTERPOLATION.dopri853IntervalData=function(e,t,r){var n=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,t,r);return n.interpolate=function(e,t){var r=(e-n.getLeft())/n.getDeltaTime(),i=1-r,o=n.getCoeffs();return o[0][t]+r*(o[1][t]+i*(o[2][t]+r*(o[3][t]+i*(o[4][t]+r*(o[5][t]+i*(o[6][t]+r*o[7][t]))))))},n.interpolateState=function(e,t,r,i){for(var o=(e-n.getLeft())/n.getDeltaTime(),a=1-o,s=n.getCoeffs(),l=r,u=0;u<i;u++)t[u]=s[0][l]+o*(s[1][l]+a*(s[2][l]+o*(s[3][l]+a*(s[4][l]+o*(s[5][l]+a*(s[6][l]+o*s[7][l])))))),l++;return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.EulerIntervalData={},EJSS_ODE_INTERPOLATION.eulerIntervalData=function(e,t,r){var n,i,o=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],r);o.interpolate=function(e,t){var r=e-o.getLeft();return n[t]+r*i[t]},o.interpolateState=function(e,t,r,a){for(var s=e-o.getLeft(),l=r,u=0;u<a;u++)t[u]=n[l]+s*i[l],l++;return t};var a=e.length;n=new Array(a),i=new Array(a);for(var s=0;s<a;s++)n[s]=e[s],i[s]=t[s];return o};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.EulerRichardsonIntervalData={},EJSS_ODE_INTERPOLATION.eulerRichardsonIntervalData=function(e,t,r,n){var i,o,a,s,l=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],r);l.interpolate=function(e,t){var r=(e-l.getLeft())/i,n=r*r*i,u=i*r-n;return o[t]+u*a[t]+n*s[t]},l.interpolateState=function(e,t,r,n){for(var u=(e-l.getLeft())/i,g=u*u*i,c=i*u-g,S=r,f=0;f<n;f++)t[f]=o[S]+c*a[S]+g*s[S],S++;return t};var u=e.length;o=new Array(u),a=new Array(u),s=new Array(u);for(var g=0;g<u;g++)o[g]=e[g],a[g]=t[g],s[g]=n[g];return i=r-e[u-1],l};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.ExtraStepsIntervalData={},EJSS_ODE_INTERPOLATION.extraStepsIntervalData=function(e,t,r){var n,i,o,a=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],t[t.length-1]);a.getTimeIndex=function(){return n},a.getDeltaTime=function(){return i},a.getCoeffs=function(){return o};var s=e.length;i=t[n=s-1]-e[n];var l=r.length;o=new Array(l);for(var u=0;u<l;u++){o[u]=new Array(s);for(var g=0;g<s;g++)o[u][g]=r[u][g]}return a};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.HermiteIntervalData={},EJSS_ODE_INTERPOLATION.hermiteIntervalData=function(e,t,r,n){var i,o,a,s,l,u,g=EJSS_ODE_INTERPOLATION.intervalData(e[e.length-1],r[r.length-1]);g.getTimeIndex=function(){return i},g.getDeltaTime=function(){return o},g.getLeftState=function(){return a},g.getLeftRate=function(){return s},g.interpolate=function(e,t){var r=(e-g.getLeft())/o,n=r-1,i=r*n,c=i*(1-2*r),S=r+c,f=i*n*o,E=i*r*o;return(-n-c)*a[t]+S*l[t]+f*s[t]+E*u[t]},g.interpolateState=function(e,t,r,n){return g.hermite((e-g.getLeft())/o,t,r,n),t},g.hermite=function(e,t,r,n){for(var i=e-1,g=e*i,c=g*(1-2*e),S=-i-c,f=e+c,E=g*i*o,d=g*e*o,p=r,h=0;h<n;h++)t[h]=S*a[p]+f*l[p]+E*s[p]+d*u[p],p++};var c=e.length;a=new Array(c),s=new Array(c),l=new Array(c),u=new Array(c);for(var S=0;S<c;S++)a[S]=e[S],s[S]=t[S],l[S]=r[S],u[S]=n[S];return o=r[i=c-1]-e[i],g};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.InitialConditionData={},EJSS_ODE_INTERPOLATION.initialConditionData=function(e){var t,r=EJSS_ODE_INTERPOLATION.intervalData(Number.NaN,Number.NaN);r.interpolate=function(r,n){return e.getInitialCondition(r,t),t[n]},r.interpolateState=function(r,n,i,o){e.getInitialCondition(r,t);for(var a=i,s=0;s<o;s++)n[s]=t[a],a++;return n};var n=e.getState().length;return t=new Array(n),r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.IntervalData={},EJSS_ODE_INTERPOLATION.intervalData=function(e,t){var r={getLeft:function(){return e},getRight:function(){return t},setRight:function(e){t=e},interpolate:function(e,t){return Number.NaN},interpolateState:function(e,t,r,n){return t}};return r};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.Radau5IntervalData={},EJSS_ODE_INTERPOLATION.radau5IntervalData=function(e,t,r){var n=EJSS_ODE_INTERPOLATION.extraStepsIntervalData(e,bState,r),i=bState[bState.length-1];return n.interpolate=function(e,t){var r=(e-i)/n.getDeltaTime(),o=n.getCoeffs(),a=EJSS_ODE_SOLVERS.Radau5.c1m1,s=EJSS_ODE_SOLVERS.Radau5.c2m1;return o[0][t]+r*(o[1][t]+(r-s)*(o[2][t]+(r-a)*o[3][t]))},n.interpolateState=function(e,t,r,o){for(var a=(e-i)/mDeltaTime,s=n.getCoeffs(),l=EJSS_ODE_SOLVERS.Radau5.c1m1,u=EJSS_ODE_SOLVERS.Radau5.c2m1,g=r,c=0;c<o;c++)t[c]=s[0][g]+a*(s[1][g]+(a-u)*(s[2][g]+(a-l)*s[3][g])),g++;return t},n};var EJSS_ODE_INTERPOLATION=EJSS_ODE_INTERPOLATION||{};EJSS_ODE_INTERPOLATION.StateHistory={},EJSS_ODE_INTERPOLATION.stateHistory=function(e){var t,r={},n=[],i=!0,o=0,a=0,s=0;return r.setLength=function(e){a=Math.abs(e),s=Math.max(o,a)},r.setMinimumLength=function(e){o=Math.abs(e),s=Math.max(o,a)},r.addIntervalData=function(e){i=e.getLeft()<=e.getRight();n.length;if(n.length>0){var t=n.length-1,r=n[t],o=0;if(i){for(;null!=r&&r.getLeft()>=e.getLeft();)o++,r=--t<0?null:n[t];null!=r&&e.getLeft()<r.getRight()&&r.setRight(e.getLeft())}else{for(;null!=r&&r.getLeft()<=e.getLeft();)o++,r=--t<0?null:n[t];null!=r&&e.getLeft()>r.getRight()&&r.setRight(e.getLeft())}o>0&&n.splice(t,o)}n.push(e)},r.toString=function(){for(var e="History has now "+n.length+" intervals: ",t=0,r=n.length;t<r;t++){var i=n[t];t>0&&(e+=", "),e+=" ["+i.getLeft()+","+i.getRight()+")"}return e},r.clearAll=function(){n=[]},r.clean=function(e){if(isFinite(s))if(0!=s){var t=0,r=n.length;if(i){e-=s;for(var o=0;o<r;o++){if(n[o].getRight()>e)break;t++}}else{e+=s;for(o=0;o<r;o++){if(n[o].getRight()<e)break;t++}}t>0&&n.splice(0,t)}else clearAll()},r.findInterval=function(e){var r=n.length;if(i)for(var o=r-1;o>=0;o--){if((a=n[o]).getLeft()<=e)return a}else for(o=r-1;o>=0;o--){var a;if((a=n[o]).getLeft()>=e)return a}return t},r.interpolate=function(e,t){return r.findInterval(e).interpolate(e,t)},r.interpolateState=function(e,t,n,i){var o=r.findInterval(e);return i||(i=t.length),n||(n=0),o.interpolateState(e,t,n,i)},e.getInitialCondition?(t=EJSS_ODE_INTERPOLATION.initialConditionData(e),e.setStateHistory(r)):t=EJSS_ODE_INTERPOLATION.constantConditionData(e.getState()),r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.EVENT_TYPE={STATE_EVENT:0,POSITIVE_EVENT:1,CROSSING_EVENT:2},EJSS_ODE_SOLVERS.EVENT_METHOD={BISECTION:0,SECANT:1},EJSS_ODE_SOLVERS.ERROR={NO_ERROR:0,INTERNAL_SOLVER_ERROR:1,EVENT_NOT_FOUND:2,ILLEGAL_EVENT_STATE:3,ZENO_EFFECT:4,TOO_MANY_STEPS_ERROR:5,DISCONTINUITY_PRODUCED_ERROR:6,DID_NOT_CONVERGE:7},EJSS_ODE_SOLVERS.DISCONTINUITY_CODE={DISCONTINUITY_PRODUCED_ERROR:0,NO_DISCONTINUITY_ALONG_STEP:1,DISCONTINUITY_ALONG_STEP:2,DISCONTINUITY_JUST_PASSED:3,DISCONTINUITY_EXACTLY_ON_STEP:4},EJSS_ODE_SOLVERS.InterpolatorEventSolver={},EJSS_ODE_SOLVERS.interpolatorEventSolver=function(e,t){var r,n,i,o,a={},s=!0,l=!1,u=.1,g=Number.NaN,c=Number.NaN,S=Number.POSITIVE_INFINITY,f=500,E=2*Number.MIN_VALUE,d=!0,p=1e4,h=u>0,m=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,A="No error",_=0,D=[],I=[],P=[],C=Number.NaN,T=null,y=0,R=[],N=null,v=!1,O=!1,M=null,b=[],G=null,L=100,x=1e-8,J=Number.NaN;function w(t,r){l?e.bestInterpolate(t,r):e.interpolate(t,r)}function k(e){var t,r;for(r=D.length,t=0;t<r;t++){(n=D[t]).findPosition(e,n.getH())}for(r=b.length,t=0;t<r;t++){var n;(n=b[t]).findPosition(e,n.getH())}}function W(e){if(R.length<=0)return a.error(EJSS_ODE_SOLVERS.ERROR.ZENO_EFFECT,"A Zeno-like effect has been detected.\nLast event was "+T.getProblem()+" which took place at "+C),!0;var t,r=!1,n=R.length;for(t=0;t<n;t++){R[t].zenoEffectAction(T.getProblem(),e)&&(r=!0)}return y=0,r}function F(e,t,r,n){r.splice(0,r.length);for(var i=D.length,o=0;o<i;o++){var s=D[o];switch(s.setH(s.getEvent().evaluate(t)),s.getCurrentPosition()){default:case EJSS_ODE_SOLVERS.ProblemData.POSITIVE:s.getH()<=0&&r.push(s);break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:if(s.getH()<=0&&(s.hasPositiveFlag()||s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT))return s;break;case EJSS_ODE_SOLVERS.ProblemData.ZERO:if(s.getH()<0){if(s.hasPositiveFlag()||s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT)return s}else if(s.getH()>0&&s.hasNegativeFlag()&&s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT)return s;break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:if(s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT){if(s.getH()<=-s.getEvent().getTolerance())return s}else if(s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT&&s.hasNegativeFlag()&&s.getH()>=0)return s;break;case EJSS_ODE_SOLVERS.ProblemData.NEGATIVE:if(s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT)s.getH()>=0&&r.push(s);else if(s.getEventType()==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT)return a.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e+" for the state event "+s.getEvent()),s}}return null}function V(e,t,r){var n,i,o=e.length,a=r,s=r-t,l=(t+r)/2;if(h)for(n=0;n<o;n++){switch((u=e[n]).getEvent().getRootFindingMethod()){default:case EJSS_ODE_SOLVERS.EVENT_METHOD.BISECTION:a=Math.min(a,l);break;case EJSS_ODE_SOLVERS.EVENT_METHOD.SECANT:i=u.getHBefore(),a=Math.min(a,t-i*s/(u.getHAfter()-i))}}else for(n=0;n<o;n++){var u;switch((u=e[n]).getEvent().getRootFindingMethod()){default:case EJSS_ODE_SOLVERS.EVENT_METHOD.BISECTION:a=Math.max(a,l);break;case EJSS_ODE_SOLVERS.EVENT_METHOD.SECANT:i=u.getHBefore(),a=Math.max(a,t-i*s/(u.getHAfter()-i))}}return a}return a.getEPSILON=function(){if(isNaN(J)){for(J=1;J+1!=1;)J/=2;J*=2}return J},a.setEnableExceptions=function(e){s=e},a.setBestInterpolation=function(e){l=e},a.setHistoryLength=function(t){e.getStateHistory().setLength(t)},a.setStepSize=function(t){u!=t&&(h=(u=t)>0,a.setInternalStepSize(e.getStepSize()))},a.getStepSize=function(){return u},a.setEstimateFirstStep=function(t){e.setEstimateFirstStep(t)},a.setInternalStepSize=function(t){e.setStepSize(h?Math.abs(t):-Math.abs(t))},a.setMaximumInternalStepSize=function(t){e.setMaximumStepSize(t)},a.setMaximumInternalSteps=function(e){p=e},a.setTolerances=function(t,r){e.setTolerances(g=Math.abs(t),c=Math.abs(r))},a.setTolerance=function(e){setTolerances(e,0)},a.getTolerance=function(){return Math.max(g,c)},a.setDDETolerance=function(e){x=e},a.getDDETolerance=function(){return x},a.setDDEIterations=function(e){L=e},a.getDDEIterations=function(){return L},a.addEvent=function(e){D.push(EJSS_ODE_SOLVERS.eventData(a,e,t.getState())),v=!0},a.removeEvent=function(e){for(var t=-1,r=D.length,n=0;n<r;n++){if(D[n].getEvent()==e){t=n;break}}if(t>=0){var i=D[t];T==i&&(T=null,y=0),N==i&&(N=null),D.splice(t,1)}v=O||D.length>0},a.addDiscontinuity=function(e){b.push(EJSS_ODE_SOLVERS.discontinuityData(a,e,t.getState())),O=!0,v=!0},a.removeDiscontinuity=function(e){for(var t=-1,r=b.length,n=0;n<r;n++){if(b[n].getDiscontinuity()==e){t=n;break}}t>=0&&b.splice(t,1),O=b.length>0,v=O||D.length>0},a.removeAllEvents=function(){D=[],b=[],O=!1,v=!1,null!=G&&a.addDiscontinuity(G)},a.setMaximumEventStep=function(e){S=Math.abs(e)},a.getMaximumEventStep=function(){return S},a.setCoalesceCloseEvents=function(e){d=e},a.isCoalesceCloseEvents=function(){return d},a.setEventProximityThreshold=function(e){E=e},a.getEventProximityThreshold=function(){return E},a.setZenoEffectDetection=function(e){f=e},a.getZenoEffectDetection=function(){return f},a.addZenoEffectListener=function(e){R.push(e)},a.removeZenoEffectListener=function(e){for(var t=R.length,r=0;r<t;r++)if(R[r]==e)return void R.splice(r,1)},a.setZeroZenoCounter=function(){y=0},a.getSolverEngine=function(){return e},a.getODE=function(){return t},a.getStateHistory=function(){return e.getStateHistory()},a.getErrorCode=function(){return m},a.getErrorMessage=function(){return A},a.getCounter=function(){return e.getCounter()},a.getNumberOfAttempts=function(){return _},a.getInternalStepSize=function(){return e.getInternalStepSize()},a.getIndependentVariableValue=function(){return t.getState()[n]},a.getCurrentTime=function(){return t.getState()[n]},a.getRunsForwards=function(){return h},a.getCurrentEventData=function(){return N},a.getLastEventData=function(){return T},a.getLastEventDataTime=function(){return C},a.initialize=function(s){var l,g,c;for(h=(u=s)>0,e.initialize(u),c=t.getState(),r=c.length,n=r-1,i=new Array(r),o=new Array(r),m=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,A="No error",y=0,T=null,N=null,null!==G&&(G.initialize(c),a.removeDiscontinuity(G),a.addDiscontinuity(G)),g=D.length,l=0;l<g;l++)D[l].reset(c);for(g=b.length,l=0;l<g;l++)b[l].reset(c)},a.step=function(){return v?function(){var o=t.getState();if(f>0&&y>f&&W(o))return 0;var s=o[n],g=e.getCurrentRate();if(s+g[n]==s)return 0;var c=s+u,m=e.getMaximumTime(O);if(isNaN(m))return a.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+o[n]);var A=h?Math.min(s+S,c):Math.max(s-S,c),_=0;for(;;){var D=null;if(N=null,h?m<A:m>A){if(e.bestInterpolate(m,i),null==(D=a.findFirstEvent(o,m,i))&&(D=M),null==D){for(var I=0;I<r;I++)o[I]=i[I];if(k(o[n]),m=e.internalStep(O),isNaN(m))return a.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver looking for an event at "+o[n]);if(++_>p)return a.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the number of internal steps at "+o[n]);continue}}else if(w(A,i),null==(D=a.findFirstEvent(o,A,i))&&null!=M&&M.time<=A&&(D=M),null==D){if(A==c){for(I=0;I<r;I++)o[I]=i[I];return k(o[n]),c-s}A=h?Math.min(A+S,c):Math.max(A-S,c);continue}if(N=D,l)e.bestInterpolate(D.getTime(),o);else for(I=0;I<r;I++)o[I]=i[I];var P=o[n],R=D.action();if(a.reinitialize(),_=0,o=t.getState(),P!=o[n])return y=0,T=null,N=null,D.reset(o),D.getTime()-s;if(null!=T&&(Math.abs(C-D.getTime())<E?(y++,d&&(R=!1)):y=0),T=D,C=D.getTime(),R)return D.getTime()-s;if(f>0&&y>f&&W(o))return D.getTime()-s;if(M=null,m=e.getMaximumTime(O),isNaN(D.getMaxAdvance())||(m=h?Math.min(m,D.getMaxAdvance()):Math.max(m,D.getMaxAdvance())),isNaN(m))return a.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver after an event at "+o[n])}}():function(){var i=t.getState(),o=e.getCurrentRate(),s=i[n];if(s+o[n]==s)return 0;var l=i[n]+u,g=e.getMaximumTime(!1);if(isNaN(g))return a.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+i[n]);var c=0;if(h)for(;g<l;){if(g=e.internalStep(!1),isNaN(g))return a.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver forwards at "+i[n]);if(++c>p){var S=i[n],f=e.bestInterpolate(l,new Array(r))[n];return a.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the maximum of "+p+" internal steps\nat "+f+", starting from "+S+" for an step of "+u)}}else for(;g>l;){if(g=e.internalStep(!1),isNaN(g))return a.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver backwards at "+i[n]);if(++c>p)return a.error(EJSS_ODE_SOLVERS.ERROR.TOO_MANY_STEPS_ERROR,"The solver exceeded the number of internal steps at "+i[n])}return w(l,i),u}()},a.maxStep=function(){return v?function(){var o=t.getState();if(f>0&&y>f&&W(o))return 0;var s=o[n],u=e.getCurrentRate();if(s+u[n]==s)return 0;var g=e.getMaximumTime(O);if(isNaN(g))return a.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+o[n]);if(s==g&&(g=e.internalStep(O),isNaN(g)))return a.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver forwards at "+o[n]);null!=T&&(isNaN(T.getMaxAdvance())||(g=h?Math.min(g,T.getMaxAdvance()):Math.max(g,T.getMaxAdvance())));var c=h?Math.min(s+S,g):Math.max(s-S,g);for(;;){var d=null;if(N=null,w(c,i),null==(d=a.findFirstEvent(o,c,i))&&null!=M&&M.getTime()<=c&&(d=M),null!=d){if(N=d,l)e.bestInterpolate(d.getTime(),o);else for(m=0;m<r;m++)o[m]=i[m];var p=o[n];return d.action(),a.reinitialize(),o=t.getState(),p!=o[n]?(y=0,T=null,N=null,d.reset(o),d.getTime()-s):(null!=T&&(Math.abs(C-d.getTime())<E?y++:y=0),T=d,C=d.getTime(),d.getTime()-s)}if(c==g){for(var m=0;m<r;m++)o[m]=i[m];return k(o[n]),g-s}c=h?Math.min(c+S,g):Math.max(c-S,g)}}():function(){var r=t.getState(),i=e.getCurrentRate(),o=r[n];if(o+i[n]==o)return 0;var s=e.getMaximumTime(!1);if(isNaN(s))return a.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at "+r[n]);if(o==s&&(s=e.internalStep(!1),isNaN(s)))return a.error(EJSS_ODE_SOLVERS.ERROR.INTERNAL_SOLVER_ERROR,"Error when stepping the solver at max step at "+r[n]);return w(s,r),s-o}()},a.userReinitialize=function(){N=null,a.reinitialize()},a.reinitialize=function(){var r,n,i=t.getState();for(e.reinitialize(i),m=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,A="No error",null!=G&&G.reset(i),n=D.length,r=0;r<n;r++)D[r].reset(i);for(n=b.length,r=0;r<n;r++)b[r].reset(i);M=null},a.resetDiscontinuities=function(e){if(null!==G){G.reset(e);for(var t=b.length,r=0;r<t;r++)b[r].reset(e)}},a.checkDiscontinuity=function(e,t){for(var r=b.length,i=null,o=0;o<r;o++){var s=b[o],l=s.getDiscontinuity().evaluate(e);switch(s.setH(l),s.getCurrentPosition()){default:case EJSS_ODE_SOLVERS.ProblemData.POSITIVE:if(l<=0)return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP;l<s.getDiscontinuity().getTolerance()&&(i=s);break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:if(l<=0&&s.hasPositiveFlag())return a.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[n]+" for the discontinuity "+s.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.ZERO:if(l<0&&s.hasPositiveFlag())return a.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[n]+" for the discontinuity "+s.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;if(l>0&&s.hasNegativeFlag())return a.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[n]+" for the discontinuity "+s.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:if(s.hasNegativeFlag()&&l>=0)return a.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,"The system started from an illegal state at "+e[n]+" for the discontinuity "+s.getDiscontinuity()),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR;break;case EJSS_ODE_SOLVERS.ProblemData.NEGATIVE:if(l>0)return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP;l>-s.getDiscontinuity().getTolerance()&&(i=s)}}return null!=i?(t&&(M=i).setTime(e[n]),EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP):EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP},a.error=function(t,r){if(m=t,A=r,s)throw{name:"ODE Solver exception",solver:e,message:r};return Number.NaN},a.findFirstEvent=function(t,i,s){var l,u;_=0;var g=F(t[n],s,I,"at t1");if(null!=g){for(g.time=t[n],g.maxAdvance=i,l=0;l<r;l++)s[l]=t[l];return g}if(I.length<=0)return null;var c=!0;for(u=D.length,l=0;l<u;l++){(h=D[l]).setHAfter(h.getH())}for(;c;){_++;var S=V(I,t[n],i);w(S,o);var f=F(t[n],o,P,"short");if(null!=f){for(f.time=t[n],f.maxAdvance=S,l=0;l<r;l++)s[l]=t[l];return f}if(P.length<=0){var E=null;for(u=I.length,l=0;l<u;l++){if((h=I[l]).getCurrentPosition()==EJSS_ODE_SOLVERS.ProblemData.POSITIVE){if(h.getH()<h.getEvent().getTolerance()){E=h;break}}else if(h.getH()>-h.getEvent().getTolerance()){E=h;break}}if(null!=E){for(E.time=S,E.maxAdvance=i,l=0;l<r;l++)s[l]=o[l];return E}for(l=0;l<r;l++)t[l]=o[l];for(u=D.length,l=0;l<u;l++){(h=D[l]).findPosition(t[n],h.getH())}var d=F(t[n],s,I,"at tTest");if(null!=d){for(d.time=t[n],d.maxAdvance=i,l=0;l<r;l++)s[l]=t[l];return d}}else{var p=!0;E=null;for(u=P.length,l=0;l<u;l++){if((m=P[l]).getCurrentPosition()==EJSS_ODE_SOLVERS.ProblemData.POSITIVE){if(m.getH()<=-m.getEvent().getTolerance()){p=!1;break}E=m}else{if(m.getH()>=m.getEvent().getTolerance()){p=!1;break}E=m}}if(p&&null!=E){for(E.time=S,E.maxAdvance=i,l=0;l<r;l++)s[l]=o[l];return E}for(i=S,l=0;l<r;l++)s[l]=o[l];for(u=D.length,l=0;l<u;l++){var h;(h=D[l]).setHAfter(h.getH())}for(I=[],u=P.length,l=0;l<u;l++)I.push(P[l])}for(u=I.length,l=0;l<u;l++){var m=I[l];if(_>m.getEvent().getMaxIterations()){c=!1;break}}}var A=I[0];return a.error(EJSS_ODE_SOLVERS.ERROR.EVENT_NOT_FOUND,"Warning : Event not found after "+_+" attempts at t="+t[n]+" h = "+A.getH()+".\nPlease check the code of your event, decrease the initial step size, the tolerance of the solver,\nor the event maximum step, or increase the maximum number of attempts.\nFirst event remaining in the queue: "+A.getEvent()),A.setTime((t[n]+i)/2),A.setMaxAdvance(Number.NaN),e.bestInterpolate(A.time,s),A},t.getDelays&&(G=EJSS_ODE_SOLVERS.ddeDiscontinuity(a,t)),e.setODE(a,t),a};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.BogackiShampine23={B3_1:2/9,B3_2:1/3,B3_3:4/9,B2_1:7/24,B2_2:1/4,B2_3:1/3,B2_4:1/8},EJSS_ODE_SOLVERS.bogackiShampine23=function(){var e,t,r,n=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(3),i=n.allocateOtherArrays;return n.getNumberOfEvaluations=function(){return 3},n.allocateOtherArrays=function(){i(),e=new Array(n.getDimension()),t=new Array(n.getDimension()),r=new Array(n.getDimension())},n.computeIntermediateStep=function(r,i){var o,a=r/2,s=n.getODE(),l=n.getInitialState(),u=n.getInitialRate(),g=n.getDimension(),c=g-1,S=EJSS_ODE_SOLVERS.BogackiShampine23;for(o=0;o<g;o++)i[o]=l[o]+a*u[o];s.getRate(i,e);var f=.75*r;for(o=0;o<g;o++)i[o]=l[o]+f*e[o];for(s.getRate(i,t),o=0;o<c;o++)i[o]=l[o]+r*(S.B3_1*u[o]+S.B3_2*e[o]+S.B3_3*t[o]);i[c]=n.getInitialTime()+r*u[c]},n.computeCarefulIntermediateStep=function(r,i,o){var a,s=i/2,l=n.getODE(),u=n.getInitialState(),g=n.getInitialRate(),c=n.getDimension(),S=c-1,f=EJSS_ODE_SOLVERS.BogackiShampine23,E=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(a=0;a<c;a++)o[a]=u[a]+s*g[a];switch(r.checkDiscontinuity(o,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:case E.NO_DISCONTINUITY_ALONG_STEP:}l.getRate(o,e);var d=.75*i;for(a=0;a<c;a++)o[a]=u[a]+d*e[a];switch(r.checkDiscontinuity(o,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:case E.NO_DISCONTINUITY_ALONG_STEP:}for(l.getRate(o,t),a=0;a<S;a++)o[a]=u[a]+i*(f.B3_1*g[a]+f.B3_2*e[a]+f.B3_3*t[a]);return o[S]=n.getInitialTime()+i*g[S],r.checkDiscontinuity(o,!0)},n.computeFinalRateAndCreateIntervalData=function(){n.getODE();var e=n.getInitialState(),t=n.getInitialRate(),r=n.getFinalState(),i=n.getFinalRate();return EJSS_ODE_INTERPOLATION.hermiteIntervalData(e,t,r,i)},n.computeApproximation=function(i){var o=n.getODE(),a=n.getTimeIndex(),s=n.getInitialState(),l=n.getInitialRate(),u=n.getFinalState(),g=n.getFinalRate();o.getRate(u,g);for(var c=EJSS_ODE_SOLVERS.BogackiShampine23,S=0;S<a;S++)r[S]=s[S]+i*(c.B2_1*l[S]+c.B2_2*e[S]+c.B2_3*t[S]+c.B2_4*g[S]);return r[a]=n.getInitialTime()+i*l[a],n.computeError(r)},n};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.CashKarp45={A_11:.2,A_21:3/40,A_22:9/40,A_31:.3,A_32:-.9,A_33:1.2,A_41:-11/54,A_42:2.5,A_43:-70/27,A_44:35/27,A_51:1631/55296,A_52:175/512,A_53:575/13824,A_54:44275/110592,A_55:253/4096,B4_1:2825/27648,B4_2:0,B4_3:18575/48384,B4_4:13525/55296,B4_5:277/14336,B4_6:1/4,B5_1:37/378,B5_2:0,B5_3:250/621,B5_4:125/594,B5_5:0,B5_6:512/1771},EJSS_ODE_SOLVERS.cashKarp45=function(){var e,t,r,n,i,o,a=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(5),s=a.allocateOtherArrays;return a.getNumberOfEvaluations=function(){return 6},a.allocateOtherArrays=function(){s(),e=new Array(a.getDimension()),t=new Array(a.getDimension()),r=new Array(a.getDimension()),n=new Array(a.getDimension()),i=new Array(a.getDimension()),o=new Array(a.getDimension())},a.computeIntermediateStep=function(o,s){var l,u=a.getODE(),g=a.getInitialState(),c=a.getInitialRate(),S=a.getDimension(),f=S-1,E=EJSS_ODE_SOLVERS.CashKarp45;for(l=0;l<S;l++)s[l]=g[l]+o*E.A_11*c[l];for(u.getRate(s,e),l=0;l<S;l++)s[l]=g[l]+o*(E.A_21*c[l]+E.A_22*e[l]);for(u.getRate(s,t),l=0;l<S;l++)s[l]=g[l]+o*(E.A_31*c[l]+E.A_32*e[l]+E.A_33*t[l]);for(u.getRate(s,r),l=0;l<S;l++)s[l]=g[l]+o*(E.A_41*c[l]+E.A_42*e[l]+E.A_43*t[l]+E.A_44*r[l]);for(u.getRate(s,n),l=0;l<S;l++)s[l]=g[l]+o*(E.A_51*c[l]+E.A_52*e[l]+E.A_53*t[l]+E.A_54*r[l]+E.A_55*n[l]);for(u.getRate(s,i),l=0;l<f;l++)s[l]=g[l]+o*(E.B5_1*c[l]+E.B5_2*e[l]+E.B5_3*t[l]+E.B5_4*r[l]+E.B5_5*n[l]+E.B5_6*i[l]);s[f]=a.getInitialTime()+o*c[f]},a.computeCarefulIntermediateStep=function(o,s,l){var u,g=a.getODE(),c=a.getInitialState(),S=a.getInitialRate(),f=a.getDimension(),E=f-1,d=EJSS_ODE_SOLVERS.CashKarp45,p=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(u=0;u<f;u++)l[u]=c[u]+s*d.A_11*S[u];switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,e),u=0;u<f;u++)l[u]=c[u]+s*(d.A_21*S[u]+d.A_22*e[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,t),u=0;u<f;u++)l[u]=c[u]+s*(d.A_31*S[u]+d.A_32*e[u]+d.A_33*t[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,r),u=0;u<f;u++)l[u]=c[u]+s*(d.A_41*S[u]+d.A_42*e[u]+d.A_43*t[u]+d.A_44*r[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,n),u=0;u<f;u++)l[u]=c[u]+s*(d.A_51*S[u]+d.A_52*e[u]+d.A_53*t[u]+d.A_54*r[u]+d.A_55*n[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,i),u=0;u<E;u++)l[u]=c[u]+s*(d.B5_1*S[u]+d.B5_2*e[u]+d.B5_3*t[u]+d.B5_4*r[u]+d.B5_5*n[u]+d.B5_6*i[u]);return l[E]=a.getInitialTime()+s*S[E],o.checkDiscontinuity(l,!0)},a.computeFinalRateAndCreateIntervalData=function(){var e=a.getODE(),t=a.getInitialState(),r=a.getInitialRate(),n=a.getFinalState(),i=a.getFinalRate();return e.getRate(n,i),EJSS_ODE_INTERPOLATION.bootstrap2IntervalData(t,r,n,i,e)},a.computeApproximation=function(s){for(var l=a.getTimeIndex(),u=a.getInitialState(),g=a.getInitialRate(),c=EJSS_ODE_SOLVERS.CashKarp45,S=0;S<l;S++)o[S]=u[S]+s*(c.B4_1*g[S]+c.B4_2*e[S]+c.B4_3*t[S]+c.B4_4*r[S]+c.B4_5*n[S]+c.B4_6*i[S]);return o[l]=a.getInitialTime()+s*g[l],a.computeError(o)},a};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.DoPri5={A_11:.2,A_21:3/40,A_22:9/40,A_31:44/45,A_32:-56/15,A_33:32/9,A_41:19372/6561,A_42:-25360/2187,A_43:64448/6561,A_44:-212/729,A_51:9017/3168,A_52:-355/33,A_53:46732/5247,A_54:49/176,A_55:-5103/18656,B5_1:35/384,B5_2:0,B5_3:500/1113,B5_4:125/192,B5_5:-2187/6784,B5_6:11/84,D_1:-1.1270175653862835,D_2:0,D_3:2.675424484351598,D_4:-5.685526961588504,D_5:3.5219323679207912,D_6:-1.7672812570757455,D_7:2.382468931778144,E_1:71/57600,E_2:0,E_3:-71/16695,E_4:71/1920,E_5:-17253/339200,E_6:22/525,E_7:-1/40},EJSS_ODE_SOLVERS.doPri5=function(){var e,t,r,n,i,o,a=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(5),s=a.allocateOtherArrays;return a.getNumberOfEvaluations=function(){return 6},a.allocateOtherArrays=function(){s();var l=a.getDimension();e=new Array(l),t=new Array(l),r=new Array(l),n=new Array(l),i=new Array(l),o=new Array(5);for(var u=0;u<5;u++)o[u]=new Array(l)},a.computeIntermediateStep=function(o,s){var l,u=a.getODE(),g=a.getInitialState(),c=a.getInitialRate(),S=a.getDimension(),f=S-1,E=EJSS_ODE_SOLVERS.DoPri5;for(l=0;l<S;l++)s[l]=g[l]+o*E.A_11*c[l];for(u.getRate(s,e),l=0;l<S;l++)s[l]=g[l]+o*(E.A_21*c[l]+E.A_22*e[l]);for(u.getRate(s,t),l=0;l<S;l++)s[l]=g[l]+o*(E.A_31*c[l]+E.A_32*e[l]+E.A_33*t[l]);for(u.getRate(s,r),l=0;l<S;l++)s[l]=g[l]+o*(E.A_41*c[l]+E.A_42*e[l]+E.A_43*t[l]+E.A_44*r[l]);for(u.getRate(s,n),l=0;l<S;l++)s[l]=g[l]+o*(E.A_51*c[l]+E.A_52*e[l]+E.A_53*t[l]+E.A_54*r[l]+E.A_55*n[l]);for(u.getRate(s,i),l=0;l<f;l++)s[l]=g[l]+o*(E.B5_1*c[l]+E.B5_2*e[l]+E.B5_3*t[l]+E.B5_4*r[l]+E.B5_5*n[l]+E.B5_6*i[l]);s[f]=a.getInitialTime()+o*c[f]},a.computeCarefulIntermediateStep=function(o,s,l){var u,g=a.getODE(),c=a.getInitialState(),S=a.getInitialRate(),f=a.getDimension(),E=f-1,d=EJSS_ODE_SOLVERS.DoPri5,p=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(u=0;u<f;u++)l[u]=c[u]+s*d.A_11*S[u];switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,e),u=0;u<f;u++)l[u]=c[u]+s*(d.A_21*S[u]+d.A_22*e[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,t),u=0;u<f;u++)l[u]=c[u]+s*(d.A_31*S[u]+d.A_32*e[u]+d.A_33*t[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,r),u=0;u<f;u++)l[u]=c[u]+s*(d.A_41*S[u]+d.A_42*e[u]+d.A_43*t[u]+d.A_44*r[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,n),u=0;u<f;u++)l[u]=c[u]+s*(d.A_51*S[u]+d.A_52*e[u]+d.A_53*t[u]+d.A_54*r[u]+d.A_55*n[u]);switch(o.checkDiscontinuity(l,!1)){case p.DISCONTINUITY_PRODUCED_ERROR:return p.DISCONTINUITY_PRODUCED_ERROR;case p.DISCONTINUITY_JUST_PASSED:return p.DISCONTINUITY_JUST_PASSED;case p.DISCONTINUITY_ALONG_STEP:return p.DISCONTINUITY_ALONG_STEP;case p.DISCONTINUITY_EXACTLY_ON_STEP:case p.NO_DISCONTINUITY_ALONG_STEP:}for(g.getRate(l,i),u=0;u<E;u++)l[u]=c[u]+s*(d.B5_1*S[u]+d.B5_2*e[u]+d.B5_3*t[u]+d.B5_4*r[u]+d.B5_5*n[u]+d.B5_6*i[u]);return l[E]=a.getInitialTime()+s*S[E],o.checkDiscontinuity(l,!0)},a.computeFinalRateAndCreateIntervalData=function(){a.getODE();for(var s=a.getInitialState(),l=a.getInitialRate(),u=a.getFinalState(),g=a.getFinalRate(),c=EJSS_ODE_SOLVERS.DoPri5,S=a.getDimension(),f=S-1,E=u[f]-s[f],d=0;d<S;d++){var p=s[d],h=l[d],m=g[d];o[0][d]=p;var A=u[d]-p,_=E*h-A;o[3][d]=A-E*m-_,o[4][d]=E*(c.D_1*h+c.D_2*e[d]+c.D_3*t[d]+c.D_4*r[d]+c.D_5*n[d]+c.D_6*i[d]+c.D_7*m),o[1][d]=A,o[2][d]=_}return EJSS_ODE_INTERPOLATION.dopri5IntervalData(s,u,o)},a.computeApproximation=function(o){var s=a.getODE(),l=a.getInitialState(),u=a.getInitialRate(),g=a.getFinalState(),c=a.getFinalRate(),S=a.getAbsTol(),f=a.getRelTol(),E=EJSS_ODE_SOLVERS.DoPri5,d=a.getDimension();s.getRate(g,c);for(var p=0,h=0;h<d;h++){var m=S[h]+f[h]*Math.max(Math.abs(g[h]),Math.abs(l[h])),A=(E.E_1*u[h]+E.E_2*e[h]+E.E_3*t[h]+E.E_4*r[h]+E.E_5*n[h]+E.E_6*i[h]+E.E_7*c[h])/m;p+=A*A}return Math.sqrt(p/d)},a};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.DoPri853={A_11:.05260015195876773,A_21:.0197250569845379,A_22:.0591751709536137,A_31:.02958758547680685,A_32:0,A_33:.08876275643042054,A_41:.2413651341592667,A_42:0,A_43:-.8845494793282861,A_44:.924834003261792,A_51:.037037037037037035,A_52:0,A_53:0,A_54:.17082860872947386,A_55:.12546768756682242,A_61:.037109375,A_62:0,A_63:0,A_64:.17025221101954405,A_65:.06021653898045596,A_66:-.017578125,A_71:.03709200011850479,A_72:0,A_73:0,A_74:.17038392571223998,A_75:.10726203044637328,A_76:-.015319437748624402,A_77:.008273789163814023,A_81:.6241109587160757,A_82:0,A_83:0,A_84:-3.3608926294469414,A_85:-.868219346841726,A_86:27.59209969944671,A_87:20.154067550477894,A_88:-43.48988418106996,A_91:.47766253643826434,A_92:0,A_93:0,A_94:-2.4881146199716677,A_95:-.590290826836843,A_96:21.230051448181193,A_97:15.279233632882423,A_98:-33.28821096898486,A_99:-.020331201708508627,A_101:-.9371424300859873,A_102:0,A_103:0,A_104:5.186372428844064,A_105:1.0914373489967295,A_106:-8.149787010746927,A_107:-18.52006565999696,A_108:22.739487099350505,A_109:2.4936055526796523,A_1010:-3.0467644718982196,A_111:2.273310147516538,A_112:0,A_113:0,A_114:-10.53449546673725,A_115:-2.0008720582248625,A_116:-17.9589318631188,A_117:27.94888452941996,A_118:-2.8589982771350235,A_119:-8.87285693353063,A_1110:12.360567175794303,A_1111:.6433927460157636,B8_1:.054293734116568765,B8_2:0,B8_3:0,B8_4:0,B8_5:0,B8_6:4.450312892752409,B8_7:1.8915178993145003,B8_8:-5.801203960010585,B8_9:.3111643669578199,B8_10:-.1521609496625161,B8_11:.20136540080403034,B8_12:.04471061572777259,AD13_1:.056167502283047954,AD13_2:0,AD13_3:0,AD13_4:0,AD13_5:0,AD13_6:0,AD13_7:.25350021021662483,AD13_8:-.2462390374708025,AD13_9:-.12419142326381637,AD13_10:.15329179827876568,AD13_11:.00820105229563469,AD13_12:.007567897660545699,AD13_13:-.008298,AD14_1:.03183464816350214,AD14_2:0,AD14_3:0,AD14_4:0,AD14_5:0,AD14_6:.028300909672366776,AD14_7:.053541988307438566,AD14_8:-.05492374857139099,AD14_9:0,AD14_10:0,AD14_11:-.00010834732869724932,AD14_12:.0003825710908356584,AD14_13:-.00034046500868740456,AD14_14:.1413124436746325,AD15_1:-.42889630158379194,AD15_2:0,AD15_3:0,AD15_4:0,AD15_5:0,AD15_6:-4.697621415361164,AD15_7:7.683421196062599,AD15_8:4.06898981839711,AD15_9:.3567271874552811,AD15_10:0,AD15_11:0,AD15_12:0,AD15_13:-.0013990241651590145,AD15_14:2.9475147891527724,AD15_15:-9.15095847217987,D4_1:-8.428938276109013,D4_2:0,D4_3:0,D4_4:0,D4_5:0,D4_6:.5667149535193777,D4_7:-3.0689499459498917,D4_8:2.38466765651207,D4_9:2.117034582445028,D4_10:-.871391583777973,D4_11:2.2404374302607883,D4_12:.6315787787694688,D4_13:-.08899033645133331,D4_14:18.148505520854727,D4_15:-9.194632392478356,D4_16:-4.436036387594894,D5_1:10.427508642579134,D5_2:0,D5_3:0,D5_4:0,D5_5:0,D5_6:242.28349177525817,D5_7:165.20045171727028,D5_8:-374.5467547226902,D5_9:-22.113666853125306,D5_10:7.733432668472264,D5_11:-30.674084731089398,D5_12:-9.332130526430229,D5_13:15.697238121770845,D5_14:-31.139403219565178,D5_15:-9.35292435884448,D5_16:35.81684148639408,D6_1:19.985053242002433,D6_2:0,D6_3:0,D6_4:0,D6_5:0,D6_6:-387.0373087493518,D6_7:-189.17813819516758,D6_8:527.8081592054236,D6_9:-11.57390253995963,D6_10:6.8812326946963,D6_11:-1.0006050966910838,D6_12:.7777137798053443,D6_13:-2.778205752353508,D6_14:-60.19669523126412,D6_15:84.32040550667716,D6_16:11.99229113618279,D7_1:-25.69393346270375,D7_2:0,D7_3:0,D7_4:0,D7_5:0,D7_6:-154.18974869023643,D7_7:-231.5293791760455,D7_8:357.6391179106141,D7_9:93.40532418362432,D7_10:-37.45832313645163,D7_11:104.0996495089623,D7_12:29.8402934266605,D7_13:-43.53345659001114,D7_14:96.32455395918828,D7_15:-39.17726167561544,D7_16:-149.72683625798564,E3_1:-.18980075407240762,E3_2:0,E3_3:0,E3_4:0,E3_5:0,E3_6:4.450312892752409,E3_7:1.8915178993145003,E3_8:-5.801203960010585,E3_9:-.42268232132379197,E3_10:-.1521609496625161,E3_11:.20136540080403034,E3_12:.022651792198360825,E5_1:.01312004499419488,E5_2:0,E5_3:0,E5_4:0,E5_5:0,E5_6:-1.2251564463762044,E5_7:-.4957589496572502,E5_8:1.6643771824549864,E5_9:-.35032884874997366,E5_10:.3341791187130175,E5_11:.08192320648511571,E5_12:-.022355307863886294},EJSS_ODE_SOLVERS.doPri853=function(){var e,t,r,n,i,o,a,s,l,u,g,c,S,f,E,d,p=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(8),h=p.allocateOtherArrays;return p.getNumberOfEvaluations=function(){return 16},p.allocateOtherArrays=function(){h();var m=p.getDimension();e=new Array(m),t=new Array(m),r=new Array(m),n=new Array(m),i=new Array(m),o=new Array(m),a=new Array(m),s=new Array(m),l=new Array(m),u=new Array(m),g=new Array(m),mRate13=new Array(m),c=new Array(m),S=new Array(m),f=new Array(m),E=new Array(m),d=new Array(8);for(var A=0;A<8;A++)d[A]=new Array(m)},p.computeIntermediateStep=function(c,S){var f,E=p.getODE(),d=p.getInitialState(),h=p.getInitialRate(),m=p.getDimension(),A=m-1,_=EJSS_ODE_SOLVERS.DoPri853;for(f=0;f<m;f++)S[f]=d[f]+c*_.A_11*h[f];for(E.getRate(S,e),f=0;f<m;f++)S[f]=d[f]+c*(_.A_21*h[f]+_.A_22*e[f]);for(E.getRate(S,t),f=0;f<m;f++)S[f]=d[f]+c*(_.A_31*h[f]+_.A_32*e[f]+_.A_33*t[f]);for(E.getRate(S,r),f=0;f<m;f++)S[f]=d[f]+c*(_.A_41*h[f]+_.A_42*e[f]+_.A_43*t[f]+_.A_44*r[f]);for(E.getRate(S,n),f=0;f<m;f++)S[f]=d[f]+c*(_.A_51*h[f]+_.A_52*e[f]+_.A_53*t[f]+_.A_54*r[f]+_.A_55*n[f]);for(E.getRate(S,i),f=0;f<m;f++)S[f]=d[f]+c*(_.A_61*h[f]+_.A_62*e[f]+_.A_63*t[f]+_.A_64*r[f]+_.A_65*n[f]+_.A_66*i[f]);for(E.getRate(S,o),f=0;f<m;f++)S[f]=d[f]+c*(_.A_71*h[f]+_.A_72*e[f]+_.A_73*t[f]+_.A_74*r[f]+_.A_75*n[f]+_.A_76*i[f]+_.A_77*o[f]);for(E.getRate(S,a),f=0;f<m;f++)S[f]=d[f]+c*(_.A_81*h[f]+_.A_82*e[f]+_.A_83*t[f]+_.A_84*r[f]+_.A_85*n[f]+_.A_86*i[f]+_.A_87*o[f]+_.A_88*a[f]);for(E.getRate(S,s),f=0;f<m;f++)S[f]=d[f]+c*(_.A_91*h[f]+_.A_92*e[f]+_.A_93*t[f]+_.A_94*r[f]+_.A_95*n[f]+_.A_96*i[f]+_.A_97*o[f]+_.A_98*a[f]+_.A_99*s[f]);for(E.getRate(S,l),f=0;f<m;f++)S[f]=d[f]+c*(_.A_101*h[f]+_.A_102*e[f]+_.A_103*t[f]+_.A_104*r[f]+_.A_105*n[f]+_.A_106*i[f]+_.A_107*o[f]+_.A_108*a[f]+_.A_109*s[f]+_.A_1010*l[f]);for(E.getRate(S,u),f=0;f<m;f++)S[f]=d[f]+c*(_.A_111*h[f]+_.A_112*e[f]+_.A_113*t[f]+_.A_114*r[f]+_.A_115*n[f]+_.A_116*i[f]+_.A_117*o[f]+_.A_118*a[f]+_.A_119*s[f]+_.A_1110*l[f]+_.A_1111*u[f]);for(E.getRate(S,g),f=0;f<A;f++)S[f]=d[f]+c*(_.B8_1*h[f]+_.B8_2*e[f]+_.B8_3*t[f]+_.B8_4*r[f]+_.B8_5*n[f]+_.B8_6*i[f]+_.B8_7*o[f]+_.B8_8*a[f]+_.B8_9*s[f]+_.B8_10*l[f]+_.B8_11*u[f]+_.B8_12*g[f]);S[A]=p.getInitialTime()+c*h[A]},p.computeCarefulIntermediateStep=function(c,S,f){var E,d=p.getODE(),h=p.getInitialState(),m=p.getInitialRate(),A=p.getDimension(),_=A-1,D=EJSS_ODE_SOLVERS.DoPri853,I=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(E=0;E<A;E++)f[E]=h[E]+S*D.A_11*m[E];switch(c.checkDiscontinuity(f,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(d.getRate(f,e),E=0;E<A;E++)f[E]=h[E]+S*(D.A_21*m[E]+D.A_22*e[E]);switch(c.checkDiscontinuity(f,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(d.getRate(f,t),E=0;E<A;E++)f[E]=h[E]+S*(D.A_31*m[E]+D.A_32*e[E]+D.A_33*t[E]);switch(c.checkDiscontinuity(f,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(d.getRate(f,r),E=0;E<A;E++)f[E]=h[E]+S*(D.A_41*m[E]+D.A_42*e[E]+D.A_43*t[E]+D.A_44*r[E]);switch(c.checkDiscontinuity(f,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(d.getRate(f,n),E=0;E<A;E++)f[E]=h[E]+S*(D.A_51*m[E]+D.A_52*e[E]+D.A_53*t[E]+D.A_54*r[E]+D.A_55*n[E]);switch(c.checkDiscontinuity(f,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(d.getRate(f,i),E=0;E<A;E++)f[E]=h[E]+S*(D.A_61*m[E]+D.A_62*e[E]+D.A_63*t[E]+D.A_64*r[E]+D.A_65*n[E]+D.A_66*i[E]);switch(c.checkDiscontinuity(f,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(d.getRate(f,o),E=0;E<A;E++)f[E]=h[E]+S*(D.A_71*m[E]+D.A_72*e[E]+D.A_73*t[E]+D.A_74*r[E]+D.A_75*n[E]+D.A_76*i[E]+D.A_77*o[E]);switch(c.checkDiscontinuity(f,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(d.getRate(f,a),E=0;E<A;E++)f[E]=h[E]+S*(D.A_81*m[E]+D.A_82*e[E]+D.A_83*t[E]+D.A_84*r[E]+D.A_85*n[E]+D.A_86*i[E]+D.A_87*o[E]+D.A_88*a[E]);switch(c.checkDiscontinuity(f,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(d.getRate(f,s),E=0;E<A;E++)f[E]=h[E]+S*(D.A_91*m[E]+D.A_92*e[E]+D.A_93*t[E]+D.A_94*r[E]+D.A_95*n[E]+D.A_96*i[E]+D.A_97*o[E]+D.A_98*a[E]+D.A_99*s[E]);switch(c.checkDiscontinuity(f,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(d.getRate(f,l),E=0;E<A;E++)f[E]=h[E]+S*(D.A_101*m[E]+D.A_102*e[E]+D.A_103*t[E]+D.A_104*r[E]+D.A_105*n[E]+D.A_106*i[E]+D.A_107*o[E]+D.A_108*a[E]+D.A_109*s[E]+D.A_1010*l[E]);switch(c.checkDiscontinuity(f,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(d.getRate(f,u),E=0;E<A;E++)f[E]=h[E]+S*(D.A_111*m[E]+D.A_112*e[E]+D.A_113*t[E]+D.A_114*r[E]+D.A_115*n[E]+D.A_116*i[E]+D.A_117*o[E]+D.A_118*a[E]+D.A_119*s[E]+D.A_1110*l[E]+D.A_1111*u[E]);switch(c.checkDiscontinuity(f,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(d.getRate(f,g),E=0;E<_;E++)f[E]=h[E]+S*(D.B8_1*m[E]+D.B8_2*e[E]+D.B8_3*t[E]+D.B8_4*r[E]+D.B8_5*n[E]+D.B8_6*i[E]+D.B8_7*o[E]+D.B8_8*a[E]+D.B8_9*s[E]+D.B8_10*l[E]+D.B8_11*u[E]+D.B8_12*g[E]);return f[_]=p.getInitialTime()+S*m[_],c.checkDiscontinuity(f,!0)},p.computeFinalRateAndCreateIntervalData=function(){var h,m=p.getODE(),A=p.getInitialState(),_=p.getInitialRate(),D=p.getFinalState(),I=p.getFinalRate(),P=EJSS_ODE_SOLVERS.DoPri853,C=p.getDimension(),T=C-1;m.getRate(D,I);var y=D[T]-A[T];for(h=0;h<C;h++)E[h]=A[h]+y*(P.AD13_1*_[h]+P.AD13_2*e[h]+P.AD13_3*t[h]+P.AD13_4*r[h]+P.AD13_5*n[h]+P.AD13_6*i[h]+P.AD13_7*o[h]+P.AD13_8*a[h]+P.AD13_9*s[h]+P.AD13_10*l[h]+P.AD13_11*u[h]+P.AD13_12*g[h]+P.AD13_13*I[h]);for(m.getRate(E,c),h=0;h<C;h++)E[h]=A[h]+y*(P.AD14_1*_[h]+P.AD14_2*e[h]+P.AD14_3*t[h]+P.AD14_4*r[h]+P.AD14_5*n[h]+P.AD14_6*i[h]+P.AD14_7*o[h]+P.AD14_8*a[h]+P.AD14_9*s[h]+P.AD14_10*l[h]+P.AD14_11*u[h]+P.AD14_12*g[h]+P.AD14_13*I[h]+P.AD14_14*c[h]);for(m.getRate(E,S),h=0;h<C;h++)E[h]=A[h]+y*(P.AD15_1*_[h]+P.AD15_2*e[h]+P.AD15_3*t[h]+P.AD15_4*r[h]+P.AD15_5*n[h]+P.AD15_6*i[h]+P.AD15_7*o[h]+P.AD15_8*a[h]+P.AD15_9*s[h]+P.AD15_10*l[h]+P.AD15_11*u[h]+P.AD15_12*g[h]+P.AD15_13*I[h]+P.AD15_14*c[h]+P.AD15_15*S[h]);for(m.getRate(E,f),h=0;h<C;h++)d[0][h]=A[h],d[1][h]=D[h]-A[h],d[2][h]=y*_[h]-d[1][h],d[3][h]=d[1][h]-y*I[h]-d[2][h],d[4][h]=y*(P.D4_1*_[h]+P.D4_2*e[h]+P.D4_3*t[h]+P.D4_4*r[h]+P.D4_5*n[h]+P.D4_6*i[h]+P.D4_7*o[h]+P.D4_8*a[h]+P.D4_9*s[h]+P.D4_10*l[h]+P.D4_11*u[h]+P.D4_12*g[h]+P.D4_13*I[h]+P.D4_14*c[h]+P.D4_15*S[h]+P.D4_16*f[h]),d[5][h]=y*(P.D5_1*_[h]+P.D5_2*e[h]+P.D5_3*t[h]+P.D5_4*r[h]+P.D5_5*n[h]+P.D5_6*i[h]+P.D5_7*o[h]+P.D5_8*a[h]+P.D5_9*s[h]+P.D5_10*l[h]+P.D5_11*u[h]+P.D5_12*g[h]+P.D5_13*I[h]+P.D5_14*c[h]+P.D5_15*S[h]+P.D5_16*f[h]),d[6][h]=y*(P.D6_1*_[h]+P.D6_2*e[h]+P.D6_3*t[h]+P.D6_4*r[h]+P.D6_5*n[h]+P.D6_6*i[h]+P.D6_7*o[h]+P.D6_8*a[h]+P.D6_9*s[h]+P.D6_10*l[h]+P.D6_11*u[h]+P.D6_12*g[h]+P.D6_13*I[h]+P.D6_14*c[h]+P.D6_15*S[h]+P.D6_16*f[h]),d[7][h]=y*(P.D7_1*_[h]+P.D7_2*e[h]+P.D7_3*t[h]+P.D7_4*r[h]+P.D7_5*n[h]+P.D7_6*i[h]+P.D7_7*o[h]+P.D7_8*a[h]+P.D7_9*s[h]+P.D7_10*l[h]+P.D7_11*u[h]+P.D7_12*g[h]+P.D7_13*I[h]+P.D7_14*c[h]+P.D7_15*S[h]+P.D7_16*f[h]);return EJSS_ODE_INTERPOLATION.dopri853IntervalData(A,D,d)},p.computeApproximation=function(c){p.getODE();for(var S=p.getInitialState(),f=p.getInitialRate(),E=p.getFinalState(),d=(p.getFinalRate(),p.getAbsTol()),h=p.getRelTol(),m=EJSS_ODE_SOLVERS.DoPri853,A=p.getDimension(),_=0,D=0,I=0;I<A;I++){var P=d[I]+h[I]*Math.max(Math.abs(E[I]),Math.abs(S[I])),C=(m.E3_1*f[I]+m.E3_2*e[I]+m.E3_3*t[I]+m.E3_4*r[I]+m.E3_5*n[I]+m.E3_6*i[I]+m.E3_7*o[I]+m.E3_8*a[I]+m.E3_9*s[I]+m.E3_10*l[I]+m.E3_11*u[I]+m.E3_12*g[I])/P;_+=C*C;var T=(m.E5_1*f[I]+m.E5_2*e[I]+m.E5_3*n[I]+m.E5_4*r[I]+m.E5_5*n[I]+m.E5_6*i[I]+m.E5_7*o[I]+m.E5_8*a[I]+m.E5_9*s[I]+m.E5_10*l[I]+m.E5_11*u[I]+m.E5_12*g[I])/P;D+=T*T}var y=D+.01*_;return y<=0&&(y=1),Math.abs(c)*D*Math.sqrt(1/(A*y))},p};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.Euler={},EJSS_ODE_SOLVERS.euler=function(){var e=EJSS_ODE_SOLVERS.solverEngineDiscreteTime();return e.getNumberOfEvaluations=function(){return 1},e.computeIntermediateStep=function(t,r){for(var n=e.getDimension(),i=e.getInitialState(),o=e.getInitialRate(),a=0;a<n;a++)r[a]=i[a]+t*o[a]},e.computeCarefulIntermediateStep=function(t,r,n){return e.computeIntermediateStep(r,n),t.checkDiscontinuity(n,!0)},e.computeFinalRateAndCreateIntervalData=function(){var t=e.getODE(),r=e.getInitialState(),n=e.getInitialRate(),i=e.getFinalState(),o=e.getFinalRate();return t.getRate(i,o),EJSS_ODE_INTERPOLATION.eulerIntervalData(r,n,i[e.getTimeIndex()])},e};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.EulerRichardson={},EJSS_ODE_SOLVERS.eulerRichardson=function(){var e,t=EJSS_ODE_SOLVERS.solverEngineDiscreteTime();return t.getNumberOfEvaluations=function(){return 2},t.allocateOtherArrays=function(){e=new Array(t.getDimension())},t.computeIntermediateStep=function(r,n){var i,o=r/2,a=t.getODE(),s=t.getInitialState(),l=t.getInitialRate(),u=t.getDimension(),g=u-1;for(i=0;i<u;i++)n[i]=s[i]+o*l[i];for(a.getRate(n,e),i=0;i<g;i++)n[i]=s[i]+r*e[i];n[g]=t.getInitialTime()+r*l[g]},t.computeCarefulIntermediateStep=function(r,n,i){var o,a=n/2,s=t.getODE(),l=t.getInitialState(),u=t.getInitialRate(),g=t.getDimension(),c=g-1,S=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(o=0;o<g;o++)i[o]=l[o]+a*u[o];switch(r.checkDiscontinuity(i,!1)){case S.DISCONTINUITY_PRODUCED_ERROR:return S.DISCONTINUITY_PRODUCED_ERROR;case S.DISCONTINUITY_JUST_PASSED:return S.DISCONTINUITY_JUST_PASSED;case S.DISCONTINUITY_ALONG_STEP:return S.DISCONTINUITY_ALONG_STEP;case S.DISCONTINUITY_EXACTLY_ON_STEP:case S.NO_DISCONTINUITY_ALONG_STEP:}for(s.getRate(i,e),o=0;o<c;o++)i[o]=l[o]+n*e[o];return i[c]=t.getInitialTime()+n*u[c],r.checkDiscontinuity(i,!0)},t.computeFinalRateAndCreateIntervalData=function(){var r=t.getODE(),n=t.getInitialState(),i=t.getInitialRate(),o=t.getFinalState(),a=t.getFinalRate(),s=t.getDimension()-1;return r.getRate(o,a),EJSS_ODE_INTERPOLATION.eulerRichardsonIntervalData(n,i,o[s],e)},t};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.Fehlberg8={},EJSS_ODE_SOLVERS.fehlberg8=function(){var e,t,r,n,i,o,a,s,l,u,g=EJSS_ODE_SOLVERS.solverEngineDiscreteTime();return g.getNumberOfEvaluations=function(){return 13},g.allocateOtherArrays=function(){e=new Array(g.getDimension()),t=new Array(g.getDimension()),r=new Array(g.getDimension()),n=new Array(g.getDimension()),i=new Array(g.getDimension()),o=new Array(g.getDimension()),a=new Array(g.getDimension()),s=new Array(g.getDimension()),l=new Array(g.getDimension()),u=new Array(g.getDimension())},g.computeIntermediateStep=function(c,S){var f,E=g.getODE(),d=g.getInitialState(),p=g.getInitialRate(),h=g.getDimension(),m=h-1,A=EJSS_ODE_SOLVERS.Fehlberg78;for(f=0;f<h;f++)S[f]=d[f]+c*A.A_11*p[f];for(E.getRate(S,e),f=0;f<h;f++)S[f]=d[f]+c*(A.A_21*p[f]+A.A_22*e[f]);for(E.getRate(S,t),f=0;f<h;f++)S[f]=d[f]+c*(A.A_31*p[f]+A.A_33*t[f]);for(E.getRate(S,r),f=0;f<h;f++)S[f]=d[f]+c*(A.A_41*p[f]+A.A_43*t[f]+A.A_44*r[f]);for(E.getRate(S,n),f=0;f<h;f++)S[f]=d[f]+c*(A.A_51*p[f]+A.A_54*r[f]+A.A_55*n[f]);for(E.getRate(S,i),f=0;f<h;f++)S[f]=d[f]+c*(A.A_61*p[f]+A.A_64*r[f]+A.A_65*n[f]+A.A_66*i[f]);for(E.getRate(S,o),f=0;f<h;f++)S[f]=d[f]+c*(A.A_71*p[f]+A.A_75*n[f]+A.A_76*i[f]+A.A_77*o[f]);for(E.getRate(S,a),f=0;f<h;f++)S[f]=d[f]+c*(A.A_81*p[f]+A.A_84*r[f]+A.A_85*n[f]+A.A_86*i[f]+A.A_87*o[f]+A.A_88*a[f]);for(E.getRate(S,s),f=0;f<h;f++)S[f]=d[f]+c*(A.A_91*p[f]+A.A_94*r[f]+A.A_95*n[f]+A.A_96*i[f]+A.A_97*o[f]+A.A_98*a[f]+A.A_99*s[f]);for(E.getRate(S,l),f=0;f<h;f++)S[f]=d[f]+c*(A.A_101*p[f]+A.A_104*r[f]+A.A_105*n[f]+A.A_106*i[f]+A.A_107*o[f]+A.A_108*a[f]+A.A_109*s[f]+A.A_1010*l[f]);for(E.getRate(S,u),f=0;f<m;f++)S[f]=d[f]+c*(A.B7_1*p[f]+A.B7_6*i[f]+A.B7_7*o[f]+A.B7_8*a[f]+A.B7_9*s[f]+A.B7_10*l[f]+A.B7_11*u[f]);S[m]=g.getInitialTime()+c*p[m]},g.computeCarefulIntermediateStep=function(c,S,f){g.getODE();var E,d=g.getInitialState(),p=g.getInitialRate(),h=g.getDimension(),m=h-1,A=(p[m],EJSS_ODE_SOLVERS.Fehlberg78),_=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(E=0;E<h;E++)f[E]=d[E]+S*A.A_11*p[E];switch(c.checkDiscontinuity(f,!1)){case _.DISCONTINUITY_PRODUCED_ERROR:return _.DISCONTINUITY_PRODUCED_ERROR;case _.DISCONTINUITY_JUST_PASSED:return _.DISCONTINUITY_JUST_PASSED;case _.DISCONTINUITY_ALONG_STEP:return _.DISCONTINUITY_ALONG_STEP;case _.DISCONTINUITY_EXACTLY_ON_STEP:case _.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(f,e),E=0;E<h;E++)f[E]=d[E]+S*(A.A_21*p[E]+A.A_22*e[E]);switch(c.checkDiscontinuity(f,!1)){case _.DISCONTINUITY_PRODUCED_ERROR:return _.DISCONTINUITY_PRODUCED_ERROR;case _.DISCONTINUITY_JUST_PASSED:return _.DISCONTINUITY_JUST_PASSED;case _.DISCONTINUITY_ALONG_STEP:return _.DISCONTINUITY_ALONG_STEP;case _.DISCONTINUITY_EXACTLY_ON_STEP:case _.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(f,t),E=0;E<h;E++)f[E]=d[E]+S*(A.A_31*p[E]+A.A_33*t[E]);switch(c.checkDiscontinuity(f,!1)){case _.DISCONTINUITY_PRODUCED_ERROR:return _.DISCONTINUITY_PRODUCED_ERROR;case _.DISCONTINUITY_JUST_PASSED:return _.DISCONTINUITY_JUST_PASSED;case _.DISCONTINUITY_ALONG_STEP:return _.DISCONTINUITY_ALONG_STEP;case _.DISCONTINUITY_EXACTLY_ON_STEP:case _.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(f,r),E=0;E<h;E++)f[E]=d[E]+S*(A.A_41*p[E]+A.A_43*t[E]+A.A_44*r[E]);switch(c.checkDiscontinuity(f,!1)){case _.DISCONTINUITY_PRODUCED_ERROR:return _.DISCONTINUITY_PRODUCED_ERROR;case _.DISCONTINUITY_JUST_PASSED:return _.DISCONTINUITY_JUST_PASSED;case _.DISCONTINUITY_ALONG_STEP:return _.DISCONTINUITY_ALONG_STEP;case _.DISCONTINUITY_EXACTLY_ON_STEP:case _.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(f,n),E=0;E<h;E++)f[E]=d[E]+S*(A.A_51*p[E]+A.A_54*r[E]+A.A_55*n[E]);switch(c.checkDiscontinuity(f,!1)){case _.DISCONTINUITY_PRODUCED_ERROR:return _.DISCONTINUITY_PRODUCED_ERROR;case _.DISCONTINUITY_JUST_PASSED:return _.DISCONTINUITY_JUST_PASSED;case _.DISCONTINUITY_ALONG_STEP:return _.DISCONTINUITY_ALONG_STEP;case _.DISCONTINUITY_EXACTLY_ON_STEP:case _.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(f,i),E=0;E<h;E++)f[E]=d[E]+S*(A.A_61*p[E]+A.A_64*r[E]+A.A_65*n[E]+A.A_66*i[E]);switch(c.checkDiscontinuity(f,!1)){case _.DISCONTINUITY_PRODUCED_ERROR:return _.DISCONTINUITY_PRODUCED_ERROR;case _.DISCONTINUITY_JUST_PASSED:return _.DISCONTINUITY_JUST_PASSED;case _.DISCONTINUITY_ALONG_STEP:return _.DISCONTINUITY_ALONG_STEP;case _.DISCONTINUITY_EXACTLY_ON_STEP:case _.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(f,o),E=0;E<h;E++)f[E]=d[E]+S*(A.A_71*p[E]+A.A_75*n[E]+A.A_76*i[E]+A.A_77*o[E]);switch(c.checkDiscontinuity(f,!1)){case _.DISCONTINUITY_PRODUCED_ERROR:return _.DISCONTINUITY_PRODUCED_ERROR;case _.DISCONTINUITY_JUST_PASSED:return _.DISCONTINUITY_JUST_PASSED;case _.DISCONTINUITY_ALONG_STEP:return _.DISCONTINUITY_ALONG_STEP;case _.DISCONTINUITY_EXACTLY_ON_STEP:case _.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(f,a),E=0;E<h;E++)f[E]=d[E]+S*(A.A_81*p[E]+A.A_84*r[E]+A.A_85*n[E]+A.A_86*i[E]+A.A_87*o[E]+A.A_88*a[E]);switch(c.checkDiscontinuity(f,!1)){case _.DISCONTINUITY_PRODUCED_ERROR:return _.DISCONTINUITY_PRODUCED_ERROR;case _.DISCONTINUITY_JUST_PASSED:return _.DISCONTINUITY_JUST_PASSED;case _.DISCONTINUITY_ALONG_STEP:return _.DISCONTINUITY_ALONG_STEP;case _.DISCONTINUITY_EXACTLY_ON_STEP:case _.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(f,s),E=0;E<h;E++)f[E]=d[E]+S*(A.A_91*p[E]+A.A_94*r[E]+A.A_95*n[E]+A.A_96*i[E]+A.A_97*o[E]+A.A_98*a[E]+A.A_99*s[E]);switch(c.checkDiscontinuity(f,!1)){case _.DISCONTINUITY_PRODUCED_ERROR:return _.DISCONTINUITY_PRODUCED_ERROR;case _.DISCONTINUITY_JUST_PASSED:return _.DISCONTINUITY_JUST_PASSED;case _.DISCONTINUITY_ALONG_STEP:return _.DISCONTINUITY_ALONG_STEP;case _.DISCONTINUITY_EXACTLY_ON_STEP:case _.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(f,l),E=0;E<h;E++)f[E]=d[E]+S*(A.A_101*p[E]+A.A_104*r[E]+A.A_105*n[E]+A.A_106*i[E]+A.A_107*o[E]+A.A_108*a[E]+A.A_109*s[E]+A.A_1010*l[E]);switch(c.checkDiscontinuity(f,!1)){case _.DISCONTINUITY_PRODUCED_ERROR:return _.DISCONTINUITY_PRODUCED_ERROR;case _.DISCONTINUITY_JUST_PASSED:return _.DISCONTINUITY_JUST_PASSED;case _.DISCONTINUITY_ALONG_STEP:return _.DISCONTINUITY_ALONG_STEP;case _.DISCONTINUITY_EXACTLY_ON_STEP:case _.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(f,u),E=0;E<m;E++)f[E]=d[E]+S*(A.B7_1*p[E]+A.B7_6*i[E]+A.B7_7*o[E]+A.B7_8*a[E]+A.B7_9*s[E]+A.B7_10*l[E]+A.B7_11*u[E]);return f[m]=g.getInitialTime()+S*p[m],c.checkDiscontinuity(f,!0)},g.computeFinalRateAndCreateIntervalData=function(){var e=g.getODE(),t=g.getInitialState(),r=g.getInitialRate(),n=g.getFinalState(),i=g.getFinalRate();return e.getRate(n,i),EJSS_ODE_INTERPOLATION.bootstrap2IntervalData(t,r,n,i,e)},g};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.Fehlberg78={A_11:2/27,A_21:1/36,A_22:1/12,A_31:1/24,A_33:1/8,A_41:5/12,A_43:-25/16,A_44:25/16,A_51:.05,A_54:1/4,A_55:.2,A_61:-25/108,A_64:125/108,A_65:-65/27,A_66:125/54,A_71:31/300,A_75:61/225,A_76:-2/9,A_77:13/900,A_81:2,A_84:-53/6,A_85:704/45,A_86:-107/9,A_87:67/90,A_88:3,A_91:-91/108,A_94:23/108,A_95:-976/135,A_96:311/54,A_97:-19/60,A_98:17/6,A_99:-1/12,A_101:2383/4100,A_104:-341/164,A_105:4496/1025,A_106:-301/82,A_107:2133/4100,A_108:45/82,A_109:45/164,A_1010:18/41,A_111:3/205,A_116:-6/41,A_117:-3/205,A_118:-3/41,A_119:3/41,A_1110:6/41,A_121:-1777/4100,A_124:-341/164,A_125:4496/1025,A_126:-289/82,A_127:2193/4100,A_128:51/82,A_129:33/164,A_1210:12/41,A_1212:1,B7_1:41/840,B7_6:34/105,B7_7:9/35,B7_8:9/35,B7_9:9/280,B7_10:9/280,B7_11:41/840,B8_6:34/105,B8_7:9/35,B8_8:9/35,B8_9:9/280,B8_10:9/280,B8_12:41/840,B8_13:41/840},EJSS_ODE_SOLVERS.fehlberg78=function(){var e,t,r,n,i,o,a,s,l,u,g,c,S=EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive(7),f=S.allocateOtherArrays;return S.getNumberOfEvaluations=function(){return 6},S.allocateOtherArrays=function(){f(),e=new Array(S.getDimension()),t=new Array(S.getDimension()),r=new Array(S.getDimension()),n=new Array(S.getDimension()),i=new Array(S.getDimension()),o=new Array(S.getDimension()),a=new Array(S.getDimension()),s=new Array(S.getDimension()),l=new Array(S.getDimension()),u=new Array(S.getDimension()),g=new Array(S.getDimension()),c=new Array(S.getDimension()),mOrder8=new Array(S.getDimension())},S.computeIntermediateStep=function(f,E){var d,p=S.getODE(),h=S.getInitialState(),m=S.getInitialRate(),A=S.getDimension(),_=A-1,D=EJSS_ODE_SOLVERS.Fehlberg78;for(d=0;d<A;d++)E[d]=h[d]+f*D.A_11*m[d];for(p.getRate(E,e),d=0;d<A;d++)E[d]=h[d]+f*(D.A_21*m[d]+D.A_22*e[d]);for(p.getRate(E,t),d=0;d<A;d++)E[d]=h[d]+f*(D.A_31*m[d]+D.A_33*t[d]);for(p.getRate(E,r),d=0;d<A;d++)E[d]=h[d]+f*(D.A_41*m[d]+D.A_43*t[d]+D.A_44*r[d]);for(p.getRate(E,n),d=0;d<A;d++)E[d]=h[d]+f*(D.A_51*m[d]+D.A_54*r[d]+D.A_55*n[d]);for(p.getRate(E,i),d=0;d<A;d++)E[d]=h[d]+f*(D.A_61*m[d]+D.A_64*r[d]+D.A_65*n[d]+D.A_66*i[d]);for(p.getRate(E,o),d=0;d<A;d++)E[d]=h[d]+f*(D.A_71*m[d]+D.A_75*n[d]+D.A_76*i[d]+D.A_77*o[d]);for(p.getRate(E,a),d=0;d<A;d++)E[d]=h[d]+f*(D.A_81*m[d]+D.A_84*r[d]+D.A_85*n[d]+D.A_86*i[d]+D.A_87*o[d]+D.A_88*a[d]);for(p.getRate(E,s),d=0;d<A;d++)E[d]=h[d]+f*(D.A_91*m[d]+D.A_94*r[d]+D.A_95*n[d]+D.A_96*i[d]+D.A_97*o[d]+D.A_98*a[d]+D.A_99*s[d]);for(p.getRate(E,l),d=0;d<A;d++)E[d]=h[d]+f*(D.A_101*m[d]+D.A_104*r[d]+D.A_105*n[d]+D.A_106*i[d]+D.A_107*o[d]+D.A_108*a[d]+D.A_109*s[d]+D.A_1010*l[d]);for(p.getRate(E,u),d=0;d<A;d++)E[d]=h[d]+f*(D.A_111*m[d]+D.A_116*i[d]+D.A_117*o[d]+D.A_118*a[d]+D.A_119*s[d]+D.A_1110*l[d]);for(p.getRate(E,g),d=0;d<A;d++)E[d]=h[d]+f*(D.A_121*m[d]+D.A_124*r[d]+D.A_125*n[d]+D.A_126*i[d]+D.A_127*o[d]+D.A_128*a[d]+D.A_129*s[d]+D.A_1210*l[d]+D.A_1212*g[d]);for(p.getRate(E,c),d=0;d<_;d++)E[d]=h[d]+f*(D.B7_1*m[d]+D.B7_6*i[d]+D.B7_7*o[d]+D.B7_8*a[d]+D.B7_9*s[d]+D.B7_10*l[d]+D.B7_11*u[d]);E[_]=S.getInitialTime()+f*m[_]},S.computeCarefulIntermediateStep=function(f,E,d){S.getODE();var p,h=S.getInitialState(),m=S.getInitialRate(),A=S.getDimension(),_=A-1,D=EJSS_ODE_SOLVERS.Fehlberg78,I=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(p=0;p<A;p++)d[p]=h[p]+E*D.A_11*m[p];switch(f.checkDiscontinuity(d,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(d,e),p=0;p<A;p++)d[p]=h[p]+E*(D.A_21*m[p]+D.A_22*e[p]);switch(f.checkDiscontinuity(d,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(d,t),p=0;p<A;p++)d[p]=h[p]+E*(D.A_31*m[p]+D.A_33*t[p]);switch(f.checkDiscontinuity(d,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(d,r),p=0;p<A;p++)d[p]=h[p]+E*(D.A_41*m[p]+D.A_43*t[p]+D.A_44*r[p]);switch(f.checkDiscontinuity(d,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(d,n),p=0;p<A;p++)d[p]=h[p]+E*(D.A_51*m[p]+D.A_54*r[p]+D.A_55*n[p]);switch(f.checkDiscontinuity(d,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(d,i),p=0;p<A;p++)d[p]=h[p]+E*(D.A_61*m[p]+D.A_64*r[p]+D.A_65*n[p]+D.A_66*i[p]);switch(f.checkDiscontinuity(d,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(d,o),p=0;p<A;p++)d[p]=h[p]+E*(D.A_71*m[p]+D.A_75*n[p]+D.A_76*i[p]+D.A_77*o[p]);switch(f.checkDiscontinuity(d,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(d,a),p=0;p<A;p++)d[p]=h[p]+E*(D.A_81*m[p]+D.A_84*r[p]+D.A_85*n[p]+D.A_86*i[p]+D.A_87*o[p]+D.A_88*a[p]);switch(f.checkDiscontinuity(d,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(d,s),p=0;p<A;p++)d[p]=h[p]+E*(D.A_91*m[p]+D.A_94*r[p]+D.A_95*n[p]+D.A_96*i[p]+D.A_97*o[p]+D.A_98*a[p]+D.A_99*s[p]);switch(f.checkDiscontinuity(d,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(d,l),p=0;p<A;p++)d[p]=h[p]+E*(D.A_101*m[p]+D.A_104*r[p]+D.A_105*n[p]+D.A_106*i[p]+D.A_107*o[p]+D.A_108*a[p]+D.A_109*s[p]+D.A_1010*l[p]);switch(f.checkDiscontinuity(d,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(d,u),p=0;p<A;p++)d[p]=h[p]+E*(D.A_111*m[p]+D.A_116*i[p]+D.A_117*o[p]+D.A_118*a[p]+D.A_119*s[p]+D.A_1110*l[p]);switch(f.checkDiscontinuity(d,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(d,g),p=0;p<A;p++)d[p]=h[p]+E*(D.A_121*m[p]+D.A_124*r[p]+D.A_125*n[p]+D.A_126*i[p]+D.A_127*o[p]+D.A_128*a[p]+D.A_129*s[p]+D.A_1210*l[p]+D.A_1212*g[p]);switch(f.checkDiscontinuity(d,!1)){case I.DISCONTINUITY_PRODUCED_ERROR:return I.DISCONTINUITY_PRODUCED_ERROR;case I.DISCONTINUITY_JUST_PASSED:return I.DISCONTINUITY_JUST_PASSED;case I.DISCONTINUITY_ALONG_STEP:return I.DISCONTINUITY_ALONG_STEP;case I.DISCONTINUITY_EXACTLY_ON_STEP:case I.NO_DISCONTINUITY_ALONG_STEP:}for(mODE.getRate(d,c),p=0;p<_;p++)d[p]=h[p]+E*(D.B7_1*m[p]+D.B7_6*i[p]+D.B7_7*o[p]+D.B7_8*a[p]+D.B7_9*s[p]+D.B7_10*l[p]+D.B7_11*u[p]);return d[_]=S.getInitialTime()+E*m[_],f.checkDiscontinuity(d,!0)},S.computeFinalRateAndCreateIntervalData=function(){var e=S.getODE(),t=S.getInitialState(),r=S.getInitialRate(),n=S.getFinalState(),i=S.getFinalRate();return e.getRate(n,i),EJSS_ODE_INTERPOLATION.bootstrap2IntervalData(t,r,n,i,e)},S.computeApproximation=function(e){for(var t=S.getTimeIndex(),r=S.getInitialState(),n=S.getInitialRate(),u=EJSS_ODE_SOLVERS.Fehlberg78,f=0;f<t;f++)mOrder8[f]=r[f]+e*(u.B8_6*i[f]+u.B8_7*o[f]+u.B8_8*a[f]+u.B8_9*s[f]+u.B8_10*l[f]+u.B8_12*g[f]+u.B8_13*c[f]);return mOrder8[t]=S.getInitialTime()+e*n[t],S.computeError(mOrder8)},S};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.RungeKutta4={},EJSS_ODE_SOLVERS.rungeKutta4=function(){var e,t,r,n=EJSS_ODE_SOLVERS.solverEngineDiscreteTime();return n.getNumberOfEvaluations=function(){return 4},n.allocateOtherArrays=function(){e=new Array(n.getDimension()),t=new Array(n.getDimension()),r=new Array(n.getDimension())},n.computeIntermediateStep=function(i,o){var a,s=i/2,l=n.getODE(),u=n.getInitialState(),g=n.getInitialRate(),c=n.getDimension(),S=c-1;for(a=0;a<c;a++)o[a]=u[a]+s*g[a];for(l.getRate(o,e),a=0;a<c;a++)o[a]=u[a]+s*e[a];for(l.getRate(o,t),a=0;a<c;a++)o[a]=u[a]+i*t[a];for(l.getRate(o,r),a=0;a<S;a++)o[a]=u[a]+i*(g[a]+2*e[a]+2*t[a]+r[a])/6;o[S]=n.getInitialTime()+i*g[S]},n.computeCarefulIntermediateStep=function(i,o,a){var s,l=o/2,u=n.getODE(),g=n.getInitialState(),c=n.getInitialRate(),S=n.getDimension(),f=S-1,E=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE;for(s=0;s<S;s++)a[s]=g[s]+l*c[s];switch(i.checkDiscontinuity(a,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:case E.NO_DISCONTINUITY_ALONG_STEP:}for(u.getRate(a,e),s=0;s<S;s++)a[s]=g[s]+l*e[s];switch(i.checkDiscontinuity(a,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:case E.NO_DISCONTINUITY_ALONG_STEP:}for(u.getRate(a,t),s=0;s<S;s++)a[s]=g[s]+o*t[s];switch(i.checkDiscontinuity(a,!1)){case E.DISCONTINUITY_PRODUCED_ERROR:return E.DISCONTINUITY_PRODUCED_ERROR;case E.DISCONTINUITY_JUST_PASSED:return E.DISCONTINUITY_JUST_PASSED;case E.DISCONTINUITY_ALONG_STEP:return E.DISCONTINUITY_ALONG_STEP;case E.DISCONTINUITY_EXACTLY_ON_STEP:case E.NO_DISCONTINUITY_ALONG_STEP:}for(u.getRate(a,r),s=0;s<f;s++)a[s]=g[s]+o*(c[s]+2*e[s]+2*t[s]+r[s])/6;return a[f]=n.getInitialTime()+o*c[f],i.checkDiscontinuity(a,!0)},n.computeFinalRateAndCreateIntervalData=function(){var e=n.getODE(),t=n.getInitialState(),r=n.getInitialRate(),i=n.getFinalState(),o=n.getFinalRate();return e.getRate(i,o),EJSS_ODE_INTERPOLATION.bootstrapIntervalData(t,r,i,o,e)},n};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverEngineDiscreteTime={},EJSS_ODE_SOLVERS.solverEngineDiscreteTime=function(){var e,t,r,n,i,o,a,s,l,u={},g=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,c=0,S=.1,f=Number.POSITIVE_INFINITY,E=0,d=0;return u.getNumberOfEvaluations=function(){return 0},u.allocateOtherArrays=function(){},u.computeIntermediateStep=function(e,t){return null},u.computeCarefulIntermediateStep=function(e,t,r){return EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP},u.computeFinalRateAndCreateIntervalData=function(){return null},u.getODE=function(){return a},u.getEventSolver=function(){return s},u.getDimension=function(){return e},u.getTimeIndex=function(){return t},u.getInitialTime=function(){return E},u.getInitialState=function(){return r},u.getInitialRate=function(){return n},u.getFinalState=function(){return i},u.getFinalRate=function(){return o},u.setFinalTime=function(e){d=e},u.getFinalTime=function(){return d},u.setErrorCode=function(e){g=e},u.addToEvaluations=function(e){c+=e},u.setODE=function(r,n){s=r;var i=(a=n).getState();e=i.length,t=e-1,l=EJSS_ODE_INTERPOLATION.stateHistory(n),a.getMaximumDelay&&l.setMinimumLength(a.getMaximumDelay())},u.initialize=function(s){S=s;var g=a.getState();null!=r&&r.length==g.length||(e=g.length,t=e-1,r=new Array(e),n=new Array(e),i=new Array(e),o=new Array(e),u.allocateOtherArrays()),c=0,l.clearAll(),a.getMaximumDelay?l.setMinimumLength(Math.max(Math.abs(a.getMaximumDelay()),Math.abs(s))):l.setMinimumLength(s),u.reinitialize(g)},u.reinitialize=function(i){E=i[t];for(var o=0;o<e;o++)r[o]=i[o];a.getRate(r,n),d=Number.NaN,g=EJSS_ODE_SOLVERS.ERROR.NO_ERROR},u.getCurrentRate=function(){return n},u.setStepSize=function(e){S=e,a.getMaximumDelay?l.setMinimumLength(Math.max(Math.abs(a.getMaximumDelay()),Math.abs(e))):l.setMinimumLength(e)},u.setMaximumStepSize=function(e){f=Math.abs(e)},u.getMaximumStepSize=function(){return f},u.getStepSize=function(){return S},u.getInternalStepSize=function(){return d-E},u.setEstimateFirstStep=function(e){},u.setTolerances=function(e,t){},u.getMaximumTime=function(e){return g!=EJSS_ODE_SOLVERS.ERROR.NO_ERROR?Number.NaN:(isNaN(d)&&u.computeOneStep(e),d)},u.internalStep=function(t){var a;for(E=d,g=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,a=0;a<e;a++)r[a]=i[a];for(a=0;a<e;a++)n[a]=o[a];return u.computeOneStep(t),d},u.getCounter=function(){return c},u.getStateHistory=function(){return l},u.interpolate=function(e,t){return l.interpolateState(e,t)},u.bestInterpolate=function(t,n){var o;if(isNaN(d))return null;if(t==d){for(o=0;o<e;o++)n[o]=i[o];return n}if(t==E){for(o=0;o<e;o++)n[o]=r[o];return n}return u.computeIntermediateStep(t-E,n),n},u.getActualStepSize=function(){return S},u.findTheDiscontinuity=function(e){for(var r=0,n=0,o=e,a=0,l=s.getDDEIterations(),g=s.getEPSILON();r<l&&!(Math.abs(n-o)<g);){var c=(n+o)/2;switch(u.computeCarefulIntermediateStep(s,c,i)){default:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return Number.NaN;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:a=i[t],n=c;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:return i[t];case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:o-=(o-n)/4;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:o=c}r++}return u.computeCarefulIntermediateStep(s,a,i),a},u.computeOneStep=function(e){var r=S;if(e){switch(u.computeCarefulIntermediateStep(s,r,i)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return void(d=Number.NaN);case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:d=i[t];break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:d=u.findTheDiscontinuity(r)}if(isNaN(d))return void(g=EJSS_ODE_SOLVERS.ERROR.DISCONTINUITY_PRODUCED_ERROR)}else u.computeIntermediateStep(r,i),d=i[t];c+=u.getNumberOfEvaluations(),l.clean(E),l.addIntervalData(u.computeFinalRateAndCreateIntervalData())},u};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive={FAC1:.33,FAC2:6,BETA:0,SAFE:.9},EJSS_ODE_SOLVERS.solverEngineDiscreteTimeAdaptive=function(e){var t,r,n,i=EJSS_ODE_SOLVERS.solverEngineDiscreteTime(),o=1/e-.75*EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.BETA,a=1e-4,s=0,l=!1,u=Number.NaN,g=Number.NaN,c=i.reinitialize,S=i.setMaximumStepSize;function f(e){var r=0;return 0!=e?(r=Math.pow(e,o),s=r/Math.exp(EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.BETA*Math.log(a)),s=Math.max(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC2,Math.min(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,s/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.SAFE))):(r=1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,s=1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC2),e<=1?(a=Math.max(e,1e-4),t/s):t/Math.min(1/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.FAC1,r/EJSS_ODE_SOLVERS.SolverEngineDiscreteTimeAdaptive.SAFE)}function E(e){var t,r,n,o=i.getODE();if(e>=0){if(o.getDelays)for(n=(t=o.getDelays(i.getInitialState())).length,r=0;r<n;r++)e=Math.min(e,t[r]/2);return Math.min(e,i.getMaximumStepSize())}if(o.getDelays)for(n=(t=o.getDelays(i.getInitialState())).length,r=0;r<n;r++)e=Math.max(e,t[r]/2);return Math.max(e,-i.getMaximumStepSize())}function d(t){var o,a=i.getDimension(),s=i.getInitialState(),l=i.getInitialRate(),u=i.getODE(),g=t<0?-1:1;t=Math.abs(t);var c,S=0,f=0;for(o=0;o<a;o++){var E=r[o]+n[o]*Math.abs(s[o]);S+=(A=l[o]/E)*A,f+=(A=s[o]/E)*A}if(c=S<=1e-10||f<=1e-10?1e-6:.01*Math.sqrt(f/S),c=g*Math.min(c,t),u.getDelays){var d=i.getEventSolver();d.resetDiscontinuities(s);for(var p=0,h=!1;!h;){for(o=0;o<a;o++)finalState[o]=s[o]+c*l[o];switch(d.checkDiscontinuity(finalState,!1)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return Number.NaN;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:c/=2;break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:h=!0}if(++p>100)return Number.NaN}}else for(o=0;o<a;o++)finalState[o]=s[o]+c*l[o];u.getRate(finalState,finalRate);var m=0;for(o=0;o<a;o++){var A;E=r[o]+n[o]*Math.abs(s[o]);m+=(A=(finalRate[o]-l[o])/E)*A}m=Math.sqrt(m)/c;var _,D=Math.max(Math.abs(m),Math.sqrt(S));return _=D<=1e-15?Math.max(1e-6,.001*Math.abs(c)):Math.exp(1/e*Math.log(.01/D)),c=g*Math.min(100*c,_),0!=t&&(c=g*Math.min(Math.abs(c),t)),c}return i.computeApproximation=function(e){},i.getAbsTol=function(){return r},i.getRelTol=function(){return n},i.allocateOtherArrays=function(){var e=i.getDimension();r=new Array(e),n=new Array(e),i.setTolerances(1e-6,1e-6)},i.reinitialize=function(e){c(e),t=E(l?d(i.getStepSize()):i.getStepSize())},i.setEstimateFirstStep=function(e){l=e},i.setMaximumStepSize=function(e){S(e),t=E(t)},i.setTolerances=function(e,o){var a,s=i.getDimension();if(e instanceof Array)for(u=g=Number.NaN,a=0;a<s;a++)r[a]=e[a],n[a]=o[a];else{if(u==e&&g==o)return;for(u=e,g=o,a=0;a<s;a++)r[a]=e,n[a]=o}mFinalTime=Number.NaN,mErrorCode=EJSS_ODE_SOLVERS.ERROR.NO_ERROR,t=E(l?d(i.getStepSize()):i.getStepSize())},i.computeOneStep=function(e){var r=i.getEventSolver(),n=i.getFinalState();mErrorCode=EJSS_ODE_SOLVERS.ERROR.NO_ERROR;for(var o=0;o<500;o++){if(e){switch(i.computeCarefulIntermediateStep(r,t,n)){case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_PRODUCED_ERROR:return void i.setFinalTime(Number.NaN);case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.NO_DISCONTINUITY_ALONG_STEP:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_EXACTLY_ON_STEP:i.setFinalTime(n[i.getTimeIndex()]);break;case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_JUST_PASSED:case EJSS_ODE_SOLVERS.DISCONTINUITY_CODE.DISCONTINUITY_ALONG_STEP:var a=i.findTheDiscontinuity(t);i.setFinalTime(a),t=a-i.getInitialTime()}if(isNaN(i.getFinalTime()))return void i.setErrorCode(EJSS_ODE_SOLVERS.ERROR.DISCONTINUITY_PRODUCED_ERROR)}else i.computeIntermediateStep(t,n),i.setFinalTime(n[i.getTimeIndex()]);var s=i.computeApproximation(t);if(i.addToEvaluations(i.getNumberOfEvaluations()),s<=1)return i.getStateHistory().clean(i.getInitialTime()),i.getStateHistory().addIntervalData(i.computeFinalRateAndCreateIntervalData()),void(t=E(o>0?t>0?Math.min(t,f(s)):Math.max(t,f(s)):f(s)));t=E(t>0?Math.min(t,f(s)):Math.max(t,f(s)))}i.setFinalTime(Number.NaN),i.setErrorCode(EJSS_ODE_SOLVERS.ERROR.DID_NOT_CONVERGE)},i.getActualStepSize=function(){return t},i.computeError=function(e){for(var t=0,o=i.getDimension(),a=i.getInitialState(),s=i.getFinalState(),l=0;l<o;l++){var u=r[l]+n[l]*Math.max(Math.abs(s[l]),Math.abs(a[l])),g=(s[l]-e[l])/u;t+=g*g}return Math.sqrt(t/o)},i};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.VelocityVerlet={},EJSS_ODE_SOLVERS.velocityVerlet=function(){var e,t,r=EJSS_ODE_SOLVERS.solverEngineDiscreteTime();return superSetODE=r.setODE,r.setODE=function(t,r){superSetODE(t,r),e=!!r.isAccelerationIndependentOfVelocity&&r.isAccelerationIndependentOfVelocity()},r.getNumberOfEvaluations=function(){return 2},r.allocateOtherArrays=function(){t=new Array(r.getDimension())},r.computeIntermediateStep=function(e,n){var i,o=r.getODE(),a=r.getInitialState(),s=r.getInitialRate(),l=r.getDimension()-1,u=e*e/2;for(i=0;i<l;i+=2)n[i]=a[i]+e*s[i]+u*s[i+1];o.getRate(n,t);var g=e/2;for(i=1;i<l;i+=2)n[i]=a[i]+g*(s[i]+t[i]);n[l]=r.getInitialTime()+e*s[l]},r.computeCarefulIntermediateStep=function(e,n,i){var o,a=r.getODE(),s=r.getInitialState(),l=r.getInitialRate(),u=r.getDimension()-1,g=EJSS_ODE_SOLVERS.DISCONTINUITY_CODE,c=n*n/2;for(o=0;o<u;o+=2)i[o]=s[o]+n*l[o]+c*l[o+1];switch(e.checkDiscontinuity(i,!1)){case g.DISCONTINUITY_PRODUCED_ERROR:return g.DISCONTINUITY_PRODUCED_ERROR;case g.DISCONTINUITY_JUST_PASSED:return g.DISCONTINUITY_JUST_PASSED;case g.DISCONTINUITY_ALONG_STEP:return g.DISCONTINUITY_ALONG_STEP;case g.DISCONTINUITY_EXACTLY_ON_STEP:case g.NO_DISCONTINUITY_ALONG_STEP:}a.getRate(i,t);var S=n/2;for(o=1;o<u;o+=2)i[o]=s[o]+S*(l[o]+t[o]);return i[u]=r.getInitialTime()+n*timeRate,e.checkDiscontinuity(i,!0)},r.computeFinalRateAndCreateIntervalData=function(){var n=r.getODE(),i=r.getInitialState(),o=r.getInitialRate(),a=r.getFinalState(),s=r.getFinalRate(),l=r.getDimension()-1;if(e){for(var u=0,g=1;u<l;u+=2,g+=2)s[u]=a[g],s[g]=t[g];s[l]=t[l]}else n.getRate(a,s),r.addToEvaluations(r.getNumberOfEvaluations());return new EJSS_ODE_INTERPOLATION.hermiteIntervalData(i,o,a,s)},r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.DDEDiscontinuity={},EJSS_ODE_SOLVERS.ddeDiscontinuity=function(e,t){var r={},n=[],i=[],o=[];return r.initialize=function(a){e.getRunsForwards()?n.push(Number.NEGATIVE_INFINITY):n.push(Number.POSITIVE_INFINITY);var s=t.getInitialConditionDiscontinuities();if(null!=s)for(var l=s.length,u=0;u<l;u++)n.push(s[u]);n.push(a[a.length-1]);var g=t.getDelays(a);i=new Array(g.length),r.reset(a),o=new Array(a.length)},r.reset=function(o){for(var a=i.length,s=0;s<a;s++)i[s]=0;!function(o){var a,s=t.getDelays(o),l=s.length,u=n.length,g=o.length-1;if(e.getRunsForwards())for(a=0;a<l;a++)for(var c=o[g]-s[a]+r.getTolerance(),S=i[a];S<u;S++){if(n[S]>c){i[a]=S;break}}else for(a=0;a<l;a++)for(c=o[g]-s[a]-r.getTolerance(),S=i[a];S<u;S++){if(n[S]<c){i[a]=S;break}}}(o)},r.evaluate=function(r){var o,a=r[r.length-1],s=t.getDelays(r),l=s.length;if(e.getRunsForwards()){var u=Number.POSITIVE_INFINITY;for(o=0;o<l;o++){var g=n[i[o]];u=Math.min(u,s[o]+g-a)}return u}var c=Number.NEGATIVE_INFINITY;for(o=0;o<l;o++){g=n[i[o]];c=Math.max(c,s[o]+g-a)}return c},r.action=function(){var i=t.getState(),a=function(n){var i,a=n.length,s=a-1,l=r.getTolerance()/20,u=e.getDDEIterations(),g=e.getStateHistory(),c=0;if(e.getRunsForwards())for(;++c<u;){for(t.getRate(n,o),g.addIntervalData(EJSS_ODE_INTERPOLATION.eulerIntervalData(n,o,n[s]+l)),i=0;i<a;i++)n[i]+=l*o[i];if(r.evaluate(n)<0)return n[s]}else for(;++c<u;){for(t.getRate(n,o),g.addIntervalData(EJSS_ODE_INTERPOLATION.eulerIntervalData(n,o,n[s]-l)),i=0;i<a;i++)n[i]-=l*o[i];if(evaluate(n)>0)return n[s]}return Number.NaN}(i);n.push(a);var s=e.findFirstEvent(i,a,i);return null!=s&&(mCurrentEventData=s,s.action()),!0},r.getTolerance=function(){return e.getDDETolerance()},r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.ProblemData={POSITIVE:2,SMALL_POSITIVE:1,ZERO:0,SMALL_NEGATIVE:-1,NEGATIVE:-2},EJSS_ODE_SOLVERS.eventData=function(e,t,r){var n,i,o,a,s,l,u,g,c={},S=t.getTypeOfEvent(),f=r.length-1;return c.getEvent=function(){return t},c.getEventType=function(){return S},c.setH=function(e){l=e},c.getH=function(){return l},c.getTime=function(){return u},c.setTime=function(e){u=e},c.hasPositiveFlag=function(){return n},c.hasNegativeFlag=function(){return i},c.getHBefore=function(){return a},c.setHAfter=function(e){s=e},c.getHAfter=function(){return s},c.getCurrentPosition=function(){return o},c.getMaxAdvance=function(){return g},c.setMaxAdvance=function(e){g=e},c.action=function(){return t.action()},c.getProblem=function(){return t},c.reset=function(r){n=!1,i=!1;var o=t.evaluate(r);c.findPosition(r[f],o),e.getCurrentEventData()!=c&&(S==EJSS_ODE_SOLVERS.EVENT_TYPE.CROSSING_EVENT?o>0?n=!0:o<0&&(i=!0):S==EJSS_ODE_SOLVERS.EVENT_TYPE.POSITIVE_EVENT&&o>0&&(n=!0))},c.findPosition=function(r,s){if((a=s)>=t.getTolerance()?(o=EJSS_ODE_SOLVERS.ProblemData.POSITIVE,n=!0):a>0?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:0==a?o=EJSS_ODE_SOLVERS.ProblemData.ZERO:a>-t.getTolerance()?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:(o=EJSS_ODE_SOLVERS.ProblemData.NEGATIVE,i=!0),S==EJSS_ODE_SOLVERS.EVENT_TYPE.STATE_EVENT&&o==EJSS_ODE_SOLVERS.ProblemData.NEGATIVE){var l="The state event "+t+" is in an illegal state: "+a+" at "+r;null==e.getLastEventData()?l+="\nThere was no previous event":l+="\nLast previous event was "+e.getLastEventData().getProblem()+", which took place at "+e.getLastEventDataTime(),e.error(EJSS_ODE_SOLVERS.ERROR.ILLEGAL_EVENT_STATE,l)}},c.reset(r),c},EJSS_ODE_SOLVERS.discontinuityData=function(e,t,r){var n,i,o,a,s,l,u={},g=r.length-1;return u.getDiscontinuity=function(){return t},u.setH=function(e){s=e},u.getH=function(){return s},u.setTime=function(e){l=e},u.getTime=function(){return l},u.hasPositiveFlag=function(){return n},u.hasNegativeFlag=function(){return i},u.getHBefore=function(){return a},u.setHAfter=function(e){mHAfter=e},u.getHAfter=function(){return mHAfter},u.getCurrentPosition=function(){return o},u.getMaxAdvance=function(){return Number.NaN},u.action=function(){return t.action()},u.getProblem=function(){return t},u.reset=function(r){n=!1,i=!1;var o=t.evaluate(r);u.findPosition(r[g],o),e.getCurrentEventData()!=u&&(o>0?n=!0:o<0&&(i=!0))},u.findPosition=function(e,r){(a=r)>=t.getTolerance()?(o=EJSS_ODE_SOLVERS.ProblemData.POSITIVE,n=!0):a>0?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_POSITIVE:0==a?o=EJSS_ODE_SOLVERS.ProblemData.ZERO:a>-t.getTolerance()?o=EJSS_ODE_SOLVERS.ProblemData.SMALL_NEGATIVE:(o=EJSS_ODE_SOLVERS.ProblemData.NEGATIVE,i=!0)},u.reset(r),u};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.ODEMultistepSolver={NO_ERROR:0,DID_NOT_CONVERGE:1},EJSS_ODE_SOLVERS.createODEMultistepSolver=function(e){var t={},r=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,n=200,i=!1,o="",a=.1,s=EJSS_ODE_SOLVERS.createODEMultistepSolverInternalODE(e),l=EJSS_ODE_SOLVERS.createCashKarp45(s);return t.enableRuntimeExceptions=function(e){i=e},t.setMaxIterations=function(e){n=Math.max(1,e)},t.setTolerance=function(e){e=Math.abs(e),l.setTolerance(e)},t.getTolerance=function(){return l.getTolerance()},t.getErrorCode=function(){return r},t.initialize=function(e){mMaxMessages=4,o="",r=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,a=e,s.setInitialConditions(),l.initialize(e)},t.setStepSize=function(e){mMaxMessages=4,a=e,e<0?l.setStepSize(Math.max(-Math.abs(l.getStepSize()),e)):l.setStepSize(Math.min(l.getStepSize(),e))},t.setMaximumNumberOfErrorMessages=function(e){mMaxMessages=e},t.getStepSize=function(){return a},t.step=function(){r=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,s.setInitialConditions();var e=0;return e=a>0?function(){var e=l.getTolerance(),t=a;(l.getStepSize()<=0||l.getStepSize()>a||a-l.getStepSize()==a)&&l.setStepSize(a);var s=0;for(;t>e*a;){s++;var u=t;if(t<l.getStepSize()){var g=l.getStepSize();l.setStepSize(t);var c=l.step();t-=c,l.setStepSize(g)}else t-=l.step();if(l.getErrorCode()!=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR||Math.abs(u-t)<=Number.MIN_VALUE||e*a/10>l.getStepSize()||s>n){if(o="ODEMultiStep did not converge. Remainder="+t,r=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE,i)throw o;mMaxMessages>0&&(mMaxMessages--,console.log(o));break}}return t}():function(){var e=l.getTolerance(),t=a;(l.getStepSize()>=0||l.getStepSize()<a||a-l.getStepSize()==a)&&l.setStepSize(a);var i=0;for(;t<e*a;){i++;var s=t;if(t>l.getStepSize()){var u=l.getStepSize();l.setStepSize(t);var g=l.step();t-=g,l.setStepSize(u)}else t-=l.step();if(l.getErrorCode()!=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR||Math.abs(s-t)<=Number.MIN_VALUE||e*a/10<l.getStepSize()||i>n){if(o="ODEMultiStep did not converge. Remainder="+t,r=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE,enableExceptions)throw o;mMaxMessages>0&&(mMaxMessages--,console.log(o))}}return t}(),s.update(),a-e},t},EJSS_ODE_SOLVERS.createODEMultistepSolverInternalODE=function(e){var t={},r=[];return t.getRate=function(t,r){e.getRate(t,r)},t.getState=function(){return r},t.setInitialConditions=function(){var t=e.getState();if(null!=t){null!=r&&r.length==t.length||(r=new Array(t.length));for(var n=0,i=t.length;n<i;n++)r[n]=t[n]}},t.update=function(){for(var t=e.getState(),n=0,i=t.length;n<i;n++)t[n]=r[n]},t.setInitialConditions(),t},EJSS_ODE_SOLVERS.createCashKarp45=function(e){var t,r={},n=[[.2],[3/40,9/40],[.3,-.9,1.2],[-11/54,2.5,-70/27,35/27],[1631/55296,175/512,575/13824,44275/110592,253/4096]],i=[37/378,0,250/621,125/594,0,512/1771],o=[277/64512,0,-6925/370944,6925/202752,277/14336,-277/7084],a=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,s=.01,l=0,u=[],g=[],c=1e-6,S=!1;return r.enableRuntimeExpecptions=function(e){S=e},r.setStepSize=function(e){s=e},r.getStepSize=function(){return s},r.setTolerance=function(e){if((c=Math.abs(e))<1e-12){var t="Error: Cash-Karp ODE solver tolerance cannot be smaller than 1.0e-12.";if(S)throw t;console.log(t),c=1e-12}},r.getTolerance=function(){return c},r.getErrorCode=function(){return a},r.initialize=function(t){s=t;var r=e.getState();if(null!=r&&l!=r.length){l=r.length,u=new Array(l),g=new Array(6);for(var n=0;n<6;n++)g[n]=new Array(l)}},r.step=function(){var r,f,E,d=10,p=s,h=0,m=e.getState();a=EJSS_ODE_SOLVERS.ODEMultistepSolver.NO_ERROR,e.getRate(m,g[0]);do{for(d--,p=s,E=1;E<6;E++){for(r=0;r<l;r++)for(u[r]=m[r],f=0;f<E;f++)u[r]=u[r]+s*n[E-1][f]*g[f][r];e.getRate(u,g[E])}for(h=0,r=0;r<l;r++){for(t=0,E=0;E<6;E++)t+=s*o[E]*g[E][r];h=Math.max(h,Math.abs(t))}if(h<=Number.MIN_VALUE&&(h=c/1e5),h>c){var A=.9*Math.pow(h/c,-.25);s*=Math.max(A,.1)}else if(h<c/10){(A=.9*Math.pow(h/c,-.2))>1&&(s*=Math.min(A,10))}}while(h>c&&d>0);for(r=0;r<l;r++)for(E=0;E<6;E++)m[r]+=p*i[E]*g[E][r];if(0==d&&(a=EJSS_ODE_SOLVERS.ODEMultistepSolver.DID_NOT_CONVERGE,S))throw"DormanPrince45 ODE solver did not converge.";return p},r.initialize(s),r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.createEulerODESolver=function(e){var t,r=EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime(e),n=r.initialize;return r.initialize=function(e){n(e),t=new Array(r.getDimension())},r.computeIntermediateStep=function(r,n){e.getRate(n,t);for(var i=0,o=n.length;i<o;i++)n[i]=n[i]+r*t[i];return n},r};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.createRungeKutta4ODESolver=function(e){var t,r,n,i,o,a=EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime(e),s=a.initialize;return a.initialize=function(e){s(e),t=new Array(a.getDimension()),r=new Array(a.getDimension()),n=new Array(a.getDimension()),i=new Array(a.getDimension()),o=new Array(a.getDimension())},a.computeIntermediateStep=function(a,s){e.getRate(s,r);for(var l=0,u=s.length;l<u;l++)t[l]=s[l],s[l]=t[l]+a*r[l]/2;e.getRate(s,n);for(l=0,u=s.length;l<u;l++)s[l]=t[l]+a*n[l]/2;e.getRate(s,i);for(l=0,u=s.length;l<u;l++)s[l]=t[l]+a*i[l];e.getRate(s,o);for(l=0,u=s.length;l<u;l++)s[l]=t[l]+a*(r[l]+2*n[l]+2*i[l]+o[l])/6;return s},a};var EJSS_ODE_SOLVERS=EJSS_ODE_SOLVERS||{};EJSS_ODE_SOLVERS.SolverInterpolatorDiscreteTime={},EJSS_ODE_SOLVERS.createSolverInterpolatorDiscreteTime=function(e){var t,r={},n=.1;Number.POSITIVE_INFINITY;return r.getNumberOfEvaluations=function(){return 0},r.allocateOtherArrays=function(){},r.computeIntermediateStep=function(e,t){return null},r.computeCarefulIntermediateStep=function(e,t,r){return 0},r.setTolerance=function(e){Math.abs(e)},r.getDimension=function(){return t},r.initialize=function(r){n=r;var i=e.getState();t=i.length},r.step=function(){var t=e.getState();return r.computeIntermediateStep(n,t),0},r.setStepSize=function(e){n=e},r.getStepSize=function(){return n},r};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.recorder=function(e){var t={},r=!1,n=!0,i=!0,o=!0,a=[],s=[];t.isStarted=function(){return r},t.setRecUserEvents=function(e){n=e},t.isRecUserEvents=function(){return n},t.setRecModelCalls=function(e){i=e},t.isRecModelCalls=function(){return i},t.setRecInteractions=function(e){o=e},t.isRecInteractions=function(){return o},t.selectVars=function(e){a=e.slice()},t.clear=function(){s=[],e.getView().clearRegInteractions()},t.stop=function(){return e.getView().unregisterInteractions(),r=!1,document.removeEventListener("mousedown",t.addEventRecord),document.removeEventListener("touchstart",t.addEventRecord),t.getRecords()},t.start=function(){r||(r=!0,s=[],o&&(e.getView().registerInteractions(!1,t.addAutoRecord),e.getView().setShortRegInteractions(!0)),n&&(document.addEventListener("mousedown",t.addEventRecord),document.addEventListener("touchstart",t.addEventRecord)))},t.addEventRecord=function(e){t.addRecord("_event."+e.type,a)},t.addAutoRecord=function(r,n){if(n){var i={};void 0!==r.action?(i.type="action",i.name=r.action):(i.type="property",i.name=r.property,i.value=r.data),t.addRecord("_view."+r.element,a,i)}else{var o=e._userSerialize();if(s[s.length-1].after={},0==a.length)s[s.length-1].after=o;else for(v in a){var l=a[v];s[s.length-1].after[l]=o[l]}}},t.addRecord=function(t,r,n){if(void 0===r)r=a;var i=e._userSerialize(),o={before:{}};if(0==r.length)o.before=i;else for(v in r){var l=r[v];o.before[l]=i[l]}if(o.timeStamp=Date.now(),o.tag=t,void 0!==n)for(var u in n)o[u]=n[u];s.push(o)},t.getRecords=function(){return s},t.downloadFile=function(){EJSS_TOOLS.File.downloadText("records.json",JSON.stringify(t.getRecords()))},t.sendRecords=function(e,t){if(0!=s.length){var r=JSON.stringify(s,(function(e,t){return"number"==typeof t&&(isNaN(t)?t="__NaN":isFinite(t)||(t="__Infinity")),t}));s=[];var n=new XMLHttpRequest,i="view_id="+u+"&info="+encodeURIComponent(r)+"&user_id="+g;n.open("POST",S+"?wstoken="+c+"&wsfunction="+f,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){4==n.readyState&&200==n.status?e&&e():t&&t()},n.send(i)}};var l=new URL(document.location),u=void 0!==l.searchParams&&l.searchParams.get("view_id");if(u){var g=l.searchParams.get("user_id"),c=l.searchParams.get("wstoken"),S=l.searchParams.get("url"),f=l.searchParams.get("wsfunction");"report_get_lainteractions"==f&&setInterval((function(){t.sendRecords()}),3e3)}return e.____play=e.play,e.play=function(){r&&i&&t.addRecord("play"),e.____play()},e.____pause=e.pause,e.pause=function(){r&&i&&t.addRecord("pause"),e.____pause()},e.____reset=e.reset,e.reset=function(n){r&&i&&t.addRecord("reset"),e.____reset()},e.____initialize=e.initialize,e.initialize=function(){r&&i&&t.addRecord("initialize"),e.____initialize()},t};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.createRemoteView=function(e,t,r,n){var i,o,a=EJSS_CORE.createView(e),s=!1,l=0,u={},g=[],c=[],S=[],f=[],E="",d=!0,p=0,h="";function m(e){var t;console.log(" --\x3e Processing input: "+e);var r={};if("{"==e.charAt(0)){var n="";if((t=JSON.parse(e)).hasOwnProperty("method")&&("reset"==(n=t.method)?a._reset():"initialize"==n?a._initialize():null!=o&&(r=o.extract(e),u=r,A(a._update))),t.hasOwnProperty("apiVersion"))for(var s in console.log("Metadata Obtained"),o=new wrapper(i,e),g)o.get(g[s],!0)}else!function(e){var t;switch(e.charAt(0)){case"R":a._reset();break;case"I":a._initialize();break;case"U":u=JSON.parse(e.substring(1)),A(a._update);break;case"C":u=JSON.parse(e.substring(1)),A(a._collectData);break;case"M":t=JSON.parse(e.substring(1)),a[t.method]?a[t.method](t.data):console.log("View function: <"+t.method+"> with data: <"+t.data+"> ignored. View function does not exist.");break;case"P":t=JSON.parse(e.substring(1)),a[t.element]?a[t.element].setProperty(t.property,t.value):console.log("setProperty<"+t.property+"> with value: <"+t.value+"> to element <"+t.element+"> ignored. Element does not exist!");break;case"E":t=JSON.parse(e.substring(1)),a[t.element]?a[t.element][t.method](t.data):console.log("Message <"+t.method+"> to element <"+t.element+"> ignored. Element does not exist!");break;case"F":t=JSON.parse(e.substring(1)),a[t.element]?a[t.element][t.method](t.data):console.log("Message with object <"+t.method+"> to element <"+t.element+"> ignored. Element does not exist!");break;case"D":t=JSON.parse(e.substring(1)),t.variables,t.methods;break;default:console.log("Not known message: Ignoring")}}(e)}function A(e){e(),a._render()}if(a.getClass=function(){return"ConnectionWS"},a._connectToServer=function(){try{i=new WebSocket(h),console.log("Connecting... (readyState "+i.readyState+")"),i.onopen=function(e){s=!0,l=0,console.log("Openhd Event: "+e.type+" - Message: "+e.data),function(e,t){if(s){void 0!==t?i.send(e+JSON.stringify(t)):i.send(e);var r=i.onmessage;i.onmessage=null,i.onmessage=r}}("",{method:"getMetadata"})},i.onclose=function(e){l<10&&(window.setTimeout((function(){a._connectToServer()}),500),l++),s=!1,console.log("Closehd Event: "+e.type+" - Message: "+e.data+" - Reopen: "+l)},i.onerror=function(e){s=!1,console.log("Errorhd Event: "+e.type+" - Message: "+e.data)},i.onmessage=function(e){m(e.data)}}catch(e){console.log(e)}a._update(),a._render()},a._getValue=function(e){return s?u[e]:a._getInitialValue(e)},super_registerVariable=a._registerVariable,super_registerAction=a._registerAction,super_startUp=a._startUp,a._startUp=function(){super_startUp(),a._connectToServer()},a._registerVariable=function(e,t,r){super_registerVariable(e,t),r?a._linkVariable(e,(function(){return a._getValue(e)}),null,t):(g.push(e),a._linkVariable(e,(function(){return a._getValue(e)}),(function(t){S.push({name:e,value:t})}),t))},a._registerAction=function(e){super_registerAction(e),c.push(e),a._setAction(e,(function(t){f.push({name:e,argument:t})}))},a._reportInteraction=function(){a._readInteractions();var e={},t={};if(S.length>0){for(var r in S)S[r].hasOwnProperty("name")&&(e[r]=S[r].name),t[r]=S[r].value;o.set(e,t,"")}if(f.length>0)for(var n in f)o.callAction(f[n].name,[f[n].argument]);S=[],f=[]},a._interactionsNumber=function(){return f.length},a.getLinkingURL=function(){return E},a.createLinkingButtons=function(){a._addElement(EJSS_INTERFACE.button,"_linkingButton_").setAction("OnClick",(function(){var e=a.getLinkingURL();window.alert(e.toString())})).setProperties({Text:"@",FontSize:"8px"}),a._addElement(EJSS_INTERFACE.button,"_qrButton_").setAction("OnClick",(function(){var e="https://chart.googleapis.com/chart?cht=qr&chl="+encodeURIComponent(a.getLinkingURL())+"&chs=400";window.open(e,"_blank")})).setProperties({Text:"QR",FontSize:"8px"})},a.hiddenLinkingButtons=function(){_view._linkingButton_.setVisibility("hidden"),_view._qrButton_.setVisibility("hidden")},a.showLinkingButtons=function(){_view._linkingButton_.setVisibility("visible"),_view._qrButton_.setVisibility("visible")},-1!=window.location.protocol.indexOf("file"))null!=t&&0!=t||(t=8800),h="ws://localhost:"+t,d=!1;else{if(history.state&&(p=history.state.mServerModelPort,d=!1),null==r||""==r){var _=window.location.host,D=window.location.protocol;r=D+"//"+_+"/ejsS_library/models"}if(null==n||""==n){var I=window.location.href.lastIndexOf("/_view");n=window.location.href.slice(r.length,I)}var P=new XMLHttpRequest;p>0?P.open("GET",r+"/broker.php?model="+n+"&port="+p,!0):P.open("GET",r+"/broker.php?model="+n,!0),P.onreadystatechange=function(){if(4==P.readyState&&200==P.status){var e=JSON.parse(P.responseText);h=e.webserver,E=r+"/linking.php?model="+n+"&port="+e.port,d&&a.createLinkingButtons(),a._startUp()}else console.log("WARNING: server no response!")},P.send()}return a};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.addToArray=function(e,t,r){EJSS_TOOLS.removeFromArray(e,t),r>=0?e.splice(r,0,t):e.push(t)},EJSS_TOOLS.arrayObjectIndexOf=function(e,t){return e.indexOf(t)},EJSS_TOOLS.removeFromArray=function(e,t){var r=e.indexOf(t);r>=0&&e.splice(r,1)},EJSS_TOOLS.compareArrays=function(e,t){if(!e||!t)return!1;if(!e instanceof Array||!t instanceof Array)return e==t;if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]instanceof Array&&t[r]instanceof Array){if(!EJSS_TOOLS.compareArrays(e[r],t[r]))return!1}else if(e[r]!=t[r])return!1;return!0};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.ConnectionWS={},EJSS_TOOLS.connectionWS=function(e){var t,r,n={},i={};function o(e,r){switch(e){case"onopen":t.onopen=function(e){r(e)};break;case"onmessage":t.onmessage=function(e){r(e)};break;case"onclose":t.onclose=function(e){r(e)};break;case"onerror":t.onerror=function(e){r(e)}}}return n.getClass=function(){return"ConnectionWS"},n.get=function(e){var t=i[e];if(void 0!==t||null==t)return t},n.set=function(e,i){if(console.log("set:"+e+":"+i.toString()),console.log("set:is open="+r),r){var o=e+" "+i.toString();t.send(o),n.reset()}},n.reset=function(){var e=t.onmessage;t.onmessage=null,t.onmessage=e},function(){try{t=new WebSocket(e),console.log("Connecting... (readyState "+t.readyState+")")}catch(e){console.log(e)}}(),o("onopen",(function(e){r=!0,console.log("Openhd Event: "+e.type+" - Message: "+e.data)})),o("onclose",(function(e){r=!1,console.log("Closehd Event: "+e.type+" - Message: "+e.data)})),o("onerror",(function(e){r=!1,console.log("Errorhd Event: "+e.type+" - Message: "+e.data)})),o("onmessage",(function(e){var t=e.data.split(" ");i[t[0]]=e.data.substring(t[0].length+1)})),n};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.Decode={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",hex_to_ascii:function(e){for(var t=e.toString(),r="",n=0;n<t.length;n+=2)r+=String.fromCharCode(parseInt(t.substr(n,2),16));return r},decode:function(e){var t,r,n,i,o,a,s="",l=0;for(e=(e=""+e).replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=this._keyStr.indexOf(e.charAt(l++))<<2|(i=this._keyStr.indexOf(e.charAt(l++)))>>4,r=(15&i)<<4|(o=this._keyStr.indexOf(e.charAt(l++)))>>2,n=(3&o)<<6|(a=this._keyStr.indexOf(e.charAt(l++))),s+=String.fromCharCode(t),64!=o&&(s+=String.fromCharCode(r)),64!=a&&(s+=String.fromCharCode(n));return s=EJSS_TOOLS.Decode._utf8_decode(s)},_utf8_decode:function(e){for(var t="",r=0,n=c1=c2=0;r<e.length;)(n=e.charCodeAt(r))<128?(t+=String.fromCharCode(n),r++):n>191&&n<224?(c2=e.charCodeAt(r+1),t+=String.fromCharCode((31&n)<<6|63&c2),r+=2):(c2=e.charCodeAt(r+1),c3=e.charCodeAt(r+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),r+=3);return t}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.DisplayColors={phaseColors:{},lineColors:["rgb(255,0,0)","rgb(0,240,0)","rgb(0,0,255)","rgb(240,240,0)","rgb(0,240,240)","rgb(255,0,255)"],markerColors:["rgb(255,0,0)","rgb(0,240,0)","rgb(0,0,255)","rgb(240,240,0)","rgb(0,240,240)","rgb(255,0,255)"],arrayColors:{black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,160],darkcyan:[0,240,240],darkgray:[64,64,64],darkgreen:[0,240,0],darkgrey:[64,64,64],darkyellow:[240,240,0],gray:[125,125,125],green:[0,255,0],grey:[125,125,125],lightblue:[173,216,230],lightgray:[192,192,192],lightgrey:[192,192,192],magenta:[255,0,255],maroon:[128,0,0],olive:[128,128,0],orange:[255,165,0],pink:[255,175,175],purple:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]},getLineColor:function(e){var t=EJSS_TOOLS.DisplayColors.lineColors[e];void 0===t&&(t="hsl("+360*e/12%360+",100%,50%)",EJSS_TOOLS.DisplayColors.lineColors[e]=t);return t},getMarkerColor:function(e){var t=EJSS_TOOLS.DisplayColors.markerColors[e];void 0===t&&(t="hsl("+360*e/12%360+",100%,100%)",EJSS_TOOLS.DisplayColors.markerColors[e]=t);return t},getArrayColor:function(e){if(0==(e=e.toLowerCase()).indexOf("rgb"))var t=e.substring(4,e.length-1).replace(/ /g,"").split(",");else if(0==e.indexOf("#")){e=(e=e.slice(1)).toUpperCase();t=new Array(3);for(var r,n,i=0,o=0;o<6;o+=2)r="0123456789ABCDEF".indexOf(e.charAt(o)),n="0123456789ABCDEF".indexOf(e.charAt(o+1)),t[i]=16*r+n,i++}else{void 0===(t=EJSS_TOOLS.DisplayColors.arrayColors[e])&&(t=EJSS_TOOLS.DisplayColors.arrayColors.black)}return[t[0]/255,t[1]/255,t[2]/255]}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.enumeration=function(e){var t=function(){throw"Can't Instantiate Enumerations"},r=t.prototype={constructor:t,toString:function(){return this.name},valueOf:function(){return this.value},toJSON:function(){return this.name}};for(var n in t.values=[],e){var i=inherit(r);i.name=n,i.value=e[n],t[n]=i,t.values.push(i)}return t.foreach=function(e,t){for(var r=0;r<this.values.length;r++)e.call(t,this.values[r])},t};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.File={JSLoaded:"",SingletonDownload:document.createElement("input"),SingletonUpload:document.createElement("input"),loadJSfile:function(e,t){if(-1!=EJSS_TOOLS.File.JSLoaded.indexOf("["+e+"]"))return console.log("File already loaded "+e),void t();EJSS_TOOLS.File.JSLoaded+="["+e+"]";var r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("src",e),void 0!==t&&(r.onload=t),document.getElementsByTagName("head")[0].appendChild(r)},plainName:function(e){var t=e.lastIndexOf("/");return t>=0&&(e=e.substring(t+1)),(t=e.indexOf("."))>0&&(e=e.substring(0,t)),e},downloadText:function(e,t){var r=new Blob([t]);EJSS_TOOLS.File.SingletonDownload=document.createElement("a"),EJSS_TOOLS.File.SingletonDownload.href=window.URL.createObjectURL(r),EJSS_TOOLS.File.SingletonDownload.download=e,EJSS_TOOLS.File.SingletonDownload.click(),window.URL.revokeObjectURL(r)},uploadText:function(e,t){EJSS_TOOLS.File.SingletonUpload.type="file",EJSS_TOOLS.File.SingletonUpload.accept="text/*",EJSS_TOOLS.File.SingletonUpload.multiple=!1,EJSS_TOOLS.File.SingletonUpload.onchange=function(r){var n=new FileReader;n.onload=function(r){var n=this.result;e.performTaskSafely((function(){t(n)})),EJSS_TOOLS.File.SingletonUpload.value=""},n.readAsText(r.target.files[0])},EJSS_TOOLS.File.SingletonUpload.click()},loadScript:function(e){var t=document.createElement("script");t.type="text/javascript",t.src=e,document.getElementsByTagName("head")[0].appendChild(t)},loadJSONFile:function(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){var e=JSON.parse(r.responseText);t(e)}},r.open("GET",e,!0),r.send()},loadCSVFile:function(e,t){var r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState&&200==r.status){for(var e=r.responseText.split(/\r\n|\n/),n=[],i=1;i<e.length;i++){for(var o=e[i].split(","),a=[],s=0;s<o.length;s++)a.push(o[s]);n.push(a)}t(n)}},r.open("GET",e,!0),r.send()},requestShortUrl:function(e,t){var r=escape("http://urlecho.appspot.com/echo?status=200&Content-Type=text/plain&body="+e);if(EJSS_TOOLS.File.CALLBACK=t,EJSS_TOOLS.File.callFunction=function(e){EJSS_TOOLS.File.CALLBACK(e.shortUrl)},null==document.getElementById("__rtShortUrl")){var n=document.createElement("script");n.type="text/javascript",n.id="__rtShortUrl",n.innerHTML="function rtShortUrl(data) { EJSS_TOOLS.File.callFunction(data); }",document.getElementsByTagName("head")[0].appendChild(n)}var i=document.getElementById("_requestShortUrl");null!=i&&document.getElementsByTagName("head")[0].removeChild(i),(i=document.createElement("script")).id="_requestShortUrl",i.type="text/javascript",i.src="http://b1t.co/Site/api/External/MakeUrlWithGet?callback=rtShortUrl&url="+r,document.getElementsByTagName("head")[0].appendChild(i)}};var EJSS_HARDWARE=EJSS_HARDWARE||{};EJSS_HARDWARE.orientationTools=function(e){var t,r={},n="Android"!=((t=navigator.userAgent||navigator.vendor||window.opera).match(/iPad/i)||t.match(/iPhone/i)||t.match(/iPod/i)?"iOS":t.match(/Android/i)?"Android":"unknown"),i=0;function o(){return n?"90"==window.orientation?90:"0"==window.orientation?0:"-90"==window.orientation?-90:180:"90"==window.orientation?-90:"0"==window.orientation?180:"-90"==window.orientation?90:0}return r.getOrientation=function(){return i},window.addEventListener("orientationchange",(function(){i=o(),void 0!==e&&e()}),!1),i=o(),r},EJSS_HARDWARE.accelerometer=function(){var e={},t=[],r=EJSS_HARDWARE.orientationTools(),n=0,i=!1,o=!1,a={x:0,y:0,z:0,interval:0,alpha:0,beta:0,gamma:0},s=[];function l(e,t,r){return r.x=e.x,r.y=e.y,r.z=e.z,r.alpha=t.alpha,r.beta=t.beta,r.gamma=t.gamma,r.millisAgo=0,r}function u(e){var r=e.accelerationIncludingGravity,i=e.rotationRate,o=e.interval;if(n>0){for(var u=0,g=s.length;u<g;u++){var c=s[u];if(c.millisAgo+=o,c.millisAgo>n){s.length=u;break}}s.unshift(l(r,i,{}))}l(r,i,a);for(var S=0,f=t.length;S<f;S++)t[S](a)}function g(){var e={x:0,y:0,z:0,interval:0,alpha:0,beta:0,gamma:0};e.alpha=a.alpha,e.beta=a.beta,e.gamma=a.gamma;for(var t=s.length,r=0;r<t;r++){var n=s[r];e.x+=n.x,e.y+=n.y,e.z+=n.z}return e.x/=t,e.y/=t,e.z/=t,e}return e.isPresent=function(){return o},e.start=function(){e.isPresent()&&(window.addEventListener("devicemotion",u,!1),i=!0)},e.stop=function(){e.isPresent()&&window.removeEventListener("devicemotion",u),s=[],a={x:0,y:0,z:0,interval:0,alpha:0,beta:0,gamma:0},i=!1},e.isRunning=function(){return i},e.setAverageInterval=function(e){(n=e)<=0&&(s=[])},e.getDeviceData=function(){return n>0?g():a},e.getViewData=function(){var e=n>0?g():a;switch(r.getOrientation()){case 0:return{x:e.x,y:e.y,z:e.z,alpha:e.alpha,beta:e.beta,gamma:e.gamma};case 90:return{x:-e.y,y:e.x,z:e.z,alpha:e.alpha,beta:e.beta,gamma:e.gamma};case-90:return{x:e.y,y:-e.x,z:e.z,alpha:e.alpha,beta:e.beta,gamma:e.gamma};default:return{x:-e.x,y:-e.y,z:e.z,alpha:e.alpha,beta:e.beta,gamma:e.gamma}}},e.addListener=function(e){t.push(e)},e.removeListener=function(e){var r=t.indexOf(e);r>-1&&(t=t.splice(r,1))},"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission&&DeviceMotionEvent.requestPermission().then(e=>{"granted"==e&&(o=!0)}).catch(console.error),e},EJSS_HARDWARE.gyroscope=function(){var e,t={},r=[],n=!1,i={alpha:0,beta:0,gamma:0},o=!1,a=0;function s(){var t=1/60;a&&(t=Math.round(e.timestamp-a)),a=e.timestamp,i.alpha=rotation.alpha,i.beta=rotation.beta,i.gamma=rotation.gamma;for(var n=0,o=r.length;n<o;n++)r[n](i,t)}function l(e){var t=e.rotationRate,n=e.interval;i.alpha=t.alpha,i.beta=t.beta,i.gamma=t.gamma;for(var o=0,a=r.length;o<a;o++)r[o](i,n)}return t.isPresent=function(){return o},t.start=function(){t.isPresent()&&("Gyroscope"in window?((e=new Gyroscope).addEventListener("reading",s,!1),e.start()):window.addEventListener("devicemotion",l,!1),n=!0)},t.stop=function(){if(t.isPresent())if("Gyroscope"in window){window.removeEventListener("reading",s);try{e.stop()}catch(e){}}else window.removeEventListener("devicemotion",l);i={alpha:0,beta:0,gamma:0},n=!1},t.isRunning=function(){return n},t.getDeviceData=function(){return i},t.addListener=function(e){r.push(e)},t.removeListener=function(e){var t=r.indexOf(e);t>-1&&(r=r.splice(t,1))},"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission&&DeviceMotionEvent.requestPermission().then(e=>{"granted"==e&&(o=!0)}).catch(console.error),t},EJSS_HARDWARE.orientation=function(){var e={},t=[],r=!1,n={alpha:0,beta:0,gamma:0};function i(e){var r=e.interval;n.alpha=e.alpha,n.beta=e.beta,n.gamma=e.gamma;for(var i=0,o=t.length;i<o;i++)t[i](n,r)}return e.isPresent=function(){return void 0!==window.DeviceOrientationEvent},e.start=function(){e.isPresent()&&(window.addEventListener("deviceorientation",i,!1),r=!0)},e.stop=function(){e.isPresent()&&window.removeEventListener("deviceorientation",i),n={alpha:0,beta:0,gamma:0},r=!1},e.isRunning=function(){return r},e.getDeviceData=function(){return n},e.addListener=function(e){t.push(e)},e.removeListener=function(e){var r=t.indexOf(e);r>-1&&(t=t.splice(r,1))},e},EJSS_HARDWARE.ambientLight=function(){var e,t={},r=[],n=!1,i={lux:0},o=0;function a(){var t=1/60;o&&(t=Math.round(e.timestamp-o)),o=e.timestamp,i.lux=e.illuminance;for(var n=0,a=r.length;n<a;n++)r[n](i,t)}return t.isPresent=function(){return void 0!==window.AmbientLightSensor},t.start=function(){t.isPresent()&&((e=new AmbientLightSensor).addEventListener("reading",a,!1),e.start(),n=!0)},t.stop=function(){t.isPresent()&&window.removeEventListener("reading",a);try{e.stop()}catch(e){}i={lux:0},n=!1},t.isRunning=function(){return n},t.getDeviceData=function(){return i},t.addListener=function(e){r.push(e)},t.removeListener=function(e){var t=r.indexOf(e);t>-1&&(r=r.splice(t,1))},t},EJSS_HARDWARE.magnometer=function(){var e,t={},r=[],n=!1,i={x:0,y:0,z:0},o=0;function a(){var t=1/60;o&&(t=Math.round(e.timestamp-o)),o=e.timestamp,i.x=e.x,i.y=e.y,i.z=e.z;for(var n=0,a=r.length;n<a;n++)r[n](i,t)}return t.isPresent=function(){return void 0!==window.Magnometer},t.start=function(){t.isPresent()&&((e=new Magnometer).addEventListener("reading",a,!1),e.start(),n=!0)},t.stop=function(){t.isPresent()&&window.removeEventListener("reading",a);try{e.stop()}catch(e){}i={x:0,y:0,z:0},n=!1},t.isRunning=function(){return n},t.getDeviceData=function(){return i},t.addListener=function(e){r.push(e)},t.removeListener=function(e){var t=r.indexOf(e);t>-1&&(r=r.splice(t,1))},t},EJSS_HARDWARE.audio=function(){var e,t,r={},n=!1,i={x:0,y:0,z:0};return r.isPresent=function(){return navigator.AudioContext||navigator.webkitAudioContext},r.start=function(i,o){if(r.isPresent()&&void 0===e){e=new(window.AudioContext||window.webkitAudioContext),(t=audioCtx.createAnalyser()).minDecibels=-20,t.maxDecibels=-80,t.smoothingTimeConstant=.85;var a=audioCtx.createWaveShaper(),s=audioCtx.createGain(),l=audioCtx.createBiquadFilter(),u=audioCtx.createConvolver();navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(r){e.createMediaStreamSource(r).connect(t),t.connect(a),a.connect(l),l.connect(u),u.connect(s),s.connect(e.destination),void 0===i&&i(),n=!0})).catch((function(e){console.log("The following getUserMedia error occured: "+e),void 0===o&&o()}))}},r.stop=function(){},r.getAudioContext=function(){return mAudioContext},r.getAnalyser=function(){return t},r.isRunning=function(){return n},r.getDeviceData=function(){return i},r};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.JsonrpcBuilder={template:{METHOD:"${METHOD}",PARAMS:"${PARAMS}",ID:"${ID}",REQUEST:'{jsonrpc: "2.0", method: ${METHOD}, params: ${PARAMS}, id: ${ID}}',RESPONSE_OK:'{jsonrpc: "2.0", result: ${RESULT}, params: ${PARAMS}, id: ${ID}}',RESPONSE_ERROR:'{jsonrpc: "2.0", method: ${METHOD}, params: ${PARAMS}, id: ${ID}}',ERROR:'{code: "2.0", message: ${MESSAGE}, data: ${DATA}}'},request:function(e,t,r){if(t&&!(t instanceof Array))throw new InvalidParamsException;var n={jsonrpc:"2.0",method:e};return t&&(n.params=t),r&&(n.id=r),n},response:function(e,t){return{jsonrpc:"2.0",result:e,id:t}},responseWithError:function(e,t){return{jsonrpc:"2.0",error:e,id:t}},error:function(e,t,r){return{code:e,message:t,data:r}},parseResponse:function(e){var t=null;try{t=JSON.parse(e)}catch(e){console.log(e)}return null!=t?t.result:null}};var EJSS_TOOLS=EJSS_TOOLS||{};EJSS_TOOLS.JsonrpcClient={methods:{connect:"connect",open:"open",getMetadata:"getMetadata",getValue:"getValue",setValue:"setValue",close:"close",disconnect:"disconnect"}},EJSS_TOOLS.jsonrpcClient=function(e,t){var r,n,i,o,a,s={},l=EJSS_TOOLS.JsonrpcClient,u=EJSS_TOOLS.JsonrpcBuilder,g={};function c(e,t,n,i){var o=i||function(e){for(var t="",r="abcdefghijklmnopqrstuvwxyz",n=0;n<e;n++)t+=r.charAt(Math.floor(Math.random()*r.length));return t}(12);n&&(g[o]=n);var a=u.request(e,t,o);r.send(JSON.stringify(a))}return s.connect=function(e){return c(l.methods.connect,null,e)},s.open=function(e){return c(l.methods.open,null,e)},s.getValue=function(e,t){return c(l.methods.getValue,[e],t)},s.setValue=function(e,t){return c(l.methods.setValue,e,t)},s.getMetadata=function(e){return c(l.methods.getMetadata,null,e)},s.disconnect=function(e){return c(l.methods.disconnect,null,e)},s.close=function(e){return c(l.methods.close,null,e)},s.init=function(s,l,u,c){try{n=s,o=u,i=c,a=l;var S="ws://"+e;t&&(S+=":"+t),(r=new WebSocket(S)).onopen=function(e){n&&n(e),console.log("Openhd Event: "+e.type+" - Message: "+e.data)},r.onmessage=function(e){var t=JSON.parse(e.data);a&&a(g),t.id&&g[t.id]&&g[t.id](t.result)},r.onclose=function(e){i&&i(message),console.log("Closehd Event: "+message.type+" - Message: "+message.data)},r.onerror=function(e){o&&o(e),console.log("Errorhd Event: "+e.type+" - Message: "+e.data)},console.log("Connecting... (readyState "+r.readyState+")")}catch(e){console.log(e)}},s.finish=function(){try{r.close()}catch(e){console.log(e)}},s};var EJSS_TOOLS=EJSS_TOOLS||{};function _smartDevice(e,t){return this.websocket=e,this.loadMetadata(t),this}function wrapper(e,t){e.hasOwnProperty("ip")?(wsUri="ws://"+e.ip+":"+e.port+"/",this.websocket=new WebSocket(wsUri)):this.websocket=e,this.smartdevice=new _smartDevice(this.websocket,t),this.smartdevice.loadApis(),this.smartdevice.loadModels(),this.smartdevice.generateMethodCall(),this.smartdevice.generateModelFilling()}EJSS_TOOLS.Mathematics={TWO_PI:6.2831852,TO_RADIANS:Math.PI/180,LOG10SCALE:1/Math.log(10),cosineAndSine:[],cosineAndSineForDegrees:function(e){(e%=360)<0&&(e+=360);var t=this.cosineAndSine[e];if(void 0===t){var r=e*this.TO_RADIANS;t=[Math.cos(r),Math.sin(r)]}return t},radians:function(e){return e*Math.PI/180},degrees:function(e){var t=180*e/Math.PI,r=t%360;return t=360*r<0?r+360:r},norm:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r]*e[r];return Math.sqrt(t)},crossProduct:function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},normalize:function(e){var t=EJSS_TOOLS.Mathematics.norm(e);return 0==t?e:[e[0]/t,e[1]/t,e[2]/t]},normalTo:function(e){if(0==e[0])return[1,0,0];if(0==e[1])return[0,1,0];if(0==e[2])return[0,0,1];var t=EJSS_TOOLS.Mathematics.norm(e);return[-e[1]/t,e[0]/t,0]},rotate:function(e,t,r){var n=Math.cos(r),i=Math.sin(r);return[n*(t[0]-e[0])+i*(t[1]-e[1])+e[0],n*(t[1]-e[1])-i*(t[0]-e[0])+e[1]]}},_smartDevice.prototype={metadata:"",apis:[],models:"",modelsTemplate:[],apisFn:[],loadMetadata:function(e){this.metadata=JSON.parse(e)},loadModels:function(){this.models=this.metadata.models},loadApis:function(){this.apis=this.metadata.apis},getModelTemplate:function(e){if(this.models.hasOwnProperty(e)){var t=JSON.parse(JSON.stringify(this.models[e]));e=t.id,t.properties;return t}return writeToScreen('<span style="color: red;">ERROR:</span> '+e+" is not a key -> Model Not found"),null},generateMethodCall:function(e){for(var t=0;t<this.apis.length;t++)for(var r=this.apis[t].operations,n=0;n<r.length;n++){var i=r[n];if(i.nickname==e||null==e){var o,a=i.parameters[0],s=this.getModelTemplate(a.type),l=s.properties;s.hasOwnProperty("required")&&(o=s.required);var u="{",g=[],c=!1;for(var S in l)c?u+=",":c=!0,u+="'"+S+"' : "+S,g.push(S);u+="}";var f="{";if(null!=o)for(var E in o)f+="if( "+o[E]+" == undefined)  { \nconsole.log('Required parameter, "+o[E]+" : must be an input'); \nreturn null;} \n";f+="this.websocket.send(JSON.stringify("+u+"))",f+="}",this[i.nickname]=new Function(g,f)}}return!0},generateModelFilling:function(e){for(var t in this.models)if(t==e||null==e){var r,n=this.models[t],i=n.properties;n.hasOwnProperty("required")&&(r=n.required);var o=[],a="";for(var s in a+="{\n",a+="\t var json2send = this.getModelTemplate('"+t+"').properties;\n",i)o.push(s),a+="\t if( "+s+" != undefined)  { \n",a+="\t\t json2send['"+s+"'] = "+s+";  \n",a+="\t }else{\n",a+="\t\t delete json2send."+s+";\n",a+="\t }\n";if(null!=r)for(var l in r)a+="\t if( "+l+" == undefined)  { \n\t\t console.log('Required parameter, "+l+" : must be an input'); \n\t\t return null; \n",a+="\t }\n";a+="\t return json2send;",a+="}",this["fill"+t]=new Function(o,a)}return!0},bindFunctions:function(){},searchMethod:function(e){for(var t=0;t<this.apis.length;t++)for(var r=this.apis[t].operations,n=0;n<r.length;n++){var i=r[n];if(i.nickname==e)return i}},isValidMessage:function(e,t){var r=e;if(r.hasOwnProperty("method"))var n=this.searchMethod(r.method);else{if(null==t)return!1;n=this.searchMethod(t)}for(var i=this.getModelTemplate(n.type),o=!1,a="",s=0;s<i.required.length;s++){if(a=i.required[s],!r.hasOwnProperty(a))return o=!1,console.log("Error processinMessage : "+e+" -> Property : "+a+" is a required field"),o;o=!0}return o},extract:function(e,t){if(this.isValidMessage(t)){for(var r={},n=0;n<e.length;n++)name=e[n],r[name]=t[name];return r}}},wrapper.prototype={methods:{connect:"connect",disconnect:"disconnect",get:"get",set:"set",callAction:"callAction",extract:"extract",eval:"eval",open:"open",step:"step"},post:function(e,t){(null!=e||t.hasOwnProperty("method"))&&(null==e||t.hasOwnProperty("method")||(t.method=e),websocket.send(t))},sync:function(e){null!=e&&e(response)},connect:function(e){this.smartdevice=new _smartDevice(fullData),this.smartdevice.loadApis(),this.smartdevice.loadModels(),this.smartdevice.generateMethodCall()},disconnect:function(e){},get:function(e,t,r){void 0===t||0==t?this.smartdevice.getSensorData("getSensorData",e):this.smartdevice.getSensorData("getSensorData",e,[this.smartdevice.fillConfigurationItem("updateFrequency",2)])},set:function(e,t,r,n){1==e.length?this.smartdevice.sendActuatorData(r,"sendActuatorData","modelVars",[e],[t]):this.smartdevice.sendActuatorData(r,"sendActuatorData","modelVars",e,t)},callAction:function(e,t,r){this.smartdevice.callAction("","callAction","modelMethods",e,t)},extract:function(e,t){var r=JSON.parse(e),n={};if(r.hasOwnProperty("method")){var i=r.method,o={};if("getSensorData"==i)n=["sensorId","responseData"];else if("sendActuatorData"==i)n=["lastMeasured","accessrole","payload","observerMode"];else if("getSensorMetadata"==i)n=["sensors"];else if("getActuatorMetadata"==i)n=["actuators"];else if("getActionsMetadata"==i)n=["sensors"];else if("callAction"==i)n=["method","callerName","nickName","params"];else{if("actionDataResponse"!=i)return void console.log("The method : "+r.method+" is not handled in this wrapper. \nWill be ignored.");n=["method","nickName"]}}return o=this.smartdevice.extract(n,r),this.toEjssReadable(i,o)},eval:function(e,t){},open:function(e,t){},step:function(e,t){},toEjssReadable:function(e,t){if("getSensorData"==e){for(var r={},n=t.responseData.valueNames,i=t.responseData.data,o=0;o<n.length;o++)r[n[o]]=i[o];return r}return"sendActuatorData"==e||("getSensorMetadata"==e||"getActuatorMetadata"==e||"getActionsMetadata"==e||"callAction"==e||"actionDataResponse"==e?t:void console.log("The method : "+e+" is nor handled in this wrapper. \nWill be ignored."))}};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.Tools={showInputDialog:EJSS_INTERFACE.BoxPanel.showInputDialog,showOkDialog:EJSS_INTERFACE.BoxPanel.showOkDialog,showOkCancelDialog:EJSS_INTERFACE.BoxPanel.showOkCancelDialog,downloadText:EJSS_TOOLS.File.downloadText,uploadText:function(e){EJSS_TOOLS.File.uploadText(_model,e)},isMobile:function(){return void 0!==navigator&&navigator.userAgent.match(/iPhone|iPad|iPod|Android|BlackBerry|Opera Mini|IEMobile/i)},isIOS:function(){return/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},isAndroid:function(){return/Android|android/i.test(navigator.userAgent)},isIPad:function(){return/iPad/.test(navigator.userAgent)&&!window.MSStream},isIPhone:function(){return/iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream},isIOSapp:function(){return"undefined"!=typeof parent&&void 0!==parent.device&&"iOS"==parent.device.platform},isAndroidapp:function(){return"undefined"!=typeof parent&&void 0!==parent.device&&"Android"==parent.device.platform},isApp:function(){return _iOSapp||_Androidapp},accelerometer:EJSS_HARDWARE.accelerometer,gyroscope:EJSS_HARDWARE.gyroscope,orientation:EJSS_HARDWARE.orientation,ambientLight:EJSS_HARDWARE.ambientLight,magnometer:EJSS_HARDWARE.magnometer,audio:EJSS_HARDWARE.audio};var EJSS_CORE=EJSS_CORE||{};EJSS_CORE.createView=function(e){var t,r,n,i,o,a,s,l,u={},g={},c={},S=[],f=[],E=[],d=[],p=[],h=[],m=[],A=[],_=[],D=[],I=[],P=[],C=[],T=!0,y=[],R=[],N=!1,v=[],O=[],M=[];function b(e,t){return e.match("^"+t)==t}return u._getTopLevelElement=function(){return t},u._clearAll=function(){t.innerHTML="",g={},c={},S=[],f=[],y=[],E=[],d=[],p=[],h=[],m=[],_=[],D=[],I=[],P=[],C=[],A=[],T=!0},u._setResourcePath=function(e){n=e},u._getResourcePath=function(e,t){if(null==e||e.length<=0)return e;if(b(e,"local:"))return e;if(b(e,"data:"))return e;if(b(e,"blob:"))return e;if(b(e,"http:")||b(e,"https:")||b(e,"ws:"))return e;if("undefined"!=typeof __base64Images){var r=__base64Images[e];if(r)return r}if(i&&!b(e,i)&&"/"==e.charAt(0)?e=i+"images"+e:n&&!b(e,n)&&"/"!=e.charAt(0)&&(e=n+e),t&&b(window.location.protocol,"ibooks")){var o=window.location.pathname;o=o.substring(0,o.lastIndexOf("/")),b(e,"./")&&(e=e.substring(2)),e=window.location.protocol+"://"+window.location.host+"/"+o+"/"+e}return e},u._setLibraryPath=function(e){i=e},u._showDocument=function(e){window.open(u._getResourcePath(e))},u._addDescriptionPage=function(e,t){v[e]=t},u._openDescriptionPage=function(e){var t=v[e];t?window.open(u._getResourcePath(t)):console.log("Desription page not found: "+e)},u._registerVariable=function(e,t){g[e]={getter:null,setter:null,listeners:[],collectors:[],value:t}},u._registerVariables=function(e){for(var t=0;t<e.length;t++)u._registerVariable(e[t])},u._registerAction=function(e){c[e]={action:null}},u._registerActions=function(e){for(var t=0;t<e.length;t++)u._registerAction(e[t])},u._addElement=function(e,t,r,n){var i=EJSS_CORE.promoteToControlElement(e(t,n),u,t);return i.render&&p.push(i),i.touch&&h.push(i),i.dataCollected&&m.push(i),i.reset&&E.push(i),i.initialize&&d.push(i),i.enableEPub&&_.push(i),i.adjustPosition&&D.push(i),t&&(u[t]=i),r&&i.setProperty("Parent",r),i},u._getInitialValue=function(e){var t=g[e];if(void 0!==t)return t.value},u._startUp=function(){u._reset(),u._initValues(),u._initialize(),u._update(),u._render()},u._setRootProperty=function(e,t,r){switch(t){case"RunAlways":e.setRunAlways(r);break;case"OnBlur":u._addOnBlurAction(r);break;case"OnFocus":u._addOnFocusAction(r);break;case"InnerHTML":u._setInnerHTML(r);break;case"OnResize":u._addResizeListener(r);break;case"OnOrientationChange":u._addOrientationChangeListener(r);break;default:console.log("WARNING: View property not registered : "+t)}},u._setReportInteractionMethod=function(e){r=e},u._linkVariable=function(e,t,r,n){var i=g[e];if(i){i.getter=t,i.setter=r,i.value=n;var o=f.indexOf(i);i.getter?i.listeners.length>0&&o<0&&f.push(i):o>=0&&f.splice(o,1),o=y.indexOf(i),i.value?i.listeners.length>0&&o<0&&y.push(i):o>=0&&y.splice(o,1)}else console.log("WARNING: view._setAccessors() - Variable not found : "+e);return i},u._setAction=function(e,t){var r=c[e];return r?r.action=t:console.log("WARNING: view._setAction() - Action not found : "+e),r},u._setReportNeeded=function(e){T=e},u._reset=function(){for(var e=0,t=E.length;e<t;e++)E[e].reset()},u._initValues=function(){for(var e=0,t=y.length;e<t;e++){var r=y[e],n=r.value;if(n)for(var i=r.listeners,o=0,a=i.length;o<a;o++)i[o](n)}},u._initialize=function(){for(var e=0,t=d.length;e<t;e++)d[e].initialize()},u._update=function(){var e,t;for(e=0,t=f.length;e<t;e++)for(var r=f[e],n=r.listeners,i=r.getter(),o=0,a=n.length;o<a;o++)n[o](i);for(e=0,t=S.length;e<t;e++){var s=S[e];s.propertySetter(s.getter())}},u._collectData=function(){var e,t;for(e=0,t=f.length;e<t;e++)for(var r=f[e],n=r.collectors,i=r.getter(),o=0,a=n.length;o<a;o++)n[o](i);for(e=0,t=S.length;e<t;e++){var s=S[e];s.isCollector&&s.propertySetter(s.getter())}for(e=0,t=m.length;e<t;e++)m[e].dataCollected()},u._render=function(){for(var e=0,t=p.length;e<t;e++)p[e].render()},u._touch=function(){for(var e=0,t=h.length;e<t;e++)h[e].touch()},u._enableEPub=function(){if("undefined"!=typeof _isEPub&&_isEPub)for(var e=0,t=_.length;e<t;e++)_[e].enableEPub()},u._addFontResizeListener=function(e){I.push(e)},u._fontResized=function(e,t,r){for(var n=0,i=D.length;n<i;n++)D[n].adjustPosition();if(e)for(var o=0,a=I.length;o<a;o++)I[o](e,t,r)},u._addResizeListener=function(e){P.push(e)},u._resized=function(){for(var e={width:window.innerWidth,height:window.innerHeight},t=0,r=D.length;t<r;t++)D[t].adjustPosition();for(var n=0,i=P.length;n<i;n++)P[n](e)},u._addOrientationChangeListener=function(e){C.push(e)},u._orientationChanged=function(e,t){for(var r={width:window.innerWidth,height:window.innerHeight},n=0,i=D.length;n<i;n++)D[n].adjustPosition();for(var o=0,a=C.length;o<a;o++)C[o](r)},u._readInteractions=function(e,t,r){if(A.length<=0)return!1;for(var n=0;n<A.length;n++){var i=A[n];if(u.isRegInteractions()){var o=i.interaction;o.data=i.data,o.timeStamp=Date.now(),u.isShortRegInteractions()||(o.runCount=e,o.runTime=t,o.isPlaying=r),u.pushRegInteractions(o,!0)}i.data&&i.data.info?i.what(i.data.info,i.data):i.what(i.data),u.isRegInteractions()&&u.pushRegInteractions(o,!1)}return A=[],!0},u._interactionsNumber=function(){return A.length},u._addOnBlurAction=function(e){O.push(e)},u._onBlur=function(){for(var e=0,t=O.length;e<t;e++)O[e]()},u._addOnFocusAction=function(e){M.push(e)},u._onFocus=function(){for(var e=0,t=M.length;e<t;e++)M[e]()},u._setInnerHTML=function(e){void 0===l&&(l=document.createElement("div"),document.body.appendChild(l)),l.innerHTML=e},u._reportInteraction=function(){r&&T&&r()},u._addListener=function(e,t,r){var n=g[e];return n?(n.listeners.indexOf(t)<0&&(n.listeners.push(t),r&&n.collectors.push(t)),n.getter&&f.indexOf(n)<0&&f.push(n),n.value&&y.indexOf(n)<0&&y.push(n)):console.log("WARNING: view._addListener() - Variable not found : "+e),n},u._addUnkownListener=function(e,t,r){for(var n=!1,i=0,o=S.length;i<o;i++){var a=S[i];if(a.propertySetter===t){a.getter=e,n=!0;break}}return n||S.push({getter:e,propertySetter:t,isCollector:r}),n},u._getAction=function(e){var t=c[e];return t||console.log("WARNING: view._getAction() - Action not found : "+e),t},u._addInteraction=function(e,t,n){r?T&&A.push({what:e,data:t,interaction:n}):e(t)},u._format=function(e,t){var r=t.indexOf("."),n=0;return r>=0&&(n=Number(t.length-r-1)),parseFloat(e).toFixed(n)},u.print=function(e){var t=document.getElementsByTagName("textarea");t.length?t[0].innerHTML=e:console.log(e)},u._setVisible=function(e){t.style.display=e?"inherit":"none"},u._switchVisibility=function(){u._setVisible("none"==t.style.display)},u.serialize=function(){var e={};for(key in u)u[key].serialize&&(e[key]=u[key].serialize());return e},u.unserialize=function(e){for(key in e)u[key]&&u[key].unserialize?u[key].unserialize(e[key]):console.log("Impossible unserialize: "+key)},u.registerInteractions=function(e,t){R=[],a=e,s=t,N=!0,o=!1},u.unregisterInteractions=function(){N=!1},u.getRegInteractions=function(e){var t=R.slice();return e&&(R=[]),t},u.clearRegInteractions=function(){R=[]},u.isRegInteractions=function(){return N},u.setShortRegInteractions=function(e){o=e},u.isShortRegInteractions=function(){return o},u.pushRegInteractions=function(e,t){t?a?a.send(JSON.stringify(e)):s?s(e,t):R.push(e):s&&s(e,t)},t="string"==typeof e?u[e]=document.getElementById(e):e,u},EJSS_CORE.promoteToControlElement=function(e,t,r){r=r||"unnamed";var n=null,i={},o={};return e.getView=function(){return t},e.setName=function(e){r=e},e.getName=function(){return r},e.getResourcePath=function(e){return t._getResourcePath(e)},e.setDataObject=function(e){n=e},e.getDataObject=function(e){return n},e.registerProperty=function(t,r,n){return i[t]={setter:r,getter:n,variable:null,variableSetter:null},e},e.registerAction=function(t,r,n,i){return o[t]={action:null,helper:r,process:n},i&&e.setAction(t,i),e},e.setProperty=function(t,r){if(o[t])return e.setAction(t,r);var n=i[t];return n?n.setter(r):console.log("WARNING: ControlElement setProperty() - Property not registered : "+t+" for element : "+e.getName()),e},e.setProperties=function(t){for(var r in t)e.setProperty(r,t[r]);return e},e.linkProperty=function(r,n,o){var a=i[r];if(!a)return console.log("WARNING: ControlElement linkProperty() - Element property not registered : "+r+" for element : "+e.getName()),e;if("string"==typeof n){var s=t._addListener(n,a.setter,e.dataCollected);if(!s)return console.log("WARNING: ControlElement linkProperty() - element : "+e.getName()+" - property :"+r+" - View variable not registered : "+n),e;"InputOnly"===o||(a.variable=s),a.variableSetter=null}else t._addUnkownListener(n,a.setter,e.dataCollected),a.variableSetter=o,a.variable=null;return e},e.linkProperties=function(t){for(var r in t)e.linkProperty(r,t[r]);return e},e.setAction=function(r,n){var i=o[r];if(!i)return console.log("WARNING: ControlElement setAction() - action not registered : "+r+" for element : "+e.getName),e;if("string"==typeof n){var a=t._getAction(n);if(!a)return console.log("WARNING: ControlElement setAction() - element : "+e.getName()+" - View action not registered : "+n),e;i.action=a}else i.action={action:n};return e},e.setActions=function(t){for(var r in t)e.setAction(r,t[r]);return e},e.invokeAction=function(r){var n={};t.isRegInteractions()&&(n=t.isShortRegInteractions()?{action:r,element:e.getName()}:{action:r,element:e.getName(),timeStamp:Date.now()});var i=o[r];if(i&&(i.process&&t._addInteraction(i.process,null,n),i.action)){var a=i.helper?i.helper():null;t._addInteraction(i.action.action,a,n)}return e},e.invokeImmediateAction=function(t){var r=o[t];if(r&&(r.process&&r.process(null),r.action)){var n=r.helper?r.helper():null;r.action.action(n)}return e},e.propertiesChanged=function(){for(var t=0,r=arguments.length;t<r;t++)e.propertyChanged(arguments[t]);return e},e.propertyChanged=function(r,n){var o={};t.isRegInteractions()&&(o=t.isShortRegInteractions()?{property:r,element:e.getName()}:{property:r,element:e.getName(),timeStamp:Date.now()});var a=i[r];if(a){var s=a.variableSetter;if(s||a.variable&&(s=a.variable.setter),s||a.setter&&(s=a.setter),s){var l=void 0!==n?n:a.getter();t._addInteraction(s,l,o)}}return e},e.immediatePropertyChanged=function(t,r){var n=i[t];if(n){var o=n.variableSetter;if(o||n.variable&&(o=n.variable.setter),o||n.setter&&(o=n.setter),o)o(void 0!==r?r:n.getter())}return e},e.reportInteractions=function(r,n){var i,o;if(r)for(i=0,o=r.length;i<o;i++)e.invokeAction(r[i]);if(n)for(i=0,o=n.length;i<o;i++)e.propertiesChanged(n[i]);return t._interactionsNumber()>0&&t._reportInteraction(),e},e.getProperty=function(e,t){var r=i[e];if(r&&r.getter)return r.getter()},e.getProperties=function(){return i},e.registerProperty("name",e.setName,e.getName),e.registerProperties&&e.registerProperties(e),e};